(function(){"use strict";const mt=[1,5,2,2.5,4,3],q=[.001,.002,.005,.01,.02,.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100,150,200,300,500,750,1e3];function ot(t,n){return n?Ht(t):Gt(t)}function Ht(t){if(t[0]<=0||t[1]<=0)return[.1,10];if(t[0]>=t[1])return t;let n=q[0];for(const o of q)if(o<=t[0])n=o;else break;t[0]<q[0]&&(n=Math.pow(10,Math.floor(Math.log10(t[0]))));let e=q[q.length-1];for(let o=q.length-1;o>=0&&q[o]>=t[1];o--)e=q[o];return t[1]>q[q.length-1]&&(e=Math.pow(10,Math.ceil(Math.log10(t[1])))),[n,e]}function Gt(t){const n=t[1]-t[0];if(n===0)return t;if(n<0)return[t[1],t[0]];const e=Math.pow(10,Math.floor(Math.log10(n)));let o=e,r=1/0;for(const d of mt)for(const l of[.1,1,10]){const i=d*e*l;if(i<=0)continue;const s=Math.floor(t[0]/i)*i,h=(Math.ceil(t[1]/i)*i-s)/n-1;h>=0&&h<r&&(r=h,o=i)}const a=Math.floor(t[0]/o)*o,c=Math.ceil(t[1]/o)*o;return[Math.round(a*1e10)/1e10,Math.round(c*1e10)/1e10]}function Z(t,n,e,o,r=!1){if(t&&e in t){const a=t[e];if(typeof a=="number"&&Number.isFinite(a)&&(!r||a>0))return a}return e===o&&n!=null&&Number.isFinite(n)&&(!r||n>0)?n:null}const kt=20;function vt(t){const{rows:n,config:e,scale:o,nullValue:r,forestWidth:a,pointSize:c,effects:d=[]}=t,l=Pt(n,e,o,r,d),i=Ct(l,e,o,a,c),s=yt(l,e,o,r);return{axisLimits:l,plotRegion:i,ticks:s}}function Pt(t,n,e,o,r=[]){const a=n.rangeMin!=null,c=n.rangeMax!=null;if(a&&c)return[n.rangeMin,n.rangeMax];const d=[],l=e==="log";for(const T of t){const H=Z(T.metadata,T.point,"point","point",l);H!=null&&d.push(H);for(const D of r){const b=Z(T.metadata,T.point,D.pointCol,"point",l);b!=null&&d.push(b)}}if(d.length===0)return e==="log"?[.1,10]:[-1,1];let i=Math.min(...d),s=Math.max(...d);(n.includeNull??!0)&&(i=Math.min(i,o),s=Math.max(s,o));const u=i,h=s;let m;if(l){const T=Math.max(i,.001),H=Math.max(s,.001);m=Math.log(H)-Math.log(T)}else m=s-i;if(m===0||!Number.isFinite(m)){const T=d[0];if(l)return ot([T/2,T*2],!0);{const H=Math.max(1,Math.abs(T)*.1);return ot([T-H,T+H],!1)}}const[E,A]=ot([i,s],l),$=n.ciClipFactor??3;let L=E,S=A;const _=[],F=[];for(const T of t){const H=Z(T.metadata,T.lower,"lower","lower",l);H!=null&&_.push(H);const D=Z(T.metadata,T.upper,"upper","upper",l);D!=null&&F.push(D);for(const b of r){const I=Z(T.metadata,T.lower,b.lowerCol,"lower",l);I!=null&&_.push(I);const W=Z(T.metadata,T.upper,b.upperCol,"upper",l);W!=null&&F.push(W)}}let g,M;if(l)g=L/$,M=S*$;else{const T=S-L;g=L-T*$,M=S+T*$}let p=!1,x=!1;for(const T of _)T>=g?L=Math.min(L,T):p=!0;for(const T of F)T<=M?S=Math.max(S,T):x=!0;if(p&&(L=Math.min(L,g)),x&&(S=Math.max(S,M)),n.symmetric===!0&&!a&&!c)if(e==="log"){const T=Math.log(o),H=Math.max(Math.abs(Math.log(Math.max(u,.001))-T),Math.abs(Math.log(h)-T));L=Math.exp(T-H),S=Math.exp(T+H)}else{const T=Math.max(Math.abs(u-o),Math.abs(h-o));L=o-T,S=o+T}let N=a?n.rangeMin:L,w=c?n.rangeMax:S;return ot([N,w],e==="log")}function Ct(t,n,e,o,r){if(!(n.markerMargin??!0)||o<=0)return t;const c=o-2*kt;if(c<=0)return t;if(e==="log"){const i=Math.log(Math.max(t[0],.001)),s=Math.log(Math.max(t[1],.001)),f=s-i,u=r/2*(f/c),h=Math.min(u,.5);return[Math.exp(i-h),Math.exp(s+h)]}const d=t[1]-t[0],l=r/2*(d/c);return[t[0]-l,t[1]+l]}function yt(t,n,e,o){const[r,a]=t,c=o>=r&&o<=a,d=(n.nullTick??!0)&&c;if(n.tickValues&&n.tickValues.length>0){let s=n.tickValues.filter(f=>f>=r&&f<=a);return d&&!s.includes(o)&&(s=[...s,o].sort((f,u)=>f-u)),s}const l=n.tickCount??5;let i=e==="log"?Bt(t,l):Rt(t,l);return d&&!i.includes(o)&&(i=[...i,o].sort((s,f)=>s-f)),i}function Rt(t,n){const[e,o]=t,r=o-e;if(r===0)return[e];const a=r/Math.max(n-1,1),c=Math.pow(10,Math.floor(Math.log10(a)));let d=c,l=1/0;for(const f of mt){const u=f*c,h=Math.floor(r/u)+1,m=Math.abs(h-n);m<l&&(l=m,d=u);const E=f*c/10;if(E>0){const A=Math.floor(r/E)+1,$=Math.abs(A-n);$<l&&(l=$,d=E)}}const i=Math.ceil(e/d)*d,s=[];for(let f=i;f<=o+d*.001;f+=d){const u=Math.round(f*1e10)/1e10;u>=e&&u<=o&&s.push(u)}return s.length<2&&(s.includes(e)||s.unshift(e),s.includes(o)||s.push(o)),s}function Bt(t,n){const[e,o]=t,a=[.01,.02,.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100,150,200,500,1e3].filter(l=>l>=e&&l<=o);if(a.length<=n)return a;const c=[1,.1,10,100,.5,2,5,.2,.25,1.5,3,4,20,50],d=[];for(const l of c)a.includes(l)&&d.length<n&&d.push(l);if(d.length<n){const l=a.filter(s=>!d.includes(s)),i=Math.max(1,Math.floor(l.length/(n-d.length)));for(let s=0;s<l.length&&d.length<n;s+=i)d.push(l[s])}return d.sort((l,i)=>l-i)}function Ut(t){var o,r;const n=((o=t==null?void 0:t.shapes)==null?void 0:o.lineWidth)??1.5,e=((r=t==null?void 0:t.colors)==null?void 0:r.intervalLine)??"#475569";return{width:Math.max(4,Math.round(n*3)),height:Math.max(6,Math.round(n*4)),color:e,opacity:1}}function $t(t,n,e,o){const{width:r,height:a}=o,c=a/2;return t==="left"?`M ${n} ${e} L ${n+r} ${e-c} L ${n+r} ${e+c} Z`:`M ${n} ${e} L ${n-r} ${e-c} L ${n-r} ${e+c} Z`}const Xt=.06,xt=.04;function Ot(t){return t<=0?0:xt+t*xt}const ut={RENDERING_BUFFER:4},K={FONT_SCALE:.8,PADDING:4,GAP:6},X={DEFAULT_LABEL_WIDTH:200,DEFAULT_COLUMN_WIDTH:100,AXIS_HEIGHT:32,AXIS_LABEL_HEIGHT:20,BOTTOM_MARGIN:16,MIN_FOREST_WIDTH:200,DEFAULT_WIDTH:800,COLUMN_GAP:16},V={TITLE_HEIGHT:28,SUBTITLE_HEIGHT:20,CAPTION_HEIGHT:16,FOOTNOTE_HEIGHT:14,DEFAULT_FONT_SIZE:14,REM_BASE:16,TEXT_BASELINE_ADJUSTMENT:1/3},G={INDENT_PER_LEVEL:12,TEXT_PADDING:10,DEFAULT_TICK_COUNT:5,AXIS_LABEL_PADDING:30},Mt={GROUP_HEADER_HEIGHT_MULTIPLIER:1.3,OVERALL_ROW_HEIGHT_MULTIPLIER:1.5},tt={MIN:60,MAX:600,LABEL_MAX:400,VISUAL_MIN:{sparkline:92,bar:100,stars:84,range:84,badge:74}},rt={CHEVRON_WIDTH:12,GAP:6,SAFETY_MARGIN:8},Tt={SPACING:6};function zt(t,n){return n<=1?0:-((n-1)*Tt.SPACING)/2+t*Tt.SPACING}function it(t,n){const e=t.split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,n),e.join(".")}function ft(t){const n=Math.abs(t),e=t<0?"-":"";if(n>=1e12)throw new Error(`Cannot abbreviate value >= 1 trillion: ${t}`);if(n>=1e9){const o=n/1e9;return e+dt(o)+"B"}if(n>=1e6){const o=n/1e6;return e+dt(o)+"M"}if(n>=1e3){const o=n/1e3;return e+dt(o)+"K"}return e+Math.round(n).toString()}function dt(t){const n=Math.round(t*10)/10;return n===Math.floor(n)?n.toFixed(0):n.toFixed(1)}const Vt={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","-":"⁻","+":"⁺"};function Yt(t){return t.split("").map(n=>Vt[n]??n).join("")}function at(t,n){var d,l,i,s,f;if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";if(n!=null&&n.percent){const{decimals:u,digits:h,multiply:m=!0,symbol:E=!0}=n.percent,A=m?t*100:t,$=h!=null?A.toPrecision(h):A.toFixed(u??1);return E?`${$}%`:$}if(((d=n==null?void 0:n.numeric)==null?void 0:d.abbreviate)&&Math.abs(t)>=1e3)return ft(t);const o=(l=n==null?void 0:n.numeric)==null?void 0:l.digits;if(o!=null){const u=t.toPrecision(o),h=(i=n==null?void 0:n.numeric)==null?void 0:i.thousandsSep;return h&&typeof h=="string"?it(u,h):u}const r=(s=n==null?void 0:n.numeric)==null?void 0:s.decimals,a=(f=n==null?void 0:n.numeric)==null?void 0:f.thousandsSep;let c;return r!==void 0?c=t.toFixed(r):Number.isInteger(t)||Math.abs(t-Math.round(t))<1e-4?c=Math.round(t).toString():c=t.toFixed(2),a&&typeof a=="string"&&(c=it(c,a)),c}function bt(t,n){const{eventsField:e,nField:o,separator:r="/",showPct:a=!1,thousandsSep:c,abbreviate:d}=n.events,l=t.metadata[e],i=t.metadata[o];if(l==null||i===void 0||i===null)return n.naText??"";const s=Number(l),f=Number(i);let u,h;d&&(s>=1e3||f>=1e3)?(u=s>=1e3?ft(s):String(s),h=f>=1e3?ft(f):String(f)):(u=String(s),h=String(f),c&&typeof c=="string"&&(u=it(u,c),h=it(h,c)));let m=`${u}${r}${h}`;if(a&&f>0){const E=(s/f*100).toFixed(1);m+=` (${E}%)`}return m}function Et(t,n,e,o){var d,l,i;if(t==null||Number.isNaN(t))return"";const r=((d=o==null?void 0:o.interval)==null?void 0:d.decimals)??2,a=((l=o==null?void 0:o.interval)==null?void 0:l.sep)??" ",c=(i=o==null?void 0:o.interval)==null?void 0:i.impreciseThreshold;return n==null||e===void 0||e===null||Number.isNaN(n)||Number.isNaN(e)?t.toFixed(r):c!=null&&n>0&&e/n>c?"—":`${t.toFixed(r)}${a}(${n.toFixed(r)}, ${e.toFixed(r)})`}function It(t,n){if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";const e=n==null?void 0:n.pvalue,o=(e==null?void 0:e.digits)??2,r=(e==null?void 0:e.expThreshold)??.001,a=(e==null?void 0:e.abbrevThreshold)??null,c=(e==null?void 0:e.format)??"auto",d=(e==null?void 0:e.stars)??!1,l=(e==null?void 0:e.thresholds)??[.05,.01,.001];let i="";if(d&&(t<l[2]?i="***":t<l[1]?i="**":t<l[0]&&(i="*")),a!==null&&t<a)return`<${a}${i}`;if(c==="scientific"||c==="auto"&&t<r){const f=Math.floor(Math.log10(t));return`${(t/Math.pow(10,f)).toPrecision(o)}×10${Yt(f.toString())}${i}`}let s;return t>=.1?s=t.toFixed(o):t>=.01?s=t.toFixed(o+1):s=t.toFixed(o+2),`${s}${i}`}function jt(t,n){var a,c,d,l;const{type:e,field:o,options:r}=n;switch(e){case"interval":{const i=(a=r==null?void 0:r.interval)!=null&&a.point?t.metadata[r.interval.point]:t.point,s=(c=r==null?void 0:r.interval)!=null&&c.lower?t.metadata[r.interval.lower]:t.lower,f=(d=r==null?void 0:r.interval)!=null&&d.upper?t.metadata[r.interval.upper]:t.upper;return Et(i,s,f,r)}case"custom":return r!=null&&r.events?bt(t,r):String(t.metadata[o]??"");case"pvalue":return It(t.metadata[o],r);case"numeric":return at(t.metadata[o],r);case"percent":return at(t.metadata[o],r);case"sparkline":case"icon":case"stars":case"img":case"range":return"";case"badge":{const i=t.metadata[o];return i==null?"":`  ${String(i)}  `}case"bar":{if(((l=r==null?void 0:r.bar)==null?void 0:l.showLabel)===!1)return"";const i=t.metadata[o];return i==null?"":i>=100?i.toFixed(0):i>=10?i.toFixed(1):i.toFixed(2)}case"text":default:return String(t.metadata[o]??"")}}function Y(t,n){const e="⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻";let o=0;for(const r of t)e.includes(r)?o+=n*.3:"il1.,;:|!()[]{}' ".includes(r)?o+=n*.35:"×−".includes(r)?o+=n*.5:"mwMW@%".includes(r)?o+=n*.85:r>="0"&&r<="9"?o+=n*.6:o+=n*.55;return o}function Jt(t,n){var i,s;const e=new Map,o=j(t.theme.typography.fontSizeBase),r=t.theme.typography.headerFontScale??1.05,a=o*r,c=t.data.rows,d=(t.theme.spacing.cellPaddingX??10)*2,l=(t.theme.spacing.groupPadding??8)*2;for(const f of n){if(f.width!=="auto"&&f.width!==null&&f.width!==void 0)continue;let u=0;f.header&&(u=Math.max(u,Y(f.header,a)));for(const E of c){if(((i=E.style)==null?void 0:i.type)==="header"||((s=E.style)==null?void 0:s.type)==="spacer")continue;const A=jt(E,f);A&&(u=Math.max(u,Y(A,o)))}const h=tt.VISUAL_MIN[f.type]??tt.MIN,m=Math.ceil(u+d+ut.RENDERING_BUFFER);e.set(f.id,Math.min(tt.MAX,Math.max(h,m)))}return qt(t.columns,e,a,l,ut.RENDERING_BUFFER),e}function qt(t,n,e,o,r){function a(l){return l.isGroup?l.columns.flatMap(a):[l]}function c(l){const i=n.get(l.id);return i!==void 0?i:typeof l.width=="number"?l.width:tt.MIN}function d(l){if(l.isGroup){for(const i of l.columns)d(i);if(l.header){const i=Y(l.header,e)+o+r,s=a(l),f=s.reduce((u,h)=>u+c(h),0);if(i>f&&s.length>0){const u=Math.ceil((i-f)/s.length);for(const h of s)n.set(h.id,c(h)+u)}}}}for(const l of t)d(l)}function At(t){var l,i;const n=j(t.theme.typography.fontSizeBase),e=(t.theme.spacing.cellPaddingX??10)*2;let o=0;const r=new Map,a=Array.isArray(t.data.groups)?t.data.groups:[];for(const s of a)r.set(s.id,s.depth);const c=s=>s?(r.get(s)??0)+1:0;t.data.labelHeader&&(o=Math.max(o,Y(t.data.labelHeader,n)));for(const s of t.data.rows)if(s.label){const f=c(s.groupId),u=((l=s.style)==null?void 0:l.indent)??0,m=(f+u)*G.INDENT_PER_LEVEL;let E=Y(s.label,n)+m;if((i=s.style)!=null&&i.badge){const A=String(s.style.badge),$=n*K.FONT_SCALE,S=Y(A,$)+K.PADDING*2;E+=K.GAP+S}o=Math.max(o,E)}for(const s of a)if(s.label){const f=s.depth*G.INDENT_PER_LEVEL,u=Y(s.label,n),m=`(${countAllDescendantRows(s.id)})`,E=n*.75,A=Y(m,E),$=f+rt.CHEVRON_WIDTH+rt.GAP+u+rt.GAP+A+rt.SAFETY_MARGIN;o=Math.max(o,$)}const d=Math.ceil(o+e+ut.RENDERING_BUFFER);return Math.min(tt.LABEL_MAX,Math.max(tt.MIN,d))}function ht(t,n){const e=n.get(t.id);return e!==void 0?e:typeof t.width=="number"?t.width:X.DEFAULT_COLUMN_WIDTH}function Zt(t,n){var R,k,v,B,z;const e=t.theme,o=e.spacing.rowHeight,r=e.spacing.padding,a=Array.isArray(t.columns)?t.columns:[],c=lt(a,"left"),d=lt(a,"right"),i=pt(c)||pt(d)?e.spacing.headerHeight*Mt.GROUP_HEADER_HEIGHT_MULTIPLIER:e.spacing.headerHeight,s=!!((R=t.labels)!=null&&R.title),f=!!((k=t.labels)!=null&&k.subtitle),u=!!((v=t.labels)!=null&&v.caption),h=!!((B=t.labels)!=null&&B.footnote),m=s?V.TITLE_HEIGHT:0,E=f?V.SUBTITLE_HEIGHT:0,A=m+E+(s||f?r:0),$=u?V.CAPTION_HEIGHT:0,L=h?V.FOOTNOTE_HEIGHT:0,S=$+L+(u||h?r:0),_=_t(t),F=!!t.data.overall;let g=0;for(const C of _){const U=C.type==="data"&&((z=C.row.style)==null?void 0:z.type)==="spacer";g+=U?o/2:o}F&&(g+=o*Mt.OVERALL_ROW_HEIGHT_MULTIPLIER);const M=st(a,"left"),p=st(a,"right"),x=[...M,...p];let y,N;if(n.columnWidths){y=new Map;for(const[C,U]of Object.entries(n.columnWidths))C!=="__label__"&&y.set(C,U);N=n.columnWidths.__label__??At(t)}else y=Jt(t,x),N=At(t);const w=N+M.reduce((C,U)=>C+ht(U,y),0),T=p.reduce((C,U)=>C+ht(U,y),0),H=n.width??X.DEFAULT_WIDTH,D=t.data.includeForest,b=w+T;let I;if(!D)I=0;else if(typeof n.forestWidth=="number")I=n.forestWidth;else if(typeof t.layout.plotWidth=="number")I=t.layout.plotWidth;else{const C=H-b-X.COLUMN_GAP*2-r*2;I=Math.max(C,X.MIN_FOREST_WIDTH)}const W=r*2+b+I+X.COLUMN_GAP*2,P=Math.max(n.width??H,W),J=A+r+i+g+X.AXIS_HEIGHT+X.AXIS_LABEL_HEIGHT+S+X.BOTTOM_MARGIN;return{totalWidth:P,totalHeight:n.height??J,tableWidth:w+T,forestWidth:I,headerHeight:i,rowHeight:o,plotHeight:g,axisHeight:X.AXIS_HEIGHT,nullValue:t.data.nullValue,summaryYPosition:g-o,showOverallSummary:F,headerTextHeight:A,footerTextHeight:S,titleY:r+V.TITLE_HEIGHT-8,subtitleY:r+m+V.SUBTITLE_HEIGHT-4,mainY:A+r,footerY:A+r+i+g+X.AXIS_HEIGHT+X.AXIS_LABEL_HEIGHT+r,autoWidths:y,labelWidth:N}}function _t(t){var f;const n=t.data.rows,e=Array.isArray(t.data.groups)?t.data.groups:[];if(e.length===0)return n.map(u=>({type:"data",row:u,depth:0}));const o=new Map;for(const u of e)o.set(u.id,u);const r=new Map;for(const u of n){const h=u.groupId??null;r.has(h)||r.set(h,[]),r.get(h).push(u)}const a=new Set;for(const u of r.keys()){if(!u)continue;let h=u;for(;h;)a.add(h),h=(f=o.get(h))==null?void 0:f.parentId}function c(u){return e.filter(h=>(h.parentId??null)===u&&a.has(h.id))}function d(u){if(!u)return 0;const h=o.get(u);return h?h.depth+1:0}function l(u){var m;let h=((m=r.get(u))==null?void 0:m.length)??0;for(const E of c(u))h+=l(E.id);return h}const i=[];function s(u){if(u){const m=o.get(u);if(!m)return;const E=l(u);i.push({type:"group_header",groupId:m.id,label:m.label,depth:m.depth,rowCount:E})}for(const m of c(u))s(m.id);const h=r.get(u)??[];for(const m of h)i.push({type:"data",row:m,depth:d(m.groupId)})}return s(null),i}function Nt(t){const n=[];for(const e of t)e.isGroup?n.push(...Nt(e.columns)):n.push(e);return n}function st(t,n){const e=[];for(const o of t)o.position===n&&(o.isGroup?e.push(...Nt(o.columns)):e.push(o));return e}function lt(t,n){return t.filter(e=>e.position===n)}function pt(t){return t.some(n=>n.isGroup)}function j(t){return t.endsWith("rem")?parseFloat(t)*V.REM_BASE:t.endsWith("px")?parseFloat(t):V.DEFAULT_FONT_SIZE}function ct(t,n,e){return e==="right"?{textX:t+n-G.TEXT_PADDING,anchor:"end"}:e==="center"?{textX:t+n/2,anchor:"middle"}:{textX:t+G.TEXT_PADDING,anchor:"start"}}function O(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function gt(t,n,e,o=0){const r=n-o*2;if(Y(t,e)<=r)return t;const c="…",d=e*.55;let l=0,i=t.length;for(;l<i;){const s=Math.ceil((l+i)/2),f=t.slice(0,s);Y(f,e)+d<=r?l=s:i=s-1}return l===0?c:t.slice(0,l)+c}function Kt(t){return Math.abs(t)<.01?"0":Math.abs(t)>=100?t.toFixed(0):Math.abs(t)>=10?t.toFixed(1):t.toFixed(2)}function St(t,n){const[e,o]=t,[r,a]=n,c=(a-r)/(o-e),d=l=>r+(l-e)*c;return d.domain=()=>t,d.range=()=>n,d.ticks=l=>{const i=(o-e)/(l-1),s=[];for(let f=0;f<l;f++)s.push(e+i*f);return s},d}function Dt(t,n){const[e,o]=t.map(s=>Math.max(s,.001)),[r,a]=n,c=Math.log10(e),d=Math.log10(o),l=(a-r)/(d-c),i=s=>{const f=Math.log10(Math.max(s,.001));return r+(f-c)*l};return i.domain=()=>[e,o],i.range=()=>n,i.ticks=s=>{const f=[],u=Math.floor(Math.log10(e)),h=Math.ceil(Math.log10(o));for(let m=u;m<=h;m++){const E=Math.pow(10,m);for(const A of[1,2,5]){const $=E*A;$>=e&&$<=o&&f.push($)}}return f.length>0?f:[e,o]},i}function Qt(t,n,e){const o=t.data.scale==="log",r=G.AXIS_LABEL_PADDING,a=r,c=Math.max(n-r,a+50);if(e!=null&&e.xDomain){const f=e.xDomain,u=e.clipBounds??f,h=yt(u,t.theme.axis,t.data.scale,t.data.nullValue);return o?{scale:Dt([Math.max(f[0],.01),Math.max(f[1],.02)],[a,c]),clipBounds:u,ticks:h}:{scale:St(f,[a,c]),clipBounds:u,ticks:h}}const d=vt({rows:t.data.rows,config:t.theme.axis,scale:t.data.scale,nullValue:t.data.nullValue,forestWidth:n,pointSize:t.theme.shapes.pointSize,effects:t.data.effects}),{plotRegion:l,axisLimits:i,ticks:s}=d;return o?{scale:Dt([Math.max(l[0],.01),Math.max(l[1],.02)],[a,c]),clipBounds:i,ticks:s}:{scale:St(l,[a,c]),clipBounds:i,ticks:s}}function tn(t,n,e){var a,c;const o=[],r=e.spacing.padding;if((a=t.labels)!=null&&a.title){const d=j(e.typography.fontSizeLg);o.push(`<text x="${r}" y="${n.titleY}"
      font-family="${e.typography.fontFamily}"
      font-size="${d}px"
      font-weight="${e.typography.fontWeightBold}"
      fill="${e.colors.foreground}">${O(t.labels.title)}</text>`)}if((c=t.labels)!=null&&c.subtitle){const d=j(e.typography.fontSizeBase);o.push(`<text x="${r}" y="${n.subtitleY}"
      font-family="${e.typography.fontFamily}"
      font-size="${d}px"
      fill="${e.colors.secondary}">${O(t.labels.subtitle)}</text>`)}return o.join(`
`)}function nn(t,n,e){var c,d;const o=[],r=e.spacing.padding;let a=n.footerY;if((c=t.labels)!=null&&c.caption){const l=j(e.typography.fontSizeSm);o.push(`<text x="${r}" y="${a}"
      font-family="${e.typography.fontFamily}"
      font-size="${l}px"
      fill="${e.colors.secondary}">${O(t.labels.caption)}</text>`),a+=V.CAPTION_HEIGHT}if((d=t.labels)!=null&&d.footnote){const l=j(e.typography.fontSizeSm);o.push(`<text x="${r}" y="${a}"
      font-family="${e.typography.fontFamily}"
      font-size="${l}px"
      font-style="italic"
      fill="${e.colors.muted}">${O(t.labels.footnote)}</text>`)}return o.join(`
`)}function wt(t,n,e,o,r,a,c,d,l){const i=[],s=j(a.typography.fontSizeBase),f=a.typography.headerFontScale??1.05,u=s*f,h=a.typography.fontWeightMedium,m=a.typography.fontWeightBold,E=pt(t),A=d??X.DEFAULT_LABEL_WIDTH,$=_=>{if(l){const F=l.get(_.id);if(F!==void 0)return F}return typeof _.width=="number"?_.width:X.DEFAULT_COLUMN_WIDTH},L=_=>_.isGroup?_.columns.reduce((F,g)=>F+L(g),0):$(_),S=(_,F)=>_+F/2+u*V.TEXT_BASELINE_ADJUSTMENT;if(E){const _=r/2,F=r/2;let g=e;c&&(i.push(`<text x="${g+G.TEXT_PADDING}" y="${S(o,r)}"
        font-family="${a.typography.fontFamily}"
        font-size="${u}px"
        font-weight="${h}"
        fill="${a.colors.foreground}">${O(c)}</text>`),g+=A);const M=[];for(const p of t)if(p.isGroup){const x=L(p),y=g+x/2;i.push(`<text x="${y}" y="${S(o,_)}"
          font-family="${a.typography.fontFamily}"
          font-size="${u}px"
          font-weight="${m}"
          text-anchor="middle"
          fill="${a.colors.foreground}">${O(p.header)}</text>`),M.push({x1:g,x2:g+x}),g+=x}else{const x=$(p),y=p.headerAlign??p.align,{textX:N,anchor:w}=ct(g,x,y),T=gt(p.header,x,u,G.TEXT_PADDING);i.push(`<text x="${N}" y="${S(o,r)}"
          font-family="${a.typography.fontFamily}"
          font-size="${u}px"
          font-weight="${h}"
          text-anchor="${w}"
          fill="${a.colors.foreground}">${O(T)}</text>`),g+=x}for(const p of M)i.push(`<line x1="${p.x1}" x2="${p.x2}"
        y1="${o+_}" y2="${o+_}"
        stroke="${a.colors.border}" stroke-width="1" opacity="0.5"/>`);g=e+(c?A:0);for(const p of t)if(p.isGroup){for(const x of p.columns)if(!x.isGroup){const y=$(x),N=x.headerAlign??x.align,{textX:w,anchor:T}=ct(g,y,N);i.push(`<text x="${w}" y="${S(o+_,F)}"
              font-family="${a.typography.fontFamily}"
              font-size="${u}px"
              font-weight="${h}"
              text-anchor="${T}"
              fill="${a.colors.foreground}">${O(x.header)}</text>`),g+=y}}else{const x=$(p);g+=x}}else{let _=e;c&&(i.push(`<text x="${_+G.TEXT_PADDING}" y="${S(o,r)}"
        font-family="${a.typography.fontFamily}"
        font-size="${u}px"
        font-weight="${h}"
        fill="${a.colors.foreground}">${O(c)}</text>`),_+=A);for(const F of n){const g=$(F),M=F.headerAlign??F.align,{textX:p,anchor:x}=ct(_,g,M),y=gt(F.header,g,u,G.TEXT_PADDING);i.push(`<text x="${p}" y="${S(o,r)}"
        font-family="${a.typography.fontFamily}"
        font-size="${u}px"
        font-weight="${h}"
        text-anchor="${x}"
        fill="${a.colors.foreground}">${O(y)}</text>`),_+=g}}return i.join(`
`)}function en(t,n,e,o,r,a,c){const d=[],l=n+1,i=c.groupHeaders;let s,f,u,h,m;if(l===1?(s=j((i==null?void 0:i.level1FontSize)??c.typography.fontSizeBase),f=(i==null?void 0:i.level1FontWeight)??c.typography.fontWeightBold,u=(i==null?void 0:i.level1Italic)??!1,h=(i==null?void 0:i.level1Background)??null,m=(i==null?void 0:i.level1BorderBottom)??!1):l===2?(s=j((i==null?void 0:i.level2FontSize)??c.typography.fontSizeBase),f=(i==null?void 0:i.level2FontWeight)??c.typography.fontWeightMedium,u=(i==null?void 0:i.level2Italic)??!0,h=(i==null?void 0:i.level2Background)??null,m=(i==null?void 0:i.level2BorderBottom)??!1):(s=j((i==null?void 0:i.level3FontSize)??c.typography.fontSizeBase),f=(i==null?void 0:i.level3FontWeight)??c.typography.fontWeightNormal,u=(i==null?void 0:i.level3Italic)??!1,h=(i==null?void 0:i.level3Background)??null,m=(i==null?void 0:i.level3BorderBottom)??!1),!h){const L=c.colors.primary,S=l===1?.15:l===2?.1:.06,_=L.replace("#",""),F=parseInt(_.substring(0,2),16),g=parseInt(_.substring(2,4),16),M=parseInt(_.substring(4,6),16);h=`rgba(${F}, ${g}, ${M}, ${S})`}const E=o+r/2+s*V.TEXT_BASELINE_ADJUSTMENT,A=n*((i==null?void 0:i.indentPerLevel)??G.INDENT_PER_LEVEL);d.push(`<rect x="${e}" y="${o}"
    width="${a}" height="${r}"
    fill="${h}"/>`),m&&d.push(`<line x1="${e}" x2="${e+a}" y1="${o+r}" y2="${o+r}"
      stroke="${c.colors.border}" stroke-width="1" opacity="0.5"/>`);const $=u?' font-style="italic"':"";return d.push(`<text x="${e+G.TEXT_PADDING+A}" y="${E}"
    font-family="${c.typography.fontFamily}"
    font-size="${s}px"
    font-weight="${f}"${$}
    fill="${c.colors.foreground}">${O(t)}</text>`),d.join(`
`)}function Wt(t,n){const e=new Map;for(const o of n)if(o.type==="bar"){let r=0;for(const a of t){const c=a.metadata[o.field];typeof c=="number"&&c>r&&(r=c)}e.set(o.field,r>0?r:1)}return e}function Lt(t,n,e,o,r,a,c,d=X.DEFAULT_LABEL_WIDTH,l=0,i,s){var A,$,L,S,_,F,g,M,p,x,y,N,w,T,H,D;const f=[],u=j(a.typography.fontSizeBase),h=o+r/2+u*V.TEXT_BASELINE_ADJUSTMENT;let m=e;const E=b=>{if(s){const I=s.get(b.id);if(I!==void 0)return I}return typeof b.width=="number"?b.width:X.DEFAULT_COLUMN_WIDTH};if(c){const b=l*G.INDENT_PER_LEVEL+(((A=t.style)==null?void 0:A.indent)??0)*G.INDENT_PER_LEVEL,I=($=t.style)!=null&&$.bold||(L=t.style)!=null&&L.emphasis?a.typography.fontWeightBold:a.typography.fontWeightNormal,W=(S=t.style)!=null&&S.italic?"italic":"normal";let P=a.colors.foreground;(_=t.style)!=null&&_.color?P=t.style.color:(F=t.style)!=null&&F.muted?P=a.colors.muted:(g=t.style)!=null&&g.accent&&(P=a.colors.accent);const J=d-b-G.TEXT_PADDING*2,R=gt(t.label,J,u,0);if(f.push(`<text x="${m+G.TEXT_PADDING+b}" y="${h}"
      font-family="${a.typography.fontFamily}"
      font-size="${u}px"
      font-weight="${I}"
      font-style="${W}"
      fill="${P}">${O(R)}</text>`),(M=t.style)!=null&&M.badge){const k=String(t.style.badge),v=u*K.FONT_SCALE,B=v+K.PADDING*2,z=Y(t.label,u),C=m+G.TEXT_PADDING+b+z+K.GAP,nt=Y(k,v)+K.PADDING*2,et=o+(r-B)/2;f.push(`<rect x="${C}" y="${et}" width="${nt}" height="${B}"
        rx="3" fill="${a.colors.primary}" opacity="0.15"/>`),f.push(`<text x="${C+nt/2}" y="${et+B/2+v*.35}"
        text-anchor="middle"
        font-family="${a.typography.fontFamily}"
        font-size="${v}px"
        font-weight="500"
        fill="${a.colors.primary}">${O(k)}</text>`)}m+=d}for(const b of n){const I=E(b),W=on(t,b),{textX:P,anchor:J}=ct(m,I,b.align);if(b.type==="bar"&&typeof t.metadata[b.field]=="number"){const R=t.metadata[b.field],k=i==null?void 0:i.get(b.field),v=((x=(p=b.options)==null?void 0:p.bar)==null?void 0:x.maxValue)??k??100,B=((N=(y=b.options)==null?void 0:y.bar)==null?void 0:N.color)??a.colors.primary,z=a.shapes.pointSize*2,U=I-G.TEXT_PADDING*2-50,nt=Math.min(R/v*U,U);f.push(`<rect x="${m+G.TEXT_PADDING}" y="${o+r/2-z/2}"
        width="${Math.max(0,nt)}" height="${z}"
        fill="${B}" opacity="0.7" rx="2"/>`);const et=m+I-G.TEXT_PADDING;f.push(`<text x="${et}" y="${h}"
        font-family="${a.typography.fontFamily}"
        font-size="${u}px"
        text-anchor="end"
        fill="${a.colors.foreground}">${at(R)}</text>`)}else if(b.type==="sparkline"&&Array.isArray(t.metadata[b.field])){let R=t.metadata[b.field];Array.isArray(R[0])&&(R=R[0]);const k=((T=(w=b.options)==null?void 0:w.sparkline)==null?void 0:T.height)??16,v=((D=(H=b.options)==null?void 0:H.sparkline)==null?void 0:D.color)??a.colors.primary,B=G.TEXT_PADDING*2,z=rn(R,m+G.TEXT_PADDING,o+r/2-k/2,I-B,k);f.push(`<path d="${z}" fill="none" stroke="${v}" stroke-width="1.5"/>`)}else f.push(`<text x="${P}" y="${h}"
        font-family="${a.typography.fontFamily}"
        font-size="${u}px"
        text-anchor="${J}"
        fill="${a.colors.foreground}">${O(W)}</text>`);m+=I}return f.join(`
`)}function on(t,n){var o,r,a,c,d,l,i,s,f,u,h,m,E,A,$,L,S,_,F;if(n.type==="interval"){const g=(r=(o=n.options)==null?void 0:o.interval)!=null&&r.point?t.metadata[n.options.interval.point]:t.point,M=(c=(a=n.options)==null?void 0:a.interval)!=null&&c.lower?t.metadata[n.options.interval.lower]:t.lower,p=(l=(d=n.options)==null?void 0:d.interval)!=null&&l.upper?t.metadata[n.options.interval.upper]:t.upper;return Et(g,M,p,n.options)}if(n.type==="numeric"){const g=t.metadata[n.field];return typeof g=="number"?at(g,n.options):((i=n.options)==null?void 0:i.naText)??""}if(n.type==="custom"&&((s=n.options)!=null&&s.events))return bt(t,n.options);if(n.type==="pvalue"){const g=t.metadata[n.field];return typeof g!="number"?((f=n.options)==null?void 0:f.naText)??"":It(g,n.options)}if(n.type==="icon"){const g=t.metadata[n.field];if(g==null)return"";const M=String(g),p=(h=(u=n.options)==null?void 0:u.icon)==null?void 0:h.mapping;return p&&M in p?p[M]:M}if(n.type==="badge"){const g=t.metadata[n.field];return g!=null?String(g):""}if(n.type==="stars"){const g=t.metadata[n.field];if(typeof g!="number")return"";const M=((E=(m=n.options)==null?void 0:m.stars)==null?void 0:E.maxStars)??5,p=Math.max(0,Math.min(M,g)),x=Math.floor(p),y=M-x;return"★".repeat(x)+"☆".repeat(y)}if(n.type==="img")return(($=(A=n.options)==null?void 0:A.img)==null?void 0:$.fallback)??"[IMG]";if(n.type==="reference"){const g=t.metadata[n.field];if(g==null)return"";const M=String(g),p=((S=(L=n.options)==null?void 0:L.reference)==null?void 0:S.maxChars)??30;return M.length<=p?M:M.substring(0,p)+"..."}if(n.type==="range"){const g=(_=n.options)==null?void 0:_.range;if(!g)return"";const M=t.metadata[g.minField],p=t.metadata[g.maxField],x=g.separator??" – ",y=g.decimals,N=w=>typeof w!="number"?"":y==null?Number.isInteger(w)?String(w):w.toFixed(1):w.toFixed(y);return M===null&&p===null?"":M===null?N(p):p===null?N(M):`${N(M)}${x}${N(p)}`}const e=t.metadata[n.field];return e!=null?String(e):((F=n.options)==null?void 0:F.naText)??""}function rn(t,n,e,o,r){const a=t.filter(s=>Number.isFinite(s));if(a.length===0)return"";if(a.length===1){const s=n+o/2,f=e+r/2;return`M${s.toFixed(1)},${f.toFixed(1)}`}const c=Math.min(...a),l=Math.max(...a)-c||1;return`M${a.map((s,f)=>{const u=n+f/(a.length-1)*o,h=e+r-(s-c)/l*r;return`${u.toFixed(1)},${h.toFixed(1)}`}).join("L")}`}function an(t,n,e,o,r,a=[],c,d=0,l=1/0,i,s=!1){var M;let f;if(a.length===0){const p=!s||t.point!=null&&t.point>0?t.point:null,x=!s||t.lower!=null&&t.lower>0?t.lower:null,y=!s||t.upper!=null&&t.upper>0?t.upper:null;f=[{point:p,lower:x,upper:y,color:null,shape:null,opacity:null}]}else f=a.map(p=>({point:Z(t.metadata,t.point,p.pointCol,"point",s),lower:Z(t.metadata,t.lower,p.lowerCol,"lower",s),upper:Z(t.metadata,t.upper,p.upperCol,"upper",s),color:p.color??null,shape:p.shape??null,opacity:p.opacity??null}));const u=f.filter(p=>p.point!=null&&!Number.isNaN(p.point)&&p.lower!=null&&!Number.isNaN(p.lower)&&p.upper!=null&&!Number.isNaN(p.upper));if(u.length===0)return"";const h=o.shapes.pointSize,m=o.shapes.lineWidth,E=o.colors.intervalLine,A=((M=t.style)==null?void 0:M.type)==="summary",L=o.shapes.summaryHeight/2;function S(p){var y;if(p&&((y=t.markerStyle)==null?void 0:y.size)!=null)return h*t.markerStyle.size;const x=c?t.metadata[c]:void 0;if(x){const N=.5+Math.sqrt(x/100)*1.5;return Math.min(Math.max(h*N,3),h*2.5)}return h}function _(p,x){const y=x===0,N=t.markerStyle,w=o.shapes.markerColors,T=o.shapes.markerShapes,H=["square","circle","diamond","triangle"];let D;y&&(N!=null&&N.color)?D=N.color:p.color?D=p.color:w&&w.length>0?D=w[x%w.length]:D=o.colors.interval??o.colors.primary??"#2563eb";let b;y&&(N!=null&&N.shape)?b=N.shape:p.shape?b=p.shape:T&&T.length>0?b=T[x%T.length]:b=H[x%H.length];let I;return y&&(N==null?void 0:N.opacity)!=null?I=N.opacity:p.opacity!=null?I=p.opacity:I=1,{color:D,shape:b,opacity:I}}function F(p,x,y,N){const{color:w,shape:T,opacity:H}=N,D=H<1?` fill-opacity="${H}"`:"";switch(T){case"circle":return`<circle cx="${p}" cy="${x}" r="${y}" fill="${w}"${D}/>`;case"diamond":return`<polygon points="${[`${p},${x-y}`,`${p+y},${x}`,`${p},${x+y}`,`${p-y},${x}`].join(" ")}" fill="${w}"${D}/>`;case"triangle":return`<polygon points="${[`${p},${x-y}`,`${p+y},${x+y}`,`${p-y},${x+y}`].join(" ")}" fill="${w}"${D}/>`;default:return`<rect x="${p-y}" y="${x-y}" width="${y*2}" height="${y*2}" fill="${w}"${D}/>`}}const g=[];return u.forEach((p,x)=>{const y=n+zt(x,u.length),N=e(p.lower),w=e(p.upper),T=e(p.point),H=_(p,x),D=S(x===0),b=E;if(A){const I=H.opacity<1?` fill-opacity="${H.opacity}"`:"",W=[`${N},${y}`,`${T},${y-L}`,`${w},${y}`,`${T},${y+L}`].join(" ");g.push(`
        <g class="interval effect-${x} summary">
          <polygon points="${W}"
            fill="${H.color}"${I} stroke="${o.colors.summaryBorder}" stroke-width="1"/>
        </g>`)}else{const I=G.AXIS_LABEL_PADDING,W=d+I,P=d+l-I,J=i?p.lower<i[0]:N<W,R=i?p.upper>i[1]:w>P;let k,v;if(i){const et=Math.max(i[0],Math.min(i[1],p.lower)),hn=Math.max(i[0],Math.min(i[1],p.upper));k=e(et),v=e(hn)}else k=Math.max(W,Math.min(P,N)),v=Math.max(W,Math.min(P,w));const B=Ut(o),z=B.height/2;let C="";J?C=`<path d="${$t("left",W,y,B)}" fill="${B.color}"/>`:C=`<line x1="${k}" x2="${k}" y1="${y-z}" y2="${y+z}" stroke="${b}" stroke-width="${m}"/>`;let U="";R?U=`<path d="${$t("right",P,y,B)}" fill="${B.color}"/>`:U=`<line x1="${v}" x2="${v}" y1="${y-z}" y2="${y+z}" stroke="${b}" stroke-width="${m}"/>`;const nt=i?e(Math.max(i[0],Math.min(i[1],p.point))):Math.max(W,Math.min(P,T));g.push(`
        <g class="interval effect-${x}">
          <line x1="${k}" x2="${v}" y1="${y}" y2="${y}"
            stroke="${b}" stroke-width="${m}"/>
          ${C}
          ${U}
          ${F(nt,y,D,H)}
        </g>`)}}),g.join("")}function sn(t,n,e,o,r,a,c,d){const i=d.shapes.summaryHeight/2,[s,f]=r.domain().map(F=>r(F)),u=Math.min(s,f),h=Math.max(s,f),m=r(n),E=r(t),A=r(e),$=a+Math.max(u,Math.min(h,m)),L=a+Math.max(u,Math.min(h,E)),S=a+Math.max(u,Math.min(h,A));return`<polygon points="${[`${$},${o}`,`${L},${o-i}`,`${S},${o}`,`${L},${o+i}`].join(" ")}"
    fill="${d.colors.summaryFill}"
    stroke="${d.colors.summaryBorder}"
    stroke-width="1"/>`}function ln(t,n,e,o,r,a=1,c){const d=[],l=typeof e.axis.tickCount=="number"?e.axis.tickCount:G.DEFAULT_TICK_COUNT,i=cn(t,l,e,a,n.forestWidth,c),s=j(e.typography.fontSizeSm),f=35,u=m=>m<f?"start":m>n.forestWidth-f?"end":"middle",h=m=>m<f?2:m>n.forestWidth-f?-2:0;d.push(`<line x1="${r}" x2="${r+n.forestWidth}"
    y1="0" y2="0" stroke="${e.colors.border}" stroke-width="1"/>`);for(const m of i){const E=t(m),A=r+E,$=u(E),L=h(E);d.push(`<line x1="${A}" x2="${A}" y1="0" y2="4"
      stroke="${e.colors.border}" stroke-width="1"/>`),d.push(`<text x="${A+L}" y="16" text-anchor="${$}"
      font-family="${e.typography.fontFamily}"
      font-size="${s}px"
      fill="${e.colors.secondary}">${Kt(m)}</text>`)}return o&&d.push(`<text x="${r+n.forestWidth/2}" y="28"
      text-anchor="middle"
      font-family="${e.typography.fontFamily}"
      font-size="${s}px"
      font-weight="500"
      fill="${e.colors.secondary}">${O(o)}</text>`),`<g transform="translate(0, ${n.mainY+n.headerHeight+n.plotHeight})">${d.join(`
`)}</g>`}function cn(t,n,e,o,r,a){if(Array.isArray(e.axis.tickValues)&&e.axis.tickValues.length>0){const[M,p]=t.domain();let x=e.axis.tickValues.filter(w=>w>=M&&w<=p);const y=e.axis.nullTick!==!1,N=o>=M&&o<=p;return y&&N&&!x.includes(o)&&(x=[...x,o].sort((w,T)=>w-T)),x}const[c,d]=t.domain(),l=e.axis.nullTick!==!1,i=o>=c&&o<=d,s=50,f=Math.max(2,Math.floor(r/s)),u=Math.min(n,Math.min(7,f)),h=a&&a.length>0?a.filter(M=>M>=c&&M<=d):t.ticks(u);if(h.length===0)return l&&i?[o]:[];const m=t(o),E=h.filter(M=>M<o).reverse(),A=h.filter(M=>M>o),$=h.some(M=>M===o),L=[];let S=m;for(const M of E){const p=t(M);S-p>=s&&(L.unshift(M),S=p)}const _=[];let F=m;for(const M of A){const p=t(M);p-F>=s&&(_.push(M),F=p)}const g=[...L];if(($||l&&i)&&g.push(o),g.push(..._),g.length<2){const M=new Set(g);M.has(c)||g.unshift(c),g.length<2&&!M.has(d)&&g.push(d)}return g}function Ft(t,n,e,o,r,a,c=1,d=.6){let i=`<line x1="${t}" x2="${t}" y1="${n}" y2="${e}"
    stroke="${r}" stroke-width="${c}" stroke-opacity="${d}" stroke-dasharray="${o==="dashed"?"6,4":o==="dotted"?"2,2":"none"}"/>`;return a&&(i+=`<text x="${t}" y="${n-4}" text-anchor="middle"
      font-size="10px" fill="${r}">${O(a)}</text>`),i}class Q extends Error{constructor(n){super(`SVG Generator: ${n}`),this.name="SVGGeneratorError"}}function un(t){if(!t||typeof t!="object")throw new Q("Invalid spec: expected an object");const n=t;if(!n.data||typeof n.data!="object")throw new Q("Invalid spec: missing or invalid 'data' property");const e=n.data;if(!Array.isArray(e.rows))throw new Q("Invalid spec: 'data.rows' must be an array");if(!n.theme||typeof n.theme!="object")throw new Q("Invalid spec: missing or invalid 'theme' property");const o=n.theme;if(!o.colors||typeof o.colors!="object")throw new Q("Invalid spec: missing or invalid 'theme.colors'");if(!o.typography||typeof o.typography!="object")throw new Q("Invalid spec: missing or invalid 'theme.typography'");if(!o.spacing||typeof o.spacing!="object")throw new Q("Invalid spec: missing or invalid 'theme.spacing'")}function fn(t,n={}){var H;un(t);const e=t.theme,o=t.data.scale==="log",r=Zt(t,n),a=e.spacing.padding,c=Array.isArray(t.columns)?t.columns:[],d=lt(c,"left"),l=lt(c,"right"),i=st(c,"left"),s=st(c,"right"),f=r.labelWidth+i.reduce((D,b)=>D+ht(b,r.autoWidths),0),u=a+f+X.COLUMN_GAP,{scale:h,clipBounds:m,ticks:E}=Qt(t,r.forestWidth,n),A=u+r.forestWidth+X.COLUMN_GAP,$=[];$.push(`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
  width="${r.totalWidth}" height="${r.totalHeight}"
  viewBox="0 0 ${r.totalWidth} ${r.totalHeight}">`);const L=n.backgroundColor??e.colors.background;$.push(`<rect width="100%" height="100%" fill="${L}"/>`),$.push(tn(t,r,e)),$.push(`<line x1="${a}" x2="${r.totalWidth-a}"
    y1="${r.mainY}" y2="${r.mainY}"
    stroke="${e.colors.border}" stroke-width="2"/>`);const S=r.mainY;$.push(wt(d,i,a,S,r.headerHeight,e,t.data.labelHeader??"Study",r.labelWidth,r.autoWidths)),s.length>0&&$.push(wt(l,s,A,S,r.headerHeight,e,void 0,void 0,r.autoWidths)),$.push(`<line x1="${a}" x2="${r.totalWidth-a}"
    y1="${S+r.headerHeight}" y2="${S+r.headerHeight}"
    stroke="${e.colors.border}" stroke-width="2"/>`);const _=_t(t),g=(Array.isArray(t.data.groups)?t.data.groups:[]).length>0,M=[],p=[];let x=0;for(const D of _){const I=D.type==="data"&&((H=D.row.style)==null?void 0:H.type)==="spacer"?r.rowHeight/2:r.rowHeight;M.push(x),p.push(I),x+=I}if(t.data.includeForest&&r.forestWidth>0){const D=r.mainY+r.headerHeight,b=u+h(t.data.nullValue);$.push(Ft(b,D,D+r.plotHeight,"dashed",e.colors.muted));const I=Array.isArray(t.annotations)?t.annotations:[];for(const W of I)if(W.type==="reference_line"){const P=u+h(W.x);$.push(Ft(P,D,D+r.plotHeight,W.style,W.color??e.colors.accent,W.label,W.width??1,W.opacity??.6))}if(_.forEach((W,P)=>{if(W.type==="data"){const J=D+M[P]+p[P]/2;$.push(an(W.row,J,R=>u+h(R),e,t.data.nullValue,t.data.effects,t.data.weightCol,u,r.forestWidth,m,o))}}),t.data.overall&&r.showOverallSummary&&typeof t.data.overall.point=="number"&&!Number.isNaN(t.data.overall.point)&&typeof t.data.overall.lower=="number"&&!Number.isNaN(t.data.overall.lower)&&typeof t.data.overall.upper=="number"&&!Number.isNaN(t.data.overall.upper)){const W=D+r.summaryYPosition;$.push(sn(t.data.overall.point,t.data.overall.lower,t.data.overall.upper,W,h,u,r.forestWidth,e))}$.push(ln(h,r,e,t.data.axisLabel,u,t.data.nullValue,E))}const y=r.mainY+r.headerHeight,N=t.data.rows,w=Wt(N,i),T=Wt(N,s);return _.forEach((D,b)=>{var P,J,R;const I=y+M[b],W=p[b];if(D.type==="group_header")$.push(en(D.label,D.depth,a,I,W,r.totalWidth-a*2,e));else{const k=D.row,v=D.depth;if(!(((P=k.style)==null?void 0:P.type)==="spacer")){const z=Ot(v),C=!g&&b%2===1?Xt:0,U=Math.max(z,C);U>0&&$.push(`<rect x="${a}" y="${I}"
            width="${r.totalWidth-a*2}" height="${W}"
            fill="${e.colors.muted}" opacity="${U}"/>`)}$.push(Lt(k,i,a,I,W,e,!0,r.labelWidth,v,w,r.autoWidths)),s.length>0&&$.push(Lt(k,s,A,I,W,e,!1,0,v,T,r.autoWidths))}if(D.type==="data"){const k=D.row,v=((J=k.style)==null?void 0:J.type)==="summary",B=((R=k.style)==null?void 0:R.type)==="spacer";v&&$.push(`<line x1="${a}" x2="${r.totalWidth-a}"
          y1="${I}" y2="${I}"
          stroke="${e.colors.border}" stroke-width="2"/>`),B||$.push(`<line x1="${a}" x2="${r.totalWidth-a}"
          y1="${I+W}" y2="${I+W}"
          stroke="${e.colors.border}" stroke-width="1"/>`)}else $.push(`<line x1="${a}" x2="${r.totalWidth-a}"
        y1="${I+W}" y2="${I+W}"
        stroke="${e.colors.border}" stroke-width="1"/>`)}),$.push(nn(t,r,e)),$.push("</svg>"),$.join(`
`)}function dn(t,n){const e=JSON.parse(t);return fn(e,n)}globalThis.generateSVG=dn})();
