(function(){"use strict";function ht(t,o){if(o){const f=[.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100];let l=f[0];for(const h of f)if(h<=t[0])l=h;else break;let c=f[f.length-1];for(let h=f.length-1;h>=0&&f[h]>=t[1];h--)c=f[h];return[l,c]}const e=t[1]-t[0];if(e===0)return t;const n=Math.pow(10,Math.floor(Math.log10(e))),i=e/n;let r;i<=1?r=n*.1:i<=2?r=n*.2:i<=5?r=n*.5:r=n;const s=Math.floor(t[0]/r)*r,p=Math.ceil(t[1]/r)*r;return[s,p]}const nt=.15,pt=.06,gt=.05,ot=.04;function $t(t){return t<=0?0:ot+t*ot}const S={DEFAULT_LABEL_WIDTH:200,DEFAULT_COLUMN_WIDTH:100,AXIS_HEIGHT:32,AXIS_LABEL_HEIGHT:20,BOTTOM_MARGIN:16,MIN_FOREST_WIDTH:200,DEFAULT_WIDTH:800,COLUMN_GAP:16},F={TITLE_HEIGHT:28,SUBTITLE_HEIGHT:20,CAPTION_HEIGHT:16,FOOTNOTE_HEIGHT:14,DEFAULT_FONT_SIZE:14,REM_BASE:16,TEXT_BASELINE_ADJUSTMENT:1/3},w={INDENT_PER_LEVEL:12,TEXT_PADDING:10,WHISKER_HALF_HEIGHT:4,DEFAULT_TICK_COUNT:5},et={GROUP_HEADER_HEIGHT_MULTIPLIER:1.5,OVERALL_ROW_HEIGHT_MULTIPLIER:1.5};function yt(t,o){var k,v,V,z;const e=t.theme,n=e.spacing.rowHeight,i=e.spacing.padding,r=Array.isArray(t.columns)?t.columns:[],s=Y(r,"left"),p=Y(r,"right"),l=q(s)||q(p)?e.spacing.headerHeight*et.GROUP_HEADER_HEIGHT_MULTIPLIER:e.spacing.headerHeight,c=!!((k=t.labels)!=null&&k.title),h=!!((v=t.labels)!=null&&v.subtitle),d=!!((V=t.labels)!=null&&V.caption),g=!!((z=t.labels)!=null&&z.footnote),$=c?F.TITLE_HEIGHT:0,b=h?F.SUBTITLE_HEIGHT:0,E=$+b+(c||h?i:0),D=d?F.CAPTION_HEIGHT:0,I=g?F.FOOTNOTE_HEIGHT:0,_=D+I+(d||g?i:0),y=rt(t).length,a=!!t.data.overall,u=y*n+(a?n*et.OVERALL_ROW_HEIGHT_MULTIPLIER:0),m=j(r,"left"),T=j(r,"right"),A=S.DEFAULT_LABEL_WIDTH+m.reduce((C,U)=>C+(typeof U.width=="number"?U.width:S.DEFAULT_COLUMN_WIDTH),0),x=T.reduce((C,U)=>C+(typeof U.width=="number"?U.width:S.DEFAULT_COLUMN_WIDTH),0),N=o.width??S.DEFAULT_WIDTH,L=t.data.includeForest,X=A+x;let W;if(!L)W=0;else if(typeof t.layout.plotWidth=="number")W=t.layout.plotWidth;else{const C=N-X-S.COLUMN_GAP*2-i*2;W=Math.max(C,S.MIN_FOREST_WIDTH)}const G=i*2+X+W+S.COLUMN_GAP*2,P=Math.max(o.width??N,G),R=E+i+l+u+S.AXIS_HEIGHT+S.AXIS_LABEL_HEIGHT+_+S.BOTTOM_MARGIN;return{totalWidth:P,totalHeight:o.height??R,tableWidth:A+x,forestWidth:W,headerHeight:l,rowHeight:n,plotHeight:u,axisHeight:S.AXIS_HEIGHT,nullValue:t.data.nullValue,summaryYPosition:u-n,showOverallSummary:a,headerTextHeight:E,footerTextHeight:_,titleY:i+F.TITLE_HEIGHT-8,subtitleY:i+$+F.SUBTITLE_HEIGHT-4,mainY:E+i,footerY:E+i+l+u+S.AXIS_HEIGHT+S.AXIS_LABEL_HEIGHT+i}}function rt(t){var h;const o=t.data.rows,e=Array.isArray(t.data.groups)?t.data.groups:[];if(e.length===0)return o.map(d=>({type:"data",row:d,depth:0}));const n=new Map;for(const d of e)n.set(d.id,d);const i=new Map;for(const d of o){const g=d.groupId??null;i.has(g)||i.set(g,[]),i.get(g).push(d)}const r=new Set;for(const d of i.keys()){if(!d)continue;let g=d;for(;g;)r.add(g),g=(h=n.get(g))==null?void 0:h.parentId}function s(d){return e.filter(g=>(g.parentId??null)===d&&r.has(g.id))}function p(d){if(!d)return 0;const g=n.get(d);return g?g.depth+1:0}function f(d){var $;let g=(($=i.get(d))==null?void 0:$.length)??0;for(const b of s(d))g+=f(b.id);return g}const l=[];function c(d){if(d){const $=n.get(d);if(!$)return;const b=f(d);l.push({type:"group_header",groupId:$.id,label:$.label,depth:$.depth,rowCount:b})}for(const $ of s(d))c($.id);const g=i.get(d)??[];for(const $ of g)l.push({type:"data",row:$,depth:p($.groupId)})}return c(null),l}function it(t){const o=[];for(const e of t)e.isGroup?o.push(...it(e.columns)):o.push(e);return o}function j(t,o){const e=[];for(const n of t)n.position===o&&(n.isGroup?e.push(...it(n.columns)):e.push(n));return e}function Y(t,o){return t.filter(e=>e.position===o)}function q(t){return t.some(o=>o.isGroup)}function at(t,o){return t.isGroup?t.columns.reduce((e,n)=>e+at(n,o),0):typeof t.width=="number"?t.width:o}function O(t){return t.endsWith("rem")?parseFloat(t)*F.REM_BASE:t.endsWith("px")?parseFloat(t):F.DEFAULT_FONT_SIZE}function J(t,o,e){return e==="right"?{textX:t+o-w.TEXT_PADDING,anchor:"end"}:e==="center"?{textX:t+o/2,anchor:"middle"}:{textX:t+w.TEXT_PADDING,anchor:"start"}}function M(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Z(t,o,e,n=0){const i=e*.55,r=o-n*2,s=Math.floor(r/i);return t.length<=s?t:t.slice(0,s-1)+"…"}function K(t,o){const e=t.split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,o),e.join(".")}function Q(t,o=2){const e=Math.abs(t),n=t<0?"-":"";return e>=1e9?n+(e/1e9).toPrecision(o)+"B":e>=1e6?n+(e/1e6).toPrecision(o)+"M":e>=1e3?n+(e/1e3).toPrecision(o)+"K":t.toPrecision(o)}function st(t,o){var p,f,l,c,h;if(t==null||Number.isNaN(t))return(o==null?void 0:o.naText)??"";if(o!=null&&o.percent){const{decimals:d=1,multiply:g=!1,symbol:$=!0}=o.percent,E=(g?t*100:t).toFixed(d);return $?`${E}%`:E}const e=(p=o==null?void 0:o.numeric)==null?void 0:p.abbreviate;if(e&&Math.abs(t)>=1e3)return Q(t,typeof e=="number"?e:2);const n=(f=o==null?void 0:o.numeric)==null?void 0:f.digits;if(n!=null){const d=t.toPrecision(n),g=(l=o==null?void 0:o.numeric)==null?void 0:l.thousandsSep;return g&&typeof g=="string"?K(d,g):d}const i=(c=o==null?void 0:o.numeric)==null?void 0:c.decimals,r=(h=o==null?void 0:o.numeric)==null?void 0:h.thousandsSep;let s;return i!==void 0?s=t.toFixed(i):Number.isInteger(t)||Math.abs(t-Math.round(t))<1e-4?s=Math.round(t).toString():s=t.toFixed(2),r&&typeof r=="string"&&(s=K(s,r)),s}function mt(t,o){const{eventsField:e,nField:n,separator:i="/",showPct:r=!1,thousandsSep:s,abbreviate:p}=o.events,f=t.metadata[e],l=t.metadata[n];if(f==null||l===void 0||l===null)return o.naText??"";const c=Number(f),h=Number(l);let d,g;if(p&&(c>=1e3||h>=1e3)){const b=typeof p=="number"?p:2;d=c>=1e3?Q(c,b):String(c),g=h>=1e3?Q(h,b):String(h)}else d=String(c),g=String(h),s&&typeof s=="string"&&(d=K(d,s),g=K(g,s));let $=`${d}${i}${g}`;if(r&&h>0){const b=(c/h*100).toFixed(1);$+=` (${b}%)`}return $}function xt(t,o,e,n){var s,p;if(t==null||Number.isNaN(t))return"";const i=((s=n==null?void 0:n.interval)==null?void 0:s.decimals)??2,r=((p=n==null?void 0:n.interval)==null?void 0:p.sep)??" ";return o==null||e===void 0||e===null||Number.isNaN(o)||Number.isNaN(e)?t.toFixed(i):`${t.toFixed(i)}${r}(${o.toFixed(i)}, ${e.toFixed(i)})`}const Tt={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","-":"⁻","+":"⁺"};function Et(t){return t.split("").map(o=>Tt[o]??o).join("")}function bt(t,o){const e=o==null?void 0:o.pvalue,n=(e==null?void 0:e.digits)??2,i=(e==null?void 0:e.expThreshold)??.001,r=(e==null?void 0:e.abbrevThreshold)??null,s=(e==null?void 0:e.format)??"auto",p=(e==null?void 0:e.stars)??!1,f=(e==null?void 0:e.thresholds)??[.05,.01,.001];let l="";if(p&&(t<f[2]?l="***":t<f[1]?l="**":t<f[0]&&(l="*")),r!==null&&t<r)return`<${r}${l}`;if(s==="scientific"||s==="auto"&&t<i){const h=Math.floor(Math.log10(t));return`${(t/Math.pow(10,h)).toPrecision(n)}×10${Et(h.toString())}${l}`}let c;return t>=.1?c=t.toFixed(n):t>=.01?c=t.toFixed(n+1):c=t.toFixed(n+2),`${c}${l}`}function _t(t){return Math.abs(t)<.01?"0":Math.abs(t)>=100?t.toFixed(0):Math.abs(t)>=10?t.toFixed(1):t.toFixed(2)}function It(t,o){const[e,n]=t,[i,r]=o,s=(r-i)/(n-e),p=f=>i+(f-e)*s;return p.domain=()=>t,p.range=()=>o,p.ticks=f=>{const l=(n-e)/(f-1),c=[];for(let h=0;h<f;h++)c.push(e+l*h);return c},p}function Ht(t,o){const[e,n]=t.map(c=>Math.max(c,.001)),[i,r]=o,s=Math.log10(e),p=Math.log10(n),f=(r-i)/(p-s),l=c=>{const h=Math.log10(Math.max(c,.001));return i+(h-s)*f};return l.domain=()=>[e,n],l.range=()=>o,l.ticks=c=>{const h=[],d=Math.floor(Math.log10(e)),g=Math.ceil(Math.log10(n));for(let $=d;$<=g;$++){const b=Math.pow(10,$);for(const E of[1,2,5]){const D=b*E;D>=e&&D<=n&&h.push(D)}}return h.length>0?h:[e,n]},l}function At(t,o){const e=t.data.rows,n=t.theme.axis,i=t.data.scale==="log",r=typeof(n==null?void 0:n.rangeMin)=="number",s=typeof(n==null?void 0:n.rangeMax)=="number";let p;if(r&&s)p=[n.rangeMin,n.rangeMax];else{const l=e.flatMap(c=>[c.lower,c.upper]).filter(c=>c!=null&&!Number.isNaN(c)&&Number.isFinite(c));if(l.length===0)p=i?[.1,10]:[0,1];else{const[c,h]=[Math.min(...l),Math.max(...l)],d=h-c||1;p=[r?n.rangeMin:c-d*nt,s?n.rangeMax:h+d*nt]}}const f=ht(p,i);return i?Ht([Math.max(f[0],.01),Math.max(f[1],.02)],[0,o]):It(f,[0,o])}function Nt(t,o,e){var r,s;const n=[],i=e.spacing.padding;if((r=t.labels)!=null&&r.title){const p=O(e.typography.fontSizeLg);n.push(`<text x="${i}" y="${o.titleY}"
      font-family="${e.typography.fontFamily}"
      font-size="${p}px"
      font-weight="${e.typography.fontWeightBold}"
      fill="${e.colors.foreground}">${M(t.labels.title)}</text>`)}if((s=t.labels)!=null&&s.subtitle){const p=O(e.typography.fontSizeBase);n.push(`<text x="${i}" y="${o.subtitleY}"
      font-family="${e.typography.fontFamily}"
      font-size="${p}px"
      fill="${e.colors.secondary}">${M(t.labels.subtitle)}</text>`)}return n.join(`
`)}function Dt(t,o,e){var s,p;const n=[],i=e.spacing.padding;let r=o.footerY;if((s=t.labels)!=null&&s.caption){const f=O(e.typography.fontSizeSm);n.push(`<text x="${i}" y="${r}"
      font-family="${e.typography.fontFamily}"
      font-size="${f}px"
      fill="${e.colors.secondary}">${M(t.labels.caption)}</text>`),r+=F.CAPTION_HEIGHT}if((p=t.labels)!=null&&p.footnote){const f=O(e.typography.fontSizeSm);n.push(`<text x="${i}" y="${r}"
      font-family="${e.typography.fontFamily}"
      font-size="${f}px"
      font-style="italic"
      fill="${e.colors.muted}">${M(t.labels.footnote)}</text>`)}return n.join(`
`)}function lt(t,o,e,n,i,r,s,p){const f=[],l=O(r.typography.fontSizeSm),c=r.typography.fontWeightMedium,h=r.typography.fontWeightBold,d=q(t),g=S.DEFAULT_COLUMN_WIDTH,$=p??S.DEFAULT_LABEL_WIDTH,b=(E,D)=>E+D/2+l*F.TEXT_BASELINE_ADJUSTMENT;if(d){const E=i/2,D=i/2;let I=e;s&&(f.push(`<text x="${I+w.TEXT_PADDING}" y="${b(n,i)}"
        font-family="${r.typography.fontFamily}"
        font-size="${l}px"
        font-weight="${c}"
        fill="${r.colors.foreground}">${M(s)}</text>`),f.push(`<line x1="${I+$}" x2="${I+$}"
        y1="${n}" y2="${n+i}"
        stroke="${r.colors.border}" stroke-width="1" opacity="0.3"/>`),I+=$);for(const _ of t)if(_.isGroup){const H=at(_,g),y=I+H/2;f.push(`<text x="${y}" y="${b(n,E)}"
          font-family="${r.typography.fontFamily}"
          font-size="${l}px"
          font-weight="${h}"
          text-anchor="middle"
          fill="${r.colors.foreground}">${M(_.header)}</text>`),f.push(`<line x1="${I}" x2="${I+H}"
          y1="${n+E}" y2="${n+E}"
          stroke="${r.colors.border}" stroke-width="1" opacity="0.5"/>`),I+=H}else{const H=typeof _.width=="number"?_.width:g,y=_.headerAlign??_.align,{textX:a,anchor:u}=J(I,H,y),m=Z(_.header,H,l,w.TEXT_PADDING);f.push(`<text x="${a}" y="${b(n,i)}"
          font-family="${r.typography.fontFamily}"
          font-size="${l}px"
          font-weight="${c}"
          text-anchor="${u}"
          fill="${r.colors.foreground}">${M(m)}</text>`),I+=H}I=e+(s?$:0);for(const _ of t)if(_.isGroup){for(const H of _.columns)if(!H.isGroup){const y=typeof H.width=="number"?H.width:g,a=H.headerAlign??H.align,{textX:u,anchor:m}=J(I,y,a);f.push(`<text x="${u}" y="${b(n+E,D)}"
              font-family="${r.typography.fontFamily}"
              font-size="${l}px"
              font-weight="${c}"
              text-anchor="${m}"
              fill="${r.colors.foreground}">${M(H.header)}</text>`),I+=y}}else{const H=typeof _.width=="number"?_.width:g;I+=H}}else{let E=e;s&&(f.push(`<text x="${E+w.TEXT_PADDING}" y="${b(n,i)}"
        font-family="${r.typography.fontFamily}"
        font-size="${l}px"
        font-weight="${c}"
        fill="${r.colors.foreground}">${M(s)}</text>`),E+=$);for(const D of o){const I=typeof D.width=="number"?D.width:g,_=D.headerAlign??D.align,{textX:H,anchor:y}=J(E,I,_),a=Z(D.header,I,l,w.TEXT_PADDING);f.push(`<text x="${H}" y="${b(n,i)}"
        font-family="${r.typography.fontFamily}"
        font-size="${l}px"
        font-weight="${c}"
        text-anchor="${y}"
        fill="${r.colors.foreground}">${M(a)}</text>`),E+=I}}return f.join(`
`)}function St(t,o,e,n,i,r,s){const p=[],f=O(s.typography.fontSizeBase),l=n+i/2+f*F.TEXT_BASELINE_ADJUSTMENT,c=o*w.INDENT_PER_LEVEL;return p.push(`<rect x="${e}" y="${n}"
    width="${r}" height="${i}"
    fill="${s.colors.primary}" opacity="${gt}"/>`),p.push(`<text x="${e+w.TEXT_PADDING+c}" y="${l}"
    font-family="${s.typography.fontFamily}"
    font-size="${f}px"
    font-weight="${s.typography.fontWeightBold}"
    fill="${s.colors.foreground}">${M(t)}</text>`),p.join(`
`)}function ct(t,o){const e=new Map;for(const n of o)if(n.type==="bar"){let i=0;for(const r of t){const s=r.metadata[n.field];typeof s=="number"&&s>i&&(i=s)}e.set(n.field,i>0?i:1)}return e}function ut(t,o,e,n,i,r,s,p=S.DEFAULT_LABEL_WIDTH,f=0,l){var $,b,E,D,I,_,H,y,a,u,m,T,A;const c=[],h=O(r.typography.fontSizeBase),d=n+i/2+h*F.TEXT_BASELINE_ADJUSTMENT;let g=e;if(s){const x=f*w.INDENT_PER_LEVEL+((($=t.style)==null?void 0:$.indent)??0)*w.INDENT_PER_LEVEL,N=(b=t.style)!=null&&b.bold?r.typography.fontWeightBold:r.typography.fontWeightNormal,L=(E=t.style)!=null&&E.italic?"italic":"normal",X=p-x-w.TEXT_PADDING*2,W=Z(t.label,X,h,0);if(c.push(`<text x="${g+w.TEXT_PADDING+x}" y="${d}"
      font-family="${r.typography.fontFamily}"
      font-size="${h}px"
      font-weight="${N}"
      font-style="${L}"
      fill="${((D=t.style)==null?void 0:D.color)??r.colors.foreground}">${M(W)}</text>`),(I=t.style)!=null&&I.badge){const G=String(t.style.badge),P=h*.8,R=4,k=P+R*2,v=t.label.length*h*.55,V=g+w.TEXT_PADDING+x+v+6,C=G.length*P*.6+R*2,U=n+(i-k)/2;c.push(`<rect x="${V}" y="${U}" width="${C}" height="${k}"
        rx="3" fill="${r.colors.primary}" opacity="0.15"/>`),c.push(`<text x="${V+C/2}" y="${U+k/2+P*.35}"
        text-anchor="middle"
        font-family="${r.typography.fontFamily}"
        font-size="${P}px"
        font-weight="500"
        fill="${r.colors.primary}">${M(G)}</text>`)}g+=p}for(const x of o){const N=typeof x.width=="number"?x.width:S.DEFAULT_COLUMN_WIDTH,L=wt(t,x),{textX:X,anchor:W}=J(g,N,x.align);if(x.type==="bar"&&typeof t.metadata[x.field]=="number"){const G=t.metadata[x.field],P=l==null?void 0:l.get(x.field),R=((H=(_=x.options)==null?void 0:_.bar)==null?void 0:H.maxValue)??P??100,k=((a=(y=x.options)==null?void 0:y.bar)==null?void 0:a.color)??r.colors.primary,v=r.shapes.pointSize*2,z=N-w.TEXT_PADDING*2-50,C=Math.min(G/R*z,z);c.push(`<rect x="${g+w.TEXT_PADDING}" y="${n+i/2-v/2}"
        width="${Math.max(0,C)}" height="${v}"
        fill="${k}" opacity="0.7" rx="2"/>`);const U=g+N-w.TEXT_PADDING;c.push(`<text x="${U}" y="${d}"
        font-family="${r.typography.fontFamily}"
        font-size="${h}px"
        text-anchor="end"
        fill="${r.colors.foreground}">${st(G)}</text>`)}else if(x.type==="sparkline"&&Array.isArray(t.metadata[x.field])){let G=t.metadata[x.field];Array.isArray(G[0])&&(G=G[0]);const P=((m=(u=x.options)==null?void 0:u.sparkline)==null?void 0:m.height)??16,R=((A=(T=x.options)==null?void 0:T.sparkline)==null?void 0:A.color)??r.colors.primary,k=w.TEXT_PADDING*2,v=Mt(G,g+w.TEXT_PADDING,n+i/2-P/2,N-k,P);c.push(`<path d="${v}" fill="none" stroke="${R}" stroke-width="1.5"/>`)}else c.push(`<text x="${X}" y="${d}"
        font-family="${r.typography.fontFamily}"
        font-size="${h}px"
        text-anchor="${W}"
        fill="${r.colors.foreground}">${M(L)}</text>`);g+=N}return c.join(`
`)}function wt(t,o){var n,i,r,s,p,f,l,c,h,d,g,$,b,E,D,I,_,H,y;if(o.type==="interval"){const a=(i=(n=o.options)==null?void 0:n.interval)!=null&&i.point?t.metadata[o.options.interval.point]:t.point,u=(s=(r=o.options)==null?void 0:r.interval)!=null&&s.lower?t.metadata[o.options.interval.lower]:t.lower,m=(f=(p=o.options)==null?void 0:p.interval)!=null&&f.upper?t.metadata[o.options.interval.upper]:t.upper;return xt(a,u,m,o.options)}if(o.type==="numeric"){const a=t.metadata[o.field];return typeof a=="number"?st(a,o.options):((l=o.options)==null?void 0:l.naText)??""}if(o.type==="custom"&&((c=o.options)!=null&&c.events))return mt(t,o.options);if(o.type==="pvalue"){const a=t.metadata[o.field];return typeof a!="number"?((h=o.options)==null?void 0:h.naText)??"":bt(a,o.options)}if(o.type==="icon"){const a=t.metadata[o.field];if(a==null)return"";const u=String(a),m=(g=(d=o.options)==null?void 0:d.icon)==null?void 0:g.mapping;return m&&u in m?m[u]:u}if(o.type==="badge"){const a=t.metadata[o.field];return a!=null?String(a):""}if(o.type==="stars"){const a=t.metadata[o.field];if(typeof a!="number")return"";const u=((b=($=o.options)==null?void 0:$.stars)==null?void 0:b.maxStars)??5,m=Math.max(0,Math.min(u,a)),T=Math.floor(m),A=u-T;return"★".repeat(T)+"☆".repeat(A)}if(o.type==="img")return((D=(E=o.options)==null?void 0:E.img)==null?void 0:D.fallback)??"[IMG]";if(o.type==="reference"){const a=t.metadata[o.field];if(a==null)return"";const u=String(a),m=((_=(I=o.options)==null?void 0:I.reference)==null?void 0:_.maxChars)??30;return u.length<=m?u:u.substring(0,m)+"..."}if(o.type==="range"){const a=(H=o.options)==null?void 0:H.range;if(!a)return"";const u=t.metadata[a.minField],m=t.metadata[a.maxField],T=a.separator??" – ",A=a.decimals,x=N=>typeof N!="number"?"":A==null?Number.isInteger(N)?String(N):N.toFixed(1):N.toFixed(A);return u===null&&m===null?"":u===null?x(m):m===null?x(u):`${x(u)}${T}${x(m)}`}const e=t.metadata[o.field];return e!=null?String(e):((y=o.options)==null?void 0:y.naText)??""}function Mt(t,o,e,n,i){if(t.length===0)return"";const r=Math.min(...t),p=Math.max(...t)-r||1;return`M${t.map((l,c)=>{const h=o+c/(t.length-1)*n,d=e+i-(l-r)/p*i;return`${h.toFixed(1)},${d.toFixed(1)}`}).join("L")}`}const ft=6;function tt(t,o,e){const n=t.metadata[o];return n!=null&&typeof n=="number"&&!Number.isNaN(n)?n:e}function Lt(t,o){return o<=1?0:-((o-1)*ft)/2+t*ft}function Ft(t,o,e,n,i,r=[],s){var H;let p;r.length===0?p=[{point:t.point,lower:t.lower,upper:t.upper,color:null,shape:null,opacity:null}]:p=r.map(y=>({point:tt(t,y.pointCol,t.point),lower:tt(t,y.lowerCol,t.lower),upper:tt(t,y.upperCol,t.upper),color:y.color??null,shape:y.shape??null,opacity:y.opacity??null}));const f=p.filter(y=>y.point!=null&&!Number.isNaN(y.point)&&y.lower!=null&&!Number.isNaN(y.lower)&&y.upper!=null&&!Number.isNaN(y.upper));if(f.length===0)return"";const l=n.shapes.pointSize,c=n.shapes.lineWidth,h=n.colors.intervalLine,d=w.WHISKER_HALF_HEIGHT,g=((H=t.style)==null?void 0:H.type)==="summary",b=n.shapes.summaryHeight/2;function E(y){var u;if(y&&((u=t.markerStyle)==null?void 0:u.size)!=null)return l*t.markerStyle.size;const a=s?t.metadata[s]:void 0;if(a){const m=.5+Math.sqrt(a/100)*1.5;return Math.min(Math.max(l*m,3),l*2.5)}return l}function D(y,a){const u=a===0,m=t.markerStyle;let T;u&&(m!=null&&m.color)?T=m.color:y.color?T=y.color:T=n.colors.interval??n.colors.primary??"#2563eb";let A;u&&(m!=null&&m.shape)?A=m.shape:y.shape?A=y.shape:A="square";let x;return u&&(m==null?void 0:m.opacity)!=null?x=m.opacity:y.opacity!=null?x=y.opacity:x=1,{color:T,shape:A,opacity:x}}function I(y,a,u,m){const{color:T,shape:A,opacity:x}=m,N=x<1?` fill-opacity="${x}"`:"";switch(A){case"circle":return`<circle cx="${y}" cy="${a}" r="${u}" fill="${T}"${N}/>`;case"diamond":return`<polygon points="${[`${y},${a-u}`,`${y+u},${a}`,`${y},${a+u}`,`${y-u},${a}`].join(" ")}" fill="${T}"${N}/>`;case"triangle":return`<polygon points="${[`${y},${a-u}`,`${y+u},${a+u}`,`${y-u},${a+u}`].join(" ")}" fill="${T}"${N}/>`;default:return`<rect x="${y-u}" y="${a-u}" width="${u*2}" height="${u*2}" fill="${T}"${N}/>`}}const _=[];return f.forEach((y,a)=>{const u=o+Lt(a,f.length),m=e(y.lower),T=e(y.upper),A=e(y.point),x=D(y,a),N=E(a===0),L=h;if(g){const X=x.opacity<1?` fill-opacity="${x.opacity}"`:"",W=[`${m},${u}`,`${A},${u-b}`,`${T},${u}`,`${A},${u+b}`].join(" ");_.push(`
        <g class="interval effect-${a} summary">
          <polygon points="${W}"
            fill="${x.color}"${X} stroke="${n.colors.summaryBorder}" stroke-width="1"/>
        </g>`)}else _.push(`
        <g class="interval effect-${a}">
          <line x1="${m}" x2="${T}" y1="${u}" y2="${u}"
            stroke="${L}" stroke-width="${c}"/>
          <line x1="${m}" x2="${m}" y1="${u-d}" y2="${u+d}"
            stroke="${L}" stroke-width="${c}"/>
          <line x1="${T}" x2="${T}" y1="${u-d}" y2="${u+d}"
            stroke="${L}" stroke-width="${c}"/>
          ${I(A,u,N,x)}
        </g>`)}),_.join("")}function Gt(t,o,e,n,i,r,s,p){const l=p.shapes.summaryHeight/2,c=i(o),h=i(t),d=i(e),g=r+Math.max(0,Math.min(s,c)),$=r+Math.max(0,Math.min(s,h)),b=r+Math.max(0,Math.min(s,d));return`<polygon points="${[`${g},${n}`,`${$},${n-l}`,`${b},${n}`,`${$},${n+l}`].join(" ")}"
    fill="${p.colors.summaryFill}"
    stroke="${p.colors.summaryBorder}"
    stroke-width="1"/>`}function Wt(t,o,e,n,i){const r=[],s=typeof e.axis.tickCount=="number"?e.axis.tickCount:w.DEFAULT_TICK_COUNT,p=Array.isArray(e.axis.tickValues)?e.axis.tickValues:t.ticks(s),f=O(e.typography.fontSizeSm);r.push(`<line x1="${i}" x2="${i+o.forestWidth}"
    y1="0" y2="0" stroke="${e.colors.border}" stroke-width="1"/>`);for(const l of p){const c=i+t(l);r.push(`<line x1="${c}" x2="${c}" y1="0" y2="4"
      stroke="${e.colors.border}" stroke-width="1"/>`),r.push(`<text x="${c}" y="16" text-anchor="middle"
      font-family="${e.typography.fontFamily}"
      font-size="${f}px"
      fill="${e.colors.secondary}">${_t(l)}</text>`)}return n&&r.push(`<text x="${i+o.forestWidth/2}" y="28"
      text-anchor="middle"
      font-family="${e.typography.fontFamily}"
      font-size="${f}px"
      font-weight="500"
      fill="${e.colors.secondary}">${M(n)}</text>`),`<g transform="translate(0, ${o.mainY+o.headerHeight+o.plotHeight})">${r.join(`
`)}</g>`}function dt(t,o,e,n,i,r,s=1,p=.6){let l=`<line x1="${t}" x2="${t}" y1="${o}" y2="${e}"
    stroke="${i}" stroke-width="${s}" stroke-opacity="${p}" stroke-dasharray="${n==="dashed"?"6,4":n==="dotted"?"2,2":"none"}"/>`;return r&&(l+=`<text x="${t}" y="${o-4}" text-anchor="middle"
      font-size="10px" fill="${i}">${M(r)}</text>`),l}class B extends Error{constructor(o){super(`SVG Generator: ${o}`),this.name="SVGGeneratorError"}}function Pt(t){if(!t||typeof t!="object")throw new B("Invalid spec: expected an object");const o=t;if(!o.data||typeof o.data!="object")throw new B("Invalid spec: missing or invalid 'data' property");const e=o.data;if(!Array.isArray(e.rows))throw new B("Invalid spec: 'data.rows' must be an array");if(!o.theme||typeof o.theme!="object")throw new B("Invalid spec: missing or invalid 'theme' property");const n=o.theme;if(!n.colors||typeof n.colors!="object")throw new B("Invalid spec: missing or invalid 'theme.colors'");if(!n.typography||typeof n.typography!="object")throw new B("Invalid spec: missing or invalid 'theme.typography'");if(!n.spacing||typeof n.spacing!="object")throw new B("Invalid spec: missing or invalid 'theme.spacing'")}function kt(t,o={}){Pt(t);const e=t.theme,n=yt(t,o),i=e.spacing.padding,r=Array.isArray(t.columns)?t.columns:[],s=Y(r,"left"),p=Y(r,"right"),f=j(r,"left"),l=j(r,"right"),c=S.DEFAULT_LABEL_WIDTH+f.reduce((a,u)=>a+(typeof u.width=="number"?u.width:S.DEFAULT_COLUMN_WIDTH),0),h=i+c,d=At(t,n.forestWidth),g=h+n.forestWidth,$=[];$.push(`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
  width="${n.totalWidth}" height="${n.totalHeight}"
  viewBox="0 0 ${n.totalWidth} ${n.totalHeight}">`);const b=o.backgroundColor??e.colors.background;$.push(`<rect width="100%" height="100%" fill="${b}"/>`),$.push(Nt(t,n,e));const E=n.mainY;$.push(lt(s,f,i,E,n.headerHeight,e,t.data.labelHeader??"Study",S.DEFAULT_LABEL_WIDTH)),l.length>0&&$.push(lt(p,l,g,E,n.headerHeight,e)),$.push(`<line x1="${i}" x2="${n.totalWidth-i}"
    y1="${E+n.headerHeight}" y2="${E+n.headerHeight}"
    stroke="${e.colors.border}" stroke-width="1"/>`);const D=rt(t);if(t.data.includeForest&&n.forestWidth>0){const a=n.mainY+n.headerHeight,u=h+d(t.data.nullValue);$.push(dt(u,a,a+n.plotHeight,"dashed",e.colors.muted));const m=Array.isArray(t.annotations)?t.annotations:[];for(const T of m)if(T.type==="reference_line"){const A=h+d(T.x);$.push(dt(A,a,a+n.plotHeight,T.style,T.color??e.colors.accent,T.label,T.width??1,T.opacity??.6))}if(D.forEach((T,A)=>{if(T.type==="data"){const x=a+A*n.rowHeight+n.rowHeight/2;$.push(Ft(T.row,x,N=>h+d(N),e,t.data.nullValue,t.data.effects,t.data.weightCol))}}),t.data.overall&&n.showOverallSummary&&typeof t.data.overall.point=="number"&&!Number.isNaN(t.data.overall.point)&&typeof t.data.overall.lower=="number"&&!Number.isNaN(t.data.overall.lower)&&typeof t.data.overall.upper=="number"&&!Number.isNaN(t.data.overall.upper)){const T=a+n.summaryYPosition;$.push(Gt(t.data.overall.point,t.data.overall.lower,t.data.overall.upper,T,d,h,n.forestWidth,e))}$.push(Wt(d,n,e,t.data.axisLabel,h))}const I=n.mainY+n.headerHeight,_=t.data.rows,H=ct(_,f),y=ct(_,l);return D.forEach((a,u)=>{const m=I+u*n.rowHeight;if(a.type==="group_header")$.push(St(a.label,a.depth,i,m,n.rowHeight,n.totalWidth-i*2,e));else{const T=a.row,A=a.depth,x=$t(A),N=u%2===1?pt:0,L=Math.max(x,N);L>0&&$.push(`<rect x="${i}" y="${m}"
          width="${n.totalWidth-i*2}" height="${n.rowHeight}"
          fill="${e.colors.muted}" opacity="${L}"/>`),$.push(ut(T,f,i,m,n.rowHeight,e,!0,S.DEFAULT_LABEL_WIDTH,A,H)),l.length>0&&$.push(ut(T,l,g,m,n.rowHeight,e,!1,0,A,y))}$.push(`<line x1="${i}" x2="${n.totalWidth-i}"
      y1="${m+n.rowHeight}" y2="${m+n.rowHeight}"
      stroke="${e.colors.border}" stroke-width="1" opacity="0.5"/>`)}),$.push(Dt(t,n,e)),$.push("</svg>"),$.join(`
`)}function Ct(t,o){const e=JSON.parse(t);return kt(e,o)}globalThis.generateSVG=Ct})();
