(function(){"use strict";const on=[1,5,2,2.5,4,3],gt=[.001,.002,.005,.01,.02,.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100,150,200,300,500,750,1e3];function Pt(t,n){return n?xn(t):bn(t)}function xn(t){if(t[0]<=0||t[1]<=0)return[.1,10];if(t[0]>=t[1])return t;let n=gt[0];for(const e of gt)if(e<=t[0])n=e;else break;t[0]<gt[0]&&(n=Math.pow(10,Math.floor(Math.log10(t[0]))));let o=gt[gt.length-1];for(let e=gt.length-1;e>=0&&gt[e]>=t[1];e--)o=gt[e];return t[1]>gt[gt.length-1]&&(o=Math.pow(10,Math.ceil(Math.log10(t[1])))),[n,o]}function bn(t){const n=t[1]-t[0];if(n===0)return t;if(n<0)return[t[1],t[0]];const o=Math.pow(10,Math.floor(Math.log10(n)));let e=o,s=1/0;for(const d of on)for(const u of[.1,1,10]){const i=d*o*u;if(i<=0)continue;const a=Math.floor(t[0]/i)*i,f=(Math.ceil(t[1]/i)*i-a)/n-1;f>=0&&f<s&&(s=f,e=i)}const r=Math.floor(t[0]/e)*e,l=Math.ceil(t[1]/e)*e;return[Math.round(r*1e10)/1e10,Math.round(l*1e10)/1e10]}function xt(t,n,o,e,s=!1){if(t&&o in t){const r=t[o];if(typeof r=="number"&&Number.isFinite(r)&&(!s||r>0))return r}return o===e&&n!=null&&Number.isFinite(n)&&(!s||n>0)?n:null}const Nt=12;function Mn(t){const{rows:n,config:o,scale:e,nullValue:s,forestWidth:r,pointSize:l,effects:d=[],pointCol:u,lowerCol:i,upperCol:a}=t,c=Nn(n,o,e,s,d,u,i,a),h=Tn(c,o,e,r,l),f=en(c,o,e,s);return{axisLimits:c,plotRegion:h,ticks:f}}function Nn(t,n,o,e,s=[],r,l,d){const u=n.rangeMin!=null,i=n.rangeMax!=null;if(u&&i)return[n.rangeMin,n.rangeMax];const a=[],c=o==="log",h=r||"point";for(const _ of t){const P=xt(_.metadata,void 0,h,"point",c);P!=null&&a.push(P);for(const R of s){const V=xt(_.metadata,void 0,R.pointCol,"point",c);V!=null&&a.push(V)}}if(a.length===0)return o==="log"?[.1,10]:[-1,1];let f=Math.min(...a),p=Math.max(...a);(n.includeNull??!0)&&(f=Math.min(f,e),p=Math.max(p,e));const A=f,N=p;let M;if(c){const _=Math.max(f,.001),P=Math.max(p,.001);M=Math.log(P)-Math.log(_)}else M=p-f;if(M===0||!Number.isFinite(M)){const _=a[0];if(c)return Pt([_/2,_*2],!0);{const P=Math.max(1,Math.abs(_)*.1);return Pt([_-P,_+P],!1)}}const[C,T]=Pt([f,p],c),w=n.ciClipFactor??2;let g=C,y=T;const m=[],E=[],I=l||"lower",F=d||"upper";for(const _ of t){const P=xt(_.metadata,void 0,I,"lower",c);P!=null&&m.push(P);const R=xt(_.metadata,void 0,F,"upper",c);R!=null&&E.push(R);for(const V of s){const z=xt(_.metadata,void 0,V.lowerCol,"lower",c);z!=null&&m.push(z);const U=xt(_.metadata,void 0,V.upperCol,"upper",c);U!=null&&E.push(U)}}let H,L;if(c)H=g/w,L=y*w;else{const _=y-g;H=g-_*w,L=y+_*w}let $=!1,D=!1;for(const _ of m)_>=H?g=Math.min(g,_):$=!0;for(const _ of E)_<=L?y=Math.max(y,_):D=!0;if($&&(g=Math.min(g,H)),D&&(y=Math.max(y,L)),n.symmetric===!0&&!u&&!i)if(o==="log"){const _=Math.log(e),P=Math.max(Math.abs(Math.log(Math.max(A,.001))-_),Math.abs(Math.log(N)-_));g=Math.exp(_-P),y=Math.exp(_+P)}else{const _=Math.max(Math.abs(A-e),Math.abs(N-e));g=e-_,y=e+_}let v=u?n.rangeMin:g,x=i?n.rangeMax:y;return Pt([v,x],o==="log")}function Tn(t,n,o,e,s){if(!(n.markerMargin??!0)||e<=0)return t;const l=e-2*Nt;if(l<=0)return t;if(o==="log"){const i=Math.log(Math.max(t[0],.001)),a=Math.log(Math.max(t[1],.001)),c=a-i,h=s/2*(c/l),f=Math.min(h,.5);return[Math.exp(i-f),Math.exp(a+f)]}const d=t[1]-t[0],u=s/2*(d/l);return[t[0]-u,t[1]+u]}function en(t,n,o,e){const[s,r]=t,l=e>=s&&e<=r,d=(n.nullTick??!0)&&l;if(n.tickValues&&n.tickValues.length>0){let a=n.tickValues.filter(c=>c>=s&&c<=r);return d&&!a.includes(e)&&(a=[...a,e].sort((c,h)=>c-h)),a}const u=n.tickCount??5;let i=o==="log"?wn(t,u):En(t,u);return d&&!i.includes(e)&&(i=[...i,e].sort((a,c)=>a-c)),i}function En(t,n){const[o,e]=t,s=e-o;if(s===0)return[o];const r=s/Math.max(n-1,1),l=Math.pow(10,Math.floor(Math.log10(r)));let d=l,u=1/0;for(const c of on){const h=c*l,f=Math.floor(s/h)+1,p=Math.abs(f-n);p<u&&(u=p,d=h);const b=c*l/10;if(b>0){const A=Math.floor(s/b)+1,N=Math.abs(A-n);N<u&&(u=N,d=b)}}const i=Math.ceil(o/d)*d,a=[];for(let c=i;c<=e+d*.001;c+=d){const h=Math.round(c*1e10)/1e10;h>=o&&h<=e&&a.push(h)}return a.length<2&&(a.includes(o)||a.unshift(o),a.includes(e)||a.push(e)),a}function wn(t,n){const[o,e]=t,r=[.01,.02,.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100,150,200,500,1e3].filter(u=>u>=o&&u<=e);if(r.length<=n)return r;const l=[1,.1,10,100,.5,2,5,.2,.25,1.5,3,4,20,50],d=[];for(const u of l)r.includes(u)&&d.length<n&&d.push(u);if(d.length<n){const u=r.filter(a=>!d.includes(a)),i=Math.max(1,Math.floor(u.length/(n-d.length)));for(let a=0;a<u.length&&d.length<n;a+=i)d.push(u[a])}return d.sort((u,i)=>u-i)}function In(t){var e,s;const n=((e=t==null?void 0:t.shapes)==null?void 0:e.lineWidth)??1.5,o=((s=t==null?void 0:t.colors)==null?void 0:s.intervalLine)??"#475569";return{width:Math.max(4,Math.round(n*3)),height:Math.max(6,Math.round(n*4)),color:o,opacity:1}}function rn(t,n,o,e){const{width:s,height:r}=e,l=r/2;return t==="left"?`M ${n} ${o} L ${n+s} ${o-l} L ${n+s} ${o+l} Z`:`M ${n} ${o} L ${n-s} ${o-l} L ${n-s} ${o+l} Z`}const Yt={RENDERING_BUFFER:4},It={FONT_SCALE:.8,PADDING:4,GAP:6},Tt={DEFAULT_COLUMN_WIDTH:100,AXIS_HEIGHT:32,AXIS_LABEL_HEIGHT:32,BOTTOM_MARGIN:16,MIN_FOREST_WIDTH:200,DEFAULT_WIDTH:800},mt={TITLE_HEIGHT:28,SUBTITLE_HEIGHT:20,CAPTION_HEIGHT:16,FOOTNOTE_HEIGHT:14,DEFAULT_FONT_SIZE:14,REM_BASE:16,PT_TO_PX:96/72},X={INDENT_PER_LEVEL:12,TEXT_PADDING:10,DEFAULT_TICK_COUNT:5},An={OVERALL_ROW_HEIGHT_MULTIPLIER:1.5},Ft={MIN:60,MAX:600,LABEL_MAX:400,VISUAL_MIN:{sparkline:92,bar:100,stars:84,range:84,badge:74,forest:200,viz_bar:150,viz_boxplot:150,viz_violin:150}},Lt={CHEVRON_WIDTH:12,GAP:6,SAFETY_MARGIN:8},an={SPACING:6},jt={EDGE_THRESHOLD:35,MIN_TICK_SPACING:50},Cn={success:"#16a34a",warning:"#d97706",error:"#dc2626",info:"#2563eb"};function _n(t,n){return n<=1?0:-((n-1)*an.SPACING)/2+t*an.SPACING}function Rt(t,n){const o=t.split(".");return o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,n),o.join(".")}function Ot(t){const n=Math.abs(t),o=t<0?"-":"";if(n>=1e12)throw new Error(`Cannot abbreviate value >= 1 trillion: ${t}`);if(n>=1e9){const e=n/1e9;return o+Kt(e)+"B"}if(n>=1e6){const e=n/1e6;return o+Kt(e)+"M"}if(n>=1e3){const e=n/1e3;return o+Kt(e)+"K"}return o+Math.round(n).toString()}function Kt(t){const n=Math.round(t*10)/10;return n===Math.floor(n)?n.toFixed(0):n.toFixed(1)}const Wn={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","-":"⁻","+":"⁺"};function Fn(t){return t.split("").map(n=>Wn[n]??n).join("")}function St(t,n){var i,a,c,h,f,p,b;if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";if(n!=null&&n.percent){const{decimals:A,digits:N,multiply:M=!0,symbol:C=!0}=n.percent,T=M?t*100:t,w=N!=null?T.toPrecision(N):T.toFixed(A??1);return C?`${w}%`:w}if(((i=n==null?void 0:n.numeric)==null?void 0:i.abbreviate)&&Math.abs(t)>=1e3)return Ot(t);const e=(a=n==null?void 0:n.numeric)==null?void 0:a.digits;if(e!=null){const A=t.toPrecision(e),N=(c=n==null?void 0:n.numeric)==null?void 0:c.thousandsSep;return N&&typeof N=="string"?Rt(A,N):A}const s=(h=n==null?void 0:n.numeric)==null?void 0:h.decimals,r=(f=n==null?void 0:n.numeric)==null?void 0:f.thousandsSep;let l;s!==void 0?l=t.toFixed(s):Number.isInteger(t)||Math.abs(t-Math.round(t))<1e-4?l=Math.round(t).toString():l=t.toFixed(2),r&&typeof r=="string"&&(l=Rt(l,r));const d=(p=n==null?void 0:n.numeric)==null?void 0:p.prefix,u=(b=n==null?void 0:n.numeric)==null?void 0:b.suffix;return d&&(l=d+l),u&&(l=l+u),l}function sn(t,n){const{eventsField:o,nField:e,separator:s="/",showPct:r=!1,thousandsSep:l,abbreviate:d}=n.events,u=t.metadata[o],i=t.metadata[e];if(u==null||i===void 0||i===null)return n.naText??"";const a=Number(u),c=Number(i);let h,f;d&&(a>=1e3||c>=1e3)?(h=a>=1e3?Ot(a):String(a),f=c>=1e3?Ot(c):String(c)):(h=String(a),f=String(c),l&&typeof l=="string"&&(h=Rt(h,l),f=Rt(f,l)));let p=`${h}${s}${f}`;if(r&&c>0){const b=(a/c*100).toFixed(1);p+=` (${b}%)`}return p}function ln(t,n,o,e){var d,u,i;if(t==null||Number.isNaN(t))return"";const s=((d=e==null?void 0:e.interval)==null?void 0:d.decimals)??2,r=((u=e==null?void 0:e.interval)==null?void 0:u.sep)??" ",l=(i=e==null?void 0:e.interval)==null?void 0:i.impreciseThreshold;return n==null||o===void 0||o===null||Number.isNaN(n)||Number.isNaN(o)?t.toFixed(s):l!=null&&n>0&&o/n>l?"—":`${t.toFixed(s)}${r}(${n.toFixed(s)}, ${o.toFixed(s)})`}function cn(t,n){if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";const o=n==null?void 0:n.pvalue,e=(o==null?void 0:o.digits)??2,s=(o==null?void 0:o.expThreshold)??.001,r=(o==null?void 0:o.abbrevThreshold)??null,l=(o==null?void 0:o.format)??"auto",d=(o==null?void 0:o.stars)??!1,u=(o==null?void 0:o.thresholds)??[.05,.01,.001];let i="";if(d&&(t<u[2]?i="***":t<u[1]?i="**":t<u[0]&&(i="*")),r!==null&&t<r)return`<${r}${i}`;if(l==="scientific"||l==="auto"&&t<s){const c=Math.floor(Math.log10(t));return`${(t/Math.pow(10,c)).toPrecision(e)}×10${Fn(c.toString())}${i}`}let a;return t>=.1?a=t.toFixed(e):t>=.01?a=t.toFixed(e+1):a=t.toFixed(e+2),`${a}${i}`}function Dn(t,n){var r,l,d,u,i,a;const{type:o,field:e,options:s}=n;switch(o){case"interval":{const c=(r=s==null?void 0:s.interval)!=null&&r.point?t.metadata[s.interval.point]:t.point,h=(l=s==null?void 0:s.interval)!=null&&l.lower?t.metadata[s.interval.lower]:t.lower,f=(d=s==null?void 0:s.interval)!=null&&d.upper?t.metadata[s.interval.upper]:t.upper;return ln(c,h,f,s)}case"custom":return s!=null&&s.events?sn(t,s):String(t.metadata[e]??"");case"pvalue":return cn(t.metadata[e],s);case"numeric":return St(t.metadata[e],s);case"percent":return St(t.metadata[e],s);case"heatmap":{const c=t.metadata[e];if(c==null)return"";const h=((u=s==null?void 0:s.heatmap)==null?void 0:u.decimals)??2;return c.toFixed(h)}case"progress":{const c=t.metadata[e];if(c==null)return"";const h=((i=s==null?void 0:s.progress)==null?void 0:i.maxValue)??100;return`${Math.round(Math.min(100,Math.max(0,c/h*100)))}%`}case"sparkline":case"icon":case"stars":case"img":case"range":return"";case"badge":{const c=t.metadata[e];return c==null?"":`  ${String(c)}  `}case"bar":{if(((a=s==null?void 0:s.bar)==null?void 0:a.showLabel)===!1)return"";const c=t.metadata[e];return c==null?"":c>=100?c.toFixed(0):c>=10?c.toFixed(1):c.toFixed(2)}case"text":default:return String(t.metadata[e]??"")}}function ut(t,n){const o="⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻",e="ilI1.,;:|!()[]{}' -",s="mwMW@%",r="ABCDEFGHJKLNOPQRSTUVXYZ";let l=0;for(const d of t)o.includes(d)?l+=n*.15:e.includes(d)?l+=n*.35:"×−".includes(d)?l+=n*.4:s.includes(d)?l+=n*.85:d>="0"&&d<="9"?l+=n*.6:r.includes(d)?l+=n*.68:l+=n*.55;return l}function kn(t,n,o,e=400){if(typeof document>"u")return null;const r=document.createElement("canvas").getContext("2d");return r?(r.font=`${e} ${n} ${o}`,r.measureText(t).width):null}function Hn(t){if(!t||t.length===0)return{min:NaN,q1:NaN,median:NaN,q3:NaN,max:NaN};const n=t.filter(s=>s!=null&&!Number.isNaN(s)).sort((s,r)=>s-r);if(n.length===0)return{min:NaN,q1:NaN,median:NaN,q3:NaN,max:NaN};const o=n.length,e=s=>{if(o===1)return n[0];const r=(o-1)*s,l=Math.floor(r),d=Math.ceil(r);return l===d?n[l]:n[l]+(r-l)*(n[d]-n[l])};return{min:n[0],q1:e(.25),median:e(.5),q3:e(.75),max:n[o-1]}}function Sn(t,n,o){if(!t||t.length===0||Number.isNaN(n)||Number.isNaN(o))return[];const e=o-n,s=n-1.5*e,r=o+1.5*e;return t.filter(l=>l!=null&&!Number.isNaN(l)&&(l<s||l>r))}function un(t){const n=Hn(t),o=Sn(t,n.q1,n.q3);return{...n,outliers:o}}function vn(t){if(!t||t.length<2)return 1;const n=t.filter(f=>f!=null&&!Number.isNaN(f)).sort((f,p)=>f-p);if(n.length<2)return 1;const o=n.length,e=n.reduce((f,p)=>f+p,0)/o,s=n.reduce((f,p)=>f+(p-e)**2,0)/(o-1),r=Math.sqrt(s),l=Math.floor((o-1)*.25),d=Math.floor((o-1)*.75),u=n[l],a=n[d]-u,h=.9*Math.min(r,a/1.34)*Math.pow(o,-.2);return Math.max(h,.001)}function Gn(t){return Math.exp(-.5*t*t)/Math.sqrt(2*Math.PI)}function Pn(t,n,o=128){if(!t||t.length===0)return{x:[],y:[]};const e=t.filter(f=>f!=null&&!Number.isNaN(f));if(e.length===0)return{x:[],y:[]};const s=n??vn(e),r=Math.min(...e),l=Math.max(...e),d=3*s,u=r-d,a=(l+d-u)/(o-1),c=[],h=[];for(let f=0;f<o;f++){const p=u+f*a;c.push(p);let b=0;for(const A of e)b+=Gn((p-A)/s);b/=e.length*s,h.push(b)}return{x:c,y:h}}function Ln(t,n){if(t.y.length===0)return t;const o=Math.max(...t.y);if(o===0)return t;const e=t.y.map(s=>s/o*n);return{x:t.x,y:e}}function Vt(t,n,o,e=400){const s=kn(t,`${n}px`,o,e);if(s!==null)return s;const r=1+Math.max(0,(e-400)/100)*.02;return ut(t,n)*r}function Rn(t,n){var i,a;const o=new Map,e=ot(t.theme.typography.fontSizeBase),s=t.theme.typography.headerFontScale??1.05,r=Math.round(e*s*100)/100,l=t.data.rows,d=(t.theme.spacing.cellPaddingX??10)*2,u=(t.theme.spacing.groupPadding??8)*2;for(const c of n){if(c.width!=="auto"&&c.width!==null&&c.width!==void 0)continue;let h=0;c.header&&(h=Math.max(h,ut(c.header,r)));for(const b of l){if(((i=b.style)==null?void 0:i.type)==="header"||((a=b.style)==null?void 0:a.type)==="spacer")continue;const A=Dn(b,c);A&&(h=Math.max(h,ut(A,e)))}const f=Ft.VISUAL_MIN[c.type]??Ft.MIN,p=Math.ceil(h+d+Yt.RENDERING_BUFFER);o.set(c.id,Math.min(Ft.MAX,Math.max(f,p)))}return Vn(t.columns,o,r,u,Yt.RENDERING_BUFFER),o}function Vn(t,n,o,e,s){function r(u){return u.isGroup?u.columns.flatMap(r):[u]}function l(u){const i=n.get(u.id);return i!==void 0?i:typeof u.width=="number"?u.width:Ft.MIN}function d(u){if(u.isGroup){for(const i of u.columns)d(i);if(u.header){const i=ut(u.header,o)+e+s,a=r(u),c=a.reduce((h,f)=>h+l(f),0);if(i>c&&a.length>0){const h=Math.ceil((i-c)/a.length);for(const f of a)n.set(f.id,l(f)+h)}}}}for(const u of t)d(u)}function fn(t,n,o){let e=o.filter(r=>r.groupId===t).length;const s=n.filter(r=>r.parentId===t);for(const r of s)e+=fn(r.id,n,o);return e}function dn(t){var u,i;const n=ot(t.theme.typography.fontSizeBase),o=(t.theme.spacing.cellPaddingX??10)*2;let e=0;const s=new Map,r=Array.isArray(t.data.groups)?t.data.groups:[];for(const a of r)s.set(a.id,a.depth);const l=a=>a?(s.get(a)??0)+1:0;t.data.labelHeader&&(e=Math.max(e,ut(t.data.labelHeader,n)));for(const a of t.data.rows)if(a.label){const c=l(a.groupId),h=((u=a.style)==null?void 0:u.indent)??0,p=(c+h)*X.INDENT_PER_LEVEL;let b=ut(a.label,n)+p;if((i=a.style)!=null&&i.badge){const A=String(a.style.badge),N=n*It.FONT_SCALE,C=ut(A,N)+It.PADDING*2;b+=It.GAP+C}e=Math.max(e,b)}for(const a of r)if(a.label){const c=a.depth*X.INDENT_PER_LEVEL,h=ut(a.label,n),p=`(${fn(a.id,r,t.data.rows)})`,b=n*.75,A=ut(p,b),N=c+Lt.CHEVRON_WIDTH+Lt.GAP+h+Lt.GAP+A+Lt.SAFETY_MARGIN;e=Math.max(e,N)}const d=Math.ceil(e+o+Yt.RENDERING_BUFFER);return Math.min(Ft.LABEL_MAX,Math.max(Ft.MIN,d))}function Zt(t,n){const o=n.get(t.id);return o!==void 0?o:typeof t.width=="number"?t.width:Tt.DEFAULT_COLUMN_WIDTH}function Bn(t,n,o=0){var K,$t,ct,S,Y;const e=t.theme,s=e.spacing.rowHeight,r=e.spacing.padding,l=Array.isArray(t.columns)?t.columns:[],d=pn(l,"left"),u=pn(l,"right"),a=Bt(d)||Bt(u)||Bt(l)?2:1,c=e.spacing.cellPaddingY??4,p=(e.spacing.headerHeight/a+c*2)*a,b=!!((K=t.labels)!=null&&K.title),A=!!(($t=t.labels)!=null&&$t.subtitle),N=!!((ct=t.labels)!=null&&ct.caption),M=!!((S=t.labels)!=null&&S.footnote),C=b?mt.TITLE_HEIGHT:0,T=A?mt.SUBTITLE_HEIGHT:0,w=b&&A?13:0,g=C+w+T+(b||A?r:0),y=N?mt.CAPTION_HEIGHT:0,m=M?mt.FOOTNOTE_HEIGHT:0,E=y+m+(N||M?r:0),I=hn(t),F=!!t.data.overall;let H=0;for(const B of I){const it=B.type==="data"&&((Y=B.row.style)==null?void 0:Y.type)==="spacer";H+=it?s/2:s}const L=H+(F?s*An.OVERALL_ROW_HEIGHT_MULTIPLIER:0),$=tn(l,"left"),D=tn(l,"right"),k=Jt(l).filter(B=>B.position===void 0),v=[...$,...D,...k];let x,_;if(n.columnWidths){x=new Map;for(const[B,it]of Object.entries(n.columnWidths))B!=="__label__"&&x.set(B,it);_=n.columnWidths.__label__??dn(t)}else x=Rn(t,v),_=dn(t);const P=_+$.reduce((B,it)=>B+Zt(it,x),0),R=D.reduce((B,it)=>B+Zt(it,x),0),V=k.filter(B=>B.type!=="forest").reduce((B,it)=>B+Zt(it,x),0),z=n.width??Tt.DEFAULT_WIDTH,lt=v.some(B=>B.type==="forest")||t.data.includeForest,ft=P+R+V;let nt;if(!lt)nt=0;else if(typeof n.forestWidth=="number")nt=n.forestWidth;else if(typeof t.layout.plotWidth=="number")nt=t.layout.plotWidth;else{const B=z-ft-r*2;nt=Math.max(B,Tt.MIN_FOREST_WIDTH)}const et=r*2+ft+nt,yt=Math.max(n.width??z,et);lt&&yt>et&&typeof n.forestWidth!="number"&&typeof t.layout.plotWidth!="number"&&(nt=yt-ft-r*2);const dt=e.spacing.axisGap??12,bt=dt+Tt.AXIS_HEIGHT+Tt.AXIS_LABEL_HEIGHT,Dt=g+r+p+L+bt+E+Tt.BOTTOM_MARGIN;return{totalWidth:yt,totalHeight:n.height??Dt,tableWidth:P+R,forestWidth:nt,headerHeight:p,rowHeight:s,plotHeight:L,axisHeight:Tt.AXIS_HEIGHT,nullValue:o,summaryYPosition:L-s,showOverallSummary:F,headerTextHeight:g,footerTextHeight:E,titleY:r+mt.TITLE_HEIGHT-4,subtitleY:r+C+w+mt.SUBTITLE_HEIGHT-4,mainY:g+r,footerY:g+r+p+L+bt+8,axisGap:dt,rowsHeight:H,autoWidths:x,labelWidth:_}}function hn(t){var c;const n=t.data.rows,o=Array.isArray(t.data.groups)?t.data.groups:[];if(o.length===0)return n.map(h=>({type:"data",row:h,depth:0}));const e=new Map;for(const h of o)e.set(h.id,h);const s=new Map;for(const h of n){const f=h.groupId??null;s.has(f)||s.set(f,[]),s.get(f).push(h)}const r=new Set;for(const h of s.keys()){if(!h)continue;let f=h;for(;f;)r.add(f),f=(c=e.get(f))==null?void 0:c.parentId}function l(h){return o.filter(f=>(f.parentId??null)===h&&r.has(f.id))}function d(h){if(!h)return 0;const f=e.get(h);return f?f.depth+1:0}function u(h){var p;let f=((p=s.get(h))==null?void 0:p.length)??0;for(const b of l(h))f+=u(b.id);return f}const i=[];function a(h){if(h){const p=e.get(h);if(!p)return;const b=u(h);i.push({type:"group_header",groupId:p.id,label:p.label,depth:p.depth,rowCount:b})}for(const p of l(h))a(p.id);const f=s.get(h)??[];for(const p of f)i.push({type:"data",row:p,depth:d(p.groupId)})}return a(null),i}function Qt(t){const n=[];for(const o of t)o.isGroup?n.push(...Qt(o.columns)):n.push(o);return n}function Jt(t){const n=[];for(const o of t)o.isGroup?n.push(...Qt(o.columns)):n.push(o);return n}function tn(t,n){if(n===void 0)return Jt(t);const o=[];for(const e of t)e.position===n&&(e.isGroup?o.push(...Qt(e.columns)):o.push(e));return o}function pn(t,n){return t.filter(o=>o.position===n)}function Bt(t){return t.some(n=>n.isGroup)}function ot(t){let n;return t.endsWith("rem")?n=parseFloat(t)*mt.REM_BASE:t.endsWith("px")?n=parseFloat(t):t.endsWith("pt")?n=parseFloat(t)*mt.PT_TO_PX:n=mt.DEFAULT_FONT_SIZE,Math.round(n*100)/100}function zt(t,n,o){return o==="right"?{textX:t+n-X.TEXT_PADDING,anchor:"end"}:o==="center"?{textX:t+n/2,anchor:"middle"}:{textX:t+X.TEXT_PADDING,anchor:"start"}}function O(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function gn(t,n,o,e=0){const s=n-e*2;if(ut(t,o)<=s)return t;const l="…",d=o*.55;let u=0,i=t.length;for(;u<i;){const a=Math.ceil((u+i)/2),c=t.slice(0,a);ut(c,o)+d<=s?u=a:i=a-1}return u===0?l:t.slice(0,u)+l}function zn(t){return Math.abs(t)<.01?"0":Math.abs(t)>=100?t.toFixed(0):Math.abs(t)>=10?t.toFixed(1):t.toFixed(2)}function vt(t,n){const[o,e]=t,[s,r]=n,l=(r-s)/(e-o),d=u=>s+(u-o)*l;return d.domain=()=>t,d.range=()=>n,d.ticks=u=>{const i=(e-o)/(u-1),a=[];for(let c=0;c<u;c++)a.push(o+i*c);return a},d}function Gt(t,n){const[o,e]=t.map(a=>Math.max(a,.001)),[s,r]=n,l=Math.log10(o),d=Math.log10(e),u=(r-s)/(d-l),i=a=>{const c=Math.log10(Math.max(a,.001));return s+(c-l)*u};return i.domain=()=>[o,e],i.range=()=>n,i.ticks=a=>{const c=[],h=Math.floor(Math.log10(o)),f=Math.ceil(Math.log10(e));for(let p=h;p<=f;p++){const b=Math.pow(10,p);for(const A of[1,2,5]){const N=b*A;N>=o&&N<=e&&c.push(N)}}return c.length>0?c:[o,e]},i}function Xn(t,n,o,e){const s=o.scale==="log",r=Nt,l=Math.max(n-Nt,r+50);if(e!=null&&e.xDomain){const c=e.xDomain,h=e.clipBounds??c,f=en(h,t.theme.axis,o.scale,o.nullValue);return s?{scale:Gt([Math.max(c[0],.01),Math.max(c[1],.02)],[r,l]),clipBounds:h,ticks:f}:{scale:vt(c,[r,l]),clipBounds:h,ticks:f}}const d=Mn({rows:t.data.rows,config:t.theme.axis,scale:o.scale,nullValue:o.nullValue,forestWidth:n,pointSize:t.theme.shapes.pointSize,effects:o.effects,pointCol:o.pointCol,lowerCol:o.lowerCol,upperCol:o.upperCol}),{plotRegion:u,axisLimits:i,ticks:a}=d;return s?{scale:Gt([Math.max(u[0],.01),Math.max(u[1],.02)],[r,l]),clipBounds:i,ticks:a}:{scale:vt(u,[r,l]),clipBounds:i,ticks:a}}function Un(t,n,o){var r,l,d,u;const e=[],s=o.spacing.padding;if((r=t.labels)!=null&&r.title){const i=ot(o.typography.fontSizeLg);e.push(`<text x="${s}" y="${n.titleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${i}px"
      font-weight="${o.typography.fontWeightBold}"
      fill="${o.colors.foreground}">${O(t.labels.title)}</text>`)}if((l=t.labels)!=null&&l.subtitle){const i=ot(o.typography.fontSizeBase);e.push(`<text x="${s}" y="${n.subtitleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${i}px"
      font-weight="${o.typography.fontWeightNormal}"
      fill="${o.colors.secondary}">${O(t.labels.subtitle)}</text>`)}if((d=t.labels)!=null&&d.title&&((u=t.labels)!=null&&u.subtitle)){const a=ot(o.typography.fontSizeBase)*.75,c=n.subtitleY-a-6;e.push(`<line x1="${s}" x2="${n.totalWidth-s}"
      y1="${c}" y2="${c}"
      stroke="${o.colors.border}" stroke-width="1" opacity="0.3"/>`)}return e.join(`
`)}function qn(t,n,o){var d,u,i,a;const e=[],s=o.spacing.padding;let r=n.footerY;if(!!((d=t.labels)!=null&&d.caption)||!!((u=t.labels)!=null&&u.footnote)){const c=n.footerY-8;e.push(`<line x1="${s}" x2="${n.totalWidth-s}"
      y1="${c}" y2="${c}"
      stroke="${o.colors.border}" stroke-width="1"/>`)}if((i=t.labels)!=null&&i.caption){const c=ot(o.typography.fontSizeSm);e.push(`<text x="${s}" y="${r}"
      font-family="${o.typography.fontFamily}"
      font-size="${c}px"
      font-weight="${o.typography.fontWeightNormal}"
      fill="${o.colors.secondary}">${O(t.labels.caption)}</text>`),r+=mt.CAPTION_HEIGHT}if((a=t.labels)!=null&&a.footnote){const c=ot(o.typography.fontSizeSm);e.push(`<text x="${s}" y="${r}"
      font-family="${o.typography.fontFamily}"
      font-size="${c}px"
      font-weight="${o.typography.fontWeightNormal}"
      font-style="italic"
      fill="${o.colors.muted}">${O(t.labels.footnote)}</text>`)}return e.join(`
`)}function Yn(t,n,o,e,s,r,l,d){const u=[],i=n+1,a=d.groupHeaders;let c,h,f,p,b;if(i===1?(c=ot((a==null?void 0:a.level1FontSize)??d.typography.fontSizeBase),h=(a==null?void 0:a.level1FontWeight)??d.typography.fontWeightBold,f=(a==null?void 0:a.level1Italic)??!1,p=(a==null?void 0:a.level1Background)??null,b=(a==null?void 0:a.level1BorderBottom)??!1):i===2?(c=ot((a==null?void 0:a.level2FontSize)??d.typography.fontSizeBase),h=(a==null?void 0:a.level2FontWeight)??d.typography.fontWeightMedium,f=(a==null?void 0:a.level2Italic)??!0,p=(a==null?void 0:a.level2Background)??null,b=(a==null?void 0:a.level2BorderBottom)??!1):(c=ot((a==null?void 0:a.level3FontSize)??d.typography.fontSizeBase),h=(a==null?void 0:a.level3FontWeight)??d.typography.fontWeightNormal,f=(a==null?void 0:a.level3Italic)??!1,p=(a==null?void 0:a.level3Background)??null,b=(a==null?void 0:a.level3BorderBottom)??!1),!p){const T=d.colors.primary,w=i===1?.15:i===2?.1:.06,g=T.replace("#",""),y=parseInt(g.substring(0,2),16),m=parseInt(g.substring(2,4),16),E=parseInt(g.substring(4,6),16);p=`rgba(${y}, ${m}, ${E}, ${w})`}const A=s+r/2,N=n*((a==null?void 0:a.indentPerLevel)??X.INDENT_PER_LEVEL);u.push(`<rect x="${e}" y="${s}"
    width="${l}" height="${r}"
    fill="${p}"/>`),b&&u.push(`<line x1="${e}" x2="${e+l}" y1="${s+r}" y2="${s+r}"
      stroke="${d.colors.border}" stroke-width="1" opacity="0.5"/>`);const M=f?' font-style="italic"':"",C=e+X.TEXT_PADDING+N;if(u.push(`<text class="cell-text" x="${C}" y="${A}"
    font-family="${d.typography.fontFamily}"
    font-size="${c}px"
    font-weight="${h}"${M}
    fill="${d.colors.foreground}">${O(t)}</text>`),o>0){const T=Vt(t,c,d.typography.fontFamily,h),w=C+T+6,g=ot(d.typography.fontSizeSm??"0.75rem");u.push(`<text class="cell-text" x="${w}" y="${A}"
      font-family="${d.typography.fontFamily}"
      font-size="${g}px"
      font-weight="${d.typography.fontWeightNormal}"
      fill="${d.colors.muted}">(${o})</text>`)}return u.join(`
`)}function jn(t,n){const o=new Map;for(const e of n)if(e.type==="bar"){let s=0;for(const r of t){const l=r.metadata[e.field];typeof l=="number"&&l>s&&(s=l)}o.set(e.field,s>0?s:1)}return o}function On(t,n){var e,s,r,l,d,u,i,a,c,h,f,p,b,A,N,M,C,T,w;if(n.type==="interval"){const g=(s=(e=n.options)==null?void 0:e.interval)!=null&&s.point?t.metadata[n.options.interval.point]:t.point,y=(l=(r=n.options)==null?void 0:r.interval)!=null&&l.lower?t.metadata[n.options.interval.lower]:t.lower,m=(u=(d=n.options)==null?void 0:d.interval)!=null&&u.upper?t.metadata[n.options.interval.upper]:t.upper;return ln(g,y,m,n.options)}if(n.type==="numeric"){const g=t.metadata[n.field];return typeof g=="number"?St(g,n.options):((i=n.options)==null?void 0:i.naText)??""}if(n.type==="custom"&&((a=n.options)!=null&&a.events))return sn(t,n.options);if(n.type==="pvalue"){const g=t.metadata[n.field];return typeof g!="number"?((c=n.options)==null?void 0:c.naText)??"":cn(g,n.options)}if(n.type==="icon"){const g=t.metadata[n.field];if(g==null)return"";const y=String(g),m=(f=(h=n.options)==null?void 0:h.icon)==null?void 0:f.mapping;return m&&y in m?m[y]:y}if(n.type==="badge"){const g=t.metadata[n.field];return g!=null?String(g):""}if(n.type==="stars"){const g=t.metadata[n.field];if(typeof g!="number")return"";const y=((b=(p=n.options)==null?void 0:p.stars)==null?void 0:b.maxStars)??5,m=Math.max(0,Math.min(y,g)),E=Math.floor(m),I=y-E;return"★".repeat(E)+"☆".repeat(I)}if(n.type==="img")return((N=(A=n.options)==null?void 0:A.img)==null?void 0:N.fallback)??"[IMG]";if(n.type==="reference"){const g=t.metadata[n.field];if(g==null)return"";const y=String(g),m=((C=(M=n.options)==null?void 0:M.reference)==null?void 0:C.maxChars)??30;return y.length<=m?y:y.substring(0,m)+"..."}if(n.type==="range"){const g=(T=n.options)==null?void 0:T.range;if(!g)return"";const y=t.metadata[g.minField],m=t.metadata[g.maxField],E=g.separator??" – ",I=g.decimals,F=H=>typeof H!="number"?"":I==null?Number.isInteger(H)?String(H):H.toFixed(1):H.toFixed(I);return y===null&&m===null?"":y===null?F(m):m===null?F(y):`${F(y)}${E}${F(m)}`}const o=t.metadata[n.field];return o!=null?String(o):((w=n.options)==null?void 0:w.naText)??""}function Kn(t,n,o,e,s){const r=t.filter(a=>Number.isFinite(a));if(r.length===0)return"";if(r.length===1){const a=n+e/2,c=o+s/2;return`M${a.toFixed(1)},${c.toFixed(1)}`}const l=Math.min(...r),u=Math.max(...r)-l||1;return`M${r.map((a,c)=>{const h=n+c/(r.length-1)*e,f=o+s-(a-l)/u*s;return`${h.toFixed(1)},${f.toFixed(1)}`}).join("L")}`}function Zn(t,n,o,e,s,r=[],l,d=0,u=1/0,i,a=!1){var y;let c;if(r.length===0){const m=!a||t.point!=null&&t.point>0?t.point:null,E=!a||t.lower!=null&&t.lower>0?t.lower:null,I=!a||t.upper!=null&&t.upper>0?t.upper:null;c=[{point:m,lower:E,upper:I,color:null,shape:null,opacity:null}]}else c=r.map(m=>({point:xt(t.metadata,t.point,m.pointCol,"point",a),lower:xt(t.metadata,t.lower,m.lowerCol,"lower",a),upper:xt(t.metadata,t.upper,m.upperCol,"upper",a),color:m.color??null,shape:m.shape??null,opacity:m.opacity??null}));const h=c.filter(m=>m.point!=null&&!Number.isNaN(m.point)&&m.lower!=null&&!Number.isNaN(m.lower)&&m.upper!=null&&!Number.isNaN(m.upper));if(h.length===0)return"";const f=e.shapes.pointSize,p=e.shapes.lineWidth,b=e.colors.intervalLine,A=((y=t.style)==null?void 0:y.type)==="summary",M=e.shapes.summaryHeight/2;function C(m){var I;if(m&&((I=t.markerStyle)==null?void 0:I.size)!=null)return f*t.markerStyle.size;const E=l?t.metadata[l]:void 0;if(E){const F=.5+Math.sqrt(E/100)*1.5;return Math.min(Math.max(f*F,3),f*2.5)}return f}function T(m,E){const I=E===0,F=t.markerStyle,H=e.shapes.effectColors,L=e.shapes.markerShapes,$=["square","circle","diamond","triangle"];let D;I&&(F!=null&&F.color)?D=F.color:m.color?D=m.color:H&&H.length>0?D=H[E%H.length]:D=e.colors.interval??e.colors.primary??"#2563eb";let k;I&&(F!=null&&F.shape)?k=F.shape:m.shape?k=m.shape:L&&L.length>0?k=L[E%L.length]:k=$[E%$.length];let v;return I&&(F==null?void 0:F.opacity)!=null?v=F.opacity:m.opacity!=null?v=m.opacity:v=1,{color:D,shape:k,opacity:v}}function w(m,E,I,F){const{color:H,shape:L,opacity:$}=F,D=$<1?` fill-opacity="${$}"`:"";switch(L){case"circle":return`<circle cx="${m}" cy="${E}" r="${I}" fill="${H}"${D}/>`;case"diamond":return`<polygon points="${[`${m},${E-I}`,`${m+I},${E}`,`${m},${E+I}`,`${m-I},${E}`].join(" ")}" fill="${H}"${D}/>`;case"triangle":return`<polygon points="${[`${m},${E-I}`,`${m+I},${E+I}`,`${m-I},${E+I}`].join(" ")}" fill="${H}"${D}/>`;default:return`<rect x="${m-I}" y="${E-I}" width="${I*2}" height="${I*2}" fill="${H}"${D}/>`}}const g=[];return h.forEach((m,E)=>{const I=n+_n(E,h.length),F=o(m.lower),H=o(m.upper),L=o(m.point),$=T(m,E),D=C(E===0),k=b;if(A){const v=$.opacity<1?` fill-opacity="${$.opacity}"`:"",x=[`${F},${I}`,`${L},${I-M}`,`${H},${I}`,`${L},${I+M}`].join(" ");g.push(`
        <g class="interval effect-${E} summary">
          <polygon points="${x}"
            fill="${$.color}"${v} stroke="${e.colors.summaryBorder}" stroke-width="1"/>
        </g>`)}else{const v=d+Nt,x=d+u-Nt,_=i?m.lower<i[0]:F<v,P=i?m.upper>i[1]:H>x;let R,V;if(i){const dt=Math.max(i[0],Math.min(i[1],m.lower)),bt=Math.max(i[0],Math.min(i[1],m.upper));R=o(dt),V=o(bt)}else R=Math.max(v,Math.min(x,F)),V=Math.max(v,Math.min(x,H));const z=In(e),U=z.height/2,lt=i?o(i[0]):v,ft=i?o(i[1]):x;let nt="";_?nt=`<path d="${rn("left",lt,I,z)}" fill="${z.color}"/>`:nt=`<line x1="${R}" x2="${R}" y1="${I-U}" y2="${I+U}" stroke="${k}" stroke-width="${p}"/>`;let et="";P?et=`<path d="${rn("right",ft,I,z)}" fill="${z.color}"/>`:et=`<line x1="${V}" x2="${V}" y1="${I-U}" y2="${I+U}" stroke="${k}" stroke-width="${p}"/>`;const yt=i?o(Math.max(i[0],Math.min(i[1],m.point))):Math.max(v,Math.min(x,L));g.push(`
        <g class="interval effect-${E}">
          <line x1="${R}" x2="${V}" y1="${I}" y2="${I}"
            stroke="${k}" stroke-width="${p}"/>
          ${nt}
          ${et}
          ${w(yt,I,D,$)}
        </g>`)}}),g.join("")}function Qn(t,n,o,e,s,r,l,d){const i=d.shapes.summaryHeight/2,[a,c]=s.domain().map(w=>s(w)),h=Math.min(a,c),f=Math.max(a,c),p=s(n),b=s(t),A=s(o),N=r+Math.max(h,Math.min(f,p)),M=r+Math.max(h,Math.min(f,b)),C=r+Math.max(h,Math.min(f,A));return`<polygon points="${[`${N},${e}`,`${M},${e-i}`,`${C},${e}`,`${M},${e+i}`].join(" ")}"
    fill="${d.colors.summaryFill}"
    stroke="${d.colors.summaryBorder}"
    stroke-width="1"/>`}function Jn(t,n,o,e,s,r,l,d){const u=[],i=r.effects,a=i.length;if(!i.some(N=>{const M=t.metadata[N.value];return M!=null&&!Number.isNaN(M)}))return"";const h=o*.7,f=a>1?2:0,p=(h-f*(a-1))/a,b=Math.max(4,p),A=d.shapes.effectColors??["#3b82f6","#22c55e","#f59e0b","#ef4444","#8b5cf6"];return i.forEach((N,M)=>{const C=t.metadata[N.value];if(C==null||Number.isNaN(C))return;const T=n-h/2+M*(b+f),w=e+l(Math.min(0,C)),g=Math.abs(l(C)-l(0)),y=N.color??A[M%A.length],m=N.opacity??.85;u.push(`<rect
      x="${w}" y="${T}"
      width="${Math.max(1,g)}" height="${b}"
      fill="${y}" fill-opacity="${m}" rx="2"
      class="viz-bar-segment"/>`)}),u.join(`
`)}function to(t,n,o,e,s,r,l,d){const u=[],i=r.effects,a=i.length,c=i.map(M=>{if(M.data){const C=t.metadata[M.data];return!C||!Array.isArray(C)||C.length===0?null:un(C)}if(M.min&&M.q1&&M.median&&M.q3&&M.max){const C=t.metadata[M.min],T=t.metadata[M.q1],w=t.metadata[M.median],g=t.metadata[M.q3],y=t.metadata[M.max];if([C,T,w,g,y].some(E=>E==null||Number.isNaN(E)))return null;let m=[];if(M.outliers){const E=t.metadata[M.outliers];E&&Array.isArray(E)&&(m=E)}return{min:C,q1:T,median:w,q3:g,max:y,outliers:m}}return null});if(!c.some(M=>M!==null))return"";const f=o*.7,p=a>1?2:0,b=Math.max(8,(f-(a-1)*p)/a),A=d.shapes.effectColors??["#3b82f6","#22c55e","#f59e0b","#ef4444","#8b5cf6"],N=d.colors.foreground??"#1a1a1a";return i.forEach((M,C)=>{const T=c[C];if(!T)return;const w=n-f/2+C*(b+p),g=w+b/2,y=M.color??A[C%A.length],m=M.fillOpacity??.7;u.push(`<line
      x1="${e+l(T.min)}" x2="${e+l(T.q1)}"
      y1="${g}" y2="${g}"
      stroke="${N}" stroke-width="1"/>`),u.push(`<line
      x1="${e+l(T.min)}" x2="${e+l(T.min)}"
      y1="${g-b/4}" y2="${g+b/4}"
      stroke="${N}" stroke-width="1"/>`),u.push(`<line
      x1="${e+l(T.q3)}" x2="${e+l(T.max)}"
      y1="${g}" y2="${g}"
      stroke="${N}" stroke-width="1"/>`),u.push(`<line
      x1="${e+l(T.max)}" x2="${e+l(T.max)}"
      y1="${g-b/4}" y2="${g+b/4}"
      stroke="${N}" stroke-width="1"/>`);const E=Math.max(2,l(T.q3)-l(T.q1));if(u.push(`<rect
      x="${e+l(T.q1)}" y="${w}"
      width="${E}" height="${b}"
      fill="${y}" fill-opacity="${m}"
      stroke="${N}" stroke-width="1"/>`),u.push(`<line
      x1="${e+l(T.median)}" x2="${e+l(T.median)}"
      y1="${w}" y2="${w+b}"
      stroke="${N}" stroke-width="2"/>`),r.showOutliers!==!1&&T.outliers.length>0)for(const I of T.outliers)u.push(`<circle
          cx="${e+l(I)}" cy="${g}"
          r="2.5"
          fill="none" stroke="${y}" stroke-width="1.5"/>`)}),u.join(`
`)}function no(t,n,o,e,s,r,l,d){const u=[],i=r.effects,a=i.length,c=i.map(T=>{const w=t.metadata[T.data];return!w||!Array.isArray(w)||w.length<2?null:Pn(w,r.bandwidth)}),h=i.map(T=>{const w=t.metadata[T.data];if(!w||!Array.isArray(w)||w.length<2)return null;const g=w.filter(E=>E!=null&&!Number.isNaN(E)).sort((E,I)=>E-I);if(g.length===0)return null;const y=g.length,m=E=>{if(y===1)return g[0];const I=(y-1)*E,F=Math.floor(I),H=Math.ceil(I);return F===H?g[F]:g[F]+(I-F)*(g[H]-g[F])};return{q1:m(.25),median:m(.5),q3:m(.75)}});if(!c.some(T=>T!==null))return"";const p=o*.8,b=a>1?2:0,A=Math.max(10,(p-(a-1)*b)/a),N=A/2,M=d.shapes.effectColors??["#3b82f6","#22c55e","#f59e0b","#ef4444","#8b5cf6"],C=d.colors.foreground??"#1a1a1a";return i.forEach((T,w)=>{const g=c[w],y=h[w];if(!g||g.x.length<2)return;const m=n-p/2+A/2+w*(A+b),E=T.color??M[w%M.length],I=T.fillOpacity??.5,F=Ln(g,N),H=[];for(let L=0;L<F.x.length;L++){const $=e+l(F.x[L]),D=m-F.y[L];H.push(L===0?`M ${$} ${D}`:`L ${$} ${D}`)}for(let L=F.x.length-1;L>=0;L--){const $=e+l(F.x[L]),D=m+F.y[L];H.push(`L ${$} ${D}`)}if(H.push("Z"),u.push(`<path
      d="${H.join(" ")}"
      fill="${E}" fill-opacity="${I}"
      stroke="${C}" stroke-width="0.5"/>`),r.showMedian!==!1&&y){const L=e+l(y.median);u.push(`<line
        x1="${L}" x2="${L}"
        y1="${m-N*.6}" y2="${m+N*.6}"
        stroke="${C}" stroke-width="2"/>`)}if(r.showQuartiles&&y){const L=e+l(y.q1),$=e+l(y.q3);u.push(`<line
        x1="${L}" x2="${L}"
        y1="${m-N*.4}" y2="${m+N*.4}"
        stroke="${C}" stroke-width="1" stroke-dasharray="2,2"/>`),u.push(`<line
        x1="${$}" x2="${$}"
        y1="${m-N*.4}" y2="${m+N*.4}"
        stroke="${C}" stroke-width="1" stroke-dasharray="2,2"/>`)}}),u.join(`
`)}function oo(t,n,o){var d,u;const e=n.scale==="log",s=Nt;let r=(d=n.axisRange)==null?void 0:d[0],l=(u=n.axisRange)==null?void 0:u[1];if(r==null||l==null){const i=[];for(const a of t)for(const c of n.effects){const h=a.metadata[c.value];h!=null&&!Number.isNaN(h)&&i.push(h)}i.length>0?(r=r??Math.min(0,...i),l=l??Math.max(...i)*1.1):(r=r??0,l=l??100)}return e?Gt([Math.max(.01,r),l],[s,o-s]):vt([r,l],[s,o-s])}function eo(t,n,o){var d,u;const e=n.scale==="log",s=Nt;let r=(d=n.axisRange)==null?void 0:d[0],l=(u=n.axisRange)==null?void 0:u[1];if(r==null||l==null){const i=[];for(const a of t)for(const c of n.effects)if(c.data){const h=a.metadata[c.data];if(h&&Array.isArray(h)){const f=un(h);i.push(f.min,f.max),n.showOutliers!==!1&&i.push(...f.outliers)}}else if(c.min&&c.max){const h=a.metadata[c.min],f=a.metadata[c.max];h!=null&&!Number.isNaN(h)&&i.push(h),f!=null&&!Number.isNaN(f)&&i.push(f)}if(i.length>0){const a=Math.min(...i),c=Math.max(...i),h=c-a;r=r??a-h*.05,l=l??c+h*.05}else r=r??0,l=l??100}return e?Gt([Math.max(.01,r),l],[s,o-s]):vt([r,l],[s,o-s])}function ro(t,n,o){var d,u;const e=n.scale==="log",s=Nt;let r=(d=n.axisRange)==null?void 0:d[0],l=(u=n.axisRange)==null?void 0:u[1];if(r==null||l==null){const i=[];for(const a of t)for(const c of n.effects){const h=a.metadata[c.data];h&&Array.isArray(h)&&i.push(...h.filter(f=>f!=null&&!Number.isNaN(f)))}if(i.length>0){r=r??Math.min(...i),l=l??Math.max(...i);const a=(l??0)-(r??0);r=(r??0)-a*.1,l=(l??0)+a*.1}else r=r??0,l=l??100}return e?Gt([Math.max(.01,r),l],[s,o-s]):vt([r,l],[s,o-s])}function nn(t,n,o,e,s,r,l){const d=[],u=ot(o.typography.fontSizeSm),i=jt.EDGE_THRESHOLD,a=A=>A<i?"start":A>r-i?"end":"middle",c=A=>A<i?2:A>r-i?-2:0;d.push(`<line x1="${s}" x2="${s+r}"
    y1="0" y2="0" stroke="${o.colors.border}" stroke-width="1"/>`);const h=t.domain(),f=5,p=[],b=h[1]-h[0];for(let A=0;A<=f;A++)p.push(h[0]+b*A/f);for(const A of p){const N=t(A),M=s+N,C=a(N),T=c(N),w=St(A);d.push(`<line x1="${M}" x2="${M}" y1="0" y2="4" stroke="${o.colors.border}" stroke-width="1"/>`),d.push(`<text x="${M+T}" y="14"
      text-anchor="${C}"
      font-family="${o.typography.fontFamily}"
      font-size="${u}px"
      font-weight="${o.typography.fontWeightNormal}"
      fill="${o.colors.foreground}">${w}</text>`)}return e&&d.push(`<text x="${s+r/2}" y="28"
      text-anchor="middle"
      font-family="${o.typography.fontFamily}"
      font-size="${u}px"
      font-weight="${o.typography.fontWeightMedium}"
      fill="${o.colors.foreground}">${O(e)}</text>`),d.join(`
`)}function ao(t,n,o,e,s,r,l=1,d){const u=[],i=typeof o.axis.tickCount=="number"?o.axis.tickCount:X.DEFAULT_TICK_COUNT,a=lo(t,i,o,l,r,d),c=ot(o.typography.fontSizeSm),h=jt.EDGE_THRESHOLD,f=b=>b<h?"start":b>r-h?"end":"middle",p=b=>b<h?2:b>r-h?-2:0;u.push(`<line x1="${s}" x2="${s+r}"
    y1="0" y2="0" stroke="${o.colors.border}" stroke-width="1"/>`);for(const b of a){const A=t(b),N=s+A,M=f(A),C=p(A);u.push(`<line x1="${N}" x2="${N}" y1="0" y2="4"
      stroke="${o.colors.border}" stroke-width="1"/>`),u.push(`<text x="${N+C}" y="16" text-anchor="${M}"
      font-family="${o.typography.fontFamily}"
      font-size="${c}px"
      font-weight="${o.typography.fontWeightNormal}"
      fill="${o.colors.secondary}">${zn(b)}</text>`)}return e&&u.push(`<text x="${s+r/2}" y="28"
      text-anchor="middle"
      font-family="${o.typography.fontFamily}"
      font-size="${c}px"
      font-weight="${o.typography.fontWeightMedium}"
      fill="${o.colors.secondary}">${O(e)}</text>`),`<g transform="translate(0, ${n.mainY+n.headerHeight+n.rowsHeight+n.axisGap})">${u.join(`
`)}</g>`}function so(t,n,o,e,s,r,l,d,u,i){const a=[],c=ot(r.typography.fontSizeBase),h=r.typography.headerFontScale??1.05,f=Math.round(c*h*100)/100,p=r.typography.fontWeightBold,b=r.typography.fontWeightBold,A=Bt(t),N=(M,C)=>M+C/2;if(A){const M=s/2,C=s/2;let T=o;a.push(`<text class="cell-text" x="${T+X.TEXT_PADDING}" y="${N(e,s)}"
      font-family="${r.typography.fontFamily}"
      font-size="${f}px"
      font-weight="${p}"
      fill="${r.colors.foreground}">${O(l)}</text>`),T+=d;const w=[];for(const g of t)if(g.isGroup){const y=g.columns.reduce((E,I)=>I.isGroup?E+I.columns.reduce((F,H)=>F+i(H),0):E+i(I),0),m=T+y/2;a.push(`<text class="cell-text" x="${m}" y="${N(e,M)}"
          font-family="${r.typography.fontFamily}"
          font-size="${f}px"
          font-weight="${b}"
          text-anchor="middle"
          fill="${r.colors.foreground}">${O(g.header)}</text>`),w.push({x1:T,x2:T+y}),T+=y}else{const y=i(g),m=g.headerAlign??g.align,{textX:E,anchor:I}=zt(T,y,m),F=gn(g.header,y,f,X.TEXT_PADDING);a.push(`<text class="cell-text" x="${E}" y="${N(e,s)}"
          font-family="${r.typography.fontFamily}"
          font-size="${f}px"
          font-weight="${p}"
          text-anchor="${I}"
          fill="${r.colors.foreground}">${O(F)}</text>`),T+=y}for(const g of w)a.push(`<line x1="${g.x1}" x2="${g.x2}"
        y1="${e+M}" y2="${e+M}"
        stroke="${r.colors.border}" stroke-width="1"/>`);T=o+d;for(const g of t)if(g.isGroup){for(const y of g.columns)if(!y.isGroup){const m=i(y),E=y.headerAlign??y.align,{textX:I,anchor:F}=zt(T,m,E);a.push(`<text class="cell-text" x="${I}" y="${N(e+M,C)}"
              font-family="${r.typography.fontFamily}"
              font-size="${f}px"
              font-weight="${p}"
              text-anchor="${F}"
              fill="${r.colors.foreground}">${O(y.header)}</text>`),T+=m}}else T+=i(g)}else{let M=o;a.push(`<text class="cell-text" x="${M+X.TEXT_PADDING}" y="${N(e,s)}"
      font-family="${r.typography.fontFamily}"
      font-size="${f}px"
      font-weight="${p}"
      fill="${r.colors.foreground}">${O(l)}</text>`),M+=d;for(const C of n){const T=i(C),w=C.headerAlign??C.align,{textX:g,anchor:y}=zt(M,T,w),m=gn(C.header,T,f,X.TEXT_PADDING);a.push(`<text class="cell-text" x="${g}" y="${N(e,s)}"
        font-family="${r.typography.fontFamily}"
        font-size="${f}px"
        font-weight="${p}"
        text-anchor="${y}"
        fill="${r.colors.foreground}">${O(m)}</text>`),M+=T}}return a.join(`
`)}function io(t,n,o,e,s,r,l,d,u,i,a,c,h=[]){var T,w,g,y,m,E,I,F,H,L,$,D,k,v,x,_,P,R,V,z,U,lt,ft,nt,et,yt,dt,bt,Dt,K,$t;const f=[],p=ot(r.typography.fontSizeBase),b=e+s/2,A=d*X.INDENT_PER_LEVEL+(((T=t.style)==null?void 0:T.indent)??0)*X.INDENT_PER_LEVEL,N=(w=t.style)!=null&&w.bold||(g=t.style)!=null&&g.emphasis?r.typography.fontWeightBold:r.typography.fontWeightNormal,M=(y=t.style)!=null&&y.italic?"italic":"normal";let C=r.colors.foreground;if((m=t.style)!=null&&m.color?C=t.style.color:(E=t.style)!=null&&E.muted?C=r.colors.muted:(I=t.style)!=null&&I.accent&&(C=r.colors.accent),f.push(`<text class="cell-text" x="${o+X.TEXT_PADDING+A}" y="${b}"
    font-family="${r.typography.fontFamily}"
    font-size="${p}px"
    font-weight="${N}"
    font-style="${M}"
    fill="${C}">${O(t.label)}</text>`),(F=t.style)!=null&&F.badge){const ct=String(t.style.badge),S=p*It.FONT_SCALE,Y=S+It.PADDING*2,B=Vt(t.label,p,r.typography.fontFamily,N),it=o+X.TEXT_PADDING+A+B+It.GAP,Xt=Vt(ct,S,r.typography.fontFamily,r.typography.fontWeightBold)+It.PADDING*2,G=e+(s-Y)/2;f.push(`<rect x="${it}" y="${G}" width="${Xt}" height="${Y}"
      rx="3" fill="${r.colors.primary}" opacity="0.15"/>`),f.push(`<text class="cell-text" x="${it+Xt/2}" y="${G+Y/2}"
      text-anchor="middle"
      font-family="${r.typography.fontFamily}"
      font-size="${S}px"
      font-weight="${r.typography.fontWeightBold}"
      fill="${r.colors.primary}">${O(ct)}</text>`)}for(let ct=0;ct<n.length;ct++){const S=n[ct],Y=c[ct],B=a(S);if(S.type==="forest"||S.type==="viz_bar"||S.type==="viz_boxplot"||S.type==="viz_violin")continue;const it=On(t,S),{textX:yn,anchor:Xt}=zt(Y,B,S.align);if(S.type==="bar"&&typeof t.metadata[S.field]=="number"){const G=t.metadata[S.field],W=u.get(S.field),j=((L=(H=S.options)==null?void 0:H.bar)==null?void 0:L.maxValue)??W??100,Z=((D=($=S.options)==null?void 0:$.bar)==null?void 0:D.color)??r.colors.primary,q=r.shapes.pointSize*2,J=B-X.TEXT_PADDING*2-50,tt=Math.min(G/j*J,J),rt=t.style,at=rt!=null&&rt.bold||rt!=null&&rt.emphasis?r.typography.fontWeightBold:r.typography.fontWeightNormal;f.push(`<rect x="${Y+X.TEXT_PADDING}" y="${e+s/2-q/2}"
        width="${Math.max(0,tt)}" height="${q}"
        fill="${Z}" opacity="0.7" rx="2"/>`),f.push(`<text class="cell-text" x="${Y+B-X.TEXT_PADDING}" y="${b}"
        font-family="${r.typography.fontFamily}"
        font-size="${p}px"
        font-weight="${at}"
        text-anchor="end"
        fill="${r.colors.foreground}">${St(G)}</text>`)}else if(S.type==="sparkline"&&Array.isArray(t.metadata[S.field])){let G=t.metadata[S.field];Array.isArray(G[0])&&(G=G[0]);const W=((v=(k=S.options)==null?void 0:k.sparkline)==null?void 0:v.height)??16,j=((_=(x=S.options)==null?void 0:x.sparkline)==null?void 0:_.color)??r.colors.primary,Z=X.TEXT_PADDING*2,q=Kn(G,Y+X.TEXT_PADDING,e+s/2-W/2,B-Z,W);f.push(`<path d="${q}" fill="none" stroke="${j}" stroke-width="1.5"/>`)}else if(S.type==="badge"){const G=t.metadata[S.field];if(G!=null){const W=String(G),j=p*.85,Z=j+8,q=(R=(P=S.options)==null?void 0:P.badge)==null?void 0:R.variants,Q=(z=(V=S.options)==null?void 0:V.badge)==null?void 0:z.colors;let J=r.colors.primary,tt=r.colors.primary;if(Q&&W in Q)J=Q[W],tt=Q[W];else if(q&&W in q){const Ct=q[W];J={default:r.colors.primary,...Cn,muted:r.colors.muted}[Ct]??r.colors.primary,tt=J}const at=Vt(W,j,r.typography.fontFamily,r.typography.fontWeightBold)+12,ht=S.align==="right"?Y+B-X.TEXT_PADDING-at:S.align==="center"?Y+(B-at)/2:Y+X.TEXT_PADDING,Et=e+(s-Z)/2;f.push(`<rect x="${ht}" y="${Et}" width="${at}" height="${Z}"
          rx="${Z/2}" fill="${J}" opacity="0.15"/>`),f.push(`<text class="cell-text" x="${ht+at/2}" y="${Et+Z/2}"
          text-anchor="middle"
          font-family="${r.typography.fontFamily}"
          font-size="${j}px"
          font-weight="${r.typography.fontWeightBold}"
          fill="${tt}">${O(W)}</text>`)}}else if(S.type==="stars"){const G=t.metadata[S.field];if(typeof G=="number"){const W=((lt=(U=S.options)==null?void 0:U.stars)==null?void 0:lt.maxStars)??5,j=((nt=(ft=S.options)==null?void 0:ft.stars)==null?void 0:nt.color)??"#f59e0b",Z=((yt=(et=S.options)==null?void 0:et.stars)==null?void 0:yt.emptyColor)??"#d1d5db",q=Math.max(0,Math.min(W,G)),Q=Math.floor(q),J=((bt=(dt=S.options)==null?void 0:dt.stars)==null?void 0:bt.halfStars)&&q-Q>=.5,tt=12,rt=2,at=W*tt+(W-1)*rt;let ht=S.align==="right"?Y+B-X.TEXT_PADDING-at:S.align==="center"?Y+(B-at)/2:Y+X.TEXT_PADDING;const Et=e+(s-tt)/2,Ct=(st,wt,kt)=>{const _t=kt/2,Wt=_t*.4;let Ut="";for(let Ht=0;Ht<5;Ht++){const qt=(Ht*72-90)*Math.PI/180,Mt=(Ht*72+36-90)*Math.PI/180,pt=st+_t*Math.cos(qt),$n=wt+_t*Math.sin(qt),po=st+Wt*Math.cos(Mt),go=wt+Wt*Math.sin(Mt);Ut+=(Ht===0?`M${pt},${$n}`:`L${pt},${$n}`)+`L${po},${go}`}return Ut+"Z"};for(let st=0;st<W;st++){const wt=ht+tt/2,kt=Et+tt/2,Wt=st<Q||st===Q&&J?j:Z;f.push(`<path d="${Ct(wt,kt,tt)}" fill="${Wt}"/>`),ht+=tt+rt}}}else if(S.type==="heatmap"){const G=t.metadata[S.field];if(G!=null&&!Number.isNaN(G)){const W=(Dt=S.options)==null?void 0:Dt.heatmap,j=(W==null?void 0:W.palette)??["#f7fbff","#08306b"],Z=(W==null?void 0:W.decimals)??2,q=(W==null?void 0:W.showValue)??!0;let Q=W==null?void 0:W.minValue,J=W==null?void 0:W.maxValue;if(Q==null||J==null){const Mt=h.map(pt=>pt.metadata[S.field]).filter(pt=>pt!=null&&!Number.isNaN(pt));Q==null&&(Q=Mt.length>0?Math.min(...Mt):0),J==null&&(J=Mt.length>0?Math.max(...Mt):1)}const tt=J-Q,rt=tt===0?.5:Math.max(0,Math.min(1,(G-Q)/tt)),at=Mt=>{const pt=Mt.replace("#","");return[parseInt(pt.substring(0,2),16),parseInt(pt.substring(2,4),16),parseInt(pt.substring(4,6),16)]},ht=j.length-1,Et=Math.min(Math.floor(rt*ht),ht-1),Ct=rt*ht-Et,st=at(j[Et]),wt=at(j[Et+1]),kt=Math.round(st[0]+(wt[0]-st[0])*Ct),_t=Math.round(st[1]+(wt[1]-st[1])*Ct),Wt=Math.round(st[2]+(wt[2]-st[2])*Ct),Ut=`rgb(${kt},${_t},${Wt})`,qt=(.299*kt+.587*_t+.114*Wt)/255>.5?r.colors.foreground:"#ffffff";f.push(`<rect x="${Y+2}" y="${e+2}" width="${B-4}" height="${s-4}"
          fill="${Ut}" rx="2"/>`),q&&f.push(`<text class="cell-text" x="${Y+B/2}" y="${b}"
            font-family="${r.typography.fontFamily}"
            font-size="${p*.9}px"
            font-weight="${r.typography.fontWeightNormal}"
            text-anchor="middle"
            fill="${qt}">${G.toFixed(Z)}</text>`)}}else if(S.type==="progress"){const G=t.metadata[S.field];if(G!=null&&!Number.isNaN(G)){const W=(K=S.options)==null?void 0:K.progress,j=(W==null?void 0:W.maxValue)??100,Z=(W==null?void 0:W.color)??r.colors.primary,q=(W==null?void 0:W.showLabel)??!0,Q=Math.min(100,Math.max(0,G/j*100)),J=10,tt=e+(s-J)/2,rt=q?40:0,at=B-X.TEXT_PADDING*2-rt,ht=Q/100*at;f.push(`<rect x="${Y+X.TEXT_PADDING}" y="${tt}" width="${at}" height="${J}"
          fill="${r.colors.border}" opacity="0.5" rx="5"/>`),f.push(`<rect x="${Y+X.TEXT_PADDING}" y="${tt}" width="${Math.max(0,ht)}" height="${J}"
          fill="${Z}" rx="5"/>`),q&&f.push(`<text class="cell-text" x="${Y+B-X.TEXT_PADDING}" y="${b}"
            font-family="${r.typography.fontFamily}"
            font-size="${p*.9}px"
            font-weight="${r.typography.fontWeightNormal}"
            text-anchor="end"
            fill="${r.colors.foreground}">${Math.round(Q)}%</text>`)}}else{const G=($t=t.cellStyles)==null?void 0:$t[S.field],W=t.style;let j=r.typography.fontWeightNormal;(G!=null&&G.bold||G!=null&&G.emphasis||W!=null&&W.bold||W!=null&&W.emphasis)&&(j=r.typography.fontWeightBold);let Z="normal";(G!=null&&G.italic||W!=null&&W.italic)&&(Z="italic");let q=r.colors.foreground;G!=null&&G.color?q=G.color:G!=null&&G.muted?q=r.colors.muted:G!=null&&G.accent?q=r.colors.accent:W!=null&&W.color?q=W.color:W!=null&&W.muted?q=r.colors.muted:W!=null&&W.accent&&(q=r.colors.accent),f.push(`<text class="cell-text" x="${yn}" y="${b}"
        font-family="${r.typography.fontFamily}"
        font-size="${p}px"
        font-weight="${j}"
        font-style="${Z}"
        text-anchor="${Xt}"
        fill="${q}">${O(it)}</text>`)}}return f.join(`
`)}function lo(t,n,o,e,s,r){if(Array.isArray(o.axis.tickValues)&&o.axis.tickValues.length>0){const[y,m]=t.domain();let E=o.axis.tickValues.filter(H=>H>=y&&H<=m);const I=o.axis.nullTick!==!1,F=e>=y&&e<=m;return I&&F&&!E.includes(e)&&(E=[...E,e].sort((H,L)=>H-L)),E}const[l,d]=t.domain(),u=o.axis.nullTick!==!1,i=e>=l&&e<=d,a=jt.MIN_TICK_SPACING,c=Math.max(2,Math.floor(s/a)),h=Math.min(n,Math.min(7,c)),f=r&&r.length>0?r.filter(y=>y>=l&&y<=d):t.ticks(h);if(f.length===0)return u&&i?[e]:[];const p=t(e),b=f.filter(y=>y<e).reverse(),A=f.filter(y=>y>e),N=f.some(y=>y===e),M=[];let C=p;for(const y of b){const m=t(y);C-m>=a&&(M.unshift(y),C=m)}const T=[];let w=p;for(const y of A){const m=t(y);m-w>=a&&(T.push(y),w=m)}const g=[...M];if((N||u&&i)&&g.push(e),g.push(...T),g.length<2){const y=new Set(g);y.has(l)||g.unshift(l),g.length<2&&!y.has(d)&&g.push(d)}return g}function mn(t,n,o,e,s,r,l,d=1,u=.6){let a=`<line x1="${t}" x2="${t}" y1="${n}" y2="${o}"
    stroke="${s}" stroke-width="${d}" stroke-opacity="${u}" stroke-dasharray="${e==="dashed"?"6,4":e==="dotted"?"2,2":"none"}"/>`;if(l){const c=r.colors.secondary;a+=`<text x="${t}" y="${n-4}" text-anchor="middle"
      font-family="${r.typography.fontFamily}"
      font-size="${r.typography.fontSizeSm}"
      font-weight="${r.typography.fontWeightMedium}"
      fill="${c}">${O(l)}</text>`}return a}class At extends Error{constructor(n){super(`SVG Generator: ${n}`),this.name="SVGGeneratorError"}}function co(t){if(!t||typeof t!="object")throw new At("Invalid spec: expected an object");const n=t;if(!n.data||typeof n.data!="object")throw new At("Invalid spec: missing or invalid 'data' property");const o=n.data;if(!Array.isArray(o.rows))throw new At("Invalid spec: 'data.rows' must be an array");if(!n.theme||typeof n.theme!="object")throw new At("Invalid spec: missing or invalid 'theme' property");const e=n.theme;if(!e.colors||typeof e.colors!="object")throw new At("Invalid spec: missing or invalid 'theme.colors'");if(!e.typography||typeof e.typography!="object")throw new At("Invalid spec: missing or invalid 'theme.typography'");if(!e.spacing||typeof e.spacing!="object")throw new At("Invalid spec: missing or invalid 'theme.spacing'")}function uo(t){var r;const o=tn(t.columns,void 0).find(l=>l.type==="forest");if(!o||!((r=o.options)!=null&&r.forest))return{scale:"linear",nullValue:0,effects:[],axisLabel:"Effect",pointCol:null,lowerCol:null,upperCol:null};const e=o.options.forest,s=e.scale??"linear";return{scale:s,nullValue:e.nullValue??(s==="log"?1:0),effects:e.effects??[],axisLabel:e.axisLabel??"Effect",pointCol:e.point??null,lowerCol:e.lower??null,upperCol:e.upper??null}}function fo(t,n={}){var E,I,F,H,L;co(t);const o=t.theme,e=o.spacing.padding,s=Array.isArray(t.columns)?t.columns:[],r=Jt(s),l=[];for(let $=0;$<r.length;$++)r[$].type==="forest"&&l.push($);l.length>0;const d=[];for(let $=0;$<r.length;$++){const D=r[$];(D.type==="viz_bar"||D.type==="viz_boxplot"||D.type==="viz_violin")&&d.push({index:$,type:D.type,column:D})}const u=uo(t),i=Bn(t,n,u.nullValue),a=i.autoWidths,c=$=>{var k,v,x,_,P,R,V,z;if($.type==="forest"){const U=a.get($.id);return U!==void 0?U:typeof $.width=="number"?$.width:((v=(k=$.options)==null?void 0:k.forest)==null?void 0:v.width)??i.forestWidth}if($.type==="viz_bar"){const U=a.get($.id);return U!==void 0?U:typeof $.width=="number"?$.width:((_=(x=$.options)==null?void 0:x.vizBar)==null?void 0:_.width)??i.forestWidth}if($.type==="viz_boxplot"){const U=a.get($.id);return U!==void 0?U:typeof $.width=="number"?$.width:((R=(P=$.options)==null?void 0:P.vizBoxplot)==null?void 0:R.width)??i.forestWidth}if($.type==="viz_violin"){const U=a.get($.id);return U!==void 0?U:typeof $.width=="number"?$.width:((z=(V=$.options)==null?void 0:V.vizViolin)==null?void 0:z.width)??i.forestWidth}const D=a.get($.id);return D!==void 0?D:typeof $.width=="number"?$.width:Tt.DEFAULT_COLUMN_WIDTH},h=[];let f=e+i.labelWidth;for(const $ of r)h.push(f),f+=c($);const p=[];p.push(`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
  width="${i.totalWidth}" height="${i.totalHeight}"
  viewBox="0 0 ${i.totalWidth} ${i.totalHeight}">
<style>
  text {
    font-variant-numeric: tabular-nums;
  }
  /* Use dominant-baseline for cell text to match CSS flex centering */
  .cell-text { dominant-baseline: central; }
</style>`);const b=n.backgroundColor??o.colors.background;if(p.push(`<rect width="100%" height="100%" fill="${b}"/>`),o.layout.containerBorder!==!1){const $=o.layout.containerBorderRadius??8;p.push(`<rect x="0.5" y="0.5"
      width="${i.totalWidth-1}" height="${i.totalHeight-1}"
      fill="none" stroke="${o.colors.border}" stroke-width="1"
      rx="${$}" ry="${$}"/>`)}p.push(Un(t,i,o)),p.push(`<line x1="${e}" x2="${i.totalWidth-e}"
    y1="${i.mainY}" y2="${i.mainY}"
    stroke="${o.colors.border}" stroke-width="2"/>`);const A=i.mainY;p.push(so(s,r,e,A,i.headerHeight,o,t.data.labelHeader??"Study",i.labelWidth,a,c)),p.push(`<line x1="${e}" x2="${i.totalWidth-e}"
    y1="${A+i.headerHeight}" y2="${A+i.headerHeight}"
    stroke="${o.colors.border}" stroke-width="2"/>`);const N=hn(t),M=[],C=[];let T=0;for(const $ of N){const k=$.type==="data"&&((E=$.row.style)==null?void 0:E.type)==="spacer"?i.rowHeight/2:i.rowHeight;M.push(T),C.push(k),T+=k}const w=i.mainY+i.headerHeight;N.forEach(($,D)=>{var k,v,x,_;if($.type==="data"){const P=$.row,R=w+M[D],V=C[D];if((k=P.style)!=null&&k.bg)p.push(`<rect x="${e}" y="${R}"
          width="${i.totalWidth-e*2}" height="${V}"
          fill="${P.style.bg}"/>`);else if(((v=P.style)==null?void 0:v.type)==="header")p.push(`<rect x="${e}" y="${R}"
          width="${i.totalWidth-e*2}" height="${V}"
          fill="${o.colors.muted}" fill-opacity="0.1"/>`);else if(o.layout.banding&&!(((x=P.style)==null?void 0:x.type)==="summary"||((_=P.style)==null?void 0:_.type)==="spacer")){const lt=D%2===1?o.colors.altBg:o.colors.rowBg;lt!==o.colors.background&&p.push(`<rect x="${e}" y="${R}"
              width="${i.totalWidth-e*2}" height="${V}"
              fill="${lt}"/>`)}}});for(const $ of l){const D=r[$],k=h[$],v=c(D),x=(I=D.options)==null?void 0:I.forest,_=(x==null?void 0:x.scale)??"linear",P=(x==null?void 0:x.nullValue)??(_==="log"?1:0),R=(x==null?void 0:x.axisLabel)??"Effect",V=_==="log";let z=(x==null?void 0:x.effects)??[];const U=(x==null?void 0:x.point)??null,lt=(x==null?void 0:x.lower)??null,ft=(x==null?void 0:x.upper)??null;z.length===0&&(U||lt||ft)&&(z=[{pointCol:U,lowerCol:lt,upperCol:ft}]);const nt={scale:_,nullValue:P,effects:z,pointCol:(x==null?void 0:x.point)??null,lowerCol:(x==null?void 0:x.lower)??null,upperCol:(x==null?void 0:x.upper)??null},{scale:et,clipBounds:yt,ticks:dt}=Xn(t,v,nt,n),bt=k+et(P);p.push(mn(bt,w,w+i.rowsHeight,"dashed",o.colors.muted,o));const Dt=(x==null?void 0:x.annotations)??[];for(const K of Dt)if(K.type==="reference_line"){const $t=k+et(K.x);p.push(mn($t,w,w+i.rowsHeight,K.style,K.color??o.colors.accent,o,K.label,K.width??1,K.opacity??.6))}if(N.forEach((K,$t)=>{if(K.type==="data"){const ct=w+M[$t]+C[$t]/2;p.push(Zn(K.row,ct,S=>k+et(S),o,P,z,t.data.weightCol,k,v,yt,V))}}),t.data.overall&&i.showOverallSummary&&typeof t.data.overall.point=="number"&&!Number.isNaN(t.data.overall.point)&&typeof t.data.overall.lower=="number"&&!Number.isNaN(t.data.overall.lower)&&typeof t.data.overall.upper=="number"&&!Number.isNaN(t.data.overall.upper)){const K=w+i.summaryYPosition;p.push(Qn(t.data.overall.point,t.data.overall.lower,t.data.overall.upper,K,et,k,v,o))}p.push(ao(et,i,o,R,k,v,P,dt))}const g=t.data.rows;for(const $ of d){const D=$.column,k=h[$.index],v=c(D);if($.type==="viz_bar"){const x=(F=D.options)==null?void 0:F.vizBar;if(!x)continue;const _=oo(g,x,v);N.forEach((P,R)=>{if(P.type==="data"){const V=w+M[R]+C[R]/2,z=C[R];p.push(Jn(P.row,V,z,k,v,x,_,o))}}),x.showAxis!==!1&&(p.push(`<g transform="translate(0, ${w+i.plotHeight})">`),p.push(nn(_,i,o,x.axisLabel,k,v,x.nullValue)),p.push("</g>"))}else if($.type==="viz_boxplot"){const x=(H=D.options)==null?void 0:H.vizBoxplot;if(!x)continue;const _=eo(g,x,v);N.forEach((P,R)=>{if(P.type==="data"){const V=w+M[R]+C[R]/2,z=C[R];p.push(to(P.row,V,z,k,v,x,_,o))}}),x.showAxis!==!1&&(p.push(`<g transform="translate(0, ${w+i.plotHeight})">`),p.push(nn(_,i,o,x.axisLabel,k,v,x.nullValue)),p.push("</g>"))}else if($.type==="viz_violin"){const x=(L=D.options)==null?void 0:L.vizViolin;if(!x)continue;const _=ro(g,x,v);N.forEach((P,R)=>{if(P.type==="data"){const V=w+M[R]+C[R]/2,z=C[R];p.push(no(P.row,V,z,k,v,x,_,o))}}),x.showAxis!==!1&&(p.push(`<g transform="translate(0, ${w+i.plotHeight})">`),p.push(nn(_,i,o,x.axisLabel,k,v,x.nullValue)),p.push("</g>"))}}const y=i.mainY+i.headerHeight,m=jn(g,r);return N.forEach(($,D)=>{var x,_,P;const k=y+M[D],v=C[D];if($.type==="group_header")p.push(Yn($.label,$.depth,$.rowCount,e,k,v,i.totalWidth-e*2,o));else{const R=$.row,V=$.depth;((x=R.style)==null?void 0:x.type)==="spacer"||p.push(io(R,r,e,k,v,o,i.labelWidth,V,m,a,c,h,g))}if($.type==="data"){const R=$.row,V=((_=R.style)==null?void 0:_.type)==="summary",z=((P=R.style)==null?void 0:P.type)==="spacer";V&&p.push(`<line x1="${e}" x2="${i.totalWidth-e}"
          y1="${k}" y2="${k}"
          stroke="${o.colors.border}" stroke-width="2"/>`),z||p.push(`<line x1="${e}" x2="${i.totalWidth-e}"
          y1="${k+v}" y2="${k+v}"
          stroke="${o.colors.border}" stroke-width="1"/>`)}else p.push(`<line x1="${e}" x2="${i.totalWidth-e}"
        y1="${k+v}" y2="${k+v}"
        stroke="${o.colors.border}" stroke-width="1"/>`)}),p.push(qn(t,i,o)),p.push("</svg>"),p.join(`
`)}function ho(t,n){const o=JSON.parse(t);return fo(o,n)}globalThis.generateSVG=ho})();
