(function(){"use strict";function Dt(t,n){if(n){const p=[.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100];let r=p[0];for(const c of p)if(c<=t[0])r=c;else break;let u=p[p.length-1];for(let c=p.length-1;c>=0&&p[c]>=t[1];c--)u=p[c];return[r,u]}const o=t[1]-t[0];if(o===0)return t;const e=Math.pow(10,Math.floor(Math.log10(o))),i=o/e;let a;i<=1?a=e*.1:i<=2?a=e*.2:i<=5?a=e*.5:a=e;const s=Math.floor(t[0]/a)*a,g=Math.ceil(t[1]/a)*a;return[s,g]}const Wt=.06,ut=.04;function Ht(t){return t<=0?0:ut+t*ut}const P={DEFAULT_LABEL_WIDTH:200,DEFAULT_COLUMN_WIDTH:100,AXIS_HEIGHT:32,AXIS_LABEL_HEIGHT:20,BOTTOM_MARGIN:16,MIN_FOREST_WIDTH:200,DEFAULT_WIDTH:800,COLUMN_GAP:16},z={TITLE_HEIGHT:28,SUBTITLE_HEIGHT:20,CAPTION_HEIGHT:16,FOOTNOTE_HEIGHT:14,DEFAULT_FONT_SIZE:14,REM_BASE:16,TEXT_BASELINE_ADJUSTMENT:1/3},F={INDENT_PER_LEVEL:12,TEXT_PADDING:10,WHISKER_HALF_HEIGHT:4,DEFAULT_TICK_COUNT:5,AXIS_LABEL_PADDING:30},ft={GROUP_HEADER_HEIGHT_MULTIPLIER:1.3,OVERALL_ROW_HEIGHT_MULTIPLIER:1.5},K={PADDING:28,MIN:60,MAX:600,LABEL_MAX:400,VISUAL_MIN:{sparkline:88,bar:100,stars:80,range:80,badge:70}},q={CHEVRON_WIDTH:12,GAP:6,INTERNAL_PADDING:20},Lt={PADDING:16};function Q(t,n){const o=t.split(".");return o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,n),o.join(".")}function it(t){const n=Math.abs(t),o=t<0?"-":"";if(n>=1e12)throw new Error(`Cannot abbreviate value >= 1 trillion: ${t}`);if(n>=1e9){const e=n/1e9;return o+at(e)+"B"}if(n>=1e6){const e=n/1e6;return o+at(e)+"M"}if(n>=1e3){const e=n/1e3;return o+at(e)+"K"}return o+Math.round(n).toString()}function at(t){const n=Math.round(t*10)/10;return n===Math.floor(n)?n.toFixed(0):n.toFixed(1)}const wt={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","-":"⁻","+":"⁺"};function Gt(t){return t.split("").map(n=>wt[n]??n).join("")}function tt(t,n){var g,p,r,u,c;if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";if(n!=null&&n.percent){const{decimals:f,digits:m,multiply:h=!0,symbol:x=!0}=n.percent,W=h?t*100:t,_=m!=null?W.toPrecision(m):W.toFixed(f??1);return x?`${_}%`:_}if(((g=n==null?void 0:n.numeric)==null?void 0:g.abbreviate)&&Math.abs(t)>=1e3)return it(t);const e=(p=n==null?void 0:n.numeric)==null?void 0:p.digits;if(e!=null){const f=t.toPrecision(e),m=(r=n==null?void 0:n.numeric)==null?void 0:r.thousandsSep;return m&&typeof m=="string"?Q(f,m):f}const i=(u=n==null?void 0:n.numeric)==null?void 0:u.decimals,a=(c=n==null?void 0:n.numeric)==null?void 0:c.thousandsSep;let s;return i!==void 0?s=t.toFixed(i):Number.isInteger(t)||Math.abs(t-Math.round(t))<1e-4?s=Math.round(t).toString():s=t.toFixed(2),a&&typeof a=="string"&&(s=Q(s,a)),s}function ht(t,n){const{eventsField:o,nField:e,separator:i="/",showPct:a=!1,thousandsSep:s,abbreviate:g}=n.events,p=t.metadata[o],r=t.metadata[e];if(p==null||r===void 0||r===null)return n.naText??"";const u=Number(p),c=Number(r);let f,m;g&&(u>=1e3||c>=1e3)?(f=u>=1e3?it(u):String(u),m=c>=1e3?it(c):String(c)):(f=String(u),m=String(c),s&&typeof s=="string"&&(f=Q(f,s),m=Q(m,s)));let h=`${f}${i}${m}`;if(a&&c>0){const x=(u/c*100).toFixed(1);h+=` (${x}%)`}return h}function pt(t,n,o,e){var g,p,r;if(t==null||Number.isNaN(t))return"";const i=((g=e==null?void 0:e.interval)==null?void 0:g.decimals)??2,a=((p=e==null?void 0:e.interval)==null?void 0:p.sep)??" ",s=(r=e==null?void 0:e.interval)==null?void 0:r.impreciseThreshold;return n==null||o===void 0||o===null||Number.isNaN(n)||Number.isNaN(o)?t.toFixed(i):s!=null&&n>0&&o/n>s?"—":`${t.toFixed(i)}${a}(${n.toFixed(i)}, ${o.toFixed(i)})`}function gt(t,n){if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";const o=n==null?void 0:n.pvalue,e=(o==null?void 0:o.digits)??2,i=(o==null?void 0:o.expThreshold)??.001,a=(o==null?void 0:o.abbrevThreshold)??null,s=(o==null?void 0:o.format)??"auto",g=(o==null?void 0:o.stars)??!1,p=(o==null?void 0:o.thresholds)??[.05,.01,.001];let r="";if(g&&(t<p[2]?r="***":t<p[1]?r="**":t<p[0]&&(r="*")),a!==null&&t<a)return`<${a}${r}`;if(s==="scientific"||s==="auto"&&t<i){const c=Math.floor(Math.log10(t));return`${(t/Math.pow(10,c)).toPrecision(e)}×10${Gt(c.toString())}${r}`}let u;return t>=.1?u=t.toFixed(e):t>=.01?u=t.toFixed(e+1):u=t.toFixed(e+2),`${u}${r}`}function Ft(t,n){var a,s,g,p;const{type:o,field:e,options:i}=n;switch(o){case"interval":{const r=(a=i==null?void 0:i.interval)!=null&&a.point?t.metadata[i.interval.point]:t.point,u=(s=i==null?void 0:i.interval)!=null&&s.lower?t.metadata[i.interval.lower]:t.lower,c=(g=i==null?void 0:i.interval)!=null&&g.upper?t.metadata[i.interval.upper]:t.upper;return pt(r,u,c,i)}case"custom":return i!=null&&i.events?ht(t,i):String(t.metadata[e]??"");case"pvalue":return gt(t.metadata[e],i);case"numeric":return tt(t.metadata[e],i);case"percent":return tt(t.metadata[e],i);case"sparkline":case"icon":case"stars":case"img":case"range":return"";case"badge":{const r=t.metadata[e];return r==null?"":`  ${String(r)}  `}case"bar":{if(((p=i==null?void 0:i.bar)==null?void 0:p.showLabel)===!1)return"";const r=t.metadata[e];return r==null?"":r>=100?r.toFixed(0):r>=10?r.toFixed(1):r.toFixed(2)}case"text":default:return String(t.metadata[e]??"")}}function V(t,n){const o="⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻";let e=0;for(const i of t)o.includes(i)?e+=n*.3:"il1.,;:|!()[]{}' ".includes(i)?e+=n*.35:"×−".includes(i)?e+=n*.5:"mwMW@%".includes(i)?e+=n*.85:i>="0"&&i<="9"?e+=n*.6:e+=n*.55;return e}function kt(t,n){var a,s;const o=new Map,e=j(t.theme.typography.fontSizeBase),i=t.data.rows;for(const g of n){if(g.width!=="auto"&&g.width!==null&&g.width!==void 0)continue;let p=0;g.header&&(p=Math.max(p,V(g.header,e)));for(const c of i){if(((a=c.style)==null?void 0:a.type)==="header"||((s=c.style)==null?void 0:s.type)==="spacer")continue;const f=Ft(c,g);f&&(p=Math.max(p,V(f,e)))}const r=K.VISUAL_MIN[g.type]??K.MIN,u=Math.ceil(p+K.PADDING);o.set(g.id,Math.min(K.MAX,Math.max(r,u)))}return vt(t.columns,o,e),o}function vt(t,n,o){function e(s){return s.isGroup?s.columns.flatMap(e):[s]}function i(s){const g=n.get(s.id);return g!==void 0?g:typeof s.width=="number"?s.width:K.MIN}function a(s){if(s.isGroup){for(const g of s.columns)a(g);if(s.header){const g=V(s.header,o)+Lt.PADDING,p=e(s),r=p.reduce((u,c)=>u+i(c),0);if(g>r&&p.length>0){const u=Math.ceil((g-r)/p.length);for(const c of p)n.set(c.id,i(c)+u)}}}}for(const s of t)a(s)}function mt(t){var g,p;const n=j(t.theme.typography.fontSizeBase);let o=0;const e=new Map,i=Array.isArray(t.data.groups)?t.data.groups:[];for(const r of i)e.set(r.id,r.depth);const a=r=>r?(e.get(r)??0)+1:0;t.data.labelHeader&&(o=Math.max(o,V(t.data.labelHeader,n)));for(const r of t.data.rows)if(r.label){const u=a(r.groupId),c=((g=r.style)==null?void 0:g.indent)??0,m=(u+c)*F.INDENT_PER_LEVEL;let h=V(r.label,n)+m;if((p=r.style)!=null&&p.badge){const x=String(r.style.badge),W=n*.8,_=4,M=6,N=V(x,W)+_*2;h+=M+N}o=Math.max(o,h)}for(const r of i)if(r.label){const u=r.depth*F.INDENT_PER_LEVEL,c=V(r.label,n),m=`(${t.data.rows.filter(_=>_.groupId===r.id).length})`,h=n*.75,x=V(m,h),W=u+q.CHEVRON_WIDTH+q.GAP+c+q.GAP+x+q.INTERNAL_PADDING;o=Math.max(o,W)}const s=Math.ceil(o+K.PADDING);return Math.min(K.LABEL_MAX,Math.max(K.MIN,s))}function st(t,n){const o=n.get(t.id);return o!==void 0?o:typeof t.width=="number"?t.width:P.DEFAULT_COLUMN_WIDTH}function Pt(t,n){var v,B,R,X,J;const o=t.theme,e=o.spacing.rowHeight,i=o.spacing.padding,a=Array.isArray(t.columns)?t.columns:[],s=nt(a,"left"),g=nt(a,"right"),r=lt(s)||lt(g)?o.spacing.headerHeight*ft.GROUP_HEADER_HEIGHT_MULTIPLIER:o.spacing.headerHeight,u=!!((v=t.labels)!=null&&v.title),c=!!((B=t.labels)!=null&&B.subtitle),f=!!((R=t.labels)!=null&&R.caption),m=!!((X=t.labels)!=null&&X.footnote),h=u?z.TITLE_HEIGHT:0,x=c?z.SUBTITLE_HEIGHT:0,W=h+x+(u||c?i:0),_=f?z.CAPTION_HEIGHT:0,M=m?z.FOOTNOTE_HEIGHT:0,H=_+M+(f||m?i:0),N=yt(t),E=!!t.data.overall;let d=0;for(const U of N){const Y=U.type==="data"&&((J=U.row.style)==null?void 0:J.type)==="spacer";d+=Y?e/2:e}E&&(d+=e*ft.OVERALL_ROW_HEIGHT_MULTIPLIER);const l=et(a,"left"),y=et(a,"right"),$=[...l,...y];let b,D;if(n.columnWidths){b=new Map;for(const[U,Y]of Object.entries(n.columnWidths))U!=="__label__"&&b.set(U,Y);D=n.columnWidths.__label__??mt(t)}else b=kt(t,$),D=mt(t);const I=D+l.reduce((U,Y)=>U+st(Y,b),0),G=y.reduce((U,Y)=>U+st(Y,b),0),L=n.width??P.DEFAULT_WIDTH,S=t.data.includeForest,A=I+G;let w;if(!S)w=0;else if(typeof n.forestWidth=="number")w=n.forestWidth;else if(typeof t.layout.plotWidth=="number")w=t.layout.plotWidth;else{const U=L-A-P.COLUMN_GAP*2-i*2;w=Math.max(U,P.MIN_FOREST_WIDTH)}const T=i*2+A+w+P.COLUMN_GAP*2,k=Math.max(n.width??L,T),O=W+i+r+d+P.AXIS_HEIGHT+P.AXIS_LABEL_HEIGHT+H+P.BOTTOM_MARGIN;return{totalWidth:k,totalHeight:n.height??O,tableWidth:I+G,forestWidth:w,headerHeight:r,rowHeight:e,plotHeight:d,axisHeight:P.AXIS_HEIGHT,nullValue:t.data.nullValue,summaryYPosition:d-e,showOverallSummary:E,headerTextHeight:W,footerTextHeight:H,titleY:i+z.TITLE_HEIGHT-8,subtitleY:i+h+z.SUBTITLE_HEIGHT-4,mainY:W+i,footerY:W+i+r+d+P.AXIS_HEIGHT+P.AXIS_LABEL_HEIGHT+i,autoWidths:b,labelWidth:D}}function yt(t){var c;const n=t.data.rows,o=Array.isArray(t.data.groups)?t.data.groups:[];if(o.length===0)return n.map(f=>({type:"data",row:f,depth:0}));const e=new Map;for(const f of o)e.set(f.id,f);const i=new Map;for(const f of n){const m=f.groupId??null;i.has(m)||i.set(m,[]),i.get(m).push(f)}const a=new Set;for(const f of i.keys()){if(!f)continue;let m=f;for(;m;)a.add(m),m=(c=e.get(m))==null?void 0:c.parentId}function s(f){return o.filter(m=>(m.parentId??null)===f&&a.has(m.id))}function g(f){if(!f)return 0;const m=e.get(f);return m?m.depth+1:0}function p(f){var h;let m=((h=i.get(f))==null?void 0:h.length)??0;for(const x of s(f))m+=p(x.id);return m}const r=[];function u(f){if(f){const h=e.get(f);if(!h)return;const x=p(f);r.push({type:"group_header",groupId:h.id,label:h.label,depth:h.depth,rowCount:x})}for(const h of s(f))u(h.id);const m=i.get(f)??[];for(const h of m)r.push({type:"data",row:h,depth:g(h.groupId)})}return u(null),r}function $t(t){const n=[];for(const o of t)o.isGroup?n.push(...$t(o.columns)):n.push(o);return n}function et(t,n){const o=[];for(const e of t)e.position===n&&(e.isGroup?o.push(...$t(e.columns)):o.push(e));return o}function nt(t,n){return t.filter(o=>o.position===n)}function lt(t){return t.some(n=>n.isGroup)}function j(t){return t.endsWith("rem")?parseFloat(t)*z.REM_BASE:t.endsWith("px")?parseFloat(t):z.DEFAULT_FONT_SIZE}function ot(t,n,o){return o==="right"?{textX:t+n-F.TEXT_PADDING,anchor:"end"}:o==="center"?{textX:t+n/2,anchor:"middle"}:{textX:t+F.TEXT_PADDING,anchor:"start"}}function C(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function ct(t,n,o,e=0){const i=n-e*2;if(V(t,o)<=i)return t;const s="…",g=o*.55;let p=0,r=t.length;for(;p<r;){const u=Math.ceil((p+r)/2),c=t.slice(0,u);V(c,o)+g<=i?p=u:r=u-1}return p===0?s:t.slice(0,p)+s}function Rt(t){return Math.abs(t)<.01?"0":Math.abs(t)>=100?t.toFixed(0):Math.abs(t)>=10?t.toFixed(1):t.toFixed(2)}function xt(t,n){const[o,e]=t,[i,a]=n,s=(a-i)/(e-o),g=p=>i+(p-o)*s;return g.domain=()=>t,g.range=()=>n,g.ticks=p=>{const r=(e-o)/(p-1),u=[];for(let c=0;c<p;c++)u.push(o+r*c);return u},g}function bt(t,n){const[o,e]=t.map(u=>Math.max(u,.001)),[i,a]=n,s=Math.log10(o),g=Math.log10(e),p=(a-i)/(g-s),r=u=>{const c=Math.log10(Math.max(u,.001));return i+(c-s)*p};return r.domain=()=>[o,e],r.range=()=>n,r.ticks=u=>{const c=[],f=Math.floor(Math.log10(o)),m=Math.ceil(Math.log10(e));for(let h=f;h<=m;h++){const x=Math.pow(10,h);for(const W of[1,2,5]){const _=x*W;_>=o&&_<=e&&c.push(_)}}return c.length>0?c:[o,e]},r}function Ct(t,n,o){const e=t.data.scale==="log";if(o!=null&&o.xDomain){const E=o.xDomain;return e?bt([Math.max(E[0],.01),Math.max(E[1],.02)],[0,n]):xt(E,[0,n])}const i=t.data.rows,a=t.theme.axis,s=t.data.nullValue,g=(a==null?void 0:a.padding)??.15,p=(a==null?void 0:a.includeNull)??!0,r=a==null?void 0:a.symmetric,u=(a==null?void 0:a.markerMargin)??!0,c=(a==null?void 0:a.ciTruncationThreshold)??3,f=typeof(a==null?void 0:a.rangeMin)=="number",m=typeof(a==null?void 0:a.rangeMax)=="number";let h;if(f&&m)h=[a.rangeMin,a.rangeMax];else{const E=i.map(d=>d.point).filter(d=>d!=null&&!Number.isNaN(d)&&Number.isFinite(d));if(E.length===0)h=e?[.1,10]:[0,1];else{let d=Math.min(...E),l=Math.max(...E);p&&(d=Math.min(d,s),l=Math.max(l,s));const y=d,$=l,b=l-d||1,D=b*c,I=i.map(T=>T.lower).filter(T=>T!=null&&!Number.isNaN(T)&&Number.isFinite(T)),G=i.map(T=>T.upper).filter(T=>T!=null&&!Number.isNaN(T)&&Number.isFinite(T));for(const T of I)d-T<=D&&(d=Math.min(d,T));for(const T of G)T-l<=D&&(l=Math.max(l,T));let L=f?a.rangeMin:d-b*g,S=m?a.rangeMax:l+b*g;const A=E.some(T=>T<s)&&E.some(T=>T>s);if((r===!0||r===null&&A)&&!f&&!m)if(e){const T=Math.log(s),k=Math.max(Math.abs(Math.log(Math.max(y,.001))-T),Math.abs(Math.log($)-T));L=Math.exp(T-k),S=Math.exp(T+k)}else{const T=Math.max(Math.abs(y-s),Math.abs($-s));L=s-T,S=s+T}h=[L,S]}}const x=Dt(h,e),W=F.AXIS_LABEL_PADDING,_=n-2*W;let M=x;if(u&&_>0){const E=t.theme.shapes.pointSize,d=x[1]-x[0],l=E/2*(d/_);if(e){const y=l/x[0];M=[x[0]/(1+y),x[1]*(1+y)]}else M=[x[0]-l,x[1]+l]}const H=W,N=Math.max(n-W,H+50);return e?bt([Math.max(M[0],.01),Math.max(M[1],.02)],[H,N]):xt(M,[H,N])}function Bt(t,n,o){var a,s;const e=[],i=o.spacing.padding;if((a=t.labels)!=null&&a.title){const g=j(o.typography.fontSizeLg);e.push(`<text x="${i}" y="${n.titleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${g}px"
      font-weight="${o.typography.fontWeightBold}"
      fill="${o.colors.foreground}">${C(t.labels.title)}</text>`)}if((s=t.labels)!=null&&s.subtitle){const g=j(o.typography.fontSizeBase);e.push(`<text x="${i}" y="${n.subtitleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${g}px"
      fill="${o.colors.secondary}">${C(t.labels.subtitle)}</text>`)}return e.join(`
`)}function Xt(t,n,o){var s,g;const e=[],i=o.spacing.padding;let a=n.footerY;if((s=t.labels)!=null&&s.caption){const p=j(o.typography.fontSizeSm);e.push(`<text x="${i}" y="${a}"
      font-family="${o.typography.fontFamily}"
      font-size="${p}px"
      fill="${o.colors.secondary}">${C(t.labels.caption)}</text>`),a+=z.CAPTION_HEIGHT}if((g=t.labels)!=null&&g.footnote){const p=j(o.typography.fontSizeSm);e.push(`<text x="${i}" y="${a}"
      font-family="${o.typography.fontFamily}"
      font-size="${p}px"
      font-style="italic"
      fill="${o.colors.muted}">${C(t.labels.footnote)}</text>`)}return e.join(`
`)}function Tt(t,n,o,e,i,a,s,g,p){const r=[],u=j(a.typography.fontSizeBase),c=a.typography.fontWeightMedium,f=a.typography.fontWeightBold,m=lt(t),h=g??P.DEFAULT_LABEL_WIDTH,x=M=>{if(p){const H=p.get(M.id);if(H!==void 0)return H}return typeof M.width=="number"?M.width:P.DEFAULT_COLUMN_WIDTH},W=M=>M.isGroup?M.columns.reduce((H,N)=>H+W(N),0):x(M),_=(M,H)=>M+H/2+u*z.TEXT_BASELINE_ADJUSTMENT;if(m){const M=i/2,H=i/2;let N=o;s&&(r.push(`<text x="${N+F.TEXT_PADDING}" y="${_(e,i)}"
        font-family="${a.typography.fontFamily}"
        font-size="${u}px"
        font-weight="${c}"
        fill="${a.colors.foreground}">${C(s)}</text>`),N+=h);const E=[];for(const d of t)if(d.isGroup){const l=W(d),y=N+l/2;r.push(`<text x="${y}" y="${_(e,M)}"
          font-family="${a.typography.fontFamily}"
          font-size="${u}px"
          font-weight="${f}"
          text-anchor="middle"
          fill="${a.colors.foreground}">${C(d.header)}</text>`),E.push({x1:N,x2:N+l}),N+=l}else{const l=x(d),y=d.headerAlign??d.align,{textX:$,anchor:b}=ot(N,l,y),D=ct(d.header,l,u,F.TEXT_PADDING);r.push(`<text x="${$}" y="${_(e,i)}"
          font-family="${a.typography.fontFamily}"
          font-size="${u}px"
          font-weight="${c}"
          text-anchor="${b}"
          fill="${a.colors.foreground}">${C(D)}</text>`),N+=l}for(const d of E)r.push(`<line x1="${d.x1}" x2="${d.x2}"
        y1="${e+M}" y2="${e+M}"
        stroke="${a.colors.border}" stroke-width="1" opacity="0.5"/>`);N=o+(s?h:0);for(const d of t)if(d.isGroup){for(const l of d.columns)if(!l.isGroup){const y=x(l),$=l.headerAlign??l.align,{textX:b,anchor:D}=ot(N,y,$);r.push(`<text x="${b}" y="${_(e+M,H)}"
              font-family="${a.typography.fontFamily}"
              font-size="${u}px"
              font-weight="${c}"
              text-anchor="${D}"
              fill="${a.colors.foreground}">${C(l.header)}</text>`),N+=y}}else{const l=x(d);N+=l}}else{let M=o;s&&(r.push(`<text x="${M+F.TEXT_PADDING}" y="${_(e,i)}"
        font-family="${a.typography.fontFamily}"
        font-size="${u}px"
        font-weight="${c}"
        fill="${a.colors.foreground}">${C(s)}</text>`),M+=h);for(const H of n){const N=x(H),E=H.headerAlign??H.align,{textX:d,anchor:l}=ot(M,N,E),y=ct(H.header,N,u,F.TEXT_PADDING);r.push(`<text x="${d}" y="${_(e,i)}"
        font-family="${a.typography.fontFamily}"
        font-size="${u}px"
        font-weight="${c}"
        text-anchor="${l}"
        fill="${a.colors.foreground}">${C(y)}</text>`),M+=N}}return r.join(`
`)}function Ut(t,n,o,e,i,a,s){const g=[],p=n+1,r=s.groupHeaders;let u,c,f,m,h;if(p===1?(u=j((r==null?void 0:r.level1FontSize)??s.typography.fontSizeBase),c=(r==null?void 0:r.level1FontWeight)??s.typography.fontWeightBold,f=(r==null?void 0:r.level1Italic)??!1,m=(r==null?void 0:r.level1Background)??null,h=(r==null?void 0:r.level1BorderBottom)??!1):p===2?(u=j((r==null?void 0:r.level2FontSize)??s.typography.fontSizeBase),c=(r==null?void 0:r.level2FontWeight)??s.typography.fontWeightMedium,f=(r==null?void 0:r.level2Italic)??!0,m=(r==null?void 0:r.level2Background)??null,h=(r==null?void 0:r.level2BorderBottom)??!1):(u=j((r==null?void 0:r.level3FontSize)??s.typography.fontSizeBase),c=(r==null?void 0:r.level3FontWeight)??s.typography.fontWeightNormal,f=(r==null?void 0:r.level3Italic)??!1,m=(r==null?void 0:r.level3Background)??null,h=(r==null?void 0:r.level3BorderBottom)??!1),!m){const M=s.colors.primary,H=p===1?.15:p===2?.1:.06,N=M.replace("#",""),E=parseInt(N.substring(0,2),16),d=parseInt(N.substring(2,4),16),l=parseInt(N.substring(4,6),16);m=`rgba(${E}, ${d}, ${l}, ${H})`}const x=e+i/2+u*z.TEXT_BASELINE_ADJUSTMENT,W=n*((r==null?void 0:r.indentPerLevel)??F.INDENT_PER_LEVEL);g.push(`<rect x="${o}" y="${e}"
    width="${a}" height="${i}"
    fill="${m}"/>`),h&&g.push(`<line x1="${o}" x2="${o+a}" y1="${e+i}" y2="${e+i}"
      stroke="${s.colors.border}" stroke-width="1" opacity="0.5"/>`);const _=f?' font-style="italic"':"";return g.push(`<text x="${o+F.TEXT_PADDING+W}" y="${x}"
    font-family="${s.typography.fontFamily}"
    font-size="${u}px"
    font-weight="${c}"${_}
    fill="${s.colors.foreground}">${C(t)}</text>`),g.join(`
`)}function Mt(t,n){const o=new Map;for(const e of n)if(e.type==="bar"){let i=0;for(const a of t){const s=a.metadata[e.field];typeof s=="number"&&s>i&&(i=s)}o.set(e.field,i>0?i:1)}return o}function Et(t,n,o,e,i,a,s,g=P.DEFAULT_LABEL_WIDTH,p=0,r,u){var W,_,M,H,N,E,d,l,y,$,b,D,I,G,L,S;const c=[],f=j(a.typography.fontSizeBase),m=e+i/2+f*z.TEXT_BASELINE_ADJUSTMENT;let h=o;const x=A=>{if(u){const w=u.get(A.id);if(w!==void 0)return w}return typeof A.width=="number"?A.width:P.DEFAULT_COLUMN_WIDTH};if(s){const A=p*F.INDENT_PER_LEVEL+(((W=t.style)==null?void 0:W.indent)??0)*F.INDENT_PER_LEVEL,w=(_=t.style)!=null&&_.bold||(M=t.style)!=null&&M.emphasis?a.typography.fontWeightBold:a.typography.fontWeightNormal,T=(H=t.style)!=null&&H.italic?"italic":"normal";let k=a.colors.foreground;(N=t.style)!=null&&N.color?k=t.style.color:(E=t.style)!=null&&E.muted?k=a.colors.muted:(d=t.style)!=null&&d.accent&&(k=a.colors.accent);const O=g-A-F.TEXT_PADDING*2,v=ct(t.label,O,f,0);if(c.push(`<text x="${h+F.TEXT_PADDING+A}" y="${m}"
      font-family="${a.typography.fontFamily}"
      font-size="${f}px"
      font-weight="${w}"
      font-style="${T}"
      fill="${k}">${C(v)}</text>`),(l=t.style)!=null&&l.badge){const B=String(t.style.badge),R=f*.8,X=4,J=6,U=R+X*2,Y=V(t.label,f),rt=h+F.TEXT_PADDING+A+Y+J,_t=V(B,R)+X*2,St=e+(i-U)/2;c.push(`<rect x="${rt}" y="${St}" width="${_t}" height="${U}"
        rx="3" fill="${a.colors.primary}" opacity="0.15"/>`),c.push(`<text x="${rt+_t/2}" y="${St+U/2+R*.35}"
        text-anchor="middle"
        font-family="${a.typography.fontFamily}"
        font-size="${R}px"
        font-weight="500"
        fill="${a.colors.primary}">${C(B)}</text>`)}h+=g}for(const A of n){const w=x(A),T=Ot(t,A),{textX:k,anchor:O}=ot(h,w,A.align);if(A.type==="bar"&&typeof t.metadata[A.field]=="number"){const v=t.metadata[A.field],B=r==null?void 0:r.get(A.field),R=(($=(y=A.options)==null?void 0:y.bar)==null?void 0:$.maxValue)??B??100,X=((D=(b=A.options)==null?void 0:b.bar)==null?void 0:D.color)??a.colors.primary,J=a.shapes.pointSize*2,Y=w-F.TEXT_PADDING*2-50,rt=Math.min(v/R*Y,Y);c.push(`<rect x="${h+F.TEXT_PADDING}" y="${e+i/2-J/2}"
        width="${Math.max(0,rt)}" height="${J}"
        fill="${X}" opacity="0.7" rx="2"/>`);const At=h+w-F.TEXT_PADDING;c.push(`<text x="${At}" y="${m}"
        font-family="${a.typography.fontFamily}"
        font-size="${f}px"
        text-anchor="end"
        fill="${a.colors.foreground}">${tt(v)}</text>`)}else if(A.type==="sparkline"&&Array.isArray(t.metadata[A.field])){let v=t.metadata[A.field];Array.isArray(v[0])&&(v=v[0]);const B=((G=(I=A.options)==null?void 0:I.sparkline)==null?void 0:G.height)??16,R=((S=(L=A.options)==null?void 0:L.sparkline)==null?void 0:S.color)??a.colors.primary,X=F.TEXT_PADDING*2,J=zt(v,h+F.TEXT_PADDING,e+i/2-B/2,w-X,B);c.push(`<path d="${J}" fill="none" stroke="${R}" stroke-width="1.5"/>`)}else c.push(`<text x="${k}" y="${m}"
        font-family="${a.typography.fontFamily}"
        font-size="${f}px"
        text-anchor="${O}"
        fill="${a.colors.foreground}">${C(T)}</text>`);h+=w}return c.join(`
`)}function Ot(t,n){var e,i,a,s,g,p,r,u,c,f,m,h,x,W,_,M,H,N,E;if(n.type==="interval"){const d=(i=(e=n.options)==null?void 0:e.interval)!=null&&i.point?t.metadata[n.options.interval.point]:t.point,l=(s=(a=n.options)==null?void 0:a.interval)!=null&&s.lower?t.metadata[n.options.interval.lower]:t.lower,y=(p=(g=n.options)==null?void 0:g.interval)!=null&&p.upper?t.metadata[n.options.interval.upper]:t.upper;return pt(d,l,y,n.options)}if(n.type==="numeric"){const d=t.metadata[n.field];return typeof d=="number"?tt(d,n.options):((r=n.options)==null?void 0:r.naText)??""}if(n.type==="custom"&&((u=n.options)!=null&&u.events))return ht(t,n.options);if(n.type==="pvalue"){const d=t.metadata[n.field];return typeof d!="number"?((c=n.options)==null?void 0:c.naText)??"":gt(d,n.options)}if(n.type==="icon"){const d=t.metadata[n.field];if(d==null)return"";const l=String(d),y=(m=(f=n.options)==null?void 0:f.icon)==null?void 0:m.mapping;return y&&l in y?y[l]:l}if(n.type==="badge"){const d=t.metadata[n.field];return d!=null?String(d):""}if(n.type==="stars"){const d=t.metadata[n.field];if(typeof d!="number")return"";const l=((x=(h=n.options)==null?void 0:h.stars)==null?void 0:x.maxStars)??5,y=Math.max(0,Math.min(l,d)),$=Math.floor(y),b=l-$;return"★".repeat($)+"☆".repeat(b)}if(n.type==="img")return((_=(W=n.options)==null?void 0:W.img)==null?void 0:_.fallback)??"[IMG]";if(n.type==="reference"){const d=t.metadata[n.field];if(d==null)return"";const l=String(d),y=((H=(M=n.options)==null?void 0:M.reference)==null?void 0:H.maxChars)??30;return l.length<=y?l:l.substring(0,y)+"..."}if(n.type==="range"){const d=(N=n.options)==null?void 0:N.range;if(!d)return"";const l=t.metadata[d.minField],y=t.metadata[d.maxField],$=d.separator??" – ",b=d.decimals,D=I=>typeof I!="number"?"":b==null?Number.isInteger(I)?String(I):I.toFixed(1):I.toFixed(b);return l===null&&y===null?"":l===null?D(y):y===null?D(l):`${D(l)}${$}${D(y)}`}const o=t.metadata[n.field];return o!=null?String(o):((E=n.options)==null?void 0:E.naText)??""}function zt(t,n,o,e,i){const a=t.filter(u=>Number.isFinite(u));if(a.length===0)return"";if(a.length===1){const u=n+e/2,c=o+i/2;return`M${u.toFixed(1)},${c.toFixed(1)}`}const s=Math.min(...a),p=Math.max(...a)-s||1;return`M${a.map((u,c)=>{const f=n+c/(a.length-1)*e,m=o+i-(u-s)/p*i;return`${f.toFixed(1)},${m.toFixed(1)}`}).join("L")}`}const It=6;function dt(t,n,o){const e=t.metadata[n];return e!=null&&typeof e=="number"&&!Number.isNaN(e)?e:o}function Vt(t,n){return n<=1?0:-((n-1)*It)/2+t*It}function jt(t,n,o,e,i,a=[],s,g=0,p=1/0){var d;let r;a.length===0?r=[{point:t.point,lower:t.lower,upper:t.upper,color:null,shape:null,opacity:null}]:r=a.map(l=>({point:dt(t,l.pointCol,t.point),lower:dt(t,l.lowerCol,t.lower),upper:dt(t,l.upperCol,t.upper),color:l.color??null,shape:l.shape??null,opacity:l.opacity??null}));const u=r.filter(l=>l.point!=null&&!Number.isNaN(l.point)&&l.lower!=null&&!Number.isNaN(l.lower)&&l.upper!=null&&!Number.isNaN(l.upper));if(u.length===0)return"";const c=e.shapes.pointSize,f=e.shapes.lineWidth,m=e.colors.intervalLine,h=F.WHISKER_HALF_HEIGHT,x=((d=t.style)==null?void 0:d.type)==="summary",_=e.shapes.summaryHeight/2;function M(l){var $;if(l&&(($=t.markerStyle)==null?void 0:$.size)!=null)return c*t.markerStyle.size;const y=s?t.metadata[s]:void 0;if(y){const b=.5+Math.sqrt(y/100)*1.5;return Math.min(Math.max(c*b,3),c*2.5)}return c}function H(l,y){const $=y===0,b=t.markerStyle,D=e.shapes.markerColors,I=e.shapes.markerShapes,G=["square","circle","diamond","triangle"];let L;$&&(b!=null&&b.color)?L=b.color:l.color?L=l.color:D&&D.length>0?L=D[y%D.length]:L=e.colors.interval??e.colors.primary??"#2563eb";let S;$&&(b!=null&&b.shape)?S=b.shape:l.shape?S=l.shape:I&&I.length>0?S=I[y%I.length]:S=G[y%G.length];let A;return $&&(b==null?void 0:b.opacity)!=null?A=b.opacity:l.opacity!=null?A=l.opacity:A=1,{color:L,shape:S,opacity:A}}function N(l,y,$,b){const{color:D,shape:I,opacity:G}=b,L=G<1?` fill-opacity="${G}"`:"";switch(I){case"circle":return`<circle cx="${l}" cy="${y}" r="${$}" fill="${D}"${L}/>`;case"diamond":return`<polygon points="${[`${l},${y-$}`,`${l+$},${y}`,`${l},${y+$}`,`${l-$},${y}`].join(" ")}" fill="${D}"${L}/>`;case"triangle":return`<polygon points="${[`${l},${y-$}`,`${l+$},${y+$}`,`${l-$},${y+$}`].join(" ")}" fill="${D}"${L}/>`;default:return`<rect x="${l-$}" y="${y-$}" width="${$*2}" height="${$*2}" fill="${D}"${L}/>`}}const E=[];return u.forEach((l,y)=>{const $=n+Vt(y,u.length),b=o(l.lower),D=o(l.upper),I=o(l.point),G=H(l,y),L=M(y===0),S=m;if(x){const A=G.opacity<1?` fill-opacity="${G.opacity}"`:"",w=[`${b},${$}`,`${I},${$-_}`,`${D},${$}`,`${I},${$+_}`].join(" ");E.push(`
        <g class="interval effect-${y} summary">
          <polygon points="${w}"
            fill="${G.color}"${A} stroke="${e.colors.summaryBorder}" stroke-width="1"/>
        </g>`)}else{const A=F.AXIS_LABEL_PADDING,w=g+A,T=g+p-A,k=b<w,O=D>T,v=Math.max(w,Math.min(T,b)),B=Math.max(w,Math.min(T,D));let R="";k?R=`<path d="M ${w} ${$} L ${w+6} ${$-4} L ${w+6} ${$+4} Z" fill="${S}"/>`:R=`<line x1="${v}" x2="${v}" y1="${$-h}" y2="${$+h}" stroke="${S}" stroke-width="${f}"/>`;let X="";O?X=`<path d="M ${T} ${$} L ${T-6} ${$-4} L ${T-6} ${$+4} Z" fill="${S}"/>`:X=`<line x1="${B}" x2="${B}" y1="${$-h}" y2="${$+h}" stroke="${S}" stroke-width="${f}"/>`,E.push(`
        <g class="interval effect-${y}">
          <line x1="${v}" x2="${B}" y1="${$}" y2="${$}"
            stroke="${S}" stroke-width="${f}"/>
          ${R}
          ${X}
          ${N(I,$,L,G)}
        </g>`)}}),E.join("")}function Yt(t,n,o,e,i,a,s,g){const r=g.shapes.summaryHeight/2,[u,c]=i.domain().map(E=>i(E)),f=Math.min(u,c),m=Math.max(u,c),h=i(n),x=i(t),W=i(o),_=a+Math.max(f,Math.min(m,h)),M=a+Math.max(f,Math.min(m,x)),H=a+Math.max(f,Math.min(m,W));return`<polygon points="${[`${_},${e}`,`${M},${e-r}`,`${H},${e}`,`${M},${e+r}`].join(" ")}"
    fill="${g.colors.summaryFill}"
    stroke="${g.colors.summaryBorder}"
    stroke-width="1"/>`}function Jt(t,n,o,e,i,a=1){const s=[],g=typeof o.axis.tickCount=="number"?o.axis.tickCount:F.DEFAULT_TICK_COUNT,p=Kt(t,g,o,a,n.forestWidth),r=j(o.typography.fontSizeSm),u=35,c=m=>m<u?"start":m>n.forestWidth-u?"end":"middle",f=m=>m<u?2:m>n.forestWidth-u?-2:0;s.push(`<line x1="${i}" x2="${i+n.forestWidth}"
    y1="0" y2="0" stroke="${o.colors.border}" stroke-width="1"/>`);for(const m of p){const h=t(m),x=i+h,W=c(h),_=f(h);s.push(`<line x1="${x}" x2="${x}" y1="0" y2="4"
      stroke="${o.colors.border}" stroke-width="1"/>`),s.push(`<text x="${x+_}" y="16" text-anchor="${W}"
      font-family="${o.typography.fontFamily}"
      font-size="${r}px"
      fill="${o.colors.secondary}">${Rt(m)}</text>`)}return e&&s.push(`<text x="${i+n.forestWidth/2}" y="28"
      text-anchor="middle"
      font-family="${o.typography.fontFamily}"
      font-size="${r}px"
      font-weight="500"
      fill="${o.colors.secondary}">${C(e)}</text>`),`<g transform="translate(0, ${n.mainY+n.headerHeight+n.plotHeight})">${s.join(`
`)}</g>`}function Kt(t,n,o,e,i){if(Array.isArray(o.axis.tickValues)&&o.axis.tickValues.length>0){const[d,l]=t.domain();let y=o.axis.tickValues.filter(D=>D>=d&&D<=l);const $=o.axis.nullTick!==!1,b=e>=d&&e<=l;return $&&b&&!y.includes(e)&&(y=[...y,e].sort((D,I)=>D-I)),y}const[a,s]=t.domain(),g=o.axis.nullTick!==!1,p=e>=a&&e<=s,r=50,u=Math.max(2,Math.floor(i/r)),c=Math.min(n,Math.min(7,u)),f=t.ticks(c);if(f.length===0)return g&&p?[e]:[];const m=t(e),h=f.filter(d=>d<e).reverse(),x=f.filter(d=>d>e),W=f.some(d=>d===e),_=[];let M=m;for(const d of h){const l=t(d);M-l>=r&&(_.unshift(d),M=l)}const H=[];let N=m;for(const d of x){const l=t(d);l-N>=r&&(H.push(d),N=l)}const E=[..._];if((W||g&&p)&&E.push(e),E.push(...H),E.length<2){const d=new Set(E);d.has(a)||E.unshift(a),E.length<2&&!d.has(s)&&E.push(s)}return E}function Nt(t,n,o,e,i,a,s=1,g=.6){let r=`<line x1="${t}" x2="${t}" y1="${n}" y2="${o}"
    stroke="${i}" stroke-width="${s}" stroke-opacity="${g}" stroke-dasharray="${e==="dashed"?"6,4":e==="dotted"?"2,2":"none"}"/>`;return a&&(r+=`<text x="${t}" y="${n-4}" text-anchor="middle"
      font-size="10px" fill="${i}">${C(a)}</text>`),r}class Z extends Error{constructor(n){super(`SVG Generator: ${n}`),this.name="SVGGeneratorError"}}function Zt(t){if(!t||typeof t!="object")throw new Z("Invalid spec: expected an object");const n=t;if(!n.data||typeof n.data!="object")throw new Z("Invalid spec: missing or invalid 'data' property");const o=n.data;if(!Array.isArray(o.rows))throw new Z("Invalid spec: 'data.rows' must be an array");if(!n.theme||typeof n.theme!="object")throw new Z("Invalid spec: missing or invalid 'theme' property");const e=n.theme;if(!e.colors||typeof e.colors!="object")throw new Z("Invalid spec: missing or invalid 'theme.colors'");if(!e.typography||typeof e.typography!="object")throw new Z("Invalid spec: missing or invalid 'theme.typography'");if(!e.spacing||typeof e.spacing!="object")throw new Z("Invalid spec: missing or invalid 'theme.spacing'")}function qt(t,n={}){var D;Zt(t);const o=t.theme,e=Pt(t,n),i=o.spacing.padding,a=Array.isArray(t.columns)?t.columns:[],s=nt(a,"left"),g=nt(a,"right"),p=et(a,"left"),r=et(a,"right"),u=e.labelWidth+p.reduce((I,G)=>I+st(G,e.autoWidths),0),c=i+u+P.COLUMN_GAP,f=Ct(t,e.forestWidth,n),m=c+e.forestWidth+P.COLUMN_GAP,h=[];h.push(`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
  width="${e.totalWidth}" height="${e.totalHeight}"
  viewBox="0 0 ${e.totalWidth} ${e.totalHeight}">`);const x=n.backgroundColor??o.colors.background;h.push(`<rect width="100%" height="100%" fill="${x}"/>`),h.push(Bt(t,e,o)),h.push(`<line x1="${i}" x2="${e.totalWidth-i}"
    y1="${e.mainY}" y2="${e.mainY}"
    stroke="${o.colors.border}" stroke-width="2"/>`);const W=e.mainY;h.push(Tt(s,p,i,W,e.headerHeight,o,t.data.labelHeader??"Study",e.labelWidth,e.autoWidths)),r.length>0&&h.push(Tt(g,r,m,W,e.headerHeight,o,void 0,void 0,e.autoWidths)),h.push(`<line x1="${i}" x2="${e.totalWidth-i}"
    y1="${W+e.headerHeight}" y2="${W+e.headerHeight}"
    stroke="${o.colors.border}" stroke-width="2"/>`);const _=yt(t),H=(Array.isArray(t.data.groups)?t.data.groups:[]).length>0,N=[],E=[];let d=0;for(const I of _){const L=I.type==="data"&&((D=I.row.style)==null?void 0:D.type)==="spacer"?e.rowHeight/2:e.rowHeight;N.push(d),E.push(L),d+=L}if(t.data.includeForest&&e.forestWidth>0){const I=e.mainY+e.headerHeight,G=c+f(t.data.nullValue);h.push(Nt(G,I,I+e.plotHeight,"dashed",o.colors.muted));const L=Array.isArray(t.annotations)?t.annotations:[];for(const S of L)if(S.type==="reference_line"){const A=c+f(S.x);h.push(Nt(A,I,I+e.plotHeight,S.style,S.color??o.colors.accent,S.label,S.width??1,S.opacity??.6))}if(_.forEach((S,A)=>{if(S.type==="data"){const w=I+N[A]+E[A]/2;h.push(jt(S.row,w,T=>c+f(T),o,t.data.nullValue,t.data.effects,t.data.weightCol,c,e.forestWidth))}}),t.data.overall&&e.showOverallSummary&&typeof t.data.overall.point=="number"&&!Number.isNaN(t.data.overall.point)&&typeof t.data.overall.lower=="number"&&!Number.isNaN(t.data.overall.lower)&&typeof t.data.overall.upper=="number"&&!Number.isNaN(t.data.overall.upper)){const S=I+e.summaryYPosition;h.push(Yt(t.data.overall.point,t.data.overall.lower,t.data.overall.upper,S,f,c,e.forestWidth,o))}h.push(Jt(f,e,o,t.data.axisLabel,c,t.data.nullValue))}const l=e.mainY+e.headerHeight,y=t.data.rows,$=Mt(y,p),b=Mt(y,r);return _.forEach((I,G)=>{var A,w,T;const L=l+N[G],S=E[G];if(I.type==="group_header")h.push(Ut(I.label,I.depth,i,L,S,e.totalWidth-i*2,o));else{const k=I.row,O=I.depth;if(!(((A=k.style)==null?void 0:A.type)==="spacer")){const B=Ht(O),R=!H&&G%2===1?Wt:0,X=Math.max(B,R);X>0&&h.push(`<rect x="${i}" y="${L}"
            width="${e.totalWidth-i*2}" height="${S}"
            fill="${o.colors.muted}" opacity="${X}"/>`)}h.push(Et(k,p,i,L,S,o,!0,e.labelWidth,O,$,e.autoWidths)),r.length>0&&h.push(Et(k,r,m,L,S,o,!1,0,O,b,e.autoWidths))}if(I.type==="data"){const k=I.row,O=((w=k.style)==null?void 0:w.type)==="summary",v=((T=k.style)==null?void 0:T.type)==="spacer";O&&h.push(`<line x1="${i}" x2="${e.totalWidth-i}"
          y1="${L}" y2="${L}"
          stroke="${o.colors.border}" stroke-width="2"/>`),v||h.push(`<line x1="${i}" x2="${e.totalWidth-i}"
          y1="${L+S}" y2="${L+S}"
          stroke="${o.colors.border}" stroke-width="1"/>`)}else h.push(`<line x1="${i}" x2="${e.totalWidth-i}"
        y1="${L+S}" y2="${L+S}"
        stroke="${o.colors.border}" stroke-width="1"/>`)}),h.push(Xt(t,e,o)),h.push("</svg>"),h.join(`
`)}function Qt(t,n){const o=JSON.parse(t);return qt(o,n)}globalThis.generateSVG=Qt})();
