(function(){"use strict";const Vt=[1,5,2,2.5,4,3],at=[.001,.002,.005,.01,.02,.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100,150,200,300,500,750,1e3];function bt(t,n){return n?pn(t):gn(t)}function pn(t){if(t[0]<=0||t[1]<=0)return[.1,10];if(t[0]>=t[1])return t;let n=at[0];for(const e of at)if(e<=t[0])n=e;else break;t[0]<at[0]&&(n=Math.pow(10,Math.floor(Math.log10(t[0]))));let o=at[at.length-1];for(let e=at.length-1;e>=0&&at[e]>=t[1];e--)o=at[e];return t[1]>at[at.length-1]&&(o=Math.pow(10,Math.ceil(Math.log10(t[1])))),[n,o]}function gn(t){const n=t[1]-t[0];if(n===0)return t;if(n<0)return[t[1],t[0]];const o=Math.pow(10,Math.floor(Math.log10(n)));let e=o,a=1/0;for(const h of Vt)for(const s of[.1,1,10]){const r=h*o*s;if(r<=0)continue;const l=Math.floor(t[0]/r)*r,c=(Math.ceil(t[1]/r)*r-l)/n-1;c>=0&&c<a&&(a=c,e=r)}const i=Math.floor(t[0]/e)*e,u=Math.ceil(t[1]/e)*e;return[Math.round(i*1e10)/1e10,Math.round(u*1e10)/1e10]}function lt(t,n,o,e,a=!1){if(t&&o in t){const i=t[o];if(typeof i=="number"&&Number.isFinite(i)&&(!a||i>0))return i}return o===e&&n!=null&&Number.isFinite(n)&&(!a||n>0)?n:null}const mn=20;function yn(t){const{rows:n,config:o,scale:e,nullValue:a,forestWidth:i,pointSize:u,effects:h=[],pointCol:s,lowerCol:r,upperCol:l}=t,d=$n(n,o,e,a,h,s,r,l),f=xn(d,o,e,i,u),c=jt(d,o,e,a);return{axisLimits:d,plotRegion:f,ticks:c}}function $n(t,n,o,e,a=[],i,u,h){const s=n.rangeMin!=null,r=n.rangeMax!=null;if(s&&r)return[n.rangeMin,n.rangeMax];const l=[],d=o==="log",f=i||"point";for(const I of t){const v=lt(I.metadata,void 0,f,"point",d);v!=null&&l.push(v);for(const Y of a){const X=lt(I.metadata,void 0,Y.pointCol,"point",d);X!=null&&l.push(X)}}if(l.length===0)return o==="log"?[.1,10]:[-1,1];let c=Math.min(...l),$=Math.max(...l);(n.includeNull??!0)&&(c=Math.min(c,e),$=Math.max($,e));const _=c,A=$;let S;if(d){const I=Math.max(c,.001),v=Math.max($,.001);S=Math.log(v)-Math.log(I)}else S=$-c;if(S===0||!Number.isFinite(S)){const I=l[0];if(d)return bt([I/2,I*2],!0);{const v=Math.max(1,Math.abs(I)*.1);return bt([I-v,I+v],!1)}}const[C,N]=bt([c,$],d),F=n.ciClipFactor??2;let y=C,m=N;const p=[],E=[],g=u||"lower",b=h||"upper";for(const I of t){const v=lt(I.metadata,void 0,g,"lower",d);v!=null&&p.push(v);const Y=lt(I.metadata,void 0,b,"upper",d);Y!=null&&E.push(Y);for(const X of a){const V=lt(I.metadata,void 0,X.lowerCol,"lower",d);V!=null&&p.push(V);const B=lt(I.metadata,void 0,X.upperCol,"upper",d);B!=null&&E.push(B)}}let x,w;if(d)x=y/F,w=m*F;else{const I=m-y;x=y-I*F,w=m+I*F}let T=!1,G=!1;for(const I of p)I>=x?y=Math.min(y,I):T=!0;for(const I of E)I<=w?m=Math.max(m,I):G=!0;if(T&&(y=Math.min(y,x)),G&&(m=Math.max(m,w)),n.symmetric===!0&&!s&&!r)if(o==="log"){const I=Math.log(e),v=Math.max(Math.abs(Math.log(Math.max(_,.001))-I),Math.abs(Math.log(A)-I));y=Math.exp(I-v),m=Math.exp(I+v)}else{const I=Math.max(Math.abs(_-e),Math.abs(A-e));y=e-I,m=e+I}let R=s?n.rangeMin:y,L=r?n.rangeMax:m;return bt([R,L],o==="log")}function xn(t,n,o,e,a){if(!(n.markerMargin??!0)||e<=0)return t;const u=e-2*mn;if(u<=0)return t;if(o==="log"){const r=Math.log(Math.max(t[0],.001)),l=Math.log(Math.max(t[1],.001)),d=l-r,f=a/2*(d/u),c=Math.min(f,.5);return[Math.exp(r-c),Math.exp(l+c)]}const h=t[1]-t[0],s=a/2*(h/u);return[t[0]-s,t[1]+s]}function jt(t,n,o,e){const[a,i]=t,u=e>=a&&e<=i,h=(n.nullTick??!0)&&u;if(n.tickValues&&n.tickValues.length>0){let l=n.tickValues.filter(d=>d>=a&&d<=i);return h&&!l.includes(e)&&(l=[...l,e].sort((d,f)=>d-f)),l}const s=n.tickCount??5;let r=o==="log"?bn(t,s):Mn(t,s);return h&&!r.includes(e)&&(r=[...r,e].sort((l,d)=>l-d)),r}function Mn(t,n){const[o,e]=t,a=e-o;if(a===0)return[o];const i=a/Math.max(n-1,1),u=Math.pow(10,Math.floor(Math.log10(i)));let h=u,s=1/0;for(const d of Vt){const f=d*u,c=Math.floor(a/f)+1,$=Math.abs(c-n);$<s&&(s=$,h=f);const M=d*u/10;if(M>0){const _=Math.floor(a/M)+1,A=Math.abs(_-n);A<s&&(s=A,h=M)}}const r=Math.ceil(o/h)*h,l=[];for(let d=r;d<=e+h*.001;d+=h){const f=Math.round(d*1e10)/1e10;f>=o&&f<=e&&l.push(f)}return l.length<2&&(l.includes(o)||l.unshift(o),l.includes(e)||l.push(e)),l}function bn(t,n){const[o,e]=t,i=[.01,.02,.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100,150,200,500,1e3].filter(s=>s>=o&&s<=e);if(i.length<=n)return i;const u=[1,.1,10,100,.5,2,5,.2,.25,1.5,3,4,20,50],h=[];for(const s of u)i.includes(s)&&h.length<n&&h.push(s);if(h.length<n){const s=i.filter(l=>!h.includes(l)),r=Math.max(1,Math.floor(s.length/(n-h.length)));for(let l=0;l<s.length&&h.length<n;l+=r)h.push(s[l])}return h.sort((s,r)=>s-r)}function Tn(t){var e,a;const n=((e=t==null?void 0:t.shapes)==null?void 0:e.lineWidth)??1.5,o=((a=t==null?void 0:t.colors)==null?void 0:a.intervalLine)??"#475569";return{width:Math.max(4,Math.round(n*3)),height:Math.max(6,Math.round(n*4)),color:o,opacity:1}}function Yt(t,n,o,e){const{width:a,height:i}=e,u=i/2;return t==="left"?`M ${n} ${o} L ${n+a} ${o-u} L ${n+a} ${o+u} Z`:`M ${n} ${o} L ${n-a} ${o-u} L ${n-a} ${o+u} Z`}const Lt={RENDERING_BUFFER:4},ht={FONT_SCALE:.8,PADDING:4,GAP:6},Q={DEFAULT_COLUMN_WIDTH:100,AXIS_HEIGHT:32,AXIS_LABEL_HEIGHT:20,BOTTOM_MARGIN:16,MIN_FOREST_WIDTH:200,DEFAULT_WIDTH:800,COLUMN_GAP:16},tt={TITLE_HEIGHT:28,SUBTITLE_HEIGHT:20,CAPTION_HEIGHT:16,FOOTNOTE_HEIGHT:14,DEFAULT_FONT_SIZE:14,REM_BASE:16,TEXT_BASELINE_ADJUSTMENT:1/3},H={INDENT_PER_LEVEL:12,TEXT_PADDING:10,DEFAULT_TICK_COUNT:5,AXIS_LABEL_PADDING:30},Ot={GROUP_HEADER_HEIGHT_MULTIPLIER:1.3,OVERALL_ROW_HEIGHT_MULTIPLIER:1.5},yt={MIN:60,MAX:600,LABEL_MAX:400,VISUAL_MIN:{sparkline:92,bar:100,stars:84,range:84,badge:74}},Tt={CHEVRON_WIDTH:12,GAP:6,SAFETY_MARGIN:8},Jt={SPACING:6};function En(t,n){return n<=1?0:-((n-1)*Jt.SPACING)/2+t*Jt.SPACING}function Et(t,n){const o=t.split(".");return o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,n),o.join(".")}function Ht(t){const n=Math.abs(t),o=t<0?"-":"";if(n>=1e12)throw new Error(`Cannot abbreviate value >= 1 trillion: ${t}`);if(n>=1e9){const e=n/1e9;return o+vt(e)+"B"}if(n>=1e6){const e=n/1e6;return o+vt(e)+"M"}if(n>=1e3){const e=n/1e3;return o+vt(e)+"K"}return o+Math.round(n).toString()}function vt(t){const n=Math.round(t*10)/10;return n===Math.floor(n)?n.toFixed(0):n.toFixed(1)}const In={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","-":"⁻","+":"⁺"};function An(t){return t.split("").map(n=>In[n]??n).join("")}function It(t,n){var h,s,r,l,d;if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";if(n!=null&&n.percent){const{decimals:f,digits:c,multiply:$=!0,symbol:M=!0}=n.percent,_=$?t*100:t,A=c!=null?_.toPrecision(c):_.toFixed(f??1);return M?`${A}%`:A}if(((h=n==null?void 0:n.numeric)==null?void 0:h.abbreviate)&&Math.abs(t)>=1e3)return Ht(t);const e=(s=n==null?void 0:n.numeric)==null?void 0:s.digits;if(e!=null){const f=t.toPrecision(e),c=(r=n==null?void 0:n.numeric)==null?void 0:r.thousandsSep;return c&&typeof c=="string"?Et(f,c):f}const a=(l=n==null?void 0:n.numeric)==null?void 0:l.decimals,i=(d=n==null?void 0:n.numeric)==null?void 0:d.thousandsSep;let u;return a!==void 0?u=t.toFixed(a):Number.isInteger(t)||Math.abs(t-Math.round(t))<1e-4?u=Math.round(t).toString():u=t.toFixed(2),i&&typeof i=="string"&&(u=Et(u,i)),u}function qt(t,n){const{eventsField:o,nField:e,separator:a="/",showPct:i=!1,thousandsSep:u,abbreviate:h}=n.events,s=t.metadata[o],r=t.metadata[e];if(s==null||r===void 0||r===null)return n.naText??"";const l=Number(s),d=Number(r);let f,c;h&&(l>=1e3||d>=1e3)?(f=l>=1e3?Ht(l):String(l),c=d>=1e3?Ht(d):String(d)):(f=String(l),c=String(d),u&&typeof u=="string"&&(f=Et(f,u),c=Et(c,u)));let $=`${f}${a}${c}`;if(i&&d>0){const M=(l/d*100).toFixed(1);$+=` (${M}%)`}return $}function Zt(t,n,o,e){var h,s,r;if(t==null||Number.isNaN(t))return"";const a=((h=e==null?void 0:e.interval)==null?void 0:h.decimals)??2,i=((s=e==null?void 0:e.interval)==null?void 0:s.sep)??" ",u=(r=e==null?void 0:e.interval)==null?void 0:r.impreciseThreshold;return n==null||o===void 0||o===null||Number.isNaN(n)||Number.isNaN(o)?t.toFixed(a):u!=null&&n>0&&o/n>u?"—":`${t.toFixed(a)}${i}(${n.toFixed(a)}, ${o.toFixed(a)})`}function Kt(t,n){if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";const o=n==null?void 0:n.pvalue,e=(o==null?void 0:o.digits)??2,a=(o==null?void 0:o.expThreshold)??.001,i=(o==null?void 0:o.abbrevThreshold)??null,u=(o==null?void 0:o.format)??"auto",h=(o==null?void 0:o.stars)??!1,s=(o==null?void 0:o.thresholds)??[.05,.01,.001];let r="";if(h&&(t<s[2]?r="***":t<s[1]?r="**":t<s[0]&&(r="*")),i!==null&&t<i)return`<${i}${r}`;if(u==="scientific"||u==="auto"&&t<a){const d=Math.floor(Math.log10(t));return`${(t/Math.pow(10,d)).toPrecision(e)}×10${An(d.toString())}${r}`}let l;return t>=.1?l=t.toFixed(e):t>=.01?l=t.toFixed(e+1):l=t.toFixed(e+2),`${l}${r}`}function Nn(t,n){var i,u,h,s;const{type:o,field:e,options:a}=n;switch(o){case"interval":{const r=(i=a==null?void 0:a.interval)!=null&&i.point?t.metadata[a.interval.point]:t.point,l=(u=a==null?void 0:a.interval)!=null&&u.lower?t.metadata[a.interval.lower]:t.lower,d=(h=a==null?void 0:a.interval)!=null&&h.upper?t.metadata[a.interval.upper]:t.upper;return Zt(r,l,d,a)}case"custom":return a!=null&&a.events?qt(t,a):String(t.metadata[e]??"");case"pvalue":return Kt(t.metadata[e],a);case"numeric":return It(t.metadata[e],a);case"percent":return It(t.metadata[e],a);case"sparkline":case"icon":case"stars":case"img":case"range":return"";case"badge":{const r=t.metadata[e];return r==null?"":`  ${String(r)}  `}case"bar":{if(((s=a==null?void 0:a.bar)==null?void 0:s.showLabel)===!1)return"";const r=t.metadata[e];return r==null?"":r>=100?r.toFixed(0):r>=10?r.toFixed(1):r.toFixed(2)}case"text":default:return String(t.metadata[e]??"")}}function Z(t,n){const o="⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻";let e=0;for(const a of t)o.includes(a)?e+=n*.3:"il1.,;:|!()[]{}' ".includes(a)?e+=n*.35:"×−".includes(a)?e+=n*.5:"mwMW@%".includes(a)?e+=n*.85:a>="0"&&a<="9"?e+=n*.6:e+=n*.55;return e}function Sn(t,n){var r,l;const o=new Map,e=nt(t.theme.typography.fontSizeBase),a=t.theme.typography.headerFontScale??1.05,i=e*a,u=t.data.rows,h=(t.theme.spacing.cellPaddingX??10)*2,s=(t.theme.spacing.groupPadding??8)*2;for(const d of n){if(d.width!=="auto"&&d.width!==null&&d.width!==void 0)continue;let f=0;d.header&&(f=Math.max(f,Z(d.header,i)));for(const M of u){if(((r=M.style)==null?void 0:r.type)==="header"||((l=M.style)==null?void 0:l.type)==="spacer")continue;const _=Nn(M,d);_&&(f=Math.max(f,Z(_,e)))}const c=yt.VISUAL_MIN[d.type]??yt.MIN,$=Math.ceil(f+h+Lt.RENDERING_BUFFER);o.set(d.id,Math.min(yt.MAX,Math.max(c,$)))}return _n(t.columns,o,i,s,Lt.RENDERING_BUFFER),o}function _n(t,n,o,e,a){function i(s){return s.isGroup?s.columns.flatMap(i):[s]}function u(s){const r=n.get(s.id);return r!==void 0?r:typeof s.width=="number"?s.width:yt.MIN}function h(s){if(s.isGroup){for(const r of s.columns)h(r);if(s.header){const r=Z(s.header,o)+e+a,l=i(s),d=l.reduce((f,c)=>f+u(c),0);if(r>d&&l.length>0){const f=Math.ceil((r-d)/l.length);for(const c of l)n.set(c.id,u(c)+f)}}}}for(const s of t)h(s)}function Qt(t,n,o){let e=o.filter(i=>i.groupId===t).length;const a=n.filter(i=>i.parentId===t);for(const i of a)e+=Qt(i.id,n,o);return e}function tn(t){var s,r;const n=nt(t.theme.typography.fontSizeBase),o=(t.theme.spacing.cellPaddingX??10)*2;let e=0;const a=new Map,i=Array.isArray(t.data.groups)?t.data.groups:[];for(const l of i)a.set(l.id,l.depth);const u=l=>l?(a.get(l)??0)+1:0;t.data.labelHeader&&(e=Math.max(e,Z(t.data.labelHeader,n)));for(const l of t.data.rows)if(l.label){const d=u(l.groupId),f=((s=l.style)==null?void 0:s.indent)??0,$=(d+f)*H.INDENT_PER_LEVEL;let M=Z(l.label,n)+$;if((r=l.style)!=null&&r.badge){const _=String(l.style.badge),A=n*ht.FONT_SCALE,C=Z(_,A)+ht.PADDING*2;M+=ht.GAP+C}e=Math.max(e,M)}for(const l of i)if(l.label){const d=l.depth*H.INDENT_PER_LEVEL,f=Z(l.label,n),$=`(${Qt(l.id,i,t.data.rows)})`,M=n*.75,_=Z($,M),A=d+Tt.CHEVRON_WIDTH+Tt.GAP+f+Tt.GAP+_+Tt.SAFETY_MARGIN;e=Math.max(e,A)}const h=Math.ceil(e+o+Lt.RENDERING_BUFFER);return Math.min(yt.LABEL_MAX,Math.max(yt.MIN,h))}function nn(t,n){const o=n.get(t.id);return o!==void 0?o:typeof t.width=="number"?t.width:Q.DEFAULT_COLUMN_WIDTH}function wn(t,n,o=0){var X,V,B,et,rt;const e=t.theme,a=e.spacing.rowHeight,i=e.spacing.padding,u=Array.isArray(t.columns)?t.columns:[],h=rn(u,"left"),s=rn(u,"right"),l=Pt(h)||Pt(s)?e.spacing.headerHeight*Ot.GROUP_HEADER_HEIGHT_MULTIPLIER:e.spacing.headerHeight,d=!!((X=t.labels)!=null&&X.title),f=!!((V=t.labels)!=null&&V.subtitle),c=!!((B=t.labels)!=null&&B.caption),$=!!((et=t.labels)!=null&&et.footnote),M=d?tt.TITLE_HEIGHT:0,_=f?tt.SUBTITLE_HEIGHT:0,A=M+_+(d||f?i:0),S=c?tt.CAPTION_HEIGHT:0,C=$?tt.FOOTNOTE_HEIGHT:0,N=S+C+(c||$?i:0),F=en(t),y=!!t.data.overall;let m=0;for(const U of F){const J=U.type==="data"&&((rt=U.row.style)==null?void 0:rt.type)==="spacer";m+=J?a/2:a}y&&(m+=a*Ot.OVERALL_ROW_HEIGHT_MULTIPLIER);const p=kt(u,"left"),E=kt(u,"right"),g=[...p,...E];let b,x;if(n.columnWidths){b=new Map;for(const[U,J]of Object.entries(n.columnWidths))U!=="__label__"&&b.set(U,J);x=n.columnWidths.__label__??tn(t)}else b=Sn(t,g),x=tn(t);const w=x+p.reduce((U,J)=>U+nn(J,b),0),T=E.reduce((U,J)=>U+nn(J,b),0),G=n.width??Q.DEFAULT_WIDTH,k=t.data.includeForest,R=w+T;let L;if(!k)L=0;else if(typeof n.forestWidth=="number")L=n.forestWidth;else if(typeof t.layout.plotWidth=="number")L=t.layout.plotWidth;else{const U=G-R-Q.COLUMN_GAP*2-i*2;L=Math.max(U,Q.MIN_FOREST_WIDTH)}const I=i*2+R+L+Q.COLUMN_GAP*2,v=Math.max(n.width??G,I),Y=A+i+l+m+Q.AXIS_HEIGHT+Q.AXIS_LABEL_HEIGHT+N+Q.BOTTOM_MARGIN;return{totalWidth:v,totalHeight:n.height??Y,tableWidth:w+T,forestWidth:L,headerHeight:l,rowHeight:a,plotHeight:m,axisHeight:Q.AXIS_HEIGHT,nullValue:o,summaryYPosition:m-a,showOverallSummary:y,headerTextHeight:A,footerTextHeight:N,titleY:i+tt.TITLE_HEIGHT-8,subtitleY:i+M+tt.SUBTITLE_HEIGHT-4,mainY:A+i,footerY:A+i+l+m+Q.AXIS_HEIGHT+Q.AXIS_LABEL_HEIGHT+i,autoWidths:b,labelWidth:x}}function en(t){var d;const n=t.data.rows,o=Array.isArray(t.data.groups)?t.data.groups:[];if(o.length===0)return n.map(f=>({type:"data",row:f,depth:0}));const e=new Map;for(const f of o)e.set(f.id,f);const a=new Map;for(const f of n){const c=f.groupId??null;a.has(c)||a.set(c,[]),a.get(c).push(f)}const i=new Set;for(const f of a.keys()){if(!f)continue;let c=f;for(;c;)i.add(c),c=(d=e.get(c))==null?void 0:d.parentId}function u(f){return o.filter(c=>(c.parentId??null)===f&&i.has(c.id))}function h(f){if(!f)return 0;const c=e.get(f);return c?c.depth+1:0}function s(f){var $;let c=(($=a.get(f))==null?void 0:$.length)??0;for(const M of u(f))c+=s(M.id);return c}const r=[];function l(f){if(f){const $=e.get(f);if(!$)return;const M=s(f);r.push({type:"group_header",groupId:$.id,label:$.label,depth:$.depth,rowCount:M})}for(const $ of u(f))l($.id);const c=a.get(f)??[];for(const $ of c)r.push({type:"data",row:$,depth:h($.groupId)})}return l(null),r}function Wt(t){const n=[];for(const o of t)o.isGroup?n.push(...Wt(o.columns)):n.push(o);return n}function on(t){const n=[];for(const o of t)o.isGroup?n.push(...Wt(o.columns)):n.push(o);return n}function kt(t,n){if(n===void 0)return on(t);const o=[];for(const e of t)e.position===n&&(e.isGroup?o.push(...Wt(e.columns)):o.push(e));return o}function rn(t,n){return t.filter(o=>o.position===n)}function Pt(t){return t.some(n=>n.isGroup)}function nt(t){return t.endsWith("rem")?parseFloat(t)*tt.REM_BASE:t.endsWith("px")?parseFloat(t):tt.DEFAULT_FONT_SIZE}function At(t,n,o){return o==="right"?{textX:t+n-H.TEXT_PADDING,anchor:"end"}:o==="center"?{textX:t+n/2,anchor:"middle"}:{textX:t+H.TEXT_PADDING,anchor:"start"}}function j(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Rt(t,n,o,e=0){const a=n-e*2;if(Z(t,o)<=a)return t;const u="…",h=o*.55;let s=0,r=t.length;for(;s<r;){const l=Math.ceil((s+r)/2),d=t.slice(0,l);Z(d,o)+h<=a?s=l:r=l-1}return s===0?u:t.slice(0,s)+u}function Dn(t){return Math.abs(t)<.01?"0":Math.abs(t)>=100?t.toFixed(0):Math.abs(t)>=10?t.toFixed(1):t.toFixed(2)}function an(t,n){const[o,e]=t,[a,i]=n,u=(i-a)/(e-o),h=s=>a+(s-o)*u;return h.domain=()=>t,h.range=()=>n,h.ticks=s=>{const r=(e-o)/(s-1),l=[];for(let d=0;d<s;d++)l.push(o+r*d);return l},h}function sn(t,n){const[o,e]=t.map(l=>Math.max(l,.001)),[a,i]=n,u=Math.log10(o),h=Math.log10(e),s=(i-a)/(h-u),r=l=>{const d=Math.log10(Math.max(l,.001));return a+(d-u)*s};return r.domain=()=>[o,e],r.range=()=>n,r.ticks=l=>{const d=[],f=Math.floor(Math.log10(o)),c=Math.ceil(Math.log10(e));for(let $=f;$<=c;$++){const M=Math.pow(10,$);for(const _ of[1,2,5]){const A=M*_;A>=o&&A<=e&&d.push(A)}}return d.length>0?d:[o,e]},r}function Cn(t,n,o,e){const a=o.scale==="log",i=H.AXIS_LABEL_PADDING,u=i,h=Math.max(n-i,u+50);if(e!=null&&e.xDomain){const f=e.xDomain,c=e.clipBounds??f,$=jt(c,t.theme.axis,o.scale,o.nullValue);return a?{scale:sn([Math.max(f[0],.01),Math.max(f[1],.02)],[u,h]),clipBounds:c,ticks:$}:{scale:an(f,[u,h]),clipBounds:c,ticks:$}}const s=yn({rows:t.data.rows,config:t.theme.axis,scale:o.scale,nullValue:o.nullValue,forestWidth:n,pointSize:t.theme.shapes.pointSize,effects:o.effects,pointCol:o.pointCol,lowerCol:o.lowerCol,upperCol:o.upperCol}),{plotRegion:r,axisLimits:l,ticks:d}=s;return a?{scale:sn([Math.max(r[0],.01),Math.max(r[1],.02)],[u,h]),clipBounds:l,ticks:d}:{scale:an(r,[u,h]),clipBounds:l,ticks:d}}function Fn(t,n,o){var i,u;const e=[],a=o.spacing.padding;if((i=t.labels)!=null&&i.title){const h=nt(o.typography.fontSizeLg);e.push(`<text x="${a}" y="${n.titleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${h}px"
      font-weight="${o.typography.fontWeightBold}"
      fill="${o.colors.foreground}">${j(t.labels.title)}</text>`)}if((u=t.labels)!=null&&u.subtitle){const h=nt(o.typography.fontSizeBase);e.push(`<text x="${a}" y="${n.subtitleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${h}px"
      fill="${o.colors.secondary}">${j(t.labels.subtitle)}</text>`)}return e.join(`
`)}function Gn(t,n,o){var u,h;const e=[],a=o.spacing.padding;let i=n.footerY;if((u=t.labels)!=null&&u.caption){const s=nt(o.typography.fontSizeSm);e.push(`<text x="${a}" y="${i}"
      font-family="${o.typography.fontFamily}"
      font-size="${s}px"
      fill="${o.colors.secondary}">${j(t.labels.caption)}</text>`),i+=tt.CAPTION_HEIGHT}if((h=t.labels)!=null&&h.footnote){const s=nt(o.typography.fontSizeSm);e.push(`<text x="${a}" y="${i}"
      font-family="${o.typography.fontFamily}"
      font-size="${s}px"
      font-style="italic"
      fill="${o.colors.muted}">${j(t.labels.footnote)}</text>`)}return e.join(`
`)}function Ln(t,n,o,e,a,i,u){const h=[],s=n+1,r=u.groupHeaders;let l,d,f,c,$;if(s===1?(l=nt((r==null?void 0:r.level1FontSize)??u.typography.fontSizeBase),d=(r==null?void 0:r.level1FontWeight)??u.typography.fontWeightBold,f=(r==null?void 0:r.level1Italic)??!1,c=(r==null?void 0:r.level1Background)??null,$=(r==null?void 0:r.level1BorderBottom)??!1):s===2?(l=nt((r==null?void 0:r.level2FontSize)??u.typography.fontSizeBase),d=(r==null?void 0:r.level2FontWeight)??u.typography.fontWeightMedium,f=(r==null?void 0:r.level2Italic)??!0,c=(r==null?void 0:r.level2Background)??null,$=(r==null?void 0:r.level2BorderBottom)??!1):(l=nt((r==null?void 0:r.level3FontSize)??u.typography.fontSizeBase),d=(r==null?void 0:r.level3FontWeight)??u.typography.fontWeightNormal,f=(r==null?void 0:r.level3Italic)??!1,c=(r==null?void 0:r.level3Background)??null,$=(r==null?void 0:r.level3BorderBottom)??!1),!c){const S=u.colors.primary,C=s===1?.15:s===2?.1:.06,N=S.replace("#",""),F=parseInt(N.substring(0,2),16),y=parseInt(N.substring(2,4),16),m=parseInt(N.substring(4,6),16);c=`rgba(${F}, ${y}, ${m}, ${C})`}const M=e+a/2+l*tt.TEXT_BASELINE_ADJUSTMENT,_=n*((r==null?void 0:r.indentPerLevel)??H.INDENT_PER_LEVEL);h.push(`<rect x="${o}" y="${e}"
    width="${i}" height="${a}"
    fill="${c}"/>`),$&&h.push(`<line x1="${o}" x2="${o+i}" y1="${e+a}" y2="${e+a}"
      stroke="${u.colors.border}" stroke-width="1" opacity="0.5"/>`);const A=f?' font-style="italic"':"";return h.push(`<text x="${o+H.TEXT_PADDING+_}" y="${M}"
    font-family="${u.typography.fontFamily}"
    font-size="${l}px"
    font-weight="${d}"${A}
    fill="${u.colors.foreground}">${j(t)}</text>`),h.join(`
`)}function Hn(t,n){const o=new Map;for(const e of n)if(e.type==="bar"){let a=0;for(const i of t){const u=i.metadata[e.field];typeof u=="number"&&u>a&&(a=u)}o.set(e.field,a>0?a:1)}return o}function vn(t,n){var e,a,i,u,h,s,r,l,d,f,c,$,M,_,A,S,C,N,F;if(n.type==="interval"){const y=(a=(e=n.options)==null?void 0:e.interval)!=null&&a.point?t.metadata[n.options.interval.point]:t.point,m=(u=(i=n.options)==null?void 0:i.interval)!=null&&u.lower?t.metadata[n.options.interval.lower]:t.lower,p=(s=(h=n.options)==null?void 0:h.interval)!=null&&s.upper?t.metadata[n.options.interval.upper]:t.upper;return Zt(y,m,p,n.options)}if(n.type==="numeric"){const y=t.metadata[n.field];return typeof y=="number"?It(y,n.options):((r=n.options)==null?void 0:r.naText)??""}if(n.type==="custom"&&((l=n.options)!=null&&l.events))return qt(t,n.options);if(n.type==="pvalue"){const y=t.metadata[n.field];return typeof y!="number"?((d=n.options)==null?void 0:d.naText)??"":Kt(y,n.options)}if(n.type==="icon"){const y=t.metadata[n.field];if(y==null)return"";const m=String(y),p=(c=(f=n.options)==null?void 0:f.icon)==null?void 0:c.mapping;return p&&m in p?p[m]:m}if(n.type==="badge"){const y=t.metadata[n.field];return y!=null?String(y):""}if(n.type==="stars"){const y=t.metadata[n.field];if(typeof y!="number")return"";const m=((M=($=n.options)==null?void 0:$.stars)==null?void 0:M.maxStars)??5,p=Math.max(0,Math.min(m,y)),E=Math.floor(p),g=m-E;return"★".repeat(E)+"☆".repeat(g)}if(n.type==="img")return((A=(_=n.options)==null?void 0:_.img)==null?void 0:A.fallback)??"[IMG]";if(n.type==="reference"){const y=t.metadata[n.field];if(y==null)return"";const m=String(y),p=((C=(S=n.options)==null?void 0:S.reference)==null?void 0:C.maxChars)??30;return m.length<=p?m:m.substring(0,p)+"..."}if(n.type==="range"){const y=(N=n.options)==null?void 0:N.range;if(!y)return"";const m=t.metadata[y.minField],p=t.metadata[y.maxField],E=y.separator??" – ",g=y.decimals,b=x=>typeof x!="number"?"":g==null?Number.isInteger(x)?String(x):x.toFixed(1):x.toFixed(g);return m===null&&p===null?"":m===null?b(p):p===null?b(m):`${b(m)}${E}${b(p)}`}const o=t.metadata[n.field];return o!=null?String(o):((F=n.options)==null?void 0:F.naText)??""}function Wn(t,n,o,e,a){const i=t.filter(l=>Number.isFinite(l));if(i.length===0)return"";if(i.length===1){const l=n+e/2,d=o+a/2;return`M${l.toFixed(1)},${d.toFixed(1)}`}const u=Math.min(...i),s=Math.max(...i)-u||1;return`M${i.map((l,d)=>{const f=n+d/(i.length-1)*e,c=o+a-(l-u)/s*a;return`${f.toFixed(1)},${c.toFixed(1)}`}).join("L")}`}function kn(t,n,o,e,a,i=[],u,h=0,s=1/0,r,l=!1){var m;let d;if(i.length===0){const p=!l||t.point!=null&&t.point>0?t.point:null,E=!l||t.lower!=null&&t.lower>0?t.lower:null,g=!l||t.upper!=null&&t.upper>0?t.upper:null;d=[{point:p,lower:E,upper:g,color:null,shape:null,opacity:null}]}else d=i.map(p=>({point:lt(t.metadata,t.point,p.pointCol,"point",l),lower:lt(t.metadata,t.lower,p.lowerCol,"lower",l),upper:lt(t.metadata,t.upper,p.upperCol,"upper",l),color:p.color??null,shape:p.shape??null,opacity:p.opacity??null}));const f=d.filter(p=>p.point!=null&&!Number.isNaN(p.point)&&p.lower!=null&&!Number.isNaN(p.lower)&&p.upper!=null&&!Number.isNaN(p.upper));if(f.length===0)return"";const c=e.shapes.pointSize,$=e.shapes.lineWidth,M=e.colors.intervalLine,_=((m=t.style)==null?void 0:m.type)==="summary",S=e.shapes.summaryHeight/2;function C(p){var g;if(p&&((g=t.markerStyle)==null?void 0:g.size)!=null)return c*t.markerStyle.size;const E=u?t.metadata[u]:void 0;if(E){const b=.5+Math.sqrt(E/100)*1.5;return Math.min(Math.max(c*b,3),c*2.5)}return c}function N(p,E){const g=E===0,b=t.markerStyle,x=e.shapes.markerColors,w=e.shapes.markerShapes,T=["square","circle","diamond","triangle"];let G;g&&(b!=null&&b.color)?G=b.color:p.color?G=p.color:x&&x.length>0?G=x[E%x.length]:G=e.colors.interval??e.colors.primary??"#2563eb";let k;g&&(b!=null&&b.shape)?k=b.shape:p.shape?k=p.shape:w&&w.length>0?k=w[E%w.length]:k=T[E%T.length];let R;return g&&(b==null?void 0:b.opacity)!=null?R=b.opacity:p.opacity!=null?R=p.opacity:R=1,{color:G,shape:k,opacity:R}}function F(p,E,g,b){const{color:x,shape:w,opacity:T}=b,G=T<1?` fill-opacity="${T}"`:"";switch(w){case"circle":return`<circle cx="${p}" cy="${E}" r="${g}" fill="${x}"${G}/>`;case"diamond":return`<polygon points="${[`${p},${E-g}`,`${p+g},${E}`,`${p},${E+g}`,`${p-g},${E}`].join(" ")}" fill="${x}"${G}/>`;case"triangle":return`<polygon points="${[`${p},${E-g}`,`${p+g},${E+g}`,`${p-g},${E+g}`].join(" ")}" fill="${x}"${G}/>`;default:return`<rect x="${p-g}" y="${E-g}" width="${g*2}" height="${g*2}" fill="${x}"${G}/>`}}const y=[];return f.forEach((p,E)=>{const g=n+En(E,f.length),b=o(p.lower),x=o(p.upper),w=o(p.point),T=N(p,E),G=C(E===0),k=M;if(_){const R=T.opacity<1?` fill-opacity="${T.opacity}"`:"",L=[`${b},${g}`,`${w},${g-S}`,`${x},${g}`,`${w},${g+S}`].join(" ");y.push(`
        <g class="interval effect-${E} summary">
          <polygon points="${L}"
            fill="${T.color}"${R} stroke="${e.colors.summaryBorder}" stroke-width="1"/>
        </g>`)}else{const R=H.AXIS_LABEL_PADDING,L=h+R,I=h+s-R,v=r?p.lower<r[0]:b<L,Y=r?p.upper>r[1]:x>I;let X,V;if(r){const $t=Math.max(r[0],Math.min(r[1],p.lower)),P=Math.max(r[0],Math.min(r[1],p.upper));X=o($t),V=o(P)}else X=Math.max(L,Math.min(I,b)),V=Math.max(L,Math.min(I,x));const B=Tn(e),et=B.height/2;let rt="";v?rt=`<path d="${Yt("left",L,g,B)}" fill="${B.color}"/>`:rt=`<line x1="${X}" x2="${X}" y1="${g-et}" y2="${g+et}" stroke="${k}" stroke-width="${$}"/>`;let U="";Y?U=`<path d="${Yt("right",I,g,B)}" fill="${B.color}"/>`:U=`<line x1="${V}" x2="${V}" y1="${g-et}" y2="${g+et}" stroke="${k}" stroke-width="${$}"/>`;const J=r?o(Math.max(r[0],Math.min(r[1],p.point))):Math.max(L,Math.min(I,w));y.push(`
        <g class="interval effect-${E}">
          <line x1="${X}" x2="${V}" y1="${g}" y2="${g}"
            stroke="${k}" stroke-width="${$}"/>
          ${rt}
          ${U}
          ${F(J,g,G,T)}
        </g>`)}}),y.join("")}function Pn(t,n,o,e,a,i,u,h){const r=h.shapes.summaryHeight/2,[l,d]=a.domain().map(F=>a(F)),f=Math.min(l,d),c=Math.max(l,d),$=a(n),M=a(t),_=a(o),A=i+Math.max(f,Math.min(c,$)),S=i+Math.max(f,Math.min(c,M)),C=i+Math.max(f,Math.min(c,_));return`<polygon points="${[`${A},${e}`,`${S},${e-r}`,`${C},${e}`,`${S},${e+r}`].join(" ")}"
    fill="${h.colors.summaryFill}"
    stroke="${h.colors.summaryBorder}"
    stroke-width="1"/>`}function Rn(t,n,o,e,a,i,u=1,h){const s=[],r=typeof o.axis.tickCount=="number"?o.axis.tickCount:H.DEFAULT_TICK_COUNT,l=Un(t,r,o,u,i,h),d=nt(o.typography.fontSizeSm),f=35,c=M=>M<f?"start":M>i-f?"end":"middle",$=M=>M<f?2:M>i-f?-2:0;s.push(`<line x1="${a}" x2="${a+i}"
    y1="0" y2="0" stroke="${o.colors.border}" stroke-width="1"/>`);for(const M of l){const _=t(M),A=a+_,S=c(_),C=$(_);s.push(`<line x1="${A}" x2="${A}" y1="0" y2="4"
      stroke="${o.colors.border}" stroke-width="1"/>`),s.push(`<text x="${A+C}" y="16" text-anchor="${S}"
      font-family="${o.typography.fontFamily}"
      font-size="${d}px"
      fill="${o.colors.secondary}">${Dn(M)}</text>`)}return e&&s.push(`<text x="${a+i/2}" y="28"
      text-anchor="middle"
      font-family="${o.typography.fontFamily}"
      font-size="${d}px"
      font-weight="500"
      fill="${o.colors.secondary}">${j(e)}</text>`),`<g transform="translate(0, ${n.mainY+n.headerHeight+n.plotHeight})">${s.join(`
`)}</g>`}function Xn(t,n,o,e,a,i,u,h,s,r){const l=[],d=nt(i.typography.fontSizeBase),f=i.typography.headerFontScale??1.05,c=d*f,$=i.typography.fontWeightMedium,M=i.typography.fontWeightBold,_=Pt(t),A=(S,C)=>S+C/2+c*tt.TEXT_BASELINE_ADJUSTMENT;if(_){const S=a/2,C=a/2;let N=o;l.push(`<text x="${N+H.TEXT_PADDING}" y="${A(e,a)}"
      font-family="${i.typography.fontFamily}"
      font-size="${c}px"
      font-weight="${$}"
      fill="${i.colors.foreground}">${j(u)}</text>`),N+=h;const F=[];for(const y of t)if(y.isGroup){const m=y.columns.reduce((E,g)=>g.isGroup?E+g.columns.reduce((b,x)=>b+r(x),0):E+r(g),0),p=N+m/2;l.push(`<text x="${p}" y="${A(e,S)}"
          font-family="${i.typography.fontFamily}"
          font-size="${c}px"
          font-weight="${M}"
          text-anchor="middle"
          fill="${i.colors.foreground}">${j(y.header)}</text>`),F.push({x1:N,x2:N+m}),N+=m}else{const m=r(y),p=y.headerAlign??y.align,{textX:E,anchor:g}=At(N,m,p),b=Rt(y.header,m,c,H.TEXT_PADDING);l.push(`<text x="${E}" y="${A(e,a)}"
          font-family="${i.typography.fontFamily}"
          font-size="${c}px"
          font-weight="${$}"
          text-anchor="${g}"
          fill="${i.colors.foreground}">${j(b)}</text>`),N+=m}for(const y of F)l.push(`<line x1="${y.x1}" x2="${y.x2}"
        y1="${e+S}" y2="${e+S}"
        stroke="${i.colors.border}" stroke-width="1" opacity="0.5"/>`);N=o+h;for(const y of t)if(y.isGroup){for(const m of y.columns)if(!m.isGroup){const p=r(m),E=m.headerAlign??m.align,{textX:g,anchor:b}=At(N,p,E);l.push(`<text x="${g}" y="${A(e+S,C)}"
              font-family="${i.typography.fontFamily}"
              font-size="${c}px"
              font-weight="${$}"
              text-anchor="${b}"
              fill="${i.colors.foreground}">${j(m.header)}</text>`),N+=p}}else N+=r(y)}else{let S=o;l.push(`<text x="${S+H.TEXT_PADDING}" y="${A(e,a)}"
      font-family="${i.typography.fontFamily}"
      font-size="${c}px"
      font-weight="${$}"
      fill="${i.colors.foreground}">${j(u)}</text>`),S+=h;for(const C of n){const N=r(C),F=C.headerAlign??C.align,{textX:y,anchor:m}=At(S,N,F),p=Rt(C.header,N,c,H.TEXT_PADDING);l.push(`<text x="${y}" y="${A(e,a)}"
        font-family="${i.typography.fontFamily}"
        font-size="${c}px"
        font-weight="${$}"
        text-anchor="${m}"
        fill="${i.colors.foreground}">${j(p)}</text>`),S+=N}}return l.join(`
`)}function Bn(t,n,o,e,a,i,u,h,s,r,l,d){var F,y,m,p,E,g,b,x,w,T,G,k,R,L,I,v,Y,X,V,B,et,rt,U,J,$t,P,ct,Nt,St;const f=[],c=nt(i.typography.fontSizeBase),$=e+a/2+c*tt.TEXT_BASELINE_ADJUSTMENT,M=h*H.INDENT_PER_LEVEL+(((F=t.style)==null?void 0:F.indent)??0)*H.INDENT_PER_LEVEL,_=(y=t.style)!=null&&y.bold||(m=t.style)!=null&&m.emphasis?i.typography.fontWeightBold:i.typography.fontWeightNormal,A=(p=t.style)!=null&&p.italic?"italic":"normal";let S=i.colors.foreground;(E=t.style)!=null&&E.color?S=t.style.color:(g=t.style)!=null&&g.muted?S=i.colors.muted:(b=t.style)!=null&&b.accent&&(S=i.colors.accent);const C=u-M-H.TEXT_PADDING*2,N=Rt(t.label,C,c,0);if(f.push(`<text x="${o+H.TEXT_PADDING+M}" y="${$}"
    font-family="${i.typography.fontFamily}"
    font-size="${c}px"
    font-weight="${_}"
    font-style="${A}"
    fill="${S}">${j(N)}</text>`),(x=t.style)!=null&&x.badge){const gt=String(t.style.badge),D=c*ht.FONT_SCALE,q=D+ht.PADDING*2,st=Z(t.label,c),_t=o+H.TEXT_PADDING+M+st+ht.GAP,wt=Z(gt,D)+ht.PADDING*2,W=e+(a-q)/2;f.push(`<rect x="${_t}" y="${W}" width="${wt}" height="${q}"
      rx="3" fill="${i.colors.primary}" opacity="0.15"/>`),f.push(`<text x="${_t+wt/2}" y="${W+q/2+D*.35}"
      text-anchor="middle"
      font-family="${i.typography.fontFamily}"
      font-size="${D}px"
      font-weight="500"
      fill="${i.colors.primary}">${j(gt)}</text>`)}for(let gt=0;gt<n.length;gt++){const D=n[gt],q=d[gt],st=l(D);if(D.type==="forest")continue;const _t=vn(t,D),{textX:ln,anchor:wt}=At(q,st,D.align);if(D.type==="bar"&&typeof t.metadata[D.field]=="number"){const W=t.metadata[D.field],z=s.get(D.field),K=((T=(w=D.options)==null?void 0:w.bar)==null?void 0:T.maxValue)??z??100,O=((k=(G=D.options)==null?void 0:G.bar)==null?void 0:k.color)??i.colors.primary,it=i.shapes.pointSize*2,ft=st-H.TEXT_PADDING*2-50,ot=Math.min(W/K*ft,ft);f.push(`<rect x="${q+H.TEXT_PADDING}" y="${e+a/2-it/2}"
        width="${Math.max(0,ot)}" height="${it}"
        fill="${O}" opacity="0.7" rx="2"/>`),f.push(`<text x="${q+st-H.TEXT_PADDING}" y="${$}"
        font-family="${i.typography.fontFamily}"
        font-size="${c}px"
        text-anchor="end"
        fill="${i.colors.foreground}">${It(W)}</text>`)}else if(D.type==="sparkline"&&Array.isArray(t.metadata[D.field])){let W=t.metadata[D.field];Array.isArray(W[0])&&(W=W[0]);const z=((L=(R=D.options)==null?void 0:R.sparkline)==null?void 0:L.height)??16,K=((v=(I=D.options)==null?void 0:I.sparkline)==null?void 0:v.color)??i.colors.primary,O=H.TEXT_PADDING*2,it=Wn(W,q+H.TEXT_PADDING,e+a/2-z/2,st-O,z);f.push(`<path d="${it}" fill="none" stroke="${K}" stroke-width="1.5"/>`)}else if(D.type==="badge"){const W=t.metadata[D.field];if(W!=null){const z=String(W),K=c*.85,O=K+8,it=(X=(Y=D.options)==null?void 0:Y.badge)==null?void 0:X.variants,ut=(B=(V=D.options)==null?void 0:V.badge)==null?void 0:B.colors;let ft=i.colors.primary,ot=i.colors.primary;if(ut&&z in ut)ft=ut[z],ot=ut[z];else if(it&&z in it){const Ut=it[z];ft={default:i.colors.primary,success:"#16a34a",warning:"#d97706",error:"#dc2626",info:"#2563eb",muted:i.colors.muted}[Ut]??i.colors.primary,ot=ft}const mt=Z(z,K)+12,xt=D.align==="right"?q+st-H.TEXT_PADDING-mt:D.align==="center"?q+(st-mt)/2:q+H.TEXT_PADDING,Dt=e+(a-O)/2;f.push(`<rect x="${xt}" y="${Dt}" width="${mt}" height="${O}"
          rx="${O/2}" fill="${ft}" opacity="0.15"/>`),f.push(`<text x="${xt+mt/2}" y="${Dt+O/2+K*.35}"
          text-anchor="middle"
          font-family="${i.typography.fontFamily}"
          font-size="${K}px"
          font-weight="500"
          fill="${ot}">${j(z)}</text>`)}}else if(D.type==="stars"){const W=t.metadata[D.field];if(typeof W=="number"){const z=((rt=(et=D.options)==null?void 0:et.stars)==null?void 0:rt.maxStars)??5,K=((J=(U=D.options)==null?void 0:U.stars)==null?void 0:J.color)??"#f59e0b",O=((P=($t=D.options)==null?void 0:$t.stars)==null?void 0:P.emptyColor)??"#d1d5db",it=Math.max(0,Math.min(z,W)),ut=Math.floor(it),ft=((Nt=(ct=D.options)==null?void 0:ct.stars)==null?void 0:Nt.halfStars)&&it-ut>=.5,ot=12,Bt=2,mt=z*ot+(z-1)*Bt;let xt=D.align==="right"?q+st-H.TEXT_PADDING-mt:D.align==="center"?q+(st-mt)/2:q+H.TEXT_PADDING;const Dt=e+(a-ot)/2,Ut=(dt,Ct,zt)=>{const Ft=zt/2,Gt=Ft*.4;let cn="";for(let Mt=0;Mt<5;Mt++){const un=(Mt*72-90)*Math.PI/180,fn=(Mt*72+36-90)*Math.PI/180,dn=dt+Ft*Math.cos(un),hn=Ct+Ft*Math.sin(un),On=dt+Gt*Math.cos(fn),Jn=Ct+Gt*Math.sin(fn);cn+=(Mt===0?`M${dn},${hn}`:`L${dn},${hn}`)+`L${On},${Jn}`}return cn+"Z"};for(let dt=0;dt<z;dt++){const Ct=xt+ot/2,zt=Dt+ot/2,Gt=dt<ut||dt===ut&&ft?K:O;f.push(`<path d="${Ut(Ct,zt,ot)}" fill="${Gt}"/>`),xt+=ot+Bt}}}else{const W=(St=t.cellStyles)==null?void 0:St[D.field];let z=i.typography.fontWeightNormal,K="normal",O=i.colors.foreground;W&&((W.bold||W.emphasis)&&(z=i.typography.fontWeightBold),W.italic&&(K="italic"),W.color?O=W.color:W.muted?O=i.colors.muted:W.accent&&(O=i.colors.accent)),f.push(`<text x="${ln}" y="${$}"
        font-family="${i.typography.fontFamily}"
        font-size="${c}px"
        font-weight="${z}"
        font-style="${K}"
        text-anchor="${wt}"
        fill="${O}">${j(_t)}</text>`)}}return f.join(`
`)}function Un(t,n,o,e,a,i){if(Array.isArray(o.axis.tickValues)&&o.axis.tickValues.length>0){const[m,p]=t.domain();let E=o.axis.tickValues.filter(x=>x>=m&&x<=p);const g=o.axis.nullTick!==!1,b=e>=m&&e<=p;return g&&b&&!E.includes(e)&&(E=[...E,e].sort((x,w)=>x-w)),E}const[u,h]=t.domain(),s=o.axis.nullTick!==!1,r=e>=u&&e<=h,l=50,d=Math.max(2,Math.floor(a/l)),f=Math.min(n,Math.min(7,d)),c=i&&i.length>0?i.filter(m=>m>=u&&m<=h):t.ticks(f);if(c.length===0)return s&&r?[e]:[];const $=t(e),M=c.filter(m=>m<e).reverse(),_=c.filter(m=>m>e),A=c.some(m=>m===e),S=[];let C=$;for(const m of M){const p=t(m);C-p>=l&&(S.unshift(m),C=p)}const N=[];let F=$;for(const m of _){const p=t(m);p-F>=l&&(N.push(m),F=p)}const y=[...S];if((A||s&&r)&&y.push(e),y.push(...N),y.length<2){const m=new Set(y);m.has(u)||y.unshift(u),y.length<2&&!m.has(h)&&y.push(h)}return y}function Xt(t,n,o,e,a,i,u=1,h=.6){let r=`<line x1="${t}" x2="${t}" y1="${n}" y2="${o}"
    stroke="${a}" stroke-width="${u}" stroke-opacity="${h}" stroke-dasharray="${e==="dashed"?"6,4":e==="dotted"?"2,2":"none"}"/>`;return i&&(r+=`<text x="${t}" y="${n-4}" text-anchor="middle"
      font-size="10px" fill="${a}">${j(i)}</text>`),r}class pt extends Error{constructor(n){super(`SVG Generator: ${n}`),this.name="SVGGeneratorError"}}function zn(t){if(!t||typeof t!="object")throw new pt("Invalid spec: expected an object");const n=t;if(!n.data||typeof n.data!="object")throw new pt("Invalid spec: missing or invalid 'data' property");const o=n.data;if(!Array.isArray(o.rows))throw new pt("Invalid spec: 'data.rows' must be an array");if(!n.theme||typeof n.theme!="object")throw new pt("Invalid spec: missing or invalid 'theme' property");const e=n.theme;if(!e.colors||typeof e.colors!="object")throw new pt("Invalid spec: missing or invalid 'theme.colors'");if(!e.typography||typeof e.typography!="object")throw new pt("Invalid spec: missing or invalid 'theme.typography'");if(!e.spacing||typeof e.spacing!="object")throw new pt("Invalid spec: missing or invalid 'theme.spacing'")}function Vn(t){var i;const o=kt(t.columns,void 0).find(u=>u.type==="forest");if(!o||!((i=o.options)!=null&&i.forest))return{scale:"linear",nullValue:0,effects:[],axisLabel:"Effect",pointCol:null,lowerCol:null,upperCol:null};const e=o.options.forest,a=e.scale??"linear";return{scale:a,nullValue:e.nullValue??(a==="log"?1:0),effects:e.effects??[],axisLabel:e.axisLabel??"Effect",pointCol:e.point??null,lowerCol:e.lower??null,upperCol:e.upper??null}}function jn(t,n={}){var p,E;zn(t);const o=t.theme,e=o.spacing.padding,a=Array.isArray(t.columns)?t.columns:[],i=on(a),u=[];for(let g=0;g<i.length;g++)i[g].type==="forest"&&u.push(g);u.length>0;const h=Vn(t),s=wn(t,n,h.nullValue),r=s.autoWidths,l=g=>{var x,w;if(g.type==="forest")return((w=(x=g.options)==null?void 0:x.forest)==null?void 0:w.width)??s.forestWidth;const b=r.get(g.id);return b!==void 0?b:typeof g.width=="number"?g.width:Q.DEFAULT_COLUMN_WIDTH},d=[];let f=e+s.labelWidth;for(const g of i)d.push(f),f+=l(g);const c=[];c.push(`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
  width="${s.totalWidth}" height="${s.totalHeight}"
  viewBox="0 0 ${s.totalWidth} ${s.totalHeight}">`);const $=n.backgroundColor??o.colors.background;c.push(`<rect width="100%" height="100%" fill="${$}"/>`),c.push(Fn(t,s,o)),c.push(`<line x1="${e}" x2="${s.totalWidth-e}"
    y1="${s.mainY}" y2="${s.mainY}"
    stroke="${o.colors.border}" stroke-width="2"/>`);const M=s.mainY;c.push(Xn(a,i,e,M,s.headerHeight,o,t.data.labelHeader??"Study",s.labelWidth,r,l)),c.push(`<line x1="${e}" x2="${s.totalWidth-e}"
    y1="${M+s.headerHeight}" y2="${M+s.headerHeight}"
    stroke="${o.colors.border}" stroke-width="2"/>`);const _=en(t),A=[],S=[];let C=0;for(const g of _){const x=g.type==="data"&&((p=g.row.style)==null?void 0:p.type)==="spacer"?s.rowHeight/2:s.rowHeight;A.push(C),S.push(x),C+=x}const N=s.mainY+s.headerHeight;for(const g of u){const b=i[g],x=d[g],w=l(b),T=(E=b.options)==null?void 0:E.forest,G=(T==null?void 0:T.scale)??"linear",k=(T==null?void 0:T.nullValue)??(G==="log"?1:0),R=(T==null?void 0:T.axisLabel)??"Effect",L=G==="log";let I=(T==null?void 0:T.effects)??[];const v=(T==null?void 0:T.point)??null,Y=(T==null?void 0:T.lower)??null,X=(T==null?void 0:T.upper)??null;I.length===0&&(v||Y||X)&&(I=[{pointCol:v,lowerCol:Y,upperCol:X}]);const V={scale:G,nullValue:k,effects:I,pointCol:(T==null?void 0:T.point)??null,lowerCol:(T==null?void 0:T.lower)??null,upperCol:(T==null?void 0:T.upper)??null},{scale:B,clipBounds:et,ticks:rt}=Cn(t,w,V,n),U=x+B(k);c.push(Xt(U,N,N+s.plotHeight,"dashed",o.colors.muted));const J=(T==null?void 0:T.annotations)??[];for(const P of J)if(P.type==="reference_line"){const ct=x+B(P.x);c.push(Xt(ct,N,N+s.plotHeight,P.style,P.color??o.colors.accent,P.label,P.width??1,P.opacity??.6))}const $t=Array.isArray(t.annotations)?t.annotations:[];for(const P of $t)if(P.type==="reference_line"){const ct=x+B(P.x);c.push(Xt(ct,N,N+s.plotHeight,P.style,P.color??o.colors.accent,P.label,P.width??1,P.opacity??.6))}if(_.forEach((P,ct)=>{if(P.type==="data"){const Nt=N+A[ct]+S[ct]/2;c.push(kn(P.row,Nt,St=>x+B(St),o,k,I,t.data.weightCol,x,w,et,L))}}),t.data.overall&&s.showOverallSummary&&typeof t.data.overall.point=="number"&&!Number.isNaN(t.data.overall.point)&&typeof t.data.overall.lower=="number"&&!Number.isNaN(t.data.overall.lower)&&typeof t.data.overall.upper=="number"&&!Number.isNaN(t.data.overall.upper)){const P=N+s.summaryYPosition;c.push(Pn(t.data.overall.point,t.data.overall.lower,t.data.overall.upper,P,B,x,w,o))}c.push(Rn(B,s,o,R,x,w,k,rt))}const F=s.mainY+s.headerHeight,y=t.data.rows,m=Hn(y,i);return _.forEach((g,b)=>{var T,G,k,R;const x=F+A[b],w=S[b];if(g.type==="group_header")c.push(Ln(g.label,g.depth,e,x,w,s.totalWidth-e*2,o));else{const L=g.row,I=g.depth,v=((T=L.style)==null?void 0:T.type)==="spacer",Y=(G=L.style)==null?void 0:G.bg;if(!v&&!Y&&o.layout.banding){const V=b%2===1?o.colors.altBg:o.colors.rowBg;V!==o.colors.background&&c.push(`<rect x="${e}" y="${x}"
            width="${s.totalWidth-e*2}" height="${w}"
            fill="${V}"/>`)}c.push(Bn(L,i,e,x,w,o,s.labelWidth,I,m,r,l,d))}if(g.type==="data"){const L=g.row,I=((k=L.style)==null?void 0:k.type)==="summary",v=((R=L.style)==null?void 0:R.type)==="spacer";I&&c.push(`<line x1="${e}" x2="${s.totalWidth-e}"
          y1="${x}" y2="${x}"
          stroke="${o.colors.border}" stroke-width="2"/>`),v||c.push(`<line x1="${e}" x2="${s.totalWidth-e}"
          y1="${x+w}" y2="${x+w}"
          stroke="${o.colors.border}" stroke-width="1"/>`)}else c.push(`<line x1="${e}" x2="${s.totalWidth-e}"
        y1="${x+w}" y2="${x+w}"
        stroke="${o.colors.border}" stroke-width="1"/>`)}),c.push(Gn(t,s,o)),c.push("</svg>"),c.join(`
`)}function Yn(t,n){const o=JSON.parse(t);return jn(o,n)}globalThis.generateSVG=Yn})();
