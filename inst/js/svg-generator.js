(function(){"use strict";function ot(t,e){if(e){const l=Math.floor(Math.log10(Math.max(t[0],.001))),c=Math.ceil(Math.log10(Math.max(t[1],.001)));return[Math.pow(10,l),Math.pow(10,c)]}const n=t[1]-t[0];if(n===0)return t;const o=Math.pow(10,Math.floor(Math.log10(n))),r=n/o;let i;r<=1?i=o*.1:r<=2?i=o*.2:r<=5?i=o*.5:i=o;const f=Math.floor(t[0]/i)*i,s=Math.ceil(t[1]/i)*i;return[f,s]}const j=.15,_={DEFAULT_COLUMN_WIDTH:80,DEFAULT_LABEL_WIDTH:150,AXIS_HEIGHT:32,MIN_FOREST_WIDTH:200,DEFAULT_WIDTH:800},L={TITLE_HEIGHT:28,SUBTITLE_HEIGHT:20,CAPTION_HEIGHT:16,FOOTNOTE_HEIGHT:14,DEFAULT_FONT_SIZE:14,REM_BASE:16,TEXT_BASELINE_ADJUSTMENT:1/3},D={TEXT_PADDING:10,INDENT_PER_LEVEL:12,WHISKER_HALF_HEIGHT:4,DEFAULT_TICK_COUNT:5},R={GROUP_HEADER_HEIGHT_MULTIPLIER:1.5,OVERALL_ROW_HEIGHT_MULTIPLIER:1.5,AUTO_FOREST_WIDTH_FRACTION:.25};function nt(t,e){var k,U,O,tt;const n=t.theme,o=n.spacing.rowHeight,r=n.spacing.padding,i=Array.isArray(t.columns)?t.columns:[],f=v(i,"left"),s=v(i,"right"),c=P(f)||P(s)?n.spacing.headerHeight*R.GROUP_HEADER_HEIGHT_MULTIPLIER:n.spacing.headerHeight,a=!!((k=t.labels)!=null&&k.title),u=!!((U=t.labels)!=null&&U.subtitle),g=!!((O=t.labels)!=null&&O.caption),x=!!((tt=t.labels)!=null&&tt.footnote),h=a?L.TITLE_HEIGHT:0,m=u?L.SUBTITLE_HEIGHT:0,p=h+m+(a||u?r:0),H=g?L.CAPTION_HEIGHT:0,d=x?L.FOOTNOTE_HEIGHT:0,y=H+d+(g||x?r:0),$=t.data.rows.length,T=!!t.data.overall,I=$*o+(T?o*R.OVERALL_ROW_HEIGHT_MULTIPLIER:0),N=C(i,"left"),E=C(i,"right"),M=_.DEFAULT_LABEL_WIDTH+N.reduce((B,Y)=>B+(Y.width??_.DEFAULT_COLUMN_WIDTH),0),S=E.reduce((B,Y)=>B+(Y.width??_.DEFAULT_COLUMN_WIDTH),0),X=e.width??_.DEFAULT_WIDTH,V=t.data.includeForest;let b;V?typeof t.layout.plotWidth=="number"?b=t.layout.plotWidth:b=Math.max(X*R.AUTO_FOREST_WIDTH_FRACTION,_.MIN_FOREST_WIDTH):b=0;const W=e.width??M+b+S+r*2,G=p+c+I+_.AXIS_HEIGHT+y+r*2;return{totalWidth:W,totalHeight:e.height??G,tableWidth:M+S,forestWidth:b,headerHeight:c,rowHeight:o,plotHeight:I,axisHeight:_.AXIS_HEIGHT,nullValue:t.data.nullValue,summaryYPosition:I-o,showOverallSummary:T,headerTextHeight:p,footerTextHeight:y,titleY:r+L.TITLE_HEIGHT-8,subtitleY:r+h+L.SUBTITLE_HEIGHT-4,mainY:p+r,footerY:p+r+c+I+_.AXIS_HEIGHT+r}}function C(t,e){const n=[];for(const o of t)o.position===e&&(o.isGroup?n.push(...C(o.columns,e)):n.push(o));return n}function v(t,e){return t.filter(n=>n.position===e)}function P(t){return t.some(e=>e.isGroup)}function J(t,e){return t.isGroup?t.columns.reduce((n,o)=>n+J(o,e),0):t.width??e}function w(t){return t.endsWith("rem")?parseFloat(t)*L.REM_BASE:t.endsWith("px")?parseFloat(t):L.DEFAULT_FONT_SIZE}function z(t,e,n){return n==="right"?{textX:t+e-D.TEXT_PADDING,anchor:"end"}:n==="center"?{textX:t+e/2,anchor:"middle"}:{textX:t+D.TEXT_PADDING,anchor:"start"}}function A(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function K(t){return t==null||Number.isNaN(t)?"":t.toFixed(2)}function et(t,e,n){return t==null||Number.isNaN(t)?"":e==null||n===void 0||n===null||Number.isNaN(e)||Number.isNaN(n)?K(t):`${t.toFixed(2)} (${e.toFixed(2)}, ${n.toFixed(2)})`}function it(t){return Math.abs(t)<.01?"0":Math.abs(t)>=100?t.toFixed(0):Math.abs(t)>=10?t.toFixed(1):t.toFixed(2)}function rt(t,e){const[n,o]=t,[r,i]=e,f=(i-r)/(o-n),s=l=>r+(l-n)*f;return s.domain=()=>t,s.range=()=>e,s.ticks=l=>{const c=(o-n)/(l-1),a=[];for(let u=0;u<l;u++)a.push(n+c*u);return a},s}function st(t,e){const[n,o]=t.map(a=>Math.max(a,.001)),[r,i]=e,f=Math.log10(n),s=Math.log10(o),l=(i-r)/(s-f),c=a=>{const u=Math.log10(Math.max(a,.001));return r+(u-f)*l};return c.domain=()=>[n,o],c.range=()=>e,c.ticks=a=>{const u=[],g=Math.floor(Math.log10(n)),x=Math.ceil(Math.log10(o));for(let h=g;h<=x;h++){const m=Math.pow(10,h);for(const p of[1,2,5]){const H=m*p;H>=n&&H<=o&&u.push(H)}}return u.length>0?u:[n,o]},c}function at(t,e){const n=t.data.rows,o=t.theme.axis,r=t.data.scale==="log",i=typeof(o==null?void 0:o.rangeMin)=="number",f=typeof(o==null?void 0:o.rangeMax)=="number";let s;if(i&&f)s=[o.rangeMin,o.rangeMax];else{const c=n.flatMap(a=>[a.lower,a.upper]).filter(a=>a!=null&&!Number.isNaN(a)&&Number.isFinite(a));if(c.length===0)s=r?[.1,10]:[0,1];else{const[a,u]=[Math.min(...c),Math.max(...c)],g=u-a||1;s=[i?o.rangeMin:a-g*j,f?o.rangeMax:u+g*j]}}const l=ot(s,r);return r?st([Math.max(l[0],.01),Math.max(l[1],.02)],[0,e]):rt(l,[0,e])}function lt(t,e,n){var i,f;const o=[],r=n.spacing.padding;if((i=t.labels)!=null&&i.title){const s=w(n.typography.fontSizeLg);o.push(`<text x="${r}" y="${e.titleY}"
      font-family="${n.typography.fontFamily}"
      font-size="${s}px"
      font-weight="${n.typography.fontWeightBold}"
      fill="${n.colors.foreground}">${A(t.labels.title)}</text>`)}if((f=t.labels)!=null&&f.subtitle){const s=w(n.typography.fontSizeBase);o.push(`<text x="${r}" y="${e.subtitleY}"
      font-family="${n.typography.fontFamily}"
      font-size="${s}px"
      fill="${n.colors.secondary}">${A(t.labels.subtitle)}</text>`)}return o.join(`
`)}function ct(t,e,n){var f,s;const o=[],r=n.spacing.padding;let i=e.footerY;if((f=t.labels)!=null&&f.caption){const l=w(n.typography.fontSizeSm);o.push(`<text x="${r}" y="${i}"
      font-family="${n.typography.fontFamily}"
      font-size="${l}px"
      fill="${n.colors.secondary}">${A(t.labels.caption)}</text>`),i+=L.CAPTION_HEIGHT}if((s=t.labels)!=null&&s.footnote){const l=w(n.typography.fontSizeSm);o.push(`<text x="${r}" y="${i}"
      font-family="${n.typography.fontFamily}"
      font-size="${l}px"
      font-style="italic"
      fill="${n.colors.muted}">${A(t.labels.footnote)}</text>`)}return o.join(`
`)}function q(t,e,n,o,r,i,f,s){const l=[],c=w(i.typography.fontSizeSm),a=i.typography.fontWeightMedium,u=i.typography.fontWeightBold,g=P(t),x=_.DEFAULT_COLUMN_WIDTH,h=s??_.DEFAULT_LABEL_WIDTH,m=(p,H)=>p+H/2+c*L.TEXT_BASELINE_ADJUSTMENT;if(g){const p=r/2,H=r/2;let d=n;f&&(l.push(`<text x="${d+D.TEXT_PADDING}" y="${m(o,r)}"
        font-family="${i.typography.fontFamily}"
        font-size="${c}px"
        font-weight="${a}"
        fill="${i.colors.foreground}">${A(f)}</text>`),l.push(`<line x1="${d+h}" x2="${d+h}"
        y1="${o}" y2="${o+r}"
        stroke="${i.colors.border}" stroke-width="1" opacity="0.3"/>`),d+=h);for(const y of t)if(y.isGroup){const $=J(y,x),T=d+$/2;l.push(`<text x="${T}" y="${m(o,p)}"
          font-family="${i.typography.fontFamily}"
          font-size="${c}px"
          font-weight="${u}"
          text-anchor="middle"
          fill="${i.colors.foreground}">${A(y.header)}</text>`),l.push(`<line x1="${d}" x2="${d+$}"
          y1="${o+p}" y2="${o+p}"
          stroke="${i.colors.border}" stroke-width="1" opacity="0.5"/>`),d+=$}else{const $=y.width??x,{textX:T,anchor:I}=z(d,$,y.align);l.push(`<text x="${T}" y="${m(o,r)}"
          font-family="${i.typography.fontFamily}"
          font-size="${c}px"
          font-weight="${a}"
          text-anchor="${I}"
          fill="${i.colors.foreground}">${A(y.header)}</text>`),d+=$}d=n+(f?h:0);for(const y of t)if(y.isGroup){for(const $ of y.columns)if(!$.isGroup){const T=$.width??x,{textX:I,anchor:N}=z(d,T,$.align);l.push(`<text x="${I}" y="${m(o+p,H)}"
              font-family="${i.typography.fontFamily}"
              font-size="${c}px"
              font-weight="${a}"
              text-anchor="${N}"
              fill="${i.colors.foreground}">${A($.header)}</text>`),d+=T}}else d+=y.width??x}else{let p=n;f&&(l.push(`<text x="${p+D.TEXT_PADDING}" y="${m(o,r)}"
        font-family="${i.typography.fontFamily}"
        font-size="${c}px"
        font-weight="${a}"
        fill="${i.colors.foreground}">${A(f)}</text>`),p+=h);for(const H of e){const d=H.width??x,{textX:y,anchor:$}=z(p,d,H.align);l.push(`<text x="${y}" y="${m(o,r)}"
        font-family="${i.typography.fontFamily}"
        font-size="${c}px"
        font-weight="${a}"
        text-anchor="${$}"
        fill="${i.colors.foreground}">${A(H.header)}</text>`),p+=d}}return l.join(`
`)}function Z(t,e,n,o,r,i,f,s=_.DEFAULT_LABEL_WIDTH){var g,x,h,m,p,H,d,y,$,T,I,N;const l=[],c=w(i.typography.fontSizeBase),a=o+r/2+c*L.TEXT_BASELINE_ADJUSTMENT;let u=n;if(f){const E=(((g=t.style)==null?void 0:g.indent)??0)*D.INDENT_PER_LEVEL,M=(x=t.style)!=null&&x.bold?i.typography.fontWeightBold:i.typography.fontWeightNormal,S=(h=t.style)!=null&&h.italic?"italic":"normal";l.push(`<text x="${u+D.TEXT_PADDING+E}" y="${a}"
      font-family="${i.typography.fontFamily}"
      font-size="${c}px"
      font-weight="${M}"
      font-style="${S}"
      fill="${((m=t.style)==null?void 0:m.color)??i.colors.foreground}">${A(t.label)}</text>`),u+=s}for(const E of e){const M=E.width??_.DEFAULT_COLUMN_WIDTH,S=ft(t,E),{textX:X,anchor:V}=z(u,M,E.align);if(E.type==="bar"&&typeof t.metadata[E.field]=="number"){const b=t.metadata[E.field],W=((H=(p=E.options)==null?void 0:p.bar)==null?void 0:H.maxValue)??100,G=D.TEXT_PADDING*2,k=Math.min(b/W*(M-G),M-G),U=((y=(d=E.options)==null?void 0:d.bar)==null?void 0:y.color)??i.colors.primary,O=i.shapes.pointSize*2;l.push(`<rect x="${u+D.TEXT_PADDING}" y="${o+r/2-O/2}"
        width="${Math.max(0,k)}" height="${O}"
        fill="${U}" opacity="0.7" rx="2"/>`)}else if(E.type==="sparkline"&&Array.isArray(t.metadata[E.field])){const b=t.metadata[E.field],W=((T=($=E.options)==null?void 0:$.sparkline)==null?void 0:T.height)??16,G=((N=(I=E.options)==null?void 0:I.sparkline)==null?void 0:N.color)??i.colors.primary,k=D.TEXT_PADDING*2,U=ht(b,u+D.TEXT_PADDING,o+r/2-W/2,M-k,W);l.push(`<path d="${U}" fill="none" stroke="${G}" stroke-width="1.5"/>`)}else l.push(`<text x="${X}" y="${a}"
        font-family="${i.typography.fontFamily}"
        font-size="${c}px"
        text-anchor="${V}"
        fill="${i.colors.foreground}">${A(S)}</text>`);u+=M}return l.join(`
`)}function ft(t,e){var o,r,i,f;if(e.type==="interval")return et(t.point,t.lower,t.upper);if(e.type==="numeric"){const s=t.metadata[e.field];return typeof s=="number"?K(s):""}if(e.type==="pvalue"){const s=t.metadata[e.field];if(typeof s!="number")return"";const l=(r=(o=e.options)==null?void 0:o.pvalue)==null?void 0:r.stars,c=((f=(i=e.options)==null?void 0:i.pvalue)==null?void 0:f.thresholds)??[.05,.01,.001];let a="";return l&&(s<c[2]?a="***":s<c[1]?a="**":s<c[0]&&(a="*")),s<.001?`<0.001${a}`:`${s.toFixed(3)}${a}`}const n=t.metadata[e.field];return n!=null?String(n):""}function ht(t,e,n,o,r){if(t.length===0)return"";const i=Math.min(...t),s=Math.max(...t)-i||1;return`M${t.map((c,a)=>{const u=e+a/(t.length-1)*o,g=n+r-(c-i)/s*r;return`${u.toFixed(1)},${g.toFixed(1)}`}).join("L")}`}function ut(t,e,n,o,r){if(t.point==null||Number.isNaN(t.point)||t.lower==null||Number.isNaN(t.lower)||t.upper==null||Number.isNaN(t.upper))return"";const i=n(t.lower),f=n(t.upper),s=n(t.point),l=o.shapes.pointSize,c=t.metadata.weight;let a=l;if(c){const m=.5+Math.sqrt(c/100)*1.5;a=Math.min(Math.max(l*m,3),l*2.5)}const u=t.point>r?o.colors.intervalPositive:t.point<r?o.colors.intervalNegative:o.colors.muted,g=o.shapes.lineWidth,x=o.colors.intervalLine,h=D.WHISKER_HALF_HEIGHT;return`
    <g class="interval">
      <!-- CI line -->
      <line x1="${i}" x2="${f}" y1="${e}" y2="${e}"
        stroke="${x}" stroke-width="${g}"/>
      <!-- Whiskers -->
      <line x1="${i}" x2="${i}" y1="${e-h}" y2="${e+h}"
        stroke="${x}" stroke-width="${g}"/>
      <line x1="${f}" x2="${f}" y1="${e-h}" y2="${e+h}"
        stroke="${x}" stroke-width="${g}"/>
      <!-- Point -->
      <rect x="${s-a}" y="${e-a}"
        width="${a*2}" height="${a*2}" fill="${u}"/>
    </g>`}function dt(t,e,n,o,r,i,f,s){const c=s.shapes.summaryHeight/2,a=r(e),u=r(t),g=r(n),x=i+Math.max(0,Math.min(f,a)),h=i+Math.max(0,Math.min(f,u)),m=i+Math.max(0,Math.min(f,g));return`<polygon points="${[`${x},${o}`,`${h},${o-c}`,`${m},${o}`,`${h},${o+c}`].join(" ")}"
    fill="${s.colors.summaryFill}"
    stroke="${s.colors.summaryBorder}"
    stroke-width="1"/>`}function pt(t,e,n,o,r){const i=[],f=typeof n.axis.tickCount=="number"?n.axis.tickCount:D.DEFAULT_TICK_COUNT,s=Array.isArray(n.axis.tickValues)?n.axis.tickValues:t.ticks(f),l=w(n.typography.fontSizeSm);i.push(`<line x1="${r}" x2="${r+e.forestWidth}"
    y1="0" y2="0" stroke="${n.colors.border}" stroke-width="1"/>`);for(const c of s){const a=r+t(c);i.push(`<line x1="${a}" x2="${a}" y1="0" y2="4"
      stroke="${n.colors.border}" stroke-width="1"/>`),i.push(`<text x="${a}" y="16" text-anchor="middle"
      font-family="${n.typography.fontFamily}"
      font-size="${l}px"
      fill="${n.colors.secondary}">${it(c)}</text>`)}return o&&i.push(`<text x="${r+e.forestWidth/2}" y="28"
      text-anchor="middle"
      font-family="${n.typography.fontFamily}"
      font-size="${l}px"
      font-weight="500"
      fill="${n.colors.secondary}">${A(o)}</text>`),`<g transform="translate(0, ${e.mainY+e.headerHeight+e.plotHeight})">${i.join(`
`)}</g>`}function Q(t,e,n,o,r,i){let s=`<line x1="${t}" x2="${t}" y1="${e}" y2="${n}"
    stroke="${r}" stroke-width="1" stroke-dasharray="${o==="dashed"?"6,4":o==="dotted"?"2,2":"none"}"/>`;return i&&(s+=`<text x="${t}" y="${e-4}" text-anchor="middle"
      font-size="10px" fill="${r}">${A(i)}</text>`),s}class F extends Error{constructor(e){super(`SVG Generator: ${e}`),this.name="SVGGeneratorError"}}function gt(t){if(!t||typeof t!="object")throw new F("Invalid spec: expected an object");const e=t;if(!e.data||typeof e.data!="object")throw new F("Invalid spec: missing or invalid 'data' property");const n=e.data;if(!Array.isArray(n.rows))throw new F("Invalid spec: 'data.rows' must be an array");if(!e.theme||typeof e.theme!="object")throw new F("Invalid spec: missing or invalid 'theme' property");const o=e.theme;if(!o.colors||typeof o.colors!="object")throw new F("Invalid spec: missing or invalid 'theme.colors'");if(!o.typography||typeof o.typography!="object")throw new F("Invalid spec: missing or invalid 'theme.typography'");if(!o.spacing||typeof o.spacing!="object")throw new F("Invalid spec: missing or invalid 'theme.spacing'")}function $t(t,e={}){gt(t);const n=t.theme,o=nt(t,e),r=n.spacing.padding,i=Array.isArray(t.columns)?t.columns:[],f=v(i,"left"),s=v(i,"right"),l=C(i,"left"),c=C(i,"right"),a=_.DEFAULT_LABEL_WIDTH+l.reduce((d,y)=>d+(y.width??_.DEFAULT_COLUMN_WIDTH),0),u=r+a,g=at(t,o.forestWidth),x=u+o.forestWidth,h=[];h.push(`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
  width="${o.totalWidth}" height="${o.totalHeight}"
  viewBox="0 0 ${o.totalWidth} ${o.totalHeight}">`);const m=e.backgroundColor??n.colors.background;h.push(`<rect width="100%" height="100%" fill="${m}"/>`),h.push(lt(t,o,n));const p=o.mainY;if(h.push(q(f,l,r,p,o.headerHeight,n,t.data.labelHeader??"Study",_.DEFAULT_LABEL_WIDTH)),c.length>0&&h.push(q(s,c,x,p,o.headerHeight,n)),h.push(`<line x1="${r}" x2="${o.totalWidth-r}"
    y1="${p+o.headerHeight}" y2="${p+o.headerHeight}"
    stroke="${n.colors.border}" stroke-width="1"/>`),t.data.includeForest&&o.forestWidth>0){const d=o.mainY+o.headerHeight,y=u+g(t.data.nullValue);h.push(Q(y,d,d+o.plotHeight,"dashed",n.colors.muted));const $=Array.isArray(t.annotations)?t.annotations:[];for(const T of $)if(T.type==="reference_line"){const I=u+g(T.x);h.push(Q(I,d,d+o.plotHeight,T.style,T.color??n.colors.accent,T.label))}if(t.data.rows.forEach((T,I)=>{const N=d+I*o.rowHeight+o.rowHeight/2;h.push(ut(T,N,E=>u+g(E),n,t.data.nullValue))}),t.data.overall&&o.showOverallSummary){const T=d+o.summaryYPosition;h.push(dt(t.data.overall.point,t.data.overall.lower,t.data.overall.upper,T,g,u,o.forestWidth,n))}h.push(pt(g,o,n,t.data.axisLabel,u))}const H=o.mainY+o.headerHeight;return t.data.rows.forEach((d,y)=>{const $=H+y*o.rowHeight;y%2===1&&h.push(`<rect x="${r}" y="${$}"
        width="${o.totalWidth-r*2}" height="${o.rowHeight}"
        fill="${n.colors.muted}" opacity="0.1"/>`),h.push(Z(d,l,r,$,o.rowHeight,n,!0,_.DEFAULT_LABEL_WIDTH)),c.length>0&&h.push(Z(d,c,x,$,o.rowHeight,n,!1,0)),h.push(`<line x1="${r}" x2="${o.totalWidth-r}"
      y1="${$+o.rowHeight}" y2="${$+o.rowHeight}"
      stroke="${n.colors.border}" stroke-width="1" opacity="0.5"/>`)}),h.push(ct(t,o,n)),h.push("</svg>"),h.join(`
`)}function yt(t,e){const n=JSON.parse(t);return $t(n,e)}globalThis.generateSVG=yt})();
