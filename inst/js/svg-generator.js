(function(){"use strict";function _t(t,e){if(e){const u=[.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100];let a=u[0];for(const c of u)if(c<=t[0])a=c;else break;let l=u[u.length-1];for(let c=u.length-1;c>=0&&u[c]>=t[1];c--)l=u[c];return[a,l]}const o=t[1]-t[0];if(o===0)return t;const n=Math.pow(10,Math.floor(Math.log10(o))),r=o/n;let i;r<=1?i=n*.1:r<=2?i=n*.2:r<=5?i=n*.5:i=n;const s=Math.floor(t[0]/i)*i,f=Math.ceil(t[1]/i)*i;return[s,f]}const ut=.08,Nt=.06,At=.05,dt=.04;function Ht(t){return t<=0?0:dt+t*dt}const v={DEFAULT_LABEL_WIDTH:200,DEFAULT_COLUMN_WIDTH:100,AXIS_HEIGHT:32,AXIS_LABEL_HEIGHT:20,BOTTOM_MARGIN:16,MIN_FOREST_WIDTH:200,DEFAULT_WIDTH:800,COLUMN_GAP:16},X={TITLE_HEIGHT:28,SUBTITLE_HEIGHT:20,CAPTION_HEIGHT:16,FOOTNOTE_HEIGHT:14,DEFAULT_FONT_SIZE:14,REM_BASE:16,TEXT_BASELINE_ADJUSTMENT:1/3},D={INDENT_PER_LEVEL:12,TEXT_PADDING:10,WHISKER_HALF_HEIGHT:4,DEFAULT_TICK_COUNT:5},ft={GROUP_HEADER_HEIGHT_MULTIPLIER:1.5,OVERALL_ROW_HEIGHT_MULTIPLIER:1.5},Z={PADDING:28,MIN:60,MAX:600,LABEL_MAX:400};function q(t,e){const o=t.split(".");return o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,e),o.join(".")}function rt(t){const e=Math.abs(t),o=t<0?"-":"";if(e>=1e12)throw new Error(`Cannot abbreviate value >= 1 trillion: ${t}`);if(e>=1e9){const n=e/1e9;return o+it(n)+"B"}if(e>=1e6){const n=e/1e6;return o+it(n)+"M"}if(e>=1e3){const n=e/1e3;return o+it(n)+"K"}return o+Math.round(e).toString()}function it(t){const e=Math.round(t*10)/10;return e===Math.floor(e)?e.toFixed(0):e.toFixed(1)}const St={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","-":"⁻","+":"⁺"};function Dt(t){return t.split("").map(e=>St[e]??e).join("")}function Q(t,e){var f,u,a,l,c;if(t==null||Number.isNaN(t))return(e==null?void 0:e.naText)??"";if(e!=null&&e.percent){const{decimals:p,digits:m,multiply:g=!0,symbol:_=!0}=e.percent,S=g?t*100:t,N=m!=null?S.toPrecision(m):S.toFixed(p??1);return _?`${N}%`:N}if(((f=e==null?void 0:e.numeric)==null?void 0:f.abbreviate)&&Math.abs(t)>=1e3)return rt(t);const n=(u=e==null?void 0:e.numeric)==null?void 0:u.digits;if(n!=null){const p=t.toPrecision(n),m=(a=e==null?void 0:e.numeric)==null?void 0:a.thousandsSep;return m&&typeof m=="string"?q(p,m):p}const r=(l=e==null?void 0:e.numeric)==null?void 0:l.decimals,i=(c=e==null?void 0:e.numeric)==null?void 0:c.thousandsSep;let s;return r!==void 0?s=t.toFixed(r):Number.isInteger(t)||Math.abs(t-Math.round(t))<1e-4?s=Math.round(t).toString():s=t.toFixed(2),i&&typeof i=="string"&&(s=q(s,i)),s}function ht(t,e){const{eventsField:o,nField:n,separator:r="/",showPct:i=!1,thousandsSep:s,abbreviate:f}=e.events,u=t.metadata[o],a=t.metadata[n];if(u==null||a===void 0||a===null)return e.naText??"";const l=Number(u),c=Number(a);let p,m;f&&(l>=1e3||c>=1e3)?(p=l>=1e3?rt(l):String(l),m=c>=1e3?rt(c):String(c)):(p=String(l),m=String(c),s&&typeof s=="string"&&(p=q(p,s),m=q(m,s)));let g=`${p}${r}${m}`;if(i&&c>0){const _=(l/c*100).toFixed(1);g+=` (${_}%)`}return g}function pt(t,e,o,n){var f,u,a;if(t==null||Number.isNaN(t))return"";const r=((f=n==null?void 0:n.interval)==null?void 0:f.decimals)??2,i=((u=n==null?void 0:n.interval)==null?void 0:u.sep)??" ",s=(a=n==null?void 0:n.interval)==null?void 0:a.impreciseThreshold;return e==null||o===void 0||o===null||Number.isNaN(e)||Number.isNaN(o)?t.toFixed(r):s!=null&&e>0&&o/e>s?"—":`${t.toFixed(r)}${i}(${e.toFixed(r)}, ${o.toFixed(r)})`}function gt(t,e){if(t==null||Number.isNaN(t))return(e==null?void 0:e.naText)??"";const o=e==null?void 0:e.pvalue,n=(o==null?void 0:o.digits)??2,r=(o==null?void 0:o.expThreshold)??.001,i=(o==null?void 0:o.abbrevThreshold)??null,s=(o==null?void 0:o.format)??"auto",f=(o==null?void 0:o.stars)??!1,u=(o==null?void 0:o.thresholds)??[.05,.01,.001];let a="";if(f&&(t<u[2]?a="***":t<u[1]?a="**":t<u[0]&&(a="*")),i!==null&&t<i)return`<${i}${a}`;if(s==="scientific"||s==="auto"&&t<r){const c=Math.floor(Math.log10(t));return`${(t/Math.pow(10,c)).toPrecision(n)}×10${Dt(c.toString())}${a}`}let l;return t>=.1?l=t.toFixed(n):t>=.01?l=t.toFixed(n+1):l=t.toFixed(n+2),`${l}${a}`}function Lt(t,e){var i,s,f,u;const{type:o,field:n,options:r}=e;switch(o){case"interval":{const a=(i=r==null?void 0:r.interval)!=null&&i.point?t.metadata[r.interval.point]:t.point,l=(s=r==null?void 0:r.interval)!=null&&s.lower?t.metadata[r.interval.lower]:t.lower,c=(f=r==null?void 0:r.interval)!=null&&f.upper?t.metadata[r.interval.upper]:t.upper;return pt(a,l,c,r)}case"custom":return r!=null&&r.events?ht(t,r):String(t.metadata[n]??"");case"pvalue":return gt(t.metadata[n],r);case"numeric":return Q(t.metadata[n],r);case"percent":return Q(t.metadata[n],r);case"sparkline":case"icon":case"stars":case"img":case"range":return"";case"badge":{const a=t.metadata[n];return a==null?"":`  ${String(a)}  `}case"bar":{if(((u=r==null?void 0:r.bar)==null?void 0:u.showLabel)===!1)return"";const a=t.metadata[n];return a==null?"":a>=100?a.toFixed(0):a>=10?a.toFixed(1):a.toFixed(2)}case"text":default:return String(t.metadata[n]??"")}}function J(t,e){const o="⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻";let n=0;for(const r of t)o.includes(r)?n+=e*.3:"il1.,;:|!()[]{}' ".includes(r)?n+=e*.35:"×−".includes(r)?n+=e*.5:"mwMW@%".includes(r)?n+=e*.85:r>="0"&&r<="9"?n+=e*.6:n+=e*.55;return n}function Wt(t,e){var i,s;const o=new Map,n=O(t.theme.typography.fontSizeBase),r=t.data.rows;for(const f of e){if(f.width!=="auto"&&f.width!==null&&f.width!==void 0)continue;let u=0;f.header&&(u=Math.max(u,J(f.header,n)));for(const l of r){if(((i=l.style)==null?void 0:i.type)==="header"||((s=l.style)==null?void 0:s.type)==="spacer")continue;const c=Lt(l,f);c&&(u=Math.max(u,J(c,n)))}const a=Math.ceil(u+Z.PADDING);o.set(f.id,Math.min(Z.MAX,Math.max(Z.MIN,a)))}return o}function wt(t){var r;const e=O(t.theme.typography.fontSizeBase);let o=0;t.data.labelHeader&&(o=Math.max(o,J(t.data.labelHeader,e)));for(const i of t.data.rows)if(i.label){const f=(((r=i.style)==null?void 0:r.indent)??0)*D.INDENT_PER_LEVEL;o=Math.max(o,J(i.label,e)+f)}for(const i of t.data.groups)if(i.label){const s=i.depth*D.INDENT_PER_LEVEL;o=Math.max(o,J(i.label,e)+s)}const n=Math.ceil(o+Z.PADDING);return Math.min(Z.LABEL_MAX,Math.max(Z.MIN,n))}function at(t,e){const o=e.get(t.id);return o!==void 0?o:typeof t.width=="number"?t.width:v.DEFAULT_COLUMN_WIDTH}function Ft(t,e){var C,k,z,U;const o=t.theme,n=o.spacing.rowHeight,r=o.spacing.padding,i=Array.isArray(t.columns)?t.columns:[],s=nt(i,"left"),f=nt(i,"right"),a=st(s)||st(f)?o.spacing.headerHeight*ft.GROUP_HEADER_HEIGHT_MULTIPLIER:o.spacing.headerHeight,l=!!((C=t.labels)!=null&&C.title),c=!!((k=t.labels)!=null&&k.subtitle),p=!!((z=t.labels)!=null&&z.caption),m=!!((U=t.labels)!=null&&U.footnote),g=l?X.TITLE_HEIGHT:0,_=c?X.SUBTITLE_HEIGHT:0,S=g+_+(l||c?r:0),N=p?X.CAPTION_HEIGHT:0,E=m?X.FOOTNOTE_HEIGHT:0,A=N+E+(p||m?r:0),H=$t(t).length,h=!!t.data.overall,d=H*n+(h?n*ft.OVERALL_ROW_HEIGHT_MULTIPLIER:0),y=tt(i,"left"),$=tt(i,"right"),x=[...y,...$],b=Wt(t,x),I=wt(t),w=I+y.reduce((Y,j)=>Y+at(j,b),0),F=$.reduce((Y,j)=>Y+at(j,b),0),L=e.width??v.DEFAULT_WIDTH,T=t.data.includeForest,W=w+F;let R;if(!T)R=0;else if(typeof t.layout.plotWidth=="number")R=t.layout.plotWidth;else{const Y=L-W-v.COLUMN_GAP*2-r*2;R=Math.max(Y,v.MIN_FOREST_WIDTH)}const V=r*2+W+R+v.COLUMN_GAP*2,B=Math.max(e.width??L,V),P=S+r+a+d+v.AXIS_HEIGHT+v.AXIS_LABEL_HEIGHT+A+v.BOTTOM_MARGIN;return{totalWidth:B,totalHeight:e.height??P,tableWidth:w+F,forestWidth:R,headerHeight:a,rowHeight:n,plotHeight:d,axisHeight:v.AXIS_HEIGHT,nullValue:t.data.nullValue,summaryYPosition:d-n,showOverallSummary:h,headerTextHeight:S,footerTextHeight:A,titleY:r+X.TITLE_HEIGHT-8,subtitleY:r+g+X.SUBTITLE_HEIGHT-4,mainY:S+r,footerY:S+r+a+d+v.AXIS_HEIGHT+v.AXIS_LABEL_HEIGHT+r,autoWidths:b,labelWidth:I}}function $t(t){var c;const e=t.data.rows,o=Array.isArray(t.data.groups)?t.data.groups:[];if(o.length===0)return e.map(p=>({type:"data",row:p,depth:0}));const n=new Map;for(const p of o)n.set(p.id,p);const r=new Map;for(const p of e){const m=p.groupId??null;r.has(m)||r.set(m,[]),r.get(m).push(p)}const i=new Set;for(const p of r.keys()){if(!p)continue;let m=p;for(;m;)i.add(m),m=(c=n.get(m))==null?void 0:c.parentId}function s(p){return o.filter(m=>(m.parentId??null)===p&&i.has(m.id))}function f(p){if(!p)return 0;const m=n.get(p);return m?m.depth+1:0}function u(p){var g;let m=((g=r.get(p))==null?void 0:g.length)??0;for(const _ of s(p))m+=u(_.id);return m}const a=[];function l(p){if(p){const g=n.get(p);if(!g)return;const _=u(p);a.push({type:"group_header",groupId:g.id,label:g.label,depth:g.depth,rowCount:_})}for(const g of s(p))l(g.id);const m=r.get(p)??[];for(const g of m)a.push({type:"data",row:g,depth:f(g.groupId)})}return l(null),a}function yt(t){const e=[];for(const o of t)o.isGroup?e.push(...yt(o.columns)):e.push(o);return e}function tt(t,e){const o=[];for(const n of t)n.position===e&&(n.isGroup?o.push(...yt(n.columns)):o.push(n));return o}function nt(t,e){return t.filter(o=>o.position===e)}function st(t){return t.some(e=>e.isGroup)}function O(t){return t.endsWith("rem")?parseFloat(t)*X.REM_BASE:t.endsWith("px")?parseFloat(t):X.DEFAULT_FONT_SIZE}function et(t,e,o){return o==="right"?{textX:t+e-D.TEXT_PADDING,anchor:"end"}:o==="center"?{textX:t+e/2,anchor:"middle"}:{textX:t+D.TEXT_PADDING,anchor:"start"}}function G(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function lt(t,e,o,n=0){const r=e-n*2;if(J(t,o)<=r)return t;const s="…",f=o*.55;let u=0,a=t.length;for(;u<a;){const l=Math.ceil((u+a)/2),c=t.slice(0,l);J(c,o)+f<=r?u=l:a=l-1}return u===0?s:t.slice(0,u)+s}function Gt(t){return Math.abs(t)<.01?"0":Math.abs(t)>=100?t.toFixed(0):Math.abs(t)>=10?t.toFixed(1):t.toFixed(2)}function vt(t,e){const[o,n]=t,[r,i]=e,s=(i-r)/(n-o),f=u=>r+(u-o)*s;return f.domain=()=>t,f.range=()=>e,f.ticks=u=>{const a=(n-o)/(u-1),l=[];for(let c=0;c<u;c++)l.push(o+a*c);return l},f}function Pt(t,e){const[o,n]=t.map(l=>Math.max(l,.001)),[r,i]=e,s=Math.log10(o),f=Math.log10(n),u=(i-r)/(f-s),a=l=>{const c=Math.log10(Math.max(l,.001));return r+(c-s)*u};return a.domain=()=>[o,n],a.range=()=>e,a.ticks=l=>{const c=[],p=Math.floor(Math.log10(o)),m=Math.ceil(Math.log10(n));for(let g=p;g<=m;g++){const _=Math.pow(10,g);for(const S of[1,2,5]){const N=_*S;N>=o&&N<=n&&c.push(N)}}return c.length>0?c:[o,n]},a}function kt(t,e){const o=t.data.rows,n=t.theme.axis,r=t.data.scale==="log",i=typeof(n==null?void 0:n.rangeMin)=="number",s=typeof(n==null?void 0:n.rangeMax)=="number";let f;if(i&&s)f=[n.rangeMin,n.rangeMax];else{const a=o.flatMap(l=>[l.lower,l.upper]).filter(l=>l!=null&&!Number.isNaN(l)&&Number.isFinite(l));if(a.length===0)f=r?[.1,10]:[0,1];else{const[l,c]=[Math.min(...a),Math.max(...a)],p=c-l||1;f=[i?n.rangeMin:l-p*ut,s?n.rangeMax:c+p*ut]}}const u=_t(f,r);return r?Pt([Math.max(u[0],.01),Math.max(u[1],.02)],[0,e]):vt(u,[0,e])}function Ct(t,e,o){var i,s;const n=[],r=o.spacing.padding;if((i=t.labels)!=null&&i.title){const f=O(o.typography.fontSizeLg);n.push(`<text x="${r}" y="${e.titleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${f}px"
      font-weight="${o.typography.fontWeightBold}"
      fill="${o.colors.foreground}">${G(t.labels.title)}</text>`)}if((s=t.labels)!=null&&s.subtitle){const f=O(o.typography.fontSizeBase);n.push(`<text x="${r}" y="${e.subtitleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${f}px"
      fill="${o.colors.secondary}">${G(t.labels.subtitle)}</text>`)}return n.join(`
`)}function Xt(t,e,o){var s,f;const n=[],r=o.spacing.padding;let i=e.footerY;if((s=t.labels)!=null&&s.caption){const u=O(o.typography.fontSizeSm);n.push(`<text x="${r}" y="${i}"
      font-family="${o.typography.fontFamily}"
      font-size="${u}px"
      fill="${o.colors.secondary}">${G(t.labels.caption)}</text>`),i+=X.CAPTION_HEIGHT}if((f=t.labels)!=null&&f.footnote){const u=O(o.typography.fontSizeSm);n.push(`<text x="${r}" y="${i}"
      font-family="${o.typography.fontFamily}"
      font-size="${u}px"
      font-style="italic"
      fill="${o.colors.muted}">${G(t.labels.footnote)}</text>`)}return n.join(`
`)}function mt(t,e,o,n,r,i,s,f,u){const a=[],l=O(i.typography.fontSizeSm),c=i.typography.fontWeightMedium,p=i.typography.fontWeightBold,m=st(t),g=f??v.DEFAULT_LABEL_WIDTH,_=E=>{if(u){const A=u.get(E.id);if(A!==void 0)return A}return typeof E.width=="number"?E.width:v.DEFAULT_COLUMN_WIDTH},S=E=>E.isGroup?E.columns.reduce((A,M)=>A+S(M),0):_(E),N=(E,A)=>E+A/2+l*X.TEXT_BASELINE_ADJUSTMENT;if(m){const E=r/2,A=r/2;let M=o;s&&(a.push(`<text x="${M+D.TEXT_PADDING}" y="${N(n,r)}"
        font-family="${i.typography.fontFamily}"
        font-size="${l}px"
        font-weight="${c}"
        fill="${i.colors.foreground}">${G(s)}</text>`),a.push(`<line x1="${M+g}" x2="${M+g}"
        y1="${n}" y2="${n+r}"
        stroke="${i.colors.border}" stroke-width="1" opacity="0.3"/>`),M+=g);for(const H of t)if(H.isGroup){const h=S(H),d=M+h/2;a.push(`<text x="${d}" y="${N(n,E)}"
          font-family="${i.typography.fontFamily}"
          font-size="${l}px"
          font-weight="${p}"
          text-anchor="middle"
          fill="${i.colors.foreground}">${G(H.header)}</text>`),a.push(`<line x1="${M}" x2="${M+h}"
          y1="${n+E}" y2="${n+E}"
          stroke="${i.colors.border}" stroke-width="1" opacity="0.5"/>`),M+=h}else{const h=_(H),d=H.headerAlign??H.align,{textX:y,anchor:$}=et(M,h,d),x=lt(H.header,h,l,D.TEXT_PADDING);a.push(`<text x="${y}" y="${N(n,r)}"
          font-family="${i.typography.fontFamily}"
          font-size="${l}px"
          font-weight="${c}"
          text-anchor="${$}"
          fill="${i.colors.foreground}">${G(x)}</text>`),M+=h}M=o+(s?g:0);for(const H of t)if(H.isGroup){for(const h of H.columns)if(!h.isGroup){const d=_(h),y=h.headerAlign??h.align,{textX:$,anchor:x}=et(M,d,y);a.push(`<text x="${$}" y="${N(n+E,A)}"
              font-family="${i.typography.fontFamily}"
              font-size="${l}px"
              font-weight="${c}"
              text-anchor="${x}"
              fill="${i.colors.foreground}">${G(h.header)}</text>`),M+=d}}else{const h=_(H);M+=h}}else{let E=o;s&&(a.push(`<text x="${E+D.TEXT_PADDING}" y="${N(n,r)}"
        font-family="${i.typography.fontFamily}"
        font-size="${l}px"
        font-weight="${c}"
        fill="${i.colors.foreground}">${G(s)}</text>`),E+=g);for(const A of e){const M=_(A),H=A.headerAlign??A.align,{textX:h,anchor:d}=et(E,M,H),y=lt(A.header,M,l,D.TEXT_PADDING);a.push(`<text x="${h}" y="${N(n,r)}"
        font-family="${i.typography.fontFamily}"
        font-size="${l}px"
        font-weight="${c}"
        text-anchor="${d}"
        fill="${i.colors.foreground}">${G(y)}</text>`),E+=M}}return a.join(`
`)}function Rt(t,e,o,n,r,i,s){const f=[],u=O(s.typography.fontSizeBase),a=n+r/2+u*X.TEXT_BASELINE_ADJUSTMENT,l=e*D.INDENT_PER_LEVEL;return f.push(`<rect x="${o}" y="${n}"
    width="${i}" height="${r}"
    fill="${s.colors.primary}" opacity="${At}"/>`),f.push(`<text x="${o+D.TEXT_PADDING+l}" y="${a}"
    font-family="${s.typography.fontFamily}"
    font-size="${u}px"
    font-weight="${s.typography.fontWeightBold}"
    fill="${s.colors.foreground}">${G(t)}</text>`),f.join(`
`)}function xt(t,e){const o=new Map;for(const n of e)if(n.type==="bar"){let r=0;for(const i of t){const s=i.metadata[n.field];typeof s=="number"&&s>r&&(r=s)}o.set(n.field,r>0?r:1)}return o}function Tt(t,e,o,n,r,i,s,f=v.DEFAULT_LABEL_WIDTH,u=0,a,l){var S,N,E,A,M,H,h,d,y,$,x,b,I,w,F,L;const c=[],p=O(i.typography.fontSizeBase),m=n+r/2+p*X.TEXT_BASELINE_ADJUSTMENT;let g=o;const _=T=>{if(l){const W=l.get(T.id);if(W!==void 0)return W}return typeof T.width=="number"?T.width:v.DEFAULT_COLUMN_WIDTH};if(s){const T=u*D.INDENT_PER_LEVEL+(((S=t.style)==null?void 0:S.indent)??0)*D.INDENT_PER_LEVEL,W=(N=t.style)!=null&&N.bold||(E=t.style)!=null&&E.emphasis?i.typography.fontWeightBold:i.typography.fontWeightNormal,R=(A=t.style)!=null&&A.italic?"italic":"normal";let V=i.colors.foreground;(M=t.style)!=null&&M.color?V=t.style.color:(H=t.style)!=null&&H.muted?V=i.colors.muted:(h=t.style)!=null&&h.accent&&(V=i.colors.accent);const B=f-T-D.TEXT_PADDING*2,P=lt(t.label,B,p,0);if(c.push(`<text x="${g+D.TEXT_PADDING+T}" y="${m}"
      font-family="${i.typography.fontFamily}"
      font-size="${p}px"
      font-weight="${W}"
      font-style="${R}"
      fill="${V}">${G(P)}</text>`),(d=t.style)!=null&&d.badge){const C=String(t.style.badge),k=p*.8,z=4,U=k+z*2,Y=t.label.length*p*.55,j=g+D.TEXT_PADDING+T+Y+6,ot=C.length*k*.6+z*2,It=n+(r-U)/2;c.push(`<rect x="${j}" y="${It}" width="${ot}" height="${U}"
        rx="3" fill="${i.colors.primary}" opacity="0.15"/>`),c.push(`<text x="${j+ot/2}" y="${It+U/2+k*.35}"
        text-anchor="middle"
        font-family="${i.typography.fontFamily}"
        font-size="${k}px"
        font-weight="500"
        fill="${i.colors.primary}">${G(C)}</text>`)}g+=f}for(const T of e){const W=_(T),R=Ut(t,T),{textX:V,anchor:B}=et(g,W,T.align);if(T.type==="bar"&&typeof t.metadata[T.field]=="number"){const P=t.metadata[T.field],C=a==null?void 0:a.get(T.field),k=(($=(y=T.options)==null?void 0:y.bar)==null?void 0:$.maxValue)??C??100,z=((b=(x=T.options)==null?void 0:x.bar)==null?void 0:b.color)??i.colors.primary,U=i.shapes.pointSize*2,j=W-D.TEXT_PADDING*2-50,Mt=Math.min(P/k*j,j);c.push(`<rect x="${g+D.TEXT_PADDING}" y="${n+r/2-U/2}"
        width="${Math.max(0,Mt)}" height="${U}"
        fill="${z}" opacity="0.7" rx="2"/>`);const ot=g+W-D.TEXT_PADDING;c.push(`<text x="${ot}" y="${m}"
        font-family="${i.typography.fontFamily}"
        font-size="${p}px"
        text-anchor="end"
        fill="${i.colors.foreground}">${Q(P)}</text>`)}else if(T.type==="sparkline"&&Array.isArray(t.metadata[T.field])){let P=t.metadata[T.field];Array.isArray(P[0])&&(P=P[0]);const C=((w=(I=T.options)==null?void 0:I.sparkline)==null?void 0:w.height)??16,k=((L=(F=T.options)==null?void 0:F.sparkline)==null?void 0:L.color)??i.colors.primary,z=D.TEXT_PADDING*2,U=Ot(P,g+D.TEXT_PADDING,n+r/2-C/2,W-z,C);c.push(`<path d="${U}" fill="none" stroke="${k}" stroke-width="1.5"/>`)}else c.push(`<text x="${V}" y="${m}"
        font-family="${i.typography.fontFamily}"
        font-size="${p}px"
        text-anchor="${B}"
        fill="${i.colors.foreground}">${G(R)}</text>`);g+=W}return c.join(`
`)}function Ut(t,e){var n,r,i,s,f,u,a,l,c,p,m,g,_,S,N,E,A,M,H;if(e.type==="interval"){const h=(r=(n=e.options)==null?void 0:n.interval)!=null&&r.point?t.metadata[e.options.interval.point]:t.point,d=(s=(i=e.options)==null?void 0:i.interval)!=null&&s.lower?t.metadata[e.options.interval.lower]:t.lower,y=(u=(f=e.options)==null?void 0:f.interval)!=null&&u.upper?t.metadata[e.options.interval.upper]:t.upper;return pt(h,d,y,e.options)}if(e.type==="numeric"){const h=t.metadata[e.field];return typeof h=="number"?Q(h,e.options):((a=e.options)==null?void 0:a.naText)??""}if(e.type==="custom"&&((l=e.options)!=null&&l.events))return ht(t,e.options);if(e.type==="pvalue"){const h=t.metadata[e.field];return typeof h!="number"?((c=e.options)==null?void 0:c.naText)??"":gt(h,e.options)}if(e.type==="icon"){const h=t.metadata[e.field];if(h==null)return"";const d=String(h),y=(m=(p=e.options)==null?void 0:p.icon)==null?void 0:m.mapping;return y&&d in y?y[d]:d}if(e.type==="badge"){const h=t.metadata[e.field];return h!=null?String(h):""}if(e.type==="stars"){const h=t.metadata[e.field];if(typeof h!="number")return"";const d=((_=(g=e.options)==null?void 0:g.stars)==null?void 0:_.maxStars)??5,y=Math.max(0,Math.min(d,h)),$=Math.floor(y),x=d-$;return"★".repeat($)+"☆".repeat(x)}if(e.type==="img")return((N=(S=e.options)==null?void 0:S.img)==null?void 0:N.fallback)??"[IMG]";if(e.type==="reference"){const h=t.metadata[e.field];if(h==null)return"";const d=String(h),y=((A=(E=e.options)==null?void 0:E.reference)==null?void 0:A.maxChars)??30;return d.length<=y?d:d.substring(0,y)+"..."}if(e.type==="range"){const h=(M=e.options)==null?void 0:M.range;if(!h)return"";const d=t.metadata[h.minField],y=t.metadata[h.maxField],$=h.separator??" – ",x=h.decimals,b=I=>typeof I!="number"?"":x==null?Number.isInteger(I)?String(I):I.toFixed(1):I.toFixed(x);return d===null&&y===null?"":d===null?b(y):y===null?b(d):`${b(d)}${$}${b(y)}`}const o=t.metadata[e.field];return o!=null?String(o):((H=e.options)==null?void 0:H.naText)??""}function Ot(t,e,o,n,r){const i=t.filter(l=>Number.isFinite(l));if(i.length===0)return"";if(i.length===1){const l=e+n/2,c=o+r/2;return`M${l.toFixed(1)},${c.toFixed(1)}`}const s=Math.min(...i),u=Math.max(...i)-s||1;return`M${i.map((l,c)=>{const p=e+c/(i.length-1)*n,m=o+r-(l-s)/u*r;return`${p.toFixed(1)},${m.toFixed(1)}`}).join("L")}`}const bt=6;function ct(t,e,o){const n=t.metadata[e];return n!=null&&typeof n=="number"&&!Number.isNaN(n)?n:o}function Vt(t,e){return e<=1?0:-((e-1)*bt)/2+t*bt}function Bt(t,e,o,n,r,i=[],s,f=0,u=1/0){var h;let a;i.length===0?a=[{point:t.point,lower:t.lower,upper:t.upper,color:null,shape:null,opacity:null}]:a=i.map(d=>({point:ct(t,d.pointCol,t.point),lower:ct(t,d.lowerCol,t.lower),upper:ct(t,d.upperCol,t.upper),color:d.color??null,shape:d.shape??null,opacity:d.opacity??null}));const l=a.filter(d=>d.point!=null&&!Number.isNaN(d.point)&&d.lower!=null&&!Number.isNaN(d.lower)&&d.upper!=null&&!Number.isNaN(d.upper));if(l.length===0)return"";const c=n.shapes.pointSize,p=n.shapes.lineWidth,m=n.colors.intervalLine,g=D.WHISKER_HALF_HEIGHT,_=((h=t.style)==null?void 0:h.type)==="summary",N=n.shapes.summaryHeight/2;function E(d){var $;if(d&&(($=t.markerStyle)==null?void 0:$.size)!=null)return c*t.markerStyle.size;const y=s?t.metadata[s]:void 0;if(y){const x=.5+Math.sqrt(y/100)*1.5;return Math.min(Math.max(c*x,3),c*2.5)}return c}function A(d,y){const $=y===0,x=t.markerStyle,b=n.shapes.markerColors,I=n.shapes.markerShapes,w=["square","circle","diamond","triangle"];let F;$&&(x!=null&&x.color)?F=x.color:d.color?F=d.color:b&&b.length>0?F=b[y%b.length]:F=n.colors.interval??n.colors.primary??"#2563eb";let L;$&&(x!=null&&x.shape)?L=x.shape:d.shape?L=d.shape:I&&I.length>0?L=I[y%I.length]:L=w[y%w.length];let T;return $&&(x==null?void 0:x.opacity)!=null?T=x.opacity:d.opacity!=null?T=d.opacity:T=1,{color:F,shape:L,opacity:T}}function M(d,y,$,x){const{color:b,shape:I,opacity:w}=x,F=w<1?` fill-opacity="${w}"`:"";switch(I){case"circle":return`<circle cx="${d}" cy="${y}" r="${$}" fill="${b}"${F}/>`;case"diamond":return`<polygon points="${[`${d},${y-$}`,`${d+$},${y}`,`${d},${y+$}`,`${d-$},${y}`].join(" ")}" fill="${b}"${F}/>`;case"triangle":return`<polygon points="${[`${d},${y-$}`,`${d+$},${y+$}`,`${d-$},${y+$}`].join(" ")}" fill="${b}"${F}/>`;default:return`<rect x="${d-$}" y="${y-$}" width="${$*2}" height="${$*2}" fill="${b}"${F}/>`}}const H=[];return l.forEach((d,y)=>{const $=e+Vt(y,l.length),x=o(d.lower),b=o(d.upper),I=o(d.point),w=A(d,y),F=E(y===0),L=m;if(_){const T=w.opacity<1?` fill-opacity="${w.opacity}"`:"",W=[`${x},${$}`,`${I},${$-N}`,`${b},${$}`,`${I},${$+N}`].join(" ");H.push(`
        <g class="interval effect-${y} summary">
          <polygon points="${W}"
            fill="${w.color}"${T} stroke="${n.colors.summaryBorder}" stroke-width="1"/>
        </g>`)}else{const T=f,W=f+u,R=x<T,V=b>W,B=Math.max(T,Math.min(W,x)),P=Math.max(T,Math.min(W,b));let C="";R?C=`<path d="M ${T+4} ${$} L ${T+10} ${$-4} L ${T+10} ${$+4} Z" fill="${L}"/>`:C=`<line x1="${B}" x2="${B}" y1="${$-g}" y2="${$+g}" stroke="${L}" stroke-width="${p}"/>`;let k="";V?k=`<path d="M ${W-4} ${$} L ${W-10} ${$-4} L ${W-10} ${$+4} Z" fill="${L}"/>`:k=`<line x1="${P}" x2="${P}" y1="${$-g}" y2="${$+g}" stroke="${L}" stroke-width="${p}"/>`,H.push(`
        <g class="interval effect-${y}">
          <line x1="${B}" x2="${P}" y1="${$}" y2="${$}"
            stroke="${L}" stroke-width="${p}"/>
          ${C}
          ${k}
          ${M(I,$,F,w)}
        </g>`)}}),H.join("")}function zt(t,e,o,n,r,i,s,f){const a=f.shapes.summaryHeight/2,l=r(e),c=r(t),p=r(o),m=i+Math.max(0,Math.min(s,l)),g=i+Math.max(0,Math.min(s,c)),_=i+Math.max(0,Math.min(s,p));return`<polygon points="${[`${m},${n}`,`${g},${n-a}`,`${_},${n}`,`${g},${n+a}`].join(" ")}"
    fill="${f.colors.summaryFill}"
    stroke="${f.colors.summaryBorder}"
    stroke-width="1"/>`}function jt(t,e,o,n,r){const i=[],s=typeof o.axis.tickCount=="number"?o.axis.tickCount:D.DEFAULT_TICK_COUNT,f=Array.isArray(o.axis.tickValues)?o.axis.tickValues:t.ticks(s),u=O(o.typography.fontSizeSm);i.push(`<line x1="${r}" x2="${r+e.forestWidth}"
    y1="0" y2="0" stroke="${o.colors.border}" stroke-width="1"/>`);for(const a of f){const l=r+t(a);i.push(`<line x1="${l}" x2="${l}" y1="0" y2="4"
      stroke="${o.colors.border}" stroke-width="1"/>`),i.push(`<text x="${l}" y="16" text-anchor="middle"
      font-family="${o.typography.fontFamily}"
      font-size="${u}px"
      fill="${o.colors.secondary}">${Gt(a)}</text>`)}return n&&i.push(`<text x="${r+e.forestWidth/2}" y="28"
      text-anchor="middle"
      font-family="${o.typography.fontFamily}"
      font-size="${u}px"
      font-weight="500"
      fill="${o.colors.secondary}">${G(n)}</text>`),`<g transform="translate(0, ${e.mainY+e.headerHeight+e.plotHeight})">${i.join(`
`)}</g>`}function Et(t,e,o,n,r,i,s=1,f=.6){let a=`<line x1="${t}" x2="${t}" y1="${e}" y2="${o}"
    stroke="${r}" stroke-width="${s}" stroke-opacity="${f}" stroke-dasharray="${n==="dashed"?"6,4":n==="dotted"?"2,2":"none"}"/>`;return i&&(a+=`<text x="${t}" y="${e-4}" text-anchor="middle"
      font-size="10px" fill="${r}">${G(i)}</text>`),a}class K extends Error{constructor(e){super(`SVG Generator: ${e}`),this.name="SVGGeneratorError"}}function Yt(t){if(!t||typeof t!="object")throw new K("Invalid spec: expected an object");const e=t;if(!e.data||typeof e.data!="object")throw new K("Invalid spec: missing or invalid 'data' property");const o=e.data;if(!Array.isArray(o.rows))throw new K("Invalid spec: 'data.rows' must be an array");if(!e.theme||typeof e.theme!="object")throw new K("Invalid spec: missing or invalid 'theme' property");const n=e.theme;if(!n.colors||typeof n.colors!="object")throw new K("Invalid spec: missing or invalid 'theme.colors'");if(!n.typography||typeof n.typography!="object")throw new K("Invalid spec: missing or invalid 'theme.typography'");if(!n.spacing||typeof n.spacing!="object")throw new K("Invalid spec: missing or invalid 'theme.spacing'")}function Jt(t,e={}){Yt(t);const o=t.theme,n=Ft(t,e),r=o.spacing.padding,i=Array.isArray(t.columns)?t.columns:[],s=nt(i,"left"),f=nt(i,"right"),u=tt(i,"left"),a=tt(i,"right"),l=n.labelWidth+u.reduce((h,d)=>h+at(d,n.autoWidths),0),c=r+l,p=kt(t,n.forestWidth),m=c+n.forestWidth,g=[];g.push(`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
  width="${n.totalWidth}" height="${n.totalHeight}"
  viewBox="0 0 ${n.totalWidth} ${n.totalHeight}">`);const _=e.backgroundColor??o.colors.background;g.push(`<rect width="100%" height="100%" fill="${_}"/>`),g.push(Ct(t,n,o));const S=n.mainY;g.push(mt(s,u,r,S,n.headerHeight,o,t.data.labelHeader??"Study",n.labelWidth,n.autoWidths)),a.length>0&&g.push(mt(f,a,m,S,n.headerHeight,o,void 0,void 0,n.autoWidths)),g.push(`<line x1="${r}" x2="${n.totalWidth-r}"
    y1="${S+n.headerHeight}" y2="${S+n.headerHeight}"
    stroke="${o.colors.border}" stroke-width="1"/>`);const N=$t(t);if(t.data.includeForest&&n.forestWidth>0){const h=n.mainY+n.headerHeight,d=c+p(t.data.nullValue);g.push(Et(d,h,h+n.plotHeight,"dashed",o.colors.muted));const y=Array.isArray(t.annotations)?t.annotations:[];for(const $ of y)if($.type==="reference_line"){const x=c+p($.x);g.push(Et(x,h,h+n.plotHeight,$.style,$.color??o.colors.accent,$.label,$.width??1,$.opacity??.6))}if(N.forEach(($,x)=>{if($.type==="data"){const b=h+x*n.rowHeight+n.rowHeight/2;g.push(Bt($.row,b,I=>c+p(I),o,t.data.nullValue,t.data.effects,t.data.weightCol,c,n.forestWidth))}}),t.data.overall&&n.showOverallSummary&&typeof t.data.overall.point=="number"&&!Number.isNaN(t.data.overall.point)&&typeof t.data.overall.lower=="number"&&!Number.isNaN(t.data.overall.lower)&&typeof t.data.overall.upper=="number"&&!Number.isNaN(t.data.overall.upper)){const $=h+n.summaryYPosition;g.push(zt(t.data.overall.point,t.data.overall.lower,t.data.overall.upper,$,p,c,n.forestWidth,o))}g.push(jt(p,n,o,t.data.axisLabel,c))}const E=n.mainY+n.headerHeight,A=t.data.rows,M=xt(A,u),H=xt(A,a);return N.forEach((h,d)=>{var $,x;const y=E+d*n.rowHeight;if(h.type==="group_header")g.push(Rt(h.label,h.depth,r,y,n.rowHeight,n.totalWidth-r*2,o));else{const b=h.row,I=h.depth,w=Ht(I),F=d%2===1?Nt:0,L=Math.max(w,F);L>0&&g.push(`<rect x="${r}" y="${y}"
          width="${n.totalWidth-r*2}" height="${n.rowHeight}"
          fill="${o.colors.muted}" opacity="${L}"/>`),g.push(Tt(b,u,r,y,n.rowHeight,o,!0,n.labelWidth,I,M,n.autoWidths)),a.length>0&&g.push(Tt(b,a,m,y,n.rowHeight,o,!1,0,I,H,n.autoWidths))}if(h.type==="data"){const b=h.row,I=(($=b.style)==null?void 0:$.type)==="summary",w=((x=b.style)==null?void 0:x.type)==="spacer";I&&g.push(`<line x1="${r}" x2="${n.totalWidth-r}"
          y1="${y}" y2="${y}"
          stroke="${o.colors.border}" stroke-width="2"/>`),w||g.push(`<line x1="${r}" x2="${n.totalWidth-r}"
          y1="${y+n.rowHeight}" y2="${y+n.rowHeight}"
          stroke="${o.colors.border}" stroke-width="1" opacity="0.5"/>`)}else g.push(`<line x1="${r}" x2="${n.totalWidth-r}"
        y1="${y+n.rowHeight}" y2="${y+n.rowHeight}"
        stroke="${o.colors.border}" stroke-width="1" opacity="0.5"/>`)}),g.push(Xt(t,n,o)),g.push("</svg>"),g.join(`
`)}function Kt(t,e){const o=JSON.parse(t);return Jt(o,e)}globalThis.generateSVG=Kt})();
