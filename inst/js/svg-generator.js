(function(){"use strict";function Dt(t,n){if(n){const f=[.05,.1,.15,.2,.25,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.75,2,2.5,3,4,5,6,7,8,10,12,15,20,25,30,40,50,75,100];let r=f[0];for(const l of f)if(l<=t[0])r=l;else break;let d=f[f.length-1];for(let l=f.length-1;l>=0&&f[l]>=t[1];l--)d=f[l];return[r,d]}const o=t[1]-t[0];if(o===0)return t;const e=Math.pow(10,Math.floor(Math.log10(o))),i=o/e;let a;i<=1?a=e*.1:i<=2?a=e*.2:i<=5?a=e*.5:a=e;const s=Math.floor(t[0]/a)*a,p=Math.ceil(t[1]/a)*a;return[s,p]}const Ht=.06,ut=.04;function Wt(t){return t<=0?0:ut+t*ut}const v={DEFAULT_LABEL_WIDTH:200,DEFAULT_COLUMN_WIDTH:100,AXIS_HEIGHT:32,AXIS_LABEL_HEIGHT:20,BOTTOM_MARGIN:16,MIN_FOREST_WIDTH:200,DEFAULT_WIDTH:800,COLUMN_GAP:16},U={TITLE_HEIGHT:28,SUBTITLE_HEIGHT:20,CAPTION_HEIGHT:16,FOOTNOTE_HEIGHT:14,DEFAULT_FONT_SIZE:14,REM_BASE:16,TEXT_BASELINE_ADJUSTMENT:1/3},G={INDENT_PER_LEVEL:12,TEXT_PADDING:10,WHISKER_HALF_HEIGHT:4,DEFAULT_TICK_COUNT:5},ft={GROUP_HEADER_HEIGHT_MULTIPLIER:1.3,OVERALL_ROW_HEIGHT_MULTIPLIER:1.5},K={PADDING:28,MIN:60,MAX:600,LABEL_MAX:400,VISUAL_MIN:{sparkline:88,bar:100,stars:80,range:80,badge:70}},q={CHEVRON_WIDTH:12,GAP:6,INTERNAL_PADDING:20},Lt={PADDING:16};function Q(t,n){const o=t.split(".");return o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,n),o.join(".")}function it(t){const n=Math.abs(t),o=t<0?"-":"";if(n>=1e12)throw new Error(`Cannot abbreviate value >= 1 trillion: ${t}`);if(n>=1e9){const e=n/1e9;return o+at(e)+"B"}if(n>=1e6){const e=n/1e6;return o+at(e)+"M"}if(n>=1e3){const e=n/1e3;return o+at(e)+"K"}return o+Math.round(n).toString()}function at(t){const n=Math.round(t*10)/10;return n===Math.floor(n)?n.toFixed(0):n.toFixed(1)}const wt={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","-":"⁻","+":"⁺"};function Gt(t){return t.split("").map(n=>wt[n]??n).join("")}function tt(t,n){var p,f,r,d,l;if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";if(n!=null&&n.percent){const{decimals:h,digits:g,multiply:c=!0,symbol:M=!0}=n.percent,T=c?t*100:t,x=g!=null?T.toPrecision(g):T.toFixed(h??1);return M?`${x}%`:x}if(((p=n==null?void 0:n.numeric)==null?void 0:p.abbreviate)&&Math.abs(t)>=1e3)return it(t);const e=(f=n==null?void 0:n.numeric)==null?void 0:f.digits;if(e!=null){const h=t.toPrecision(e),g=(r=n==null?void 0:n.numeric)==null?void 0:r.thousandsSep;return g&&typeof g=="string"?Q(h,g):h}const i=(d=n==null?void 0:n.numeric)==null?void 0:d.decimals,a=(l=n==null?void 0:n.numeric)==null?void 0:l.thousandsSep;let s;return i!==void 0?s=t.toFixed(i):Number.isInteger(t)||Math.abs(t-Math.round(t))<1e-4?s=Math.round(t).toString():s=t.toFixed(2),a&&typeof a=="string"&&(s=Q(s,a)),s}function ht(t,n){const{eventsField:o,nField:e,separator:i="/",showPct:a=!1,thousandsSep:s,abbreviate:p}=n.events,f=t.metadata[o],r=t.metadata[e];if(f==null||r===void 0||r===null)return n.naText??"";const d=Number(f),l=Number(r);let h,g;p&&(d>=1e3||l>=1e3)?(h=d>=1e3?it(d):String(d),g=l>=1e3?it(l):String(l)):(h=String(d),g=String(l),s&&typeof s=="string"&&(h=Q(h,s),g=Q(g,s)));let c=`${h}${i}${g}`;if(a&&l>0){const M=(d/l*100).toFixed(1);c+=` (${M}%)`}return c}function pt(t,n,o,e){var p,f,r;if(t==null||Number.isNaN(t))return"";const i=((p=e==null?void 0:e.interval)==null?void 0:p.decimals)??2,a=((f=e==null?void 0:e.interval)==null?void 0:f.sep)??" ",s=(r=e==null?void 0:e.interval)==null?void 0:r.impreciseThreshold;return n==null||o===void 0||o===null||Number.isNaN(n)||Number.isNaN(o)?t.toFixed(i):s!=null&&n>0&&o/n>s?"—":`${t.toFixed(i)}${a}(${n.toFixed(i)}, ${o.toFixed(i)})`}function gt(t,n){if(t==null||Number.isNaN(t))return(n==null?void 0:n.naText)??"";const o=n==null?void 0:n.pvalue,e=(o==null?void 0:o.digits)??2,i=(o==null?void 0:o.expThreshold)??.001,a=(o==null?void 0:o.abbrevThreshold)??null,s=(o==null?void 0:o.format)??"auto",p=(o==null?void 0:o.stars)??!1,f=(o==null?void 0:o.thresholds)??[.05,.01,.001];let r="";if(p&&(t<f[2]?r="***":t<f[1]?r="**":t<f[0]&&(r="*")),a!==null&&t<a)return`<${a}${r}`;if(s==="scientific"||s==="auto"&&t<i){const l=Math.floor(Math.log10(t));return`${(t/Math.pow(10,l)).toPrecision(e)}×10${Gt(l.toString())}${r}`}let d;return t>=.1?d=t.toFixed(e):t>=.01?d=t.toFixed(e+1):d=t.toFixed(e+2),`${d}${r}`}function Ft(t,n){var a,s,p,f;const{type:o,field:e,options:i}=n;switch(o){case"interval":{const r=(a=i==null?void 0:i.interval)!=null&&a.point?t.metadata[i.interval.point]:t.point,d=(s=i==null?void 0:i.interval)!=null&&s.lower?t.metadata[i.interval.lower]:t.lower,l=(p=i==null?void 0:i.interval)!=null&&p.upper?t.metadata[i.interval.upper]:t.upper;return pt(r,d,l,i)}case"custom":return i!=null&&i.events?ht(t,i):String(t.metadata[e]??"");case"pvalue":return gt(t.metadata[e],i);case"numeric":return tt(t.metadata[e],i);case"percent":return tt(t.metadata[e],i);case"sparkline":case"icon":case"stars":case"img":case"range":return"";case"badge":{const r=t.metadata[e];return r==null?"":`  ${String(r)}  `}case"bar":{if(((f=i==null?void 0:i.bar)==null?void 0:f.showLabel)===!1)return"";const r=t.metadata[e];return r==null?"":r>=100?r.toFixed(0):r>=10?r.toFixed(1):r.toFixed(2)}case"text":default:return String(t.metadata[e]??"")}}function O(t,n){const o="⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻";let e=0;for(const i of t)o.includes(i)?e+=n*.3:"il1.,;:|!()[]{}' ".includes(i)?e+=n*.35:"×−".includes(i)?e+=n*.5:"mwMW@%".includes(i)?e+=n*.85:i>="0"&&i<="9"?e+=n*.6:e+=n*.55;return e}function vt(t,n){var a,s;const o=new Map,e=z(t.theme.typography.fontSizeBase),i=t.data.rows;for(const p of n){if(p.width!=="auto"&&p.width!==null&&p.width!==void 0)continue;let f=0;p.header&&(f=Math.max(f,O(p.header,e)));for(const l of i){if(((a=l.style)==null?void 0:a.type)==="header"||((s=l.style)==null?void 0:s.type)==="spacer")continue;const h=Ft(l,p);h&&(f=Math.max(f,O(h,e)))}const r=K.VISUAL_MIN[p.type]??K.MIN,d=Math.ceil(f+K.PADDING);o.set(p.id,Math.min(K.MAX,Math.max(r,d)))}return kt(t.columns,o,e),o}function kt(t,n,o){function e(s){return s.isGroup?s.columns.flatMap(e):[s]}function i(s){const p=n.get(s.id);return p!==void 0?p:typeof s.width=="number"?s.width:K.MIN}function a(s){if(s.isGroup){for(const p of s.columns)a(p);if(s.header){const p=O(s.header,o)+Lt.PADDING,f=e(s),r=f.reduce((d,l)=>d+i(l),0);if(p>r&&f.length>0){const d=Math.ceil((p-r)/f.length);for(const l of f)n.set(l.id,i(l)+d)}}}}for(const s of t)a(s)}function mt(t){var p,f;const n=z(t.theme.typography.fontSizeBase);let o=0;const e=new Map,i=Array.isArray(t.data.groups)?t.data.groups:[];for(const r of i)e.set(r.id,r.depth);const a=r=>r?(e.get(r)??0)+1:0;t.data.labelHeader&&(o=Math.max(o,O(t.data.labelHeader,n)));for(const r of t.data.rows)if(r.label){const d=a(r.groupId),l=((p=r.style)==null?void 0:p.indent)??0,g=(d+l)*G.INDENT_PER_LEVEL;let c=O(r.label,n)+g;if((f=r.style)!=null&&f.badge){const M=String(r.style.badge),T=n*.8,x=4,I=6,b=O(M,T)+x*2;c+=I+b}o=Math.max(o,c)}for(const r of i)if(r.label){const d=r.depth*G.INDENT_PER_LEVEL,l=O(r.label,n),g=`(${t.data.rows.filter(x=>x.groupId===r.id).length})`,c=n*.75,M=O(g,c),T=d+q.CHEVRON_WIDTH+q.GAP+l+q.GAP+M+q.INTERNAL_PADDING;o=Math.max(o,T)}const s=Math.ceil(o+K.PADDING);return Math.min(K.LABEL_MAX,Math.max(K.MIN,s))}function st(t,n){const o=n.get(t.id);return o!==void 0?o:typeof t.width=="number"?t.width:v.DEFAULT_COLUMN_WIDTH}function Pt(t,n){var F,R,P,j,J;const o=t.theme,e=o.spacing.rowHeight,i=o.spacing.padding,a=Array.isArray(t.columns)?t.columns:[],s=nt(a,"left"),p=nt(a,"right"),r=lt(s)||lt(p)?o.spacing.headerHeight*ft.GROUP_HEADER_HEIGHT_MULTIPLIER:o.spacing.headerHeight,d=!!((F=t.labels)!=null&&F.title),l=!!((R=t.labels)!=null&&R.subtitle),h=!!((P=t.labels)!=null&&P.caption),g=!!((j=t.labels)!=null&&j.footnote),c=d?U.TITLE_HEIGHT:0,M=l?U.SUBTITLE_HEIGHT:0,T=c+M+(d||l?i:0),x=h?U.CAPTION_HEIGHT:0,I=g?U.FOOTNOTE_HEIGHT:0,S=x+I+(h||g?i:0),b=yt(t),D=!!t.data.overall;let m=0;for(const B of b){const Y=B.type==="data"&&((J=B.row.style)==null?void 0:J.type)==="spacer";m+=Y?e/2:e}D&&(m+=e*ft.OVERALL_ROW_HEIGHT_MULTIPLIER);const u=et(a,"left"),y=et(a,"right"),$=[...u,...y];let N,H;if(n.columnWidths){N=new Map;for(const[B,Y]of Object.entries(n.columnWidths))B!=="__label__"&&N.set(B,Y);H=n.columnWidths.__label__??mt(t)}else N=vt(t,$),H=mt(t);const _=H+u.reduce((B,Y)=>B+st(Y,N),0),w=y.reduce((B,Y)=>B+st(Y,N),0),W=n.width??v.DEFAULT_WIDTH,A=t.data.includeForest,E=_+w;let L;if(!A)L=0;else if(typeof n.forestWidth=="number")L=n.forestWidth;else if(typeof t.layout.plotWidth=="number")L=t.layout.plotWidth;else{const B=W-E-v.COLUMN_GAP*2-i*2;L=Math.max(B,v.MIN_FOREST_WIDTH)}const V=i*2+E+L+v.COLUMN_GAP*2,k=Math.max(n.width??W,V),X=T+i+r+m+v.AXIS_HEIGHT+v.AXIS_LABEL_HEIGHT+S+v.BOTTOM_MARGIN;return{totalWidth:k,totalHeight:n.height??X,tableWidth:_+w,forestWidth:L,headerHeight:r,rowHeight:e,plotHeight:m,axisHeight:v.AXIS_HEIGHT,nullValue:t.data.nullValue,summaryYPosition:m-e,showOverallSummary:D,headerTextHeight:T,footerTextHeight:S,titleY:i+U.TITLE_HEIGHT-8,subtitleY:i+c+U.SUBTITLE_HEIGHT-4,mainY:T+i,footerY:T+i+r+m+v.AXIS_HEIGHT+v.AXIS_LABEL_HEIGHT+i,autoWidths:N,labelWidth:H}}function yt(t){var l;const n=t.data.rows,o=Array.isArray(t.data.groups)?t.data.groups:[];if(o.length===0)return n.map(h=>({type:"data",row:h,depth:0}));const e=new Map;for(const h of o)e.set(h.id,h);const i=new Map;for(const h of n){const g=h.groupId??null;i.has(g)||i.set(g,[]),i.get(g).push(h)}const a=new Set;for(const h of i.keys()){if(!h)continue;let g=h;for(;g;)a.add(g),g=(l=e.get(g))==null?void 0:l.parentId}function s(h){return o.filter(g=>(g.parentId??null)===h&&a.has(g.id))}function p(h){if(!h)return 0;const g=e.get(h);return g?g.depth+1:0}function f(h){var c;let g=((c=i.get(h))==null?void 0:c.length)??0;for(const M of s(h))g+=f(M.id);return g}const r=[];function d(h){if(h){const c=e.get(h);if(!c)return;const M=f(h);r.push({type:"group_header",groupId:c.id,label:c.label,depth:c.depth,rowCount:M})}for(const c of s(h))d(c.id);const g=i.get(h)??[];for(const c of g)r.push({type:"data",row:c,depth:p(c.groupId)})}return d(null),r}function $t(t){const n=[];for(const o of t)o.isGroup?n.push(...$t(o.columns)):n.push(o);return n}function et(t,n){const o=[];for(const e of t)e.position===n&&(e.isGroup?o.push(...$t(e.columns)):o.push(e));return o}function nt(t,n){return t.filter(o=>o.position===n)}function lt(t){return t.some(n=>n.isGroup)}function z(t){return t.endsWith("rem")?parseFloat(t)*U.REM_BASE:t.endsWith("px")?parseFloat(t):U.DEFAULT_FONT_SIZE}function ot(t,n,o){return o==="right"?{textX:t+n-G.TEXT_PADDING,anchor:"end"}:o==="center"?{textX:t+n/2,anchor:"middle"}:{textX:t+G.TEXT_PADDING,anchor:"start"}}function C(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function ct(t,n,o,e=0){const i=n-e*2;if(O(t,o)<=i)return t;const s="…",p=o*.55;let f=0,r=t.length;for(;f<r;){const d=Math.ceil((f+r)/2),l=t.slice(0,d);O(l,o)+p<=i?f=d:r=d-1}return f===0?s:t.slice(0,f)+s}function Ct(t){return Math.abs(t)<.01?"0":Math.abs(t)>=100?t.toFixed(0):Math.abs(t)>=10?t.toFixed(1):t.toFixed(2)}function xt(t,n){const[o,e]=t,[i,a]=n,s=(a-i)/(e-o),p=f=>i+(f-o)*s;return p.domain=()=>t,p.range=()=>n,p.ticks=f=>{const r=(e-o)/(f-1),d=[];for(let l=0;l<f;l++)d.push(o+r*l);return d},p}function Tt(t,n){const[o,e]=t.map(d=>Math.max(d,.001)),[i,a]=n,s=Math.log10(o),p=Math.log10(e),f=(a-i)/(p-s),r=d=>{const l=Math.log10(Math.max(d,.001));return i+(l-s)*f};return r.domain=()=>[o,e],r.range=()=>n,r.ticks=d=>{const l=[],h=Math.floor(Math.log10(o)),g=Math.ceil(Math.log10(e));for(let c=h;c<=g;c++){const M=Math.pow(10,c);for(const T of[1,2,5]){const x=M*T;x>=o&&x<=e&&l.push(x)}}return l.length>0?l:[o,e]},r}function Rt(t,n,o){const e=t.data.scale==="log";if(o!=null&&o.xDomain){const T=o.xDomain;return e?Tt([Math.max(T[0],.01),Math.max(T[1],.02)],[0,n]):xt(T,[0,n])}const i=t.data.rows,a=t.theme.axis,s=t.data.nullValue,p=(a==null?void 0:a.padding)??.1,f=(a==null?void 0:a.includeNull)??!0,r=a==null?void 0:a.symmetric,d=(a==null?void 0:a.markerMargin)??!0,l=typeof(a==null?void 0:a.rangeMin)=="number",h=typeof(a==null?void 0:a.rangeMax)=="number";let g;if(l&&h)g=[a.rangeMin,a.rangeMax];else{const T=i.map(x=>x.point).filter(x=>x!=null&&!Number.isNaN(x)&&Number.isFinite(x));if(T.length===0)g=e?[.1,10]:[0,1];else{let x=Math.min(...T),I=Math.max(...T);f&&(x=Math.min(x,s),I=Math.max(I,s));const S=I-x||1;let b=l?a.rangeMin:x-S*p,D=h?a.rangeMax:I+S*p;const m=T.some(y=>y<s)&&T.some(y=>y>s);if((r===!0||r===null&&m)&&!l&&!h)if(e){const y=Math.log(s),$=Math.max(Math.abs(Math.log(Math.max(b,.001))-y),Math.abs(Math.log(D)-y));b=Math.exp(y-$),D=Math.exp(y+$)}else{const y=Math.max(Math.abs(b-s),Math.abs(D-s));b=s-y,D=s+y}g=[b,D]}}const c=Dt(g,e);let M=c;if(d&&n>0){const T=t.theme.shapes.pointSize,x=c[1]-c[0],I=T/2*(x/n);if(e){const S=I/c[0];M=[c[0]/(1+S),c[1]*(1+S)]}else M=[c[0]-I,c[1]+I]}return e?Tt([Math.max(M[0],.01),Math.max(M[1],.02)],[0,n]):xt(M,[0,n])}function Bt(t,n,o){var a,s;const e=[],i=o.spacing.padding;if((a=t.labels)!=null&&a.title){const p=z(o.typography.fontSizeLg);e.push(`<text x="${i}" y="${n.titleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${p}px"
      font-weight="${o.typography.fontWeightBold}"
      fill="${o.colors.foreground}">${C(t.labels.title)}</text>`)}if((s=t.labels)!=null&&s.subtitle){const p=z(o.typography.fontSizeBase);e.push(`<text x="${i}" y="${n.subtitleY}"
      font-family="${o.typography.fontFamily}"
      font-size="${p}px"
      fill="${o.colors.secondary}">${C(t.labels.subtitle)}</text>`)}return e.join(`
`)}function Xt(t,n,o){var s,p;const e=[],i=o.spacing.padding;let a=n.footerY;if((s=t.labels)!=null&&s.caption){const f=z(o.typography.fontSizeSm);e.push(`<text x="${i}" y="${a}"
      font-family="${o.typography.fontFamily}"
      font-size="${f}px"
      fill="${o.colors.secondary}">${C(t.labels.caption)}</text>`),a+=U.CAPTION_HEIGHT}if((p=t.labels)!=null&&p.footnote){const f=z(o.typography.fontSizeSm);e.push(`<text x="${i}" y="${a}"
      font-family="${o.typography.fontFamily}"
      font-size="${f}px"
      font-style="italic"
      fill="${o.colors.muted}">${C(t.labels.footnote)}</text>`)}return e.join(`
`)}function bt(t,n,o,e,i,a,s,p,f){const r=[],d=z(a.typography.fontSizeBase),l=a.typography.fontWeightMedium,h=a.typography.fontWeightBold,g=lt(t),c=p??v.DEFAULT_LABEL_WIDTH,M=I=>{if(f){const S=f.get(I.id);if(S!==void 0)return S}return typeof I.width=="number"?I.width:v.DEFAULT_COLUMN_WIDTH},T=I=>I.isGroup?I.columns.reduce((S,b)=>S+T(b),0):M(I),x=(I,S)=>I+S/2+d*U.TEXT_BASELINE_ADJUSTMENT;if(g){const I=i/2,S=i/2;let b=o;s&&(r.push(`<text x="${b+G.TEXT_PADDING}" y="${x(e,i)}"
        font-family="${a.typography.fontFamily}"
        font-size="${d}px"
        font-weight="${l}"
        fill="${a.colors.foreground}">${C(s)}</text>`),b+=c);const D=[];for(const m of t)if(m.isGroup){const u=T(m),y=b+u/2;r.push(`<text x="${y}" y="${x(e,I)}"
          font-family="${a.typography.fontFamily}"
          font-size="${d}px"
          font-weight="${h}"
          text-anchor="middle"
          fill="${a.colors.foreground}">${C(m.header)}</text>`),D.push({x1:b,x2:b+u}),b+=u}else{const u=M(m),y=m.headerAlign??m.align,{textX:$,anchor:N}=ot(b,u,y),H=ct(m.header,u,d,G.TEXT_PADDING);r.push(`<text x="${$}" y="${x(e,i)}"
          font-family="${a.typography.fontFamily}"
          font-size="${d}px"
          font-weight="${l}"
          text-anchor="${N}"
          fill="${a.colors.foreground}">${C(H)}</text>`),b+=u}for(const m of D)r.push(`<line x1="${m.x1}" x2="${m.x2}"
        y1="${e+I}" y2="${e+I}"
        stroke="${a.colors.border}" stroke-width="1" opacity="0.5"/>`);b=o+(s?c:0);for(const m of t)if(m.isGroup){for(const u of m.columns)if(!u.isGroup){const y=M(u),$=u.headerAlign??u.align,{textX:N,anchor:H}=ot(b,y,$);r.push(`<text x="${N}" y="${x(e+I,S)}"
              font-family="${a.typography.fontFamily}"
              font-size="${d}px"
              font-weight="${l}"
              text-anchor="${H}"
              fill="${a.colors.foreground}">${C(u.header)}</text>`),b+=y}}else{const u=M(m);b+=u}}else{let I=o;s&&(r.push(`<text x="${I+G.TEXT_PADDING}" y="${x(e,i)}"
        font-family="${a.typography.fontFamily}"
        font-size="${d}px"
        font-weight="${l}"
        fill="${a.colors.foreground}">${C(s)}</text>`),I+=c);for(const S of n){const b=M(S),D=S.headerAlign??S.align,{textX:m,anchor:u}=ot(I,b,D),y=ct(S.header,b,d,G.TEXT_PADDING);r.push(`<text x="${m}" y="${x(e,i)}"
        font-family="${a.typography.fontFamily}"
        font-size="${d}px"
        font-weight="${l}"
        text-anchor="${u}"
        fill="${a.colors.foreground}">${C(y)}</text>`),I+=b}}return r.join(`
`)}function Ut(t,n,o,e,i,a,s){const p=[],f=n+1,r=s.groupHeaders;let d,l,h,g,c;if(f===1?(d=z((r==null?void 0:r.level1FontSize)??s.typography.fontSizeBase),l=(r==null?void 0:r.level1FontWeight)??s.typography.fontWeightBold,h=(r==null?void 0:r.level1Italic)??!1,g=(r==null?void 0:r.level1Background)??null,c=(r==null?void 0:r.level1BorderBottom)??!1):f===2?(d=z((r==null?void 0:r.level2FontSize)??s.typography.fontSizeBase),l=(r==null?void 0:r.level2FontWeight)??s.typography.fontWeightMedium,h=(r==null?void 0:r.level2Italic)??!0,g=(r==null?void 0:r.level2Background)??null,c=(r==null?void 0:r.level2BorderBottom)??!1):(d=z((r==null?void 0:r.level3FontSize)??s.typography.fontSizeBase),l=(r==null?void 0:r.level3FontWeight)??s.typography.fontWeightNormal,h=(r==null?void 0:r.level3Italic)??!1,g=(r==null?void 0:r.level3Background)??null,c=(r==null?void 0:r.level3BorderBottom)??!1),!g){const I=s.colors.primary,S=f===1?.15:f===2?.1:.06,b=I.replace("#",""),D=parseInt(b.substring(0,2),16),m=parseInt(b.substring(2,4),16),u=parseInt(b.substring(4,6),16);g=`rgba(${D}, ${m}, ${u}, ${S})`}const M=e+i/2+d*U.TEXT_BASELINE_ADJUSTMENT,T=n*((r==null?void 0:r.indentPerLevel)??G.INDENT_PER_LEVEL);p.push(`<rect x="${o}" y="${e}"
    width="${a}" height="${i}"
    fill="${g}"/>`),c&&p.push(`<line x1="${o}" x2="${o+a}" y1="${e+i}" y2="${e+i}"
      stroke="${s.colors.border}" stroke-width="1" opacity="0.5"/>`);const x=h?' font-style="italic"':"";return p.push(`<text x="${o+G.TEXT_PADDING+T}" y="${M}"
    font-family="${s.typography.fontFamily}"
    font-size="${d}px"
    font-weight="${l}"${x}
    fill="${s.colors.foreground}">${C(t)}</text>`),p.join(`
`)}function Et(t,n){const o=new Map;for(const e of n)if(e.type==="bar"){let i=0;for(const a of t){const s=a.metadata[e.field];typeof s=="number"&&s>i&&(i=s)}o.set(e.field,i>0?i:1)}return o}function Mt(t,n,o,e,i,a,s,p=v.DEFAULT_LABEL_WIDTH,f=0,r,d){var T,x,I,S,b,D,m,u,y,$,N,H,_,w,W,A;const l=[],h=z(a.typography.fontSizeBase),g=e+i/2+h*U.TEXT_BASELINE_ADJUSTMENT;let c=o;const M=E=>{if(d){const L=d.get(E.id);if(L!==void 0)return L}return typeof E.width=="number"?E.width:v.DEFAULT_COLUMN_WIDTH};if(s){const E=f*G.INDENT_PER_LEVEL+(((T=t.style)==null?void 0:T.indent)??0)*G.INDENT_PER_LEVEL,L=(x=t.style)!=null&&x.bold||(I=t.style)!=null&&I.emphasis?a.typography.fontWeightBold:a.typography.fontWeightNormal,V=(S=t.style)!=null&&S.italic?"italic":"normal";let k=a.colors.foreground;(b=t.style)!=null&&b.color?k=t.style.color:(D=t.style)!=null&&D.muted?k=a.colors.muted:(m=t.style)!=null&&m.accent&&(k=a.colors.accent);const X=p-E-G.TEXT_PADDING*2,F=ct(t.label,X,h,0);if(l.push(`<text x="${c+G.TEXT_PADDING+E}" y="${g}"
      font-family="${a.typography.fontFamily}"
      font-size="${h}px"
      font-weight="${L}"
      font-style="${V}"
      fill="${k}">${C(F)}</text>`),(u=t.style)!=null&&u.badge){const R=String(t.style.badge),P=h*.8,j=4,J=6,B=P+j*2,Y=O(t.label,h),rt=c+G.TEXT_PADDING+E+Y+J,At=O(R,P)+j*2,St=e+(i-B)/2;l.push(`<rect x="${rt}" y="${St}" width="${At}" height="${B}"
        rx="3" fill="${a.colors.primary}" opacity="0.15"/>`),l.push(`<text x="${rt+At/2}" y="${St+B/2+P*.35}"
        text-anchor="middle"
        font-family="${a.typography.fontFamily}"
        font-size="${P}px"
        font-weight="500"
        fill="${a.colors.primary}">${C(R)}</text>`)}c+=p}for(const E of n){const L=M(E),V=Ot(t,E),{textX:k,anchor:X}=ot(c,L,E.align);if(E.type==="bar"&&typeof t.metadata[E.field]=="number"){const F=t.metadata[E.field],R=r==null?void 0:r.get(E.field),P=(($=(y=E.options)==null?void 0:y.bar)==null?void 0:$.maxValue)??R??100,j=((H=(N=E.options)==null?void 0:N.bar)==null?void 0:H.color)??a.colors.primary,J=a.shapes.pointSize*2,Y=L-G.TEXT_PADDING*2-50,rt=Math.min(F/P*Y,Y);l.push(`<rect x="${c+G.TEXT_PADDING}" y="${e+i/2-J/2}"
        width="${Math.max(0,rt)}" height="${J}"
        fill="${j}" opacity="0.7" rx="2"/>`);const _t=c+L-G.TEXT_PADDING;l.push(`<text x="${_t}" y="${g}"
        font-family="${a.typography.fontFamily}"
        font-size="${h}px"
        text-anchor="end"
        fill="${a.colors.foreground}">${tt(F)}</text>`)}else if(E.type==="sparkline"&&Array.isArray(t.metadata[E.field])){let F=t.metadata[E.field];Array.isArray(F[0])&&(F=F[0]);const R=((w=(_=E.options)==null?void 0:_.sparkline)==null?void 0:w.height)??16,P=((A=(W=E.options)==null?void 0:W.sparkline)==null?void 0:A.color)??a.colors.primary,j=G.TEXT_PADDING*2,J=zt(F,c+G.TEXT_PADDING,e+i/2-R/2,L-j,R);l.push(`<path d="${J}" fill="none" stroke="${P}" stroke-width="1.5"/>`)}else l.push(`<text x="${k}" y="${g}"
        font-family="${a.typography.fontFamily}"
        font-size="${h}px"
        text-anchor="${X}"
        fill="${a.colors.foreground}">${C(V)}</text>`);c+=L}return l.join(`
`)}function Ot(t,n){var e,i,a,s,p,f,r,d,l,h,g,c,M,T,x,I,S,b,D;if(n.type==="interval"){const m=(i=(e=n.options)==null?void 0:e.interval)!=null&&i.point?t.metadata[n.options.interval.point]:t.point,u=(s=(a=n.options)==null?void 0:a.interval)!=null&&s.lower?t.metadata[n.options.interval.lower]:t.lower,y=(f=(p=n.options)==null?void 0:p.interval)!=null&&f.upper?t.metadata[n.options.interval.upper]:t.upper;return pt(m,u,y,n.options)}if(n.type==="numeric"){const m=t.metadata[n.field];return typeof m=="number"?tt(m,n.options):((r=n.options)==null?void 0:r.naText)??""}if(n.type==="custom"&&((d=n.options)!=null&&d.events))return ht(t,n.options);if(n.type==="pvalue"){const m=t.metadata[n.field];return typeof m!="number"?((l=n.options)==null?void 0:l.naText)??"":gt(m,n.options)}if(n.type==="icon"){const m=t.metadata[n.field];if(m==null)return"";const u=String(m),y=(g=(h=n.options)==null?void 0:h.icon)==null?void 0:g.mapping;return y&&u in y?y[u]:u}if(n.type==="badge"){const m=t.metadata[n.field];return m!=null?String(m):""}if(n.type==="stars"){const m=t.metadata[n.field];if(typeof m!="number")return"";const u=((M=(c=n.options)==null?void 0:c.stars)==null?void 0:M.maxStars)??5,y=Math.max(0,Math.min(u,m)),$=Math.floor(y),N=u-$;return"★".repeat($)+"☆".repeat(N)}if(n.type==="img")return((x=(T=n.options)==null?void 0:T.img)==null?void 0:x.fallback)??"[IMG]";if(n.type==="reference"){const m=t.metadata[n.field];if(m==null)return"";const u=String(m),y=((S=(I=n.options)==null?void 0:I.reference)==null?void 0:S.maxChars)??30;return u.length<=y?u:u.substring(0,y)+"..."}if(n.type==="range"){const m=(b=n.options)==null?void 0:b.range;if(!m)return"";const u=t.metadata[m.minField],y=t.metadata[m.maxField],$=m.separator??" – ",N=m.decimals,H=_=>typeof _!="number"?"":N==null?Number.isInteger(_)?String(_):_.toFixed(1):_.toFixed(N);return u===null&&y===null?"":u===null?H(y):y===null?H(u):`${H(u)}${$}${H(y)}`}const o=t.metadata[n.field];return o!=null?String(o):((D=n.options)==null?void 0:D.naText)??""}function zt(t,n,o,e,i){const a=t.filter(d=>Number.isFinite(d));if(a.length===0)return"";if(a.length===1){const d=n+e/2,l=o+i/2;return`M${d.toFixed(1)},${l.toFixed(1)}`}const s=Math.min(...a),f=Math.max(...a)-s||1;return`M${a.map((d,l)=>{const h=n+l/(a.length-1)*e,g=o+i-(d-s)/f*i;return`${h.toFixed(1)},${g.toFixed(1)}`}).join("L")}`}const It=6;function dt(t,n,o){const e=t.metadata[n];return e!=null&&typeof e=="number"&&!Number.isNaN(e)?e:o}function Vt(t,n){return n<=1?0:-((n-1)*It)/2+t*It}function jt(t,n,o,e,i,a=[],s,p=0,f=1/0){var m;let r;a.length===0?r=[{point:t.point,lower:t.lower,upper:t.upper,color:null,shape:null,opacity:null}]:r=a.map(u=>({point:dt(t,u.pointCol,t.point),lower:dt(t,u.lowerCol,t.lower),upper:dt(t,u.upperCol,t.upper),color:u.color??null,shape:u.shape??null,opacity:u.opacity??null}));const d=r.filter(u=>u.point!=null&&!Number.isNaN(u.point)&&u.lower!=null&&!Number.isNaN(u.lower)&&u.upper!=null&&!Number.isNaN(u.upper));if(d.length===0)return"";const l=e.shapes.pointSize,h=e.shapes.lineWidth,g=e.colors.intervalLine,c=G.WHISKER_HALF_HEIGHT,M=((m=t.style)==null?void 0:m.type)==="summary",x=e.shapes.summaryHeight/2;function I(u){var $;if(u&&(($=t.markerStyle)==null?void 0:$.size)!=null)return l*t.markerStyle.size;const y=s?t.metadata[s]:void 0;if(y){const N=.5+Math.sqrt(y/100)*1.5;return Math.min(Math.max(l*N,3),l*2.5)}return l}function S(u,y){const $=y===0,N=t.markerStyle,H=e.shapes.markerColors,_=e.shapes.markerShapes,w=["square","circle","diamond","triangle"];let W;$&&(N!=null&&N.color)?W=N.color:u.color?W=u.color:H&&H.length>0?W=H[y%H.length]:W=e.colors.interval??e.colors.primary??"#2563eb";let A;$&&(N!=null&&N.shape)?A=N.shape:u.shape?A=u.shape:_&&_.length>0?A=_[y%_.length]:A=w[y%w.length];let E;return $&&(N==null?void 0:N.opacity)!=null?E=N.opacity:u.opacity!=null?E=u.opacity:E=1,{color:W,shape:A,opacity:E}}function b(u,y,$,N){const{color:H,shape:_,opacity:w}=N,W=w<1?` fill-opacity="${w}"`:"";switch(_){case"circle":return`<circle cx="${u}" cy="${y}" r="${$}" fill="${H}"${W}/>`;case"diamond":return`<polygon points="${[`${u},${y-$}`,`${u+$},${y}`,`${u},${y+$}`,`${u-$},${y}`].join(" ")}" fill="${H}"${W}/>`;case"triangle":return`<polygon points="${[`${u},${y-$}`,`${u+$},${y+$}`,`${u-$},${y+$}`].join(" ")}" fill="${H}"${W}/>`;default:return`<rect x="${u-$}" y="${y-$}" width="${$*2}" height="${$*2}" fill="${H}"${W}/>`}}const D=[];return d.forEach((u,y)=>{const $=n+Vt(y,d.length),N=o(u.lower),H=o(u.upper),_=o(u.point),w=S(u,y),W=I(y===0),A=g;if(M){const E=w.opacity<1?` fill-opacity="${w.opacity}"`:"",L=[`${N},${$}`,`${_},${$-x}`,`${H},${$}`,`${_},${$+x}`].join(" ");D.push(`
        <g class="interval effect-${y} summary">
          <polygon points="${L}"
            fill="${w.color}"${E} stroke="${e.colors.summaryBorder}" stroke-width="1"/>
        </g>`)}else{const E=p,L=p+f,V=N<E,k=H>L,X=Math.max(E,Math.min(L,N)),F=Math.max(E,Math.min(L,H));let R="";V?R=`<path d="M ${E+4} ${$} L ${E+10} ${$-4} L ${E+10} ${$+4} Z" fill="${A}"/>`:R=`<line x1="${X}" x2="${X}" y1="${$-c}" y2="${$+c}" stroke="${A}" stroke-width="${h}"/>`;let P="";k?P=`<path d="M ${L-4} ${$} L ${L-10} ${$-4} L ${L-10} ${$+4} Z" fill="${A}"/>`:P=`<line x1="${F}" x2="${F}" y1="${$-c}" y2="${$+c}" stroke="${A}" stroke-width="${h}"/>`,D.push(`
        <g class="interval effect-${y}">
          <line x1="${X}" x2="${F}" y1="${$}" y2="${$}"
            stroke="${A}" stroke-width="${h}"/>
          ${R}
          ${P}
          ${b(_,$,W,w)}
        </g>`)}}),D.join("")}function Yt(t,n,o,e,i,a,s,p){const r=p.shapes.summaryHeight/2,d=i(n),l=i(t),h=i(o),g=a+Math.max(0,Math.min(s,d)),c=a+Math.max(0,Math.min(s,l)),M=a+Math.max(0,Math.min(s,h));return`<polygon points="${[`${g},${e}`,`${c},${e-r}`,`${M},${e}`,`${c},${e+r}`].join(" ")}"
    fill="${p.colors.summaryFill}"
    stroke="${p.colors.summaryBorder}"
    stroke-width="1"/>`}function Jt(t,n,o,e,i,a=1){const s=[],p=typeof o.axis.tickCount=="number"?o.axis.tickCount:G.DEFAULT_TICK_COUNT,f=Kt(t,p,o,a,n.forestWidth),r=z(o.typography.fontSizeSm),d=35,l=g=>g<d?"start":g>n.forestWidth-d?"end":"middle",h=g=>g<d?2:g>n.forestWidth-d?-2:0;s.push(`<line x1="${i}" x2="${i+n.forestWidth}"
    y1="0" y2="0" stroke="${o.colors.border}" stroke-width="1"/>`);for(const g of f){const c=t(g),M=i+c,T=l(c),x=h(c);s.push(`<line x1="${M}" x2="${M}" y1="0" y2="4"
      stroke="${o.colors.border}" stroke-width="1"/>`),s.push(`<text x="${M+x}" y="16" text-anchor="${T}"
      font-family="${o.typography.fontFamily}"
      font-size="${r}px"
      fill="${o.colors.secondary}">${Ct(g)}</text>`)}return e&&s.push(`<text x="${i+n.forestWidth/2}" y="28"
      text-anchor="middle"
      font-family="${o.typography.fontFamily}"
      font-size="${r}px"
      font-weight="500"
      fill="${o.colors.secondary}">${C(e)}</text>`),`<g transform="translate(0, ${n.mainY+n.headerHeight+n.plotHeight})">${s.join(`
`)}</g>`}function Kt(t,n,o,e,i){if(Array.isArray(o.axis.tickValues)&&o.axis.tickValues.length>0){const[m,u]=t.domain();let y=o.axis.tickValues.filter(H=>H>=m&&H<=u);const $=o.axis.nullTick!==!1,N=e>=m&&e<=u;return $&&N&&!y.includes(e)&&(y=[...y,e].sort((H,_)=>H-_)),y}const[a,s]=t.domain(),p=o.axis.nullTick!==!1,f=e>=a&&e<=s,r=50,d=Math.max(2,Math.floor(i/r)),l=Math.min(n,Math.min(7,d)),h=t.ticks(l);if(h.length===0)return p&&f?[e]:[];const g=t(e),c=h.filter(m=>m<e).reverse(),M=h.filter(m=>m>e),T=h.some(m=>m===e),x=[];let I=g;for(const m of c){const u=t(m);I-u>=r&&(x.unshift(m),I=u)}const S=[];let b=g;for(const m of M){const u=t(m);u-b>=r&&(S.push(m),b=u)}const D=[...x];if((T||p&&f)&&D.push(e),D.push(...S),D.length<2){const m=new Set(D);m.has(a)||D.unshift(a),D.length<2&&!m.has(s)&&D.push(s)}return D}function Nt(t,n,o,e,i,a,s=1,p=.6){let r=`<line x1="${t}" x2="${t}" y1="${n}" y2="${o}"
    stroke="${i}" stroke-width="${s}" stroke-opacity="${p}" stroke-dasharray="${e==="dashed"?"6,4":e==="dotted"?"2,2":"none"}"/>`;return a&&(r+=`<text x="${t}" y="${n-4}" text-anchor="middle"
      font-size="10px" fill="${i}">${C(a)}</text>`),r}class Z extends Error{constructor(n){super(`SVG Generator: ${n}`),this.name="SVGGeneratorError"}}function Zt(t){if(!t||typeof t!="object")throw new Z("Invalid spec: expected an object");const n=t;if(!n.data||typeof n.data!="object")throw new Z("Invalid spec: missing or invalid 'data' property");const o=n.data;if(!Array.isArray(o.rows))throw new Z("Invalid spec: 'data.rows' must be an array");if(!n.theme||typeof n.theme!="object")throw new Z("Invalid spec: missing or invalid 'theme' property");const e=n.theme;if(!e.colors||typeof e.colors!="object")throw new Z("Invalid spec: missing or invalid 'theme.colors'");if(!e.typography||typeof e.typography!="object")throw new Z("Invalid spec: missing or invalid 'theme.typography'");if(!e.spacing||typeof e.spacing!="object")throw new Z("Invalid spec: missing or invalid 'theme.spacing'")}function qt(t,n={}){var H;Zt(t);const o=t.theme,e=Pt(t,n),i=o.spacing.padding,a=Array.isArray(t.columns)?t.columns:[],s=nt(a,"left"),p=nt(a,"right"),f=et(a,"left"),r=et(a,"right"),d=e.labelWidth+f.reduce((_,w)=>_+st(w,e.autoWidths),0),l=i+d+v.COLUMN_GAP,h=Rt(t,e.forestWidth,n),g=l+e.forestWidth+v.COLUMN_GAP,c=[];c.push(`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
  width="${e.totalWidth}" height="${e.totalHeight}"
  viewBox="0 0 ${e.totalWidth} ${e.totalHeight}">`);const M=n.backgroundColor??o.colors.background;c.push(`<rect width="100%" height="100%" fill="${M}"/>`),c.push(Bt(t,e,o)),c.push(`<line x1="${i}" x2="${e.totalWidth-i}"
    y1="${e.mainY}" y2="${e.mainY}"
    stroke="${o.colors.border}" stroke-width="2"/>`);const T=e.mainY;c.push(bt(s,f,i,T,e.headerHeight,o,t.data.labelHeader??"Study",e.labelWidth,e.autoWidths)),r.length>0&&c.push(bt(p,r,g,T,e.headerHeight,o,void 0,void 0,e.autoWidths)),c.push(`<line x1="${i}" x2="${e.totalWidth-i}"
    y1="${T+e.headerHeight}" y2="${T+e.headerHeight}"
    stroke="${o.colors.border}" stroke-width="2"/>`);const x=yt(t),S=(Array.isArray(t.data.groups)?t.data.groups:[]).length>0,b=[],D=[];let m=0;for(const _ of x){const W=_.type==="data"&&((H=_.row.style)==null?void 0:H.type)==="spacer"?e.rowHeight/2:e.rowHeight;b.push(m),D.push(W),m+=W}if(t.data.includeForest&&e.forestWidth>0){const _=e.mainY+e.headerHeight,w=l+h(t.data.nullValue);c.push(Nt(w,_,_+e.plotHeight,"dashed",o.colors.muted));const W=Array.isArray(t.annotations)?t.annotations:[];for(const A of W)if(A.type==="reference_line"){const E=l+h(A.x);c.push(Nt(E,_,_+e.plotHeight,A.style,A.color??o.colors.accent,A.label,A.width??1,A.opacity??.6))}if(x.forEach((A,E)=>{if(A.type==="data"){const L=_+b[E]+D[E]/2;c.push(jt(A.row,L,V=>l+h(V),o,t.data.nullValue,t.data.effects,t.data.weightCol,l,e.forestWidth))}}),t.data.overall&&e.showOverallSummary&&typeof t.data.overall.point=="number"&&!Number.isNaN(t.data.overall.point)&&typeof t.data.overall.lower=="number"&&!Number.isNaN(t.data.overall.lower)&&typeof t.data.overall.upper=="number"&&!Number.isNaN(t.data.overall.upper)){const A=_+e.summaryYPosition;c.push(Yt(t.data.overall.point,t.data.overall.lower,t.data.overall.upper,A,h,l,e.forestWidth,o))}c.push(Jt(h,e,o,t.data.axisLabel,l,t.data.nullValue))}const u=e.mainY+e.headerHeight,y=t.data.rows,$=Et(y,f),N=Et(y,r);return x.forEach((_,w)=>{var E,L,V;const W=u+b[w],A=D[w];if(_.type==="group_header")c.push(Ut(_.label,_.depth,i,W,A,e.totalWidth-i*2,o));else{const k=_.row,X=_.depth;if(!(((E=k.style)==null?void 0:E.type)==="spacer")){const R=Wt(X),P=!S&&w%2===1?Ht:0,j=Math.max(R,P);j>0&&c.push(`<rect x="${i}" y="${W}"
            width="${e.totalWidth-i*2}" height="${A}"
            fill="${o.colors.muted}" opacity="${j}"/>`)}c.push(Mt(k,f,i,W,A,o,!0,e.labelWidth,X,$,e.autoWidths)),r.length>0&&c.push(Mt(k,r,g,W,A,o,!1,0,X,N,e.autoWidths))}if(_.type==="data"){const k=_.row,X=((L=k.style)==null?void 0:L.type)==="summary",F=((V=k.style)==null?void 0:V.type)==="spacer";X&&c.push(`<line x1="${i}" x2="${e.totalWidth-i}"
          y1="${W}" y2="${W}"
          stroke="${o.colors.border}" stroke-width="2"/>`),F||c.push(`<line x1="${i}" x2="${e.totalWidth-i}"
          y1="${W+A}" y2="${W+A}"
          stroke="${o.colors.border}" stroke-width="1"/>`)}else c.push(`<line x1="${i}" x2="${e.totalWidth-i}"
        y1="${W+A}" y2="${W+A}"
        stroke="${o.colors.border}" stroke-width="1"/>`)}),c.push(Xt(t,e,o)),c.push("</svg>"),c.join(`
`)}function Qt(t,n){const o=JSON.parse(t);return qt(o,n)}globalThis.generateSVG=Qt})();
