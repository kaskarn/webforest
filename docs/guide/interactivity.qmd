---
title: "Interactivity & Tooltips"
---

```{r}
#| include: false
library(webforest)
```

webforest plots are interactive by default. This guide covers tooltips, interaction controls, and layout modes.

## Hover Tooltips

Tooltips display additional data when hovering over interval markers. They're **opt-in** - you must specify which fields to show.

### Enabling Tooltips

Use `tooltip_fields` in `web_interaction()` to specify columns:

```{r}
tooltip_data <- data.frame(
  study = c("EMPA-REG 2015", "CANVAS 2017", "DECLARE 2019", "DAPA-HF 2019"),
  hr = c(0.62, 0.86, 0.93, 0.74),
  lower = c(0.49, 0.75, 0.84, 0.65),
  upper = c(0.77, 0.97, 1.03, 0.85),
  n = c(7020, 10142, 17160, 4744),
  events = c(490, 585, 882, 386),
  pvalue = c(0.0001, 0.02, 0.17, 0.0001)
)

forest_plot(tooltip_data,
  point = "hr", lower = "lower", upper = "upper",
  label = "study",
  columns = list(
    col_numeric("n", "N"),
    col_interval("HR (95% CI)")
  ),
  scale = "log", null_value = 1,
  interaction = web_interaction(
    tooltip_fields = c("n", "events", "pvalue")
  ),
  theme = web_theme_modern(),
  footnote = "Hover over markers to see tooltip"
)
```

### Tooltip Content

The tooltip automatically shows:

1. **Header**: Row label (study name)
2. **Estimate**: Point estimate with confidence interval
3. **Custom fields**: Each field from `tooltip_fields` as key-value pairs

### Tooltip Positioning

- Appears near cursor on hover
- Automatically flips to stay within viewport
- Inverted color scheme (dark background, light text)

## Interaction Controls

Control which interactions are enabled via `web_interaction()`:

```{r}
#| eval: false
web_interaction(
  tooltip_fields = NULL,    # Column names for tooltip (NULL = disabled)
  enableSort = TRUE,        # Click column headers to sort

  enableCollapse = TRUE,    # Click group headers to collapse/expand
  enableSelect = TRUE,      # Click rows to select
  enableHover = TRUE,       # Highlight rows on hover
  enableResize = TRUE,      # Drag column borders to resize
  enableExport = TRUE       # Show download button on hover
)
```

| Parameter | Default | Description |
|-----------|---------|-------------|
| `tooltip_fields` | `NULL` | Column names to show in hover tooltip |
| `enableSort` | `TRUE` | Click column headers to sort |
| `enableCollapse` | `TRUE` | Click group headers to collapse/expand |
| `enableSelect` | `TRUE` | Click rows to select them |
| `enableHover` | `TRUE` | Highlight rows on mouse hover |
| `enableResize` | `TRUE` | Drag column borders to resize |
| `enableExport` | `TRUE` | Show download button (top-right on hover) |

### Disabling Specific Features

```{r}
#| eval: false
# Read-only plot (no sorting or selection)
forest_plot(data, ...,
  interaction = web_interaction(
    enableSort = FALSE,
    enableSelect = FALSE
  )
)
```

## Interaction Presets

webforest provides preset configurations for common use cases:

### web_interaction() - Full Interactivity

Default. All interactions enabled (but no tooltip unless specified).

```{r}
#| eval: false
forest_plot(data, ...,
  interaction = web_interaction()
)
```

### web_interaction_minimal() - Hover Only

Only hover highlighting. No sorting, selection, or export.

```{r}
#| eval: false
forest_plot(data, ...,
  interaction = web_interaction_minimal()
)
```

### web_interaction_publication() - Static

Fully static output. No interactions at all. Best for print/publication.

```{r}
#| eval: false
forest_plot(data, ...,
  interaction = web_interaction_publication()
)
```

## Layout Modes

Control how the plot sizes itself in its container.

### Width Mode

| Mode | Description |
|------|-------------|
| `"natural"` | Shrink-wrap to content, centered (default) |
| `"fill"` | Scale to fill container width |

```{r}
#| eval: false
# Fill available width
forest_plot(data, ..., width_mode = "fill")
```

### Height Preset

| Preset | Description |
|--------|-------------|
| `"small"` | Max 300px, scrollable |
| `"medium"` | Max 500px, scrollable |
| `"large"` | Max 900px, scrollable |
| `"full"` | Natural height, no scroll (default) |
| `"container"` | Fill parent container height |

```{r}
#| eval: false
# Compact scrollable view
forest_plot(data, ..., height_preset = "small")

# Fill parent container
forest_plot(data, ..., height_preset = "container")
```

## Examples

### Rich Tooltips

Show detailed metadata on hover:

```{r}
rich_data <- data.frame(
  study = c("Trial A", "Trial B", "Trial C"),
  or = c(0.72, 0.95, 0.68),
  lower = c(0.55, 0.78, 0.52),
  upper = c(0.94, 1.15, 0.89),
  n_treatment = c(500, 320, 450),
  n_control = c(498, 318, 455),
  events_treatment = c(42, 58, 35),
  events_control = c(65, 62, 55),
  quality = c("High", "Moderate", "High")
)

forest_plot(rich_data,
  point = "or", lower = "lower", upper = "upper",
  label = "study",
  scale = "log", null_value = 1,
  interaction = web_interaction(
    tooltip_fields = c("n_treatment", "n_control",
                       "events_treatment", "events_control", "quality")
  ),
  theme = web_theme_modern()
)
```

### Publication-Ready (Static)

No interactivity for clean export:

```{r}
forest_plot(tooltip_data[1:3, ],
  point = "hr", lower = "lower", upper = "upper",
  label = "study",
  columns = list(col_interval("HR (95% CI)")),
  scale = "log", null_value = 1,
  interaction = web_interaction_publication(),
  theme = web_theme_jama()
)
```

### Compact Dashboard View

For embedding in dashboards with limited space:

```{r}
forest_plot(tooltip_data,
  point = "hr", lower = "lower", upper = "upper",
  label = "study",
  scale = "log", null_value = 1,
  height_preset = "small",
  width_mode = "fill",
  theme = web_theme_modern()
)
```
