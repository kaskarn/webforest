---
title: "Columns"
---

```{r}
#| include: false
library(webforest)
```

## Overview

Columns display data alongside the forest plot. Each column type has specialized formatting for different kinds of data.

```{r}
demo_data <- data.frame(
  study = c("Alpha", "Beta", "Gamma", "Delta"),
  or = c(1.2, 0.8, 1.5, 0.95),
  lower = c(0.9, 0.5, 1.1, 0.7),
  upper = c(1.6, 1.3, 2.0, 1.3),
  n = c(500, 320, 180, 420),
  weight = c(28, 22, 15, 35),
  pval = c(0.042, 0.23, 0.008, 0.61)
)

forest_plot(demo_data,
  point = "or", lower = "lower", upper = "upper",
  label = "study", null_value = 1,
  columns = list(
    col_numeric("n", header = "N", width = 60),
    col_bar("weight", header = "Weight %", width = 80),
    col_pvalue("pval", header = "P-value", width = 80),
    col_interval(header = "OR (95% CI)", width = 120, position = "right")
  ),
  theme = web_theme_modern()
)
```

## Column Types

| Type | Function | Use Case |
|------|----------|----------|
| `col_text()` | Text values | Study names, categories |
| `col_numeric()` | Formatted numbers | Sample sizes, counts |
| `col_interval()` | Point (CI) format | Effect size display |
| `col_bar()` | Horizontal bar | Weights, percentages |
| `col_pvalue()` | P-value formatting | Significance stars |
| `col_sparkline()` | Mini chart | Trends, distributions |
| `col_icon()` | Icons/emoji | Status indicators, yes/no |
| `col_badge()` | Colored badges | Status labels, categories |
| `col_stars()` | Star ratings | Quality scores (1-5) |
| `col_img()` | Inline images | Logos, flags, icons |
| `col_reference()` | Truncated links | Citations, DOIs, URLs |
| `col_range()` | Min-max ranges | Age ranges, value bounds |
| `col_group()` | Group header | Organize related columns |

## Column Positioning

Columns can appear on the left or right side of the forest plot:

```r
columns = list(
  col_numeric("n", "N", position = "left"),       # Left of forest
  col_interval("OR (95% CI)", position = "right") # Right of forest
)
```

The default position is `"right"` for most column types.

## Text Columns

Display text values from any column:

```r
col_text(field = "category", header = "Category", width = 100)
```

## Numeric Columns

Format numbers with automatic decimal places:

```r
col_numeric(field = "n", header = "N", width = 60)
col_numeric(field = "mean", header = "Mean", width = 80, decimals = 2)
```

## Interval Columns

Show the point estimate and confidence interval in formatted text:

```r
col_interval(header = "OR (95% CI)", width = 120)
```

This automatically formats as `"0.85 (0.70, 1.03)"` using the `point`, `lower`, and `upper` values from each row.

## Bar Columns

Display horizontal bars for weights or percentages:

```r
col_bar(field = "weight", header = "Weight %", width = 80)
col_bar(field = "weight", header = "Weight", width = 100, color = "#2563eb")
```

## P-value Columns

Format p-values with optional significance stars and smart exponential notation:

```r
col_pvalue(field = "pvalue", header = "P", width = 100)
```

Stars can be enabled: `*` for p < 0.05, `**` for p < 0.01, `***` for p < 0.001.

### Unicode Superscript Notation

Very small p-values are displayed using Unicode superscript for readability. For example, p = 0.00012 becomes `1.2Ã—10â»â´` instead of `1.2e-04`.

The threshold for exponential notation defaults to 0.001, but can be customized:

```r
# Use exponential notation for values below 0.01
col_pvalue("pval", exp_threshold = 0.01)

# Force decimal format for all values
col_pvalue("pval", format = "decimal")
```

### Precision Control

Control the number of significant figures:
```r
# Show 3 significant figures (default is 2)
col_pvalue("pval", digits = 3)
```

### Enable Stars

Add significance stars for quick visual identification:
```r
col_pvalue("pval", stars = TRUE)
```

### Custom Thresholds

Customize significance thresholds for stars:
```r
col_pvalue("pvalue",
  thresholds = c(0.10, 0.05, 0.01)  # *, **, *** at 0.10, 0.05, 0.01
)
```

## Sparkline Columns

Display mini charts for trends or distributions:

```r
col_sparkline(field = "trend_data", header = "Trend", width = 80)
col_sparkline(field = "dist", header = "Distribution",
  options = list(type = "bar", color = "#22c55e"))
```

Sparkline types: `"line"` (default), `"area"`, `"bar"`.

## Icon Columns

Display icons or emoji based on data values:

```r
# Direct emoji values
col_icon(field = "status_emoji", header = "Status", width = 50)

# With value-to-icon mapping
col_icon(field = "status",
  mapping = list(yes = "âœ“", no = "âœ—", pending = "â³"),
  color = "#16a34a"  # Optional color override
)
```

## Badge Columns

Display colored status badges:

```r
col_badge(field = "status", header = "Status", width = 100,
  variants = list(
    published = "success",
    draft = "warning",
    rejected = "error"
  )
)

# Or use custom hex colors
col_badge(field = "category",
  colors = list(
    "A" = "#2563eb",
    "B" = "#16a34a",
    "C" = "#f59e0b"
  )
)
```

Available variants: `"success"`, `"warning"`, `"error"`, `"info"`, `"muted"`, `"default"`.

## Star Rating Columns

Display star ratings (1-5 scale):

```r
col_stars(field = "quality", header = "Quality", width = 80)

# Customize appearance
col_stars(field = "rating",
  max_stars = 5,
  color = "#f59e0b",      # Filled star color (gold)
  empty_color = "#d1d5db", # Empty star color
  half_stars = TRUE        # Allow 0.5 increments
)
```

## Image Columns

Display inline images from URLs:

```r
col_img(field = "logo_url", header = "Logo", width = 60)

# With options
col_img(field = "avatar",
  height = 24,          # Image height in pixels
  shape = "circle",     # "square", "circle", or "rounded"
  fallback = "ðŸ“·"       # Shown if image fails to load
)
```

## Reference Columns

Display truncated text with optional links:

```r
col_reference(field = "doi", header = "DOI", width = 120)

# With clickable links
col_reference(field = "pmid",
  href_field = "pubmed_url",  # Column containing the URL
  max_chars = 25,             # Truncate after N chars
  icon = TRUE                 # Show external link icon
)
```

## Range Columns

Display min-max ranges from two fields:

```r
col_range(
  min_field = "age_min",
  max_field = "age_max",
  header = "Age Range",
  separator = " â€“ ",   # Separator between values
  decimals = 0         # NULL for auto-detection
)
```

## Column Groups

Group related columns under a shared header:

```{r}
set.seed(321)
outcomes_data <- data.frame(
  study = c("PARADIGM-HF", "DAPA-HF", "EMPEROR-Reduced"),
  primary_hr = c(0.80, 0.74, 0.75),
  primary_lower = c(0.73, 0.65, 0.65),
  primary_upper = c(0.87, 0.85, 0.86),
  primary_p = c(0.001, 0.001, 0.001),
  cvdeath_hr = c(0.80, 0.82, 0.92),
  cvdeath_p = c(0.001, 0.029, 0.382)
)

forest_plot(outcomes_data,
  point = "primary_hr", lower = "primary_lower", upper = "primary_upper",
  label = "study", null_value = 1, scale = "log",
  columns = list(
    col_group("Primary Endpoint",
      col_interval("HR (95% CI)"),
      col_pvalue("primary_p", "P"),
      position = "right"
    ),
    col_group("CV Death",
      col_numeric("cvdeath_hr", "HR"),
      col_pvalue("cvdeath_p", "P"),
      position = "right"
    )
  ),
  theme = web_theme_modern()
)
```

## Column Width

Set explicit widths in pixels:

```r
col_numeric("n", "N", width = 60)      # Narrow
col_text("notes", "Notes", width = 200) # Wide
```

If not specified, columns use sensible defaults based on their type.

## Styling Columns After Creation

Use `set_column_style()` to apply per-cell styling to a column after spec creation:

```{r}
#| eval: false
web_spec(data,
  point = "hr", lower = "lower", upper = "upper",
  label = "study",
  columns = list(col_numeric("hr", "HR"))
) |>
  set_column_style("hr", bold = "is_significant", color = "hr_color") |>
  forest_plot()
```

This is useful when styling depends on computed columns or when reusing a base spec. See [Customizing Plots](fluent-api.qmd) for more details.
