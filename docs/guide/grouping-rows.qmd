---
title: "Grouping & Row Styling"
---

```{r}
#| include: false
library(webforest)
```

## Grouping Studies

Use the `group` parameter to organize studies into collapsible groups:

```{r}
grouped_data <- data.frame(
  study = c("Study A1", "Study A2", "Study B1", "Study B2", "Study B3"),
  region = c("North", "North", "South", "South", "South"),
  or = c(0.8, 0.9, 1.1, 1.3, 0.95),
  lower = c(0.6, 0.7, 0.85, 1.0, 0.7),
  upper = c(1.1, 1.15, 1.4, 1.7, 1.3)
)

forest_plot(grouped_data,
  point = "or", lower = "lower", upper = "upper",
  label = "study", group = "region", null_value = 1
)
```

Click the group headers to collapse/expand sections.

## Nested Groups

For multi-level hierarchies, use multiple grouping columns:

```{r}
set.seed(789)
regional_data <- data.frame(
  study = c(
    "USA - Northeast", "USA - Southeast", "USA - Midwest",
    "Canada - Ontario", "Canada - Quebec",
    "UK - England", "UK - Scotland",
    "Germany - Bavaria", "Germany - Berlin"
  ),
  country = c(
    rep("USA", 3), rep("Canada", 2),
    rep("UK", 2), rep("Germany", 2)
  ),
  or = c(0.82, 0.91, 0.78, 0.85, 0.88, 0.92, 0.87, 0.79, 0.84),
  lower = c(0.68, 0.75, 0.62, 0.70, 0.72, 0.76, 0.71, 0.64, 0.68),
  upper = c(0.99, 1.10, 0.98, 1.03, 1.07, 1.11, 1.07, 0.98, 1.04)
)

forest_plot(regional_data,
  point = "or", lower = "lower", upper = "upper",
  label = "study", group = "country",
  null_value = 1, scale = "log",
  theme = web_theme_modern()
)
```

Nested rows are automatically indented and shaded by depth.

## Row Styling

Control row appearance using the `row_*` parameters. Each parameter takes a column name containing the style values:

| Parameter | Description | Column Values |
|-----------|-------------|---------------|
| `row_type` | Row type | `"data"`, `"header"`, `"summary"`, `"spacer"` |
| `row_bold` | Bold text | `TRUE` / `FALSE` |
| `row_italic` | Italic text | `TRUE` / `FALSE` |
| `row_indent` | Indentation level | `0`, `1`, `2`, ... |
| `row_color` | Custom text color | Hex color string |
| `row_badge` | Badge label | Text to show in badge |

### Example: Styled Meta-Analysis

```{r}
styled_data <- data.frame(
  study = c(
    "Cardiovascular Outcomes",
    "  EMPA-REG 2015", "  CANVAS 2017", "  DECLARE 2019", "  Subtotal", "",
    "Renal Outcomes",
    "  CREDENCE 2019", "  DAPA-CKD 2020", "  Subtotal", "",
    "Overall"
  ),
  hr = c(NA, 0.86, 0.86, 0.93, 0.88, NA, NA, 0.70, 0.61, 0.66, NA, 0.78),
  lower = c(NA, 0.74, 0.75, 0.84, 0.82, NA, NA, 0.59, 0.51, 0.57, NA, 0.73),
  upper = c(NA, 0.99, 0.97, 1.03, 0.95, NA, NA, 0.82, 0.72, 0.76, NA, 0.84),
  n = c(NA, 7020, 10142, 17160, 34322, NA, NA, 4401, 4304, 8705, NA, 43027),
  rtype = c(
    "header", "data", "data", "data", "summary", "spacer",
    "header", "data", "data", "summary", "spacer", "summary"
  ),
  rbold = c(TRUE, FALSE, FALSE, FALSE, TRUE, FALSE, TRUE, FALSE, FALSE, TRUE, FALSE, TRUE),
  rindent = c(0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0),
  rcolor = c("#0369a1", NA, NA, NA, "#0369a1", NA, "#0369a1", NA, NA, "#0369a1", NA, "#166534"),
  rbadge = c(NA, NA, NA, NA, "n=3", NA, NA, NA, NA, "n=2", NA, "n=5")
)

forest_plot(styled_data,
  point = "hr", lower = "lower", upper = "upper",
  label = "study",
  columns = list(
    col_numeric("n", "N", position = "right"),
    col_interval("HR (95% CI)", position = "right")
  ),
  row_type = "rtype",
  row_bold = "rbold",
  row_indent = "rindent",
  row_color = "rcolor",
  row_badge = "rbadge",
  theme = web_theme_modern(),
  scale = "log", null_value = 1,
  axis_label = "Hazard Ratio (95% CI)",
  title = "SGLT2 Inhibitors Meta-Analysis",
  subtitle = "Cardiovascular and renal outcomes"
)
```

## Row Types

### Header Rows

Section headers that span the full width. Header rows don't display forest plot elements (point estimates, intervals).

```r
row_type = "rtype"  # where data$rtype contains "header"
```

### Summary Rows

Display a diamond shape instead of a point estimate:

```r
row_type = "rtype"  # where data$rtype contains "summary"
```

### Spacer Rows

Empty rows for visual separation:

```r
row_type = "rtype"  # where data$rtype contains "spacer"
```

### Data Rows

Normal study rows (default when type is `"data"` or column is not specified).

## Badges

Add small labels to highlight specific rows:

```{r}
badge_data <- data.frame(
  study = c("Primary Analysis", "Sensitivity 1", "Sensitivity 2"),
  or = c(0.82, 0.85, 0.79),
  lower = c(0.70, 0.72, 0.66),
  upper = c(0.96, 1.00, 0.95),
  badge = c("Main", NA, "Robust"),
  is_bold = c(TRUE, FALSE, FALSE)
)

forest_plot(badge_data,
  point = "or", lower = "lower", upper = "upper",
  label = "study",
  row_badge = "badge",
  row_bold = "is_bold",
  null_value = 1,
  theme = web_theme_modern()
)
```

## Fluent Alternative

You can also apply row styling after spec creation using `set_row_style()`:

```{r}
#| eval: false
web_spec(badge_data,
  point = "or", lower = "lower", upper = "upper",
  label = "study", null_value = 1
) |>
  set_row_style(badge = "badge", bold = "is_bold") |>
  forest_plot(theme = web_theme_modern())
```

This is useful when building specs programmatically or reusing a base spec with different styling. See [Customizing Plots](fluent-api.qmd) for more details.
