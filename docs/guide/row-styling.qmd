---
title: "Row Styling"
---

```{r}
#| include: false
library(webforest)
```

Control the visual appearance of individual rows using `row_*` parameters. This gives you precise control over headers, summaries, indentation, colors, and badges—essential for creating publication-ready meta-analysis figures.

## Row Types

The `row_type` parameter controls fundamental row behavior. Each type renders differently:

| Type | Behavior | Marker |
|------|----------|--------|
| `"data"` | Standard data row | Point with CI line |
| `"header"` | Section header, spans full width | None |
| `"summary"` | Pooled/subtotal row | Diamond shape |
| `"spacer"` | Empty row for separation | None |

```{r}
type_demo <- data.frame(
  label = c("Outcomes", "  Mortality", "  Hospitalization", "  Summary"),
  hr = c(NA, 0.78, 0.85, 0.81),
  lower = c(NA, 0.65, 0.72, 0.70),
  upper = c(NA, 0.94, 1.00, 0.93),
  rtype = c("header", "data", "data", "summary")
)

forest_plot(type_demo,
  point = "hr", lower = "lower", upper = "upper", label = "label",
  row_type = "rtype",
  null_value = 1, scale = "log"
)
```

::: {.callout-important}
## NA Values for Non-Data Rows

Rows with `row_type = "header"` or `"spacer"` should have `NA` for `point`, `lower`, and `upper`. Summary rows need valid values to display the diamond.
:::

---

## Text Styling

Control text appearance with `row_bold`, `row_italic`, and `row_color`:

```{r}
text_demo <- data.frame(
  label = c("Primary Analysis", "Sensitivity 1", "Sensitivity 2", "Overall"),
  hr = c(0.78, 0.82, 0.75, 0.78),
  lower = c(0.65, 0.68, 0.61, 0.68),
  upper = c(0.94, 0.99, 0.92, 0.89),
  rbold = c(TRUE, FALSE, FALSE, TRUE),
  ritalic = c(FALSE, TRUE, TRUE, FALSE),
  rcolor = c("#0369a1", "#64748b", "#64748b", "#166534")
)

forest_plot(text_demo,
  point = "hr", lower = "lower", upper = "upper", label = "label",
  row_bold = "rbold",
  row_italic = "ritalic",
  row_color = "rcolor",
  null_value = 1, scale = "log"
)
```

---

## Indentation

Create visual hierarchy with `row_indent`. Values represent nesting levels (0, 1, 2, ...):

```{r}
indent_demo <- data.frame(
  label = c(
    "All Patients",
    "  Age < 65",
    "    Male", "    Female",
    "  Age >= 65",
    "    Male", "    Female"
  ),
  hr = c(0.78, 0.72, 0.70, 0.75, 0.85, 0.82, 0.88),
  lower = c(0.68, 0.58, 0.54, 0.60, 0.72, 0.66, 0.72),
  upper = c(0.89, 0.89, 0.91, 0.94, 1.00, 1.02, 1.08),
  rindent = c(0, 1, 2, 2, 1, 2, 2),
  rbold = c(TRUE, TRUE, FALSE, FALSE, TRUE, FALSE, FALSE)
)

forest_plot(indent_demo,
  point = "hr", lower = "lower", upper = "upper", label = "label",
  row_indent = "rindent",
  row_bold = "rbold",
  null_value = 1, scale = "log",
  theme = web_theme_modern()
)
```

---

## Badges

Add small labels to highlight specific rows with `row_badge`:

```{r}
badge_demo <- data.frame(
  label = c("ITT Analysis", "Per-Protocol", "As-Treated", "LOCF Imputation"),
  hr = c(0.78, 0.82, 0.75, 0.80),
  lower = c(0.65, 0.68, 0.61, 0.66),
  upper = c(0.94, 0.99, 0.92, 0.97),
  rbadge = c("Primary", NA, "Robust", NA),
  rbold = c(TRUE, FALSE, FALSE, FALSE)
)

forest_plot(badge_demo,
  point = "hr", lower = "lower", upper = "upper", label = "label",
  row_badge = "rbadge",
  row_bold = "rbold",
  null_value = 1, scale = "log",
  theme = web_theme_modern()
)
```

Badges are useful for marking primary analyses, flagging sensitivity analyses, or indicating data quality.

---

## Background Colors

Highlight rows with `row_bg` for background colors:

```{r}
#| eval: false
forest_plot(data,
  point = "hr", lower = "lower", upper = "upper", label = "label",
  row_bg = "background_color",  # Column with hex colors like "#f0f9ff"
  null_value = 1, scale = "log"
)
```

Use sparingly—subtle tints work best.

---

## Semantic Styling

For theme-aware styling that adapts automatically when you change themes, use semantic shortcuts:

| Parameter | Effect |
|-----------|--------|
| `row_emphasis` | Bold text + theme primary color (for key results) |
| `row_muted` | Lighter color, reduced prominence (for secondary data) |
| `row_accent` | Theme accent color (for highlighted findings) |

```{r}
#| eval: false
forest_plot(data,
  point = "hr", lower = "lower", upper = "upper", label = "label",
  row_emphasis = "is_primary",   # Column with TRUE/FALSE
  row_muted = "is_secondary",    # Column with TRUE/FALSE
  null_value = 1, scale = "log"
)
```

These adapt automatically to any theme, so you don't need to update color values when switching from `web_theme_jama()` to `web_theme_lancet()`.

---

## Complete Example: Meta-Analysis Figure

Here's a publication-ready meta-analysis combining all row styling features:

```{r}
meta_analysis <- data.frame(
  label = c(
    "Cardiovascular Outcomes",
    "  EMPA-REG 2015", "  CANVAS 2017", "  DECLARE 2019", "  Subtotal", "",
    "Renal Outcomes",
    "  CREDENCE 2019", "  DAPA-CKD 2020", "  Subtotal", "",
    "Overall"
  ),
  hr = c(NA, 0.86, 0.86, 0.93, 0.88, NA, NA, 0.70, 0.61, 0.66, NA, 0.78),
  lower = c(NA, 0.74, 0.75, 0.84, 0.82, NA, NA, 0.59, 0.51, 0.57, NA, 0.73),
  upper = c(NA, 0.99, 0.97, 1.03, 0.95, NA, NA, 0.82, 0.72, 0.76, NA, 0.84),
  n = c(NA, 7020, 10142, 17160, 34322, NA, NA, 4401, 4304, 8705, NA, 43027),
  rtype = c(
    "header", "data", "data", "data", "summary", "spacer",
    "header", "data", "data", "summary", "spacer", "summary"
  ),
  rbold = c(TRUE, FALSE, FALSE, FALSE, TRUE, FALSE, TRUE, FALSE, FALSE, TRUE, FALSE, TRUE),
  rindent = c(0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0),
  rcolor = c("#0369a1", NA, NA, NA, "#0369a1", NA, "#0369a1", NA, NA, "#0369a1", NA, "#166534"),
  rbadge = c(NA, NA, NA, NA, "n=3", NA, NA, NA, NA, "n=2", NA, "n=5")
)

forest_plot(meta_analysis,
  point = "hr", lower = "lower", upper = "upper", label = "label",
  columns = list(
    col_numeric("n", "N", position = "right"),
    col_interval("HR (95% CI)", position = "right")
  ),
  row_type = "rtype",
  row_bold = "rbold",
  row_indent = "rindent",
  row_color = "rcolor",
  row_badge = "rbadge",
  theme = web_theme_modern(),
  scale = "log", null_value = 1,
  axis_label = "Hazard Ratio (95% CI)",
  title = "SGLT2 Inhibitors Meta-Analysis",
  subtitle = "Cardiovascular and renal outcomes"
)
```

---

## Fluent API Alternative

You can also apply row styling using `set_row_style()` for pipe-based workflows:

```{r}
#| eval: false
forest_plot(data,
  point = "hr", lower = "lower", upper = "upper", label = "label",
  null_value = 1, scale = "log"
) |>
  set_row_style(
    type = "rtype",
    bold = "rbold",
    indent = "rindent",
    color = "rcolor",
    badge = "rbadge"
  )
```

This is useful when building styling programmatically or creating multiple variants from a base plot. See [Customizing Plots](fluent-api.qmd) for more patterns.

---

## Parameter Reference

| Parameter | Column Contains | Description |
|-----------|-----------------|-------------|
| `row_type` | `"data"`, `"header"`, `"summary"`, `"spacer"` | Row behavior and marker type |
| `row_bold` | `TRUE`/`FALSE` | Bold text |
| `row_italic` | `TRUE`/`FALSE` | Italic text |
| `row_color` | CSS color (e.g., `"#1a365d"`) | Text color |
| `row_bg` | CSS color | Background color |
| `row_indent` | Integer (0, 1, 2, ...) | Indentation level |
| `row_badge` | Text | Badge label |
| `row_icon` | Emoji/unicode | Icon before label |
| `row_emphasis` | `TRUE`/`FALSE` | Theme-aware emphasis styling |
| `row_muted` | `TRUE`/`FALSE` | Theme-aware muted styling |
| `row_accent` | `TRUE`/`FALSE` | Theme-aware accent styling |

---

## See Also

- [Grouping Studies](grouping.qmd) — Automatic collapsible sections from column values
- [Styling Functions](../reference/styling.qmd) — Complete `set_row_style()` reference
- [forest_plot()](../reference/forest_plot.qmd) — All arguments
