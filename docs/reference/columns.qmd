---
title: "Columns"
---

```{r}
#| include: false
library(webforest)
```

Column functions for defining table columns in forest plots.

## Basic Columns

### col_text {#col_text}

Text column for displaying character data.

```r
col_text(field, header = NULL, width = NULL, position = "left")
```

| Argument | Description |
|----------|-------------|
| `field` | Column name in data |
| `header` | Display header (defaults to field name) |
| `width` | Column width in pixels |
| `position` | `"left"` or `"right"` of forest plot |

### col_numeric {#col_numeric}

Numeric column with automatic formatting.

```r
col_numeric(field, header = NULL, width = NULL, position = "left")
```

| Argument | Description |
|----------|-------------|
| `field` | Column name in data |
| `header` | Display header |
| `width` | Column width in pixels |
| `position` | `"left"` or `"right"` |

### col_interval {#col_interval}

Confidence interval display showing point estimate with bounds.

```r
col_interval(header = "95% CI", width = 140, position = "right")
```

| Argument | Description |
|----------|-------------|
| `header` | Column header (default: "95% CI") |
| `width` | Column width in pixels (default: 140) |
| `position` | Position relative to plot (default: "right") |

**Note**: This column automatically uses the `point`, `lower`, and `upper` values specified in `forest_plot()`.

## Visualization Columns

### col_bar {#col_bar}

Horizontal bar chart for showing magnitude.

```r
col_bar(
  field,
  header = NULL,
  width = NULL,
  max_value = NULL,
  show_label = TRUE,
  color = NULL
)
```

| Argument | Description |
|----------|-------------|
| `field` | Column name containing numeric values |
| `header` | Column header |
| `width` | Column width in pixels |
| `max_value` | Maximum value for scaling (auto if NULL) |
| `show_label` | Show value label (default: TRUE) |
| `color` | Bar color |

### col_pvalue {#col_pvalue}

P-value column with optional significance stars and smart formatting. Very small values are displayed using Unicode superscript notation (e.g., 1.2×10⁻⁵) for improved readability.

```r
col_pvalue(
  field = "pvalue",
  header = "P-value",
  stars = TRUE,
  thresholds = c(0.05, 0.01, 0.001),
  format = c("auto", "scientific", "decimal"),
  digits = 2,
  exp_threshold = 0.001,
  width = 100
)
```

| Argument | Description |
|----------|-------------|
| `field` | Column name containing p-values |
| `header` | Column header (default: "P-value") |
| `stars` | Show significance stars (default: FALSE) |
| `thresholds` | Numeric vector of 3 significance thresholds (default: `c(0.05, 0.01, 0.001)`) |
| `format` | Display format: `"auto"`, `"scientific"`, or `"decimal"` |
| `digits` | Number of significant figures (default: 2) |
| `exp_threshold` | Values below this use exponential notation (default: 0.001) |
| `width` | Column width in pixels (default: 100) |

**Formatting behavior**:

- Values ≥ `exp_threshold`: displayed as decimal (e.g., 0.042)
- Values < `exp_threshold`: displayed with Unicode superscript (e.g., 2.3×10⁻⁴)
- Values < 0.0001: displayed as "<0.0001"

**Significance levels** (when `stars = TRUE`):

- `*` p < 0.05
- `**` p < 0.01
- `***` p < 0.001

**Examples**:

```r
# Default: 2 significant figures, exponential below 0.001
col_pvalue("pval")

# More precision
col_pvalue("pval", digits = 3)

# Use exponential notation earlier (below 0.01)
col_pvalue("pval", exp_threshold = 0.01)

# With significance stars
col_pvalue("pval", stars = TRUE)
```

### col_sparkline {#col_sparkline}

Inline sparkline chart for trend visualization.

```r
col_sparkline(field, header = NULL, width = 80, type = "line")
```

| Argument | Description |
|----------|-------------|
| `field` | Column name containing numeric vector |
| `header` | Column header |
| `width` | Column width (default: 80) |
| `type` | `"line"`, `"bar"`, or `"area"` |

**Note**: The field should contain list-columns with numeric vectors.

### col_n {#col_n}

Sample size column (alias for `col_numeric` with sensible defaults).

```r
col_n(field = "n", header = "N", width = 60)
```

### col_weight {#col_weight}

Weight column with bar visualization for meta-analysis.

```r
col_weight(field = "weight", header = "Weight", width = 100)
```

## Column Groups

### col_group {#col_group}

Group multiple columns under a shared header.

```r
col_group(header, ...)
```

| Argument | Description |
|----------|-------------|
| `header` | Group header text |
| `...` | Column specifications to group |

## Examples

### Mixed Column Types

```{r}
data <- data.frame(
  study = c("Trial A", "Trial B", "Trial C"),
  hr = c(0.72, 0.85, 0.68),
  lower = c(0.55, 0.70, 0.52),
  upper = c(0.95, 1.03, 0.89),
  n = c(245, 180, 320),
  weight = c(35, 28, 37),
  pval = c(0.018, 0.092, 0.003)
)

forest_plot(data,
  point = "hr", lower = "lower", upper = "upper",
  label = "study",
  columns = list(
    col_n("n"),
    col_weight("weight"),
    col_interval("HR (95% CI)"),
    col_pvalue("pval")
  ),
  null_value = 1, scale = "log"
)
```

### Column Groups

```{r}
#| eval: false
columns = list(
  col_n("n"),
  col_group("Treatment Effect",
    col_numeric("hr", "HR"),
    col_interval("95% CI")
  ),
  col_pvalue("pval")
)
```

## Fluent Column Styling

### set_column_style {#set_column_style}

Apply per-cell styling to a column after spec creation. See [Customizing Plots](../guide/fluent-api.qmd) guide.

```r
spec |> set_column_style(column, bold = NULL, italic = NULL, color = NULL, bg = NULL, badge = NULL, icon = NULL)
```

| Argument | Description |
|----------|-------------|
| `column` | Field name of the column to style |
| `bold` | Column name for bold text (logical) |
| `italic` | Column name for italic text (logical) |
| `color` | Column name for text color (hex string) |
| `bg` | Column name for background color (hex string) |
| `badge` | Column name for badge text |
| `icon` | Column name for icon (emoji/unicode) |

Example:

```{r}
#| eval: false
web_spec(data, point = "hr", lower = "lower", upper = "upper", label = "study",
  columns = list(col_numeric("hr", "HR"))
) |>
  set_column_style("hr", bold = "is_significant", color = "hr_color") |>
  forest_plot()
```

## See Also

- [forest_plot()](forest_plot.qmd) for using columns
- [Columns Guide](../guide/columns.qmd) for detailed examples
- [Customizing Plots](../guide/fluent-api.qmd) for pipe-based styling
