---
title: "forest_plot"
---

```{r}
#| include: false
library(webforest)
```

Create interactive forest plots from data frames or WebSpec objects.

::: {.callout-tip}
## Two Ways to Create Plots

**Quick path**: Pass a data frame directly with all arguments:
```r
forest_plot(data, point = "hr", lower = "lower", upper = "upper", label = "study", ...)
```

**Flexible path**: Create a WebSpec first, then render:
```r
spec <- web_spec(data, point = "hr", ...) |> set_row_style(bold = "is_summary")
forest_plot(spec, axis_range = c(0.5, 2))
```

Use the two-step approach when you need to reuse specs, apply conditional styling, or create variants.
:::

## Usage

```r
forest_plot(
  x,
  ...,
  split_by = NULL,
  shared_axis = FALSE,
  axis_range = NULL,
  axis_ticks = NULL,
  axis_gridlines = NULL,
  plot_position = NULL,
  row_height = NULL,
  width_mode = c("natural", "fill"),
  height_preset = c("full", "small", "medium", "large", "container"),
  width = NULL,
  height = NULL,
  elementId = NULL
)
```

## Arguments

### Core Data Arguments (passed to `web_spec()` via `...`)

| Argument | Description |
|----------|-------------|
| `x` | A data frame or WebSpec object |
| `point` | Column name for point estimates |
| `lower` | Column name for lower confidence bounds |
| `upper` | Column name for upper confidence bounds |
| `label` | Column name for row labels |
| `group` | Column name(s) for hierarchical grouping |
| `columns` | List of column specifications |
| `scale` | `"linear"` or `"log"` |
| `null_value` | Reference value (e.g., 1 for ratios, 0 for differences) |
| `axis_label` | X-axis label |
| `theme` | Theme object (default: `web_theme_default()`) |
| `title` | Plot title |
| `subtitle` | Plot subtitle |
| `caption` | Plot caption |
| `footnote` | Plot footnote |
| `weight` | Column for marker size weighting (larger values = larger markers) |

::: {.callout-note}
## Constructor Arguments vs Fluent API

Every styling argument (like `row_bold`, `marker_color`) has an equivalent fluent method (`set_row_style(bold = ...)`, `set_marker_style(color = ...)`). Both produce identical results. See [Customizing Plots](../guide/fluent-api.qmd) for details.
:::

### Row Styling Arguments

| Argument | Description |
|----------|-------------|
| `row_type` | Column for row type: `"header"`, `"data"`, `"summary"`, `"spacer"` |
| `row_bold` | Column for bold styling (logical) |
| `row_italic` | Column for italic styling (logical) |
| `row_indent` | Column for indentation level (integer) |
| `row_color` | Column for text color (hex string) |
| `row_bg` | Column for background color (hex string) |
| `row_badge` | Column for badge text |

::: {.callout-tip}
## Semantic Styling Shortcuts

For quick conditional formatting, use these semantic options that automatically use theme colors:

| Argument | Effect |
|----------|--------|
| `row_emphasis` | Bold text, darker color (for key results) |
| `row_muted` | Lighter color, reduced prominence (for secondary data) |
| `row_accent` | Theme accent color (for highlighted findings) |

These adapt automatically when you switch themes.
:::

### Marker Styling Arguments

| Argument | Description |
|----------|-------------|
| `marker_color` | Column for marker fill color (hex string) |
| `marker_shape` | Column for shapes: `"square"`, `"circle"`, `"diamond"`, `"triangle"` |
| `marker_opacity` | Column for opacity values (0-1) |
| `marker_size` | Column for size multiplier (1 = default) |
| `weight` | Column for weight-based sizing (alternative to `marker_size`) |

::: {.callout-note}
## Weight vs Size

`weight` is typically used for meta-analysis study weights - larger weights produce larger markers proportionally. `marker_size` is for explicit size control via a multiplier column.
:::

### Split Plot Arguments

| Argument | Description |
|----------|-------------|
| `split_by` | Column name(s) to split data into separate plots with sidebar navigation |
| `shared_axis` | When `split_by` is used, `TRUE` to use the same axis range across all plots |

### Visual Override Arguments

These override theme settings for quick adjustments:

| Argument | Description |
|----------|-------------|
| `axis_range` | `c(min, max)` to override axis limits |
| `axis_ticks` | Numeric vector of explicit tick positions |
| `axis_gridlines` | `TRUE`/`FALSE` to show/hide gridlines |
| `plot_position` | `"left"` or `"right"` |
| `row_height` | Row height in pixels |

::: {.callout-tip}
## Equivalence with Theme Modifiers

Direct arguments are shortcuts for theme modifications:
```r
# These are equivalent:
forest_plot(data, ..., row_height = 32)
forest_plot(data, ..., theme = web_theme_default() |> set_spacing(row_height = 32))
```
:::

### Layout Arguments

| Argument | Description |
|----------|-------------|
| `width_mode` | `"natural"` (centered at natural width) or `"fill"` (scale to fill container) |
| `height_preset` | `"full"` (natural height), `"small"` (300px), `"medium"` (500px), `"large"` (900px), or `"container"` (fill parent) |
| `width` | Widget width |
| `height` | Widget height |
| `elementId` | HTML element ID |

## Value

An htmlwidget object that can be:

- Displayed in RStudio Viewer
- Rendered in R Markdown / Quarto documents
- Used in Shiny applications
- Saved to files with `save_plot()`
- Further modified with `set_*()` functions

## Examples

### Basic Usage

```{r}
data <- data.frame(
  study = c("Study A", "Study B", "Study C"),
  hr = c(0.72, 0.85, 0.91),
  lower = c(0.55, 0.70, 0.75),
  upper = c(0.95, 1.03, 1.10)
)

forest_plot(data,
  point = "hr",
  lower = "lower",
  upper = "upper",
  label = "study",
  null_value = 1,
  scale = "log"
)
```

### With Columns and Theme

```{r}
data <- data.frame(
  study = c("Trial A", "Trial B", "Trial C"),
  hr = c(0.72, 0.85, 0.68),
  lower = c(0.55, 0.70, 0.52),
  upper = c(0.95, 1.03, 0.89),
  n = c(245, 180, 320),
  events = c("89/245", "62/180", "98/320")
)

forest_plot(data,
  point = "hr", lower = "lower", upper = "upper",
  label = "study",
  columns = list(
    col_numeric("n", "N"),
    col_text("events", "Events"),
    col_interval("HR (95% CI)")
  ),
  null_value = 1,
  scale = "log",
  theme = web_theme_lancet(),
  title = "Treatment Effect by Trial"
)
```

### Row Styling with Summary Diamond

```{r}
library(dplyr)

styled <- tibble(
  label = c("Primary Endpoint", "  Outcome A", "  Outcome B", "Summary"),
  hr = c(NA, 0.72, 0.85, 0.78),
  lower = c(NA, 0.55, 0.70, 0.65),
  upper = c(NA, 0.95, 1.03, 0.93),
  rtype = c("header", "data", "data", "summary"),
  rbold = c(TRUE, FALSE, FALSE, TRUE)
)

forest_plot(styled,
  point = "hr", lower = "lower", upper = "upper",
  label = "label",
  row_type = "rtype",
  row_bold = "rbold",
  null_value = 1, scale = "log"
)
```

::: {.callout-warning}
## Row Types and NA Values

Rows with `row_type = "header"` or `"spacer"` should have `NA` for point, lower, and upper. The plot will display them as label-only rows without intervals.
:::

## See Also

- [webtable()](webtable.qmd) for table-only widgets
- [web_spec()](web_spec.qmd) for creating specifications programmatically
- [Themes](themes.qmd) for customizing appearance
- [Columns](columns.qmd) for column types
- [Customizing Plots](../guide/fluent-api.qmd) for the fluent API pattern
